"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[4866],{31940:(y,I,i)=>{i.d(I,{f:()=>F});var g=i(27691),r=i(41483),p=i(47947),C=i(25814),d=i(72683),T=i(45122),v=i(25744),f=i(12007),k=i(15911),S=i(22922),l=i(53107);let m=(()=>{class _{parse(h,n){const E=n.payload,e=Object.assign(new k.c,E);return new S.hT(n.statusCode,void 0,e)}static#e=this.\u0275fac=function(n){return new(n||_)};static#t=this.\u0275prov=l.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})();var R=i(70210),O=i(9843);let F=(()=>{class _{constructor(h,n,E){this.requestService=h,this.rdbService=n,this.halService=E,this.linkPath="registrations",this.searchByTokenPath="/search/findByToken?token="}getRegistrationEndpoint(){return this.halService.getEndpoint(this.linkPath)}getTokenSearchEndpoint(h){return this.halService.getEndpoint(this.linkPath).pipe((0,r.p)(n=>(0,d.hj)(n)),(0,p.T)(n=>`${n}${this.searchByTokenPath}${h}`))}registerEmail(h,n=null,E){const e=new k.c;e.email=h;const M=this.requestService.generateRequestId(),A=this.getRegistrationEndpoint(),P=Object.create({});let b=new g.Lr;return n&&(b=b.append("x-recaptcha-token",n)),P.headers=b,(0,d.a4)(E)&&(P.params=E?new g.Nl({fromString:"accountRequestType="+E}):new g.Nl),A.pipe((0,C.I)(D=>(0,d.a4)(D)),(0,p.T)(D=>{const G=new R.Qf(M,D,e,P);this.requestService.send(G)})).subscribe(),this.rdbService.buildFromRequestUUID(M).pipe((0,f.qD)())}searchByToken(h){const n=this.requestService.generateRequestId(),E=this.getTokenSearchEndpoint(h).pipe((0,C.I)(e=>(0,d.a4)(e)));return E.subscribe(e=>{const M=new R.IP(n,e);Object.assign(M,{getResponseParser:()=>m}),this.requestService.send(M,!0)}),this.rdbService.buildSingle(E).pipe((0,p.T)(e=>e.hasSucceeded&&(0,d.a4)(e.payload)?Object.assign(e,{payload:Object.assign(e.payload,{token:h})}):e))}static#e=this.\u0275fac=function(n){return new(n||_)(l.KVO(O.B),l.KVO(T.o),l.KVO(v.Y))};static#t=this.\u0275prov=l.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},24866:(y,I,i)=>{i.r(I),i.d(I,{RegisterEmailFormComponent:()=>W,TYPE_REQUEST_FORGOT:()=>L,TYPE_REQUEST_REGISTER:()=>U});var g=i(54460),r=i(10936),p=i(69685),C=i(71217),d=i(76627),T=i(22867),v=i(63016),f=i(47947),k=i(37610),S=i(30593),l=i(84195),m=i(31940),R=i(66040),O=i(63276),F=i(12007),_=i(96858),j=i(16700),h=i(72683),n=i(99882),E=i(79224),e=i(53107),M=i(95968),A=i(4496);const P=o=>({domains:o});function b(o,u){if(1&o&&(e.j41(0,"p"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Lme(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".info.maildomain")," ",t.validMailDomains.join(", ")," ")}}function D(o,u){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,1,t.MESSAGE_PREFIX+".email.error.required")," ")}}function G(o,u){if(1&o&&(e.qex(0),e.EFF(1),e.nI1(2,"translate"),e.bVm()),2&o){const t=e.XpG(3);e.R7$(),e.SpI(" ",e.i5U(2,1,t.MESSAGE_PREFIX+".email.error.not-valid-domain",e.eq3(4,P,t.validMailDomains.join(", ")))," ")}}function B(o,u){if(1&o&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.DNE(3,G,3,6,"ng-container",2),e.k0s()),2&o){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".email.error.not-email-form")," "),e.R7$(2),e.Y8G("ngIf",t.validMailDomains.length>0)}}function x(o,u){if(1&o&&(e.j41(0,"div",13),e.DNE(1,D,3,3,"span",2)(2,B,4,4,"span",2),e.k0s()),2&o){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.email.errors&&t.email.errors.required),e.R7$(),e.Y8G("ngIf",t.email.errors&&(t.email.errors.pattern&&t.typeRequest===t.TYPE_REQUEST_REGISTER||t.email.errors.email))}}function X(o,u){if(1&o){const t=e.RV6();e.j41(0,"ds-alert",14),e.nrm(1,"p",15),e.nI1(2,"translate"),e.j41(3,"p",16)(4,"a",17),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.klaroService.showSettings())}),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()}if(2&o){const t=e.XpG();e.Y8G("type",t.AlertTypeEnum.Warning),e.R7$(),e.Y8G("innerHTML",e.bMT(2,3,t.MESSAGE_PREFIX+".google-recaptcha.must-accept-cookies"),e.npT),e.R7$(4),e.JRh(e.bMT(6,5,t.MESSAGE_PREFIX+".google-recaptcha.open-cookie-settings"))}}function $(o,u){if(1&o){const t=e.RV6();e.j41(0,"div",18)(1,"ds-google-recaptcha",19),e.nI1(2,"async"),e.bIt("executeRecaptcha",function(a){e.eBV(t);const c=e.XpG();return e.Njj(c.register(a))})("checkboxChecked",function(a){e.eBV(t);const c=e.XpG();return e.Njj(c.onCheckboxChecked(a))})("showNotification",function(a){e.eBV(t);const c=e.XpG();return e.Njj(c.showNotification(a))}),e.k0s()()}if(2&o){const t=e.XpG();e.R7$(),e.Y8G("captchaMode",e.bMT(2,1,t.googleRecaptchaService.captchaMode()))}}function N(o,u){if(1&o){const t=e.RV6();e.qex(0),e.j41(1,"button",20),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.register())}),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.bVm()}if(2&o){const t=e.XpG();e.R7$(),e.Y8G("disabled",t.form.invalid||t.registrationVerification&&!t.isRecaptchaCookieAccepted()||t.disableUntilChecked),e.R7$(),e.SpI(" ",e.bMT(3,2,t.MESSAGE_PREFIX+".submit")," ")}}function K(o,u){if(1&o){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.executeRecaptcha())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}if(2&o){const t=e.XpG();e.Y8G("disabled",t.form.invalid),e.R7$(),e.SpI(" ",e.bMT(2,2,t.MESSAGE_PREFIX+".submit")," ")}}const L="forgot",U="register";let W=(()=>{class o{captchaVersion(){return this.googleRecaptchaService.captchaVersion()}captchaMode(){return this.googleRecaptchaService.captchaMode()}constructor(t,s,a,c,V,Y,w,z,Q,Z,H){this.epersonRegistrationService=t,this.notificationService=s,this.translateService=a,this.router=c,this.formBuilder=V,this.configService=Y,this.googleRecaptchaService=w,this.cookieService=z,this.klaroService=Q,this.changeDetectorRef=Z,this.notificationsService=H,this.typeRequest=null,this.AlertTypeEnum=j.v,this.registrationVerification=!1,this.checkboxCheckedSubject$=new C.t(!1),this.disableUntilChecked=!0,this.TYPE_REQUEST_REGISTER=U,this.subscriptions=[]}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}ngOnInit(){const t=[r.k0.required,r.k0.email,r.k0.pattern("^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$")];this.form=this.formBuilder.group({email:new r.hs("",{validators:t})}),this.validMailDomains=[],this.typeRequest===U&&this.subscriptions.push(this.configService.findByPropertyName("authentication-password.domain.valid").pipe((0,F.Hz)()).subscribe(s=>{this.validMailDomains=s.values;for(const a of s.values)0!==this.validMailDomains.length&&(this.form.get("email").setValidators([...t,r.k0.pattern(this.validMailDomains.map(c=>"(^.*"+c.replace(new RegExp("\\.","g"),"\\.")+"$)").join("|"))]),this.form.updateValueAndValidity());this.changeDetectorRef.detectChanges()})),this.subscriptions.push(this.configService.findByPropertyName("registration.verification.enabled").pipe((0,F.ak)(),(0,f.T)(s=>"true"===s?.values[0].toLowerCase())).subscribe(s=>{this.registrationVerification=s})),this.subscriptions.push(this.disableUntilCheckedFcn().subscribe(s=>{this.disableUntilChecked=s,this.changeDetectorRef.detectChanges()}))}executeRecaptcha(){this.googleRecaptchaService.executeRecaptcha()}register(t){this.form.invalid||(this.registrationVerification?this.subscriptions.push((0,d.z)([this.captchaVersion(),this.captchaMode()]).pipe((0,T.n)(([s,a])=>"v3"===s?this.googleRecaptchaService.getRecaptchaToken("register_email"):"v2"===s&&"checkbox"===a?(0,v.of)(this.googleRecaptchaService.getRecaptchaTokenResponse()):"v2"===s&&"invisible"===a?(0,v.of)(t):(console.error(`Invalid reCaptcha configuration: version = ${s}, mode = ${a}`),void this.showNotification("error"))),(0,k.s)(1)).subscribe(s=>{(0,h.hj)(s)?this.registration(s):(console.error("reCaptcha error"),this.showNotification("error"))})):this.registration())}registration(t=null){const s=this.epersonRegistrationService.registerEmail(this.email.value,t||null,this.typeRequest);this.subscriptions.push(s.subscribe(a=>{a.hasSucceeded?(this.notificationService.success(this.translateService.get(`${this.MESSAGE_PREFIX}.success.head`),this.translateService.get(`${this.MESSAGE_PREFIX}.success.content`,{email:this.email.value})),this.router.navigate(["/home"])):this.notificationService.error(this.translateService.get(`${this.MESSAGE_PREFIX}.error.head`),422===a.statusCode?this.translateService.get(`${this.MESSAGE_PREFIX}.error.maildomain`,{domains:this.validMailDomains.join(", ")}):this.translateService.get(`${this.MESSAGE_PREFIX}.error.content`,{email:this.email.value}))}))}isRecaptchaCookieAccepted(){const t=this.cookieService.get("klaro-anonymous");return!!(0,h.hj)(t)&&t[R.BA]}disableUntilCheckedFcn(){const t=this.checkboxCheckedSubject$.asObservable();return(0,d.z)([this.captchaVersion(),this.captchaMode(),t]).pipe((0,T.n)(([s,a,c])=>(0,v.of)("v2"===s&&"checkbox"===a&&!c)),(0,S.Z)(!0))}get email(){return this.form.get("email")}onCheckboxChecked(t){this.checkboxCheckedSubject$.next(t)}showNotification(t){const s=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.title"),a=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.message.error"),c=this.translateService.get(this.MESSAGE_PREFIX+".google-recaptcha.notification.message.expired");switch(t){case"expired":this.notificationsService.warning(s,c);break;case"error":this.notificationsService.error(s,a);break;default:console.warn(`Unimplemented notification '${t}' from reCaptcha service`)}}static#e=this.\u0275fac=function(s){return new(s||o)(e.rXU(m.f),e.rXU(E.I),e.rXU(p.c$),e.rXU(M.Ix),e.rXU(r.ze),e.rXU(l.ConfigurationDataService),e.rXU(R.wq),e.rXU(O.O),e.rXU(A.$,8),e.rXU(e.gRc),e.rXU(E.I))};static#t=this.\u0275cmp=e.VBU({type:o,selectors:[["ds-base-register-email-form"]],inputs:{MESSAGE_PREFIX:"MESSAGE_PREFIX",typeRequest:"typeRequest"},standalone:!0,features:[e.aNF],decls:28,vars:28,consts:[["v2Invisible",""],[1,"container"],[4,"ngIf"],[3,"formGroup"],[1,"form-group"],[1,"row"],[1,"col-12"],["for","email",1,"font-weight-bold"],["type","text","id","email","formControlName","email",3,"className"],["class","invalid-feedback show-feedback",4,"ngIf"],[3,"type",4,"ngIf"],["class","my-3",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"invalid-feedback","show-feedback"],[3,"type"],[1,"m-0",3,"innerHTML"],[1,"m-0"],["href","javascript:void(0);",3,"click"],[1,"my-3"],[3,"executeRecaptcha","checkboxChecked","showNotification","captchaMode"],[1,"btn","btn-primary",3,"click","disabled"]],template:function(s,a){if(1&s&&(e.j41(0,"div",1)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"p"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,b,3,4,"p",2),e.j41(8,"form",3)(9,"div",4)(10,"div",5)(11,"div",6)(12,"label",7),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.nrm(15,"input",8),e.DNE(16,x,3,2,"div",9),e.k0s(),e.j41(17,"div",6),e.EFF(18),e.nI1(19,"translate"),e.k0s()()(),e.DNE(20,X,7,7,"ds-alert",10)(21,$,3,3,"div",11),e.nI1(22,"async"),e.DNE(23,N,4,4,"ng-container",12),e.nI1(24,"async"),e.nI1(25,"async"),e.DNE(26,K,3,4,"ng-template",null,0,e.C5r),e.k0s()()),2&s){const c=e.sdS(27);e.R7$(2),e.JRh(e.bMT(3,14,a.MESSAGE_PREFIX+".header")),e.R7$(3),e.JRh(e.bMT(6,16,a.MESSAGE_PREFIX+".info")),e.R7$(2),e.Y8G("ngIf",0!==a.validMailDomains.length&&a.typeRequest===a.TYPE_REQUEST_REGISTER),e.R7$(),e.HbH("ng-invalid"),e.Y8G("formGroup",a.form),e.R7$(5),e.JRh(e.bMT(14,18,a.MESSAGE_PREFIX+".email")),e.R7$(2),e.Y8G("className",a.email.invalid&&(a.email.dirty||a.email.touched)?"form-control is-invalid":"form-control"),e.R7$(),e.Y8G("ngIf",a.email.invalid&&(a.email.dirty||a.email.touched)),e.R7$(2),e.SpI(" ",e.bMT(19,20,a.MESSAGE_PREFIX+".email.hint")," "),e.R7$(2),e.Y8G("ngIf",a.registrationVerification&&!a.isRecaptchaCookieAccepted()),e.R7$(),e.Y8G("ngIf",a.isRecaptchaCookieAccepted()&&"v2"===e.bMT(22,22,a.googleRecaptchaService.captchaVersion())),e.R7$(2),e.Y8G("ngIf",!a.registrationVerification||"v2"!==e.bMT(24,24,a.googleRecaptchaService.captchaVersion())&&"invisible"===e.bMT(25,26,a.googleRecaptchaService.captchaMode()))("ngIfElse",c)}},dependencies:[g.bT,r.YN,r.qT,r.me,r.BC,r.cb,r.X1,r.j4,r.JD,_.C,n.U,g.Jj,p.h,p.D9],encapsulation:2})}return o})()},99882:(y,I,i)=>{i.d(I,{U:()=>v});var g=i(54460),r=i(53107),p=i(66190),C=i(84195),d=i(12007),T=i(72683);let v=(()=>{class f{constructor(S,l){this._window=S,this.configService=l,this.executeRecaptcha=new r.bkB,this.checkboxChecked=new r.bkB,this.showNotification=new r.bkB,this.dataCallbackFcn=m=>{switch(this.captchaMode){case"invisible":this.executeRecaptcha.emit(m);break;case"checkbox":this.checkboxChecked.emit((0,T.hj)(m));break;default:console.error(`Invalid reCaptcha mode '${this.captchaMode}`),this.showNotification.emit("error")}},this.expiredCallbackFcn=()=>{this.checkboxChecked.emit(!1),this.showNotification.emit("expired")},this.errorCallbackFcn=()=>{this.showNotification.emit("error")}}ngOnInit(){this.recaptchaKey$=this.configService.findByPropertyName("google.recaptcha.key.site").pipe((0,d.ak)()),this._window.nativeWindow.dataCallback=this.dataCallbackFcn,this._window.nativeWindow.expiredCallback=this.expiredCallbackFcn,this._window.nativeWindow.errorCallback=this.errorCallbackFcn}static#e=this.\u0275fac=function(l){return new(l||f)(r.rXU(p.lc),r.rXU(C.ConfigurationDataService))};static#t=this.\u0275cmp=r.VBU({type:f,selectors:[["ds-google-recaptcha"]],inputs:{captchaMode:"captchaMode"},outputs:{executeRecaptcha:"executeRecaptcha",checkboxChecked:"checkboxChecked",showNotification:"showNotification"},standalone:!0,features:[r.aNF],decls:2,vars:7,consts:[[1,"g-recaptcha"]],template:function(l,m){if(1&l&&(r.nrm(0,"div",0),r.nI1(1,"async")),2&l){let R;r.BMQ("data-callback","dataCallback")("data-expired-callback","expiredCallback")("data-error-callback","errorCallback")("data-sitekey",null==(R=r.bMT(1,5,m.recaptchaKey$))?null:R.values[0])("data-size","invisible"===m.captchaMode?"invisible":null)}},dependencies:[g.Jj]})}return f})()}}]);