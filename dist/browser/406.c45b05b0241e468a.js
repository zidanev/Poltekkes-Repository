"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[406],{50406:(Z,$,o)=>{o.r($),o.d($,{ROUTES:()=>Bn,ValidateEmailErrorStateMatcher:()=>Se});var I=o(89593),C=o(32588),j=o(29443),T=o(53527),_=o(57079),b=o(69685),y=o(71217),Y=o(66645),u=o(47947),ne=o(58526),B=o(82219),g=o(54460),v=o(2155),e=o(53107);class ie{constructor(){this.change=new e.bkB,this.instances={},this.DEFAULT_ID="DEFAULT_PAGINATION_ID"}defaultId(){return this.DEFAULT_ID}register(r){return null==r.id&&(r.id=this.DEFAULT_ID),this.instances[r.id]?this.updateInstance(r):(this.instances[r.id]=r,!0)}updateInstance(r){let t=!1;for(let n in this.instances[r.id])r[n]!==this.instances[r.id][n]&&(this.instances[r.id][n]=r[n],t=!0);return t}getCurrentPage(r){return this.instances[r]?this.instances[r].currentPage:1}setCurrentPage(r,t){if(this.instances[r]){let n=this.instances[r];t<=Math.ceil(n.totalItems/n.itemsPerPage)&&1<=t&&(this.instances[r].currentPage=t,this.change.emit(r))}}setTotalItems(r,t){this.instances[r]&&0<=t&&(this.instances[r].totalItems=t,this.change.emit(r))}setItemsPerPage(r,t){this.instances[r]&&(this.instances[r].itemsPerPage=t,this.change.emit(r))}getInstance(r=this.DEFAULT_ID){return this.instances[r]?this.clone(this.instances[r]):{}}clone(r){var t={};for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n]);return t}}const $e=Number.MAX_SAFE_INTEGER;let je=(()=>{class a{constructor(t){this.service=t,this.state={}}transform(t,n){if(!(t instanceof Array)){let S=n.id||this.service.defaultId();return this.state[S]?this.state[S].slice:t}let m,h,i=n.totalItems&&n.totalItems!==t.length,s=this.createInstance(t,n),l=s.id,c=s.itemsPerPage,x=this.service.register(s);if(!i&&t instanceof Array){if(c=+c||$e,m=(s.currentPage-1)*c,h=m+c,this.stateIsIdentical(l,t,m,h))return this.state[l].slice;{let G=t.slice(m,h);return this.saveState(l,t,G,m,h),this.service.change.emit(l),G}}return x&&this.service.change.emit(l),this.saveState(l,t,t,m,h),t}createInstance(t,n){return this.checkConfig(n),{id:null!=n.id?n.id:this.service.defaultId(),itemsPerPage:+n.itemsPerPage||0,currentPage:+n.currentPage||1,totalItems:+n.totalItems||t.length}}checkConfig(t){const i=["itemsPerPage","currentPage"].filter(s=>!(s in t));if(0<i.length)throw new Error(`PaginatePipe: Argument is missing the following required properties: ${i.join(", ")}`)}saveState(t,n,i,s,l){this.state[t]={collection:n,size:n.length,slice:i,start:s,end:l}}stateIsIdentical(t,n,i,s){let l=this.state[t];return!(!l||l.size!==n.length||l.start!==i||l.end!==s)&&l.slice.every((h,c)=>h===n[i+c])}}return a.\u0275fac=function(t){return new(t||a)(e.rXU(ie,16))},a.\u0275pipe=e.EJ8({name:"paginate",type:a,pure:!1}),a})(),Ne=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({providers:[ie],imports:[[g.MD]]}),a})();var A=o(5338),ae=o(36423),De=o(3631),Me=o(82506),p=o(72683),Be=o(47637),Le=o(62705),X=o(51661),k=o(67899),we=o(51206),Ae=o(63226),Xe=o(75911);const Oe=a=>({number:a}),se=a=>({repeatable:!0,listId:a}),Ve=(a,r,t)=>({itemsPerPage:a,currentPage:r,totalItems:t});function Ue(a,r){1&a&&e.nrm(0,"span",12)}function Ye(a,r){1&a&&e.nrm(0,"span",13)}function ze(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",6),e.bIt("click",function(){e.eBV(t),e.XpG();const i=e.sdS(1);return e.Njj(i.toggle("browse"))}),e.j41(1,"button",7),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.preventDefault())}),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",8)(5,"div",9),e.DNE(6,Ue,1,0,"span",10)(7,Ye,1,0,"span",11),e.k0s()()()}if(2&a){e.XpG();const t=e.sdS(1);e.R7$(),e.BMQ("aria-expanded",t.isExpanded("browse")),e.R7$(),e.SpI(" ",e.bMT(3,4,"admin.access-control.bulk-access-browse.header")," "),e.R7$(4),e.Y8G("ngIf",t.isExpanded("browse")),e.R7$(),e.Y8G("ngIf",!t.isExpanded("browse"))}}function Je(a,r){if(1&a&&(e.j41(0,"div",20),e.nrm(1,"ds-search",21),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.Y8G("configuration","administrativeBulkAccess")("selectable",!0)("selectionConfig",e.eq3(4,se,t.listId))("showThumbnails",!1)}}function We(a,r){if(1&a&&(e.j41(0,"li",26),e.nI1(1,"dsBrowserOnly"),e.nrm(2,"ds-selectable-list-item-control",27)(3,"ds-listable-object-component-loader",28),e.k0s()),2&a){const t=r.$implicit,n=r.index,i=e.XpG(4);e.BMQ("data-test",e.bMT(1,9,"list-object")),e.R7$(2),e.Y8G("index",n)("object",t)("selectionConfig",e.eq3(11,se,i.listId)),e.R7$(),e.Y8G("listID",i.listId)("index",n)("object",t)("showThumbnails",!1)("viewMode","list")}}function He(a,r){if(1&a&&(e.j41(0,"ul",24),e.DNE(1,We,4,13,"li",25),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.nI1(6,"paginate"),e.k0s()),2&a){let t;const n=e.XpG(3);e.R7$(),e.Y8G("ngForOf",e.i5U(6,9,null==(t=e.bMT(2,1,n.objectsSelected$))||null==t.payload?null:t.payload.page,e.sMw(12,Ve,e.bMT(3,3,n.paginationOptions$).pageSize,e.bMT(4,5,n.paginationOptions$).currentPage,null==(t=e.bMT(5,7,n.objectsSelected$))||null==t.payload?null:t.payload.page.length)))}}function Qe(a,r){if(1&a){const t=e.RV6();e.j41(0,"ds-pagination",22),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.bIt("prev",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.pagePrev())})("next",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.pageNext())}),e.DNE(4,He,7,16,"ul",23),e.nI1(5,"async"),e.k0s()}if(2&a){let t,n;const i=e.XpG(2);e.Y8G("paginationOptions",e.bMT(1,5,i.paginationOptions$))("collectionSize",null==(t=e.bMT(2,7,i.objectsSelected$))||null==t.payload?null:t.payload.totalElements)("objects",e.bMT(3,9,i.objectsSelected$))("showPaginator",!1),e.R7$(4),e.Y8G("ngIf",null==(n=e.bMT(5,11,i.objectsSelected$))?null:n.hasSucceeded)}}function qe(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",14)(1,"ul",15,1),e.mxI("activeIdChange",function(i){e.eBV(t);const s=e.XpG();return e.DH7(s.activateId,i)||(s.activateId=i),e.Njj(i)}),e.j41(3,"li",16)(4,"a",17),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,Je,2,6,"ng-template",18),e.k0s(),e.j41(8,"li",16)(9,"a",17),e.EFF(10),e.nI1(11,"async"),e.nI1(12,"async"),e.nI1(13,"translate"),e.k0s(),e.DNE(14,Qe,6,13,"ng-template",18),e.k0s()(),e.nrm(15,"div",19),e.k0s()}if(2&a){let t;const n=e.sdS(2),i=e.XpG();e.R7$(),e.R50("activeId",i.activateId),e.R7$(2),e.Y8G("ngbNavItem","search"),e.R7$(2),e.JRh(e.bMT(6,6,"admin.access-control.bulk-access-browse.search.header")),e.R7$(3),e.Y8G("ngbNavItem","selected"),e.R7$(2),e.SpI(" ",e.i5U(13,12,"admin.access-control.bulk-access-browse.selected.header",e.eq3(15,Oe,null!=(t=e.bMT(11,8,i.objectsSelected$))&&null!=t.payload&&t.payload.totalElements?null==(t=e.bMT(12,10,i.objectsSelected$))||null==t.payload?null:t.payload.totalElements:"0"))," "),e.R7$(5),e.Y8G("ngbNavOutlet",n)}}let Ke=(()=>{class a{constructor(t){this.selectableListService=t,this.activateId="search",this.objectsSelected$=new y.t(null),this.paginationOptions$=new y.t(Object.assign(new k.W,{id:"bas",pageSize:5,currentPage:1})),this.subs=[]}ngOnInit(){this.subs.push(this.selectableListService.getSelectableList(this.listId).pipe((0,Y.F)(),(0,u.T)(t=>this.generatePaginatedListBySelectedElements(t))).subscribe(this.objectsSelected$))}pageNext(){this.paginationOptions$.next(Object.assign(new k.W,this.paginationOptions$.value,{currentPage:this.paginationOptions$.value.currentPage+1}))}pagePrev(){this.paginationOptions$.next(Object.assign(new k.W,this.paginationOptions$.value,{currentPage:this.paginationOptions$.value.currentPage-1}))}calculatePageCount(t,n=0){return n<t?1:Math.ceil(n/t)}generatePaginatedListBySelectedElements(t){const n=new ae.Q({elementsPerPage:this.paginationOptions$.value.pageSize,totalElements:t?.selection.length,totalPages:this.calculatePageCount(this.paginationOptions$.value.pageSize,t?.selection.length),currentPage:this.paginationOptions$.value.currentPage});return n.currentPage>n.totalPages&&(n.currentPage=n.totalPages,this.paginationOptions$.next(Object.assign(new k.W,this.paginationOptions$.value,{currentPage:n.currentPage}))),(0,we.SP)((0,A.g)(n,t?.selection||[]))}ngOnDestroy(){this.subs.filter(t=>(0,p.a4)(t)).forEach(t=>t.unsubscribe()),this.selectableListService.deselectAll(this.listId)}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(B.K))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-bulk-access-browse"]],inputs:{listId:"listId"},standalone:!0,features:[e.Jv_([{provide:Me.EN,useClass:De.g}]),e.aNF],decls:5,vars:2,consts:[["acc","ngbAccordion"],["nav","ngbNav"],[3,"activeIds"],[3,"id"],["ngbPanelHeader",""],["ngbPanelContent",""],["ngbPanelToggle","","data-test","browse",1,"w-100","d-flex","gap-3","justify-content-between","collapse-toggle",3,"click"],["type","button","aria-controls","bulk-access-browse-panel-content",1,"btn","btn-link","p-0",3,"click"],[1,"text-right","d-flex","gap-2"],[1,"d-flex","my-auto"],["class","fas fa-chevron-up fa-fw",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],[1,"fas","fa-chevron-up","fa-fw"],[1,"fas","fa-chevron-down","fa-fw"],["id","bulk-access-browse-panel-content"],["ngbNav","",1,"nav-pills",3,"activeIdChange","activeId"],["role","presentation",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[1,"mt-5",3,"ngbNavOutlet"],[1,"mx-n3"],[3,"configuration","selectable","selectionConfig","showThumbnails"],[3,"prev","next","paginationOptions","collectionSize","objects","showPaginator"],["class","list-unstyled ml-4",4,"ngIf"],[1,"list-unstyled","ml-4"],["class","mt-4 mb-4 d-flex",4,"ngFor","ngForOf"],[1,"mt-4","mb-4","d-flex"],[3,"index","object","selectionConfig"],[3,"listID","index","object","showThumbnails","viewMode"]],template:function(n,i){1&n&&(e.j41(0,"ngb-accordion",2,0)(2,"ngb-panel",3),e.DNE(3,ze,8,6,"ng-template",4)(4,qe,16,17,"ng-template",5),e.k0s()()),2&n&&(e.Y8G("activeIds","browse"),e.R7$(2),e.Y8G("id","browse"))},dependencies:[X.e,g.Jj,v._f,v.W1,v.CT,v.t3,v.Xc,b.h,b.D9,g.bT,v.Pv,v.Um,v.X9,v.sy,v.Ri,v.m_,Ae.N,Xe.L,g.Sq,Ne,je,Le.Y,Be.v]})}return a})();var Ze=o(93068);const et=["dsAccessControlForm"];function tt(a,r){1&a&&e.nrm(0,"span",12)}function nt(a,r){1&a&&e.nrm(0,"span",13)}function it(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",6),e.bIt("click",function(){e.eBV(t),e.XpG();const i=e.sdS(1);return e.Njj(i.toggle("settings"))}),e.j41(1,"button",7),e.bIt("click",function(i){return e.eBV(t),e.Njj(i.preventDefault())}),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",8)(5,"div",9),e.DNE(6,tt,1,0,"span",10)(7,nt,1,0,"span",11),e.k0s()()()}if(2&a){e.XpG();const t=e.sdS(1);e.R7$(),e.BMQ("aria-expanded",t.isExpanded("settings")),e.R7$(),e.SpI(" ",e.bMT(3,4,"admin.access-control.bulk-access-settings.header")," "),e.R7$(4),e.Y8G("ngIf",t.isExpanded("settings")),e.R7$(),e.Y8G("ngIf",!t.isExpanded("settings"))}}function at(a,r){1&a&&e.nrm(0,"ds-access-control-form-container",14,1),2&a&&e.Y8G("showSubmit",!1)}let st=(()=>{class a{getValue(){return this.controlForm.getFormValue()}reset(){this.controlForm.reset()}static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-bulk-access-settings"]],viewQuery:function(n,i){if(1&n&&e.GBs(et,5),2&n){let s;e.mGM(s=e.lsd())&&(i.controlForm=s.first)}},exportAs:["dsBulkSettings"],standalone:!0,features:[e.aNF],decls:5,vars:2,consts:[["acc","ngbAccordion"],["dsAccessControlForm",""],[3,"activeIds"],[3,"id"],["ngbPanelHeader",""],["ngbPanelContent",""],["ngbPanelToggle","","data-test","settings",1,"w-100","d-flex","gap-3","justify-content-between","collapse-toggle",3,"click"],["type","button","aria-controls","bulk-access-settings-panel-content",1,"btn","btn-link","p-0",3,"click"],[1,"text-right","d-flex","gap-2"],[1,"d-flex","my-auto"],["class","fas fa-chevron-up fa-fw",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],[1,"fas","fa-chevron-up","fa-fw"],[1,"fas","fa-chevron-down","fa-fw"],["id","bulk-access-settings-panel-content",3,"showSubmit"]],template:function(n,i){1&n&&(e.j41(0,"ngb-accordion",2,0)(2,"ngb-panel",3),e.DNE(3,it,8,6,"ng-template",4)(4,at,2,1,"ng-template",5),e.k0s()()),2&n&&(e.Y8G("activeIds","settings"),e.R7$(2),e.Y8G("id","settings"))},dependencies:[v._f,v.W1,v.CT,v.t3,v.Xc,b.h,b.D9,g.bT,Ze.o]})}return a})();const rt=["dsBulkSettings"];let ot=(()=>{class a{constructor(t,n){this.bulkAccessControlService=t,this.selectableListService=n,this.listId="bulk-access-list",this.objectsSelected$=new y.t([]),this.subs=[]}ngOnInit(){this.subs.push(this.selectableListService.getSelectableList(this.listId).pipe((0,Y.F)(),(0,u.T)(t=>this.generateIdListBySelectedElements(t))).subscribe(this.objectsSelected$))}canExport(){return this.objectsSelected$.value?.length>0}reset(){this.settings.reset()}submit(){const t=this.settings.getValue(),n=t.bitstream,i=t.item,{file:s}=this.bulkAccessControlService.createPayloadFile({bitstreamAccess:n,itemAccess:i,state:t.state});this.bulkAccessControlService.executeScript(this.objectsSelected$.value||[],s).subscribe()}generateIdListBySelectedElements(t){return t?.selection?.map(n=>n.indexableObject.uuid)}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(ne.r),e.rXU(B.K))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-bulk-access"]],viewQuery:function(n,i){if(1&n&&e.GBs(rt,5),2&n){let s;e.mGM(s=e.lsd())&&(i.settings=s.first)}},standalone:!0,features:[e.aNF],decls:16,vars:11,consts:[["dsBulkSettings",""],[1,"container"],[3,"listId"],[1,"clearfix","mb-3"],[1,"d-flex","justify-content-end"],[1,"btn","btn-outline-primary","mr-3",3,"click"],[1,"btn","btn-primary",3,"click","disabled"]],template:function(n,i){if(1&n){const s=e.RV6();e.j41(0,"div",1)(1,"h1"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"ds-bulk-access-browse",2)(5,"div",3)(6,"ds-bulk-access-settings",null,0)(8,"hr"),e.j41(9,"div",4)(10,"button",5),e.bIt("click",function(){return e.eBV(s),e.Njj(i.reset())}),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"button",6),e.bIt("click",function(){return e.eBV(s),e.Njj(i.submit())}),e.EFF(14),e.nI1(15,"translate"),e.k0s()()()}2&n&&(e.R7$(2),e.JRh(e.bMT(3,5,"admin.access-control.bulk-access.title")),e.R7$(2),e.Y8G("listId",i.listId),e.R7$(7),e.SpI(" ",e.bMT(12,7,"access-control-cancel")," "),e.R7$(2),e.Y8G("disabled",!i.canExport()),e.R7$(),e.SpI(" ",e.bMT(15,9,"access-control-execute")," "))},dependencies:[b.h,b.D9,st,Ke]})}return a})();var f=o(10936),R=o(95968),N=o(76627),P=o(22867),F=o(37610),O=o(83116),z=o(77304),D=o(36556),J=o(9843),V=o(31363),lt=o(83383),W=o(95438),d=o(12007),ee=o(14922),te=o(21548),U=o(79224);const ct=a=>({"table-primary":a}),re=a=>({name:a});function pt(a,r){1&a&&e.nrm(0,"ds-loading")}function ut(a,r){if(1&a){const t=e.RV6();e.j41(0,"button",33),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.deleteEPerson(i.eperson))}),e.nrm(2,"i",34),e.k0s()}if(2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.FS9("title",e.i5U(1,1,n.labelPrefix+"table.edit.buttons.remove",e.eq3(4,re,n.dsoNameService.getName(t.eperson))))}}function gt(a,r){if(1&a&&(e.j41(0,"tr",28),e.nI1(1,"async"),e.j41(2,"td"),e.EFF(3),e.k0s(),e.j41(4,"td"),e.EFF(5),e.k0s(),e.j41(6,"td"),e.EFF(7),e.k0s(),e.j41(8,"td")(9,"div",29)(10,"button",30),e.nI1(11,"translate"),e.nrm(12,"i",31),e.k0s(),e.DNE(13,ut,3,6,"button",32),e.k0s()()()),2&a){const t=r.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(12,ct,e.bMT(1,7,n.isActive(t.eperson)))),e.R7$(3),e.JRh(t.eperson.id),e.R7$(2),e.JRh(n.dsoNameService.getName(t.eperson)),e.R7$(2),e.JRh(t.eperson.email),e.R7$(3),e.FS9("title",e.i5U(11,9,n.labelPrefix+"table.edit.buttons.edit",e.eq3(14,re,n.dsoNameService.getName(t.eperson)))),e.Y8G("routerLink",n.getEditEPeoplePage(t.eperson.id)),e.R7$(3),e.Y8G("ngIf",t.ableToDelete)}}function dt(a,r){if(1&a&&(e.j41(0,"ds-pagination",23),e.nI1(1,"async"),e.j41(2,"div",24)(3,"table",25)(4,"thead")(5,"tr")(6,"th",26),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",26),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",26),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,gt,14,16,"tr",27),e.nI1(20,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,9,i.pageInfoState$))?null:t.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,11,i.labelPrefix+"table.id")),e.R7$(3),e.JRh(e.bMT(11,13,i.labelPrefix+"table.name")),e.R7$(3),e.JRh(e.bMT(14,15,i.labelPrefix+"table.email")),e.R7$(3),e.JRh(e.bMT(17,17,i.labelPrefix+"table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(20,19,i.ePeopleDto$))?null:n.page)}}function mt(a,r){if(1&a&&(e.j41(0,"div",35),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.labelPrefix+"no-items")," ")}}let ht=(()=>{class a{constructor(t,n,i,s,l,m,h,c,x,S){this.epersonService=t,this.translateService=n,this.notificationsService=i,this.authorizationService=s,this.formBuilder=l,this.router=m,this.modalService=h,this.paginationService=c,this.requestService=x,this.dsoNameService=S,this.labelPrefix="admin.access-control.epeople.",this.ePeople$=new y.t((0,A.g)(new ae.Q,[])),this.ePeopleDto$=new y.t({}),this.pageInfoState$=new y.t(void 0),this.searching$=new y.t(!1),this.config=Object.assign(new k.W,{id:"elp",pageSize:5,currentPage:1}),this.subs=[],this.currentSearchQuery="",this.currentSearchScope="metadata",this.searchForm=this.formBuilder.group({scope:"metadata",query:""})}ngOnInit(){this.initialisePage()}initialisePage(){this.searching$.next(!0),this.search({scope:this.currentSearchScope,query:this.currentSearchQuery}),this.subs.push(this.ePeople$.pipe((0,P.n)(t=>t.pageInfo.totalElements>0?(0,N.z)(t.page.map(n=>this.authorizationService.isAuthorized(D._.CanDelete,(0,p.a4)(n)?n.self:void 0).pipe((0,u.T)(i=>{const s=new lt.h;return s.ableToDelete=i,s.eperson=n,s})))).pipe((0,u.T)(n=>(0,A.g)(t.pageInfo,n))):[t])).subscribe(t=>{this.searching$.next(!1),this.ePeopleDto$.next(t),this.pageInfoState$.next(t.pageInfo)}))}search(t){this.searching$.next(!0),(0,p.a4)(this.findListOptionsSub)&&this.findListOptionsSub.unsubscribe(),this.findListOptionsSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,P.n)(n=>{const i=t.query,s=t.scope;return null!=i&&this.currentSearchQuery!==i&&(this.router.navigate([(0,_.bL)()],{queryParamsHandling:"merge"}),this.currentSearchQuery=i,this.paginationService.resetPage(this.config.id)),null!=s&&this.currentSearchScope!==s&&(this.router.navigate([(0,_.bL)()],{queryParamsHandling:"merge"}),this.currentSearchScope=s,this.paginationService.resetPage(this.config.id)),this.epersonService.searchByScope(this.currentSearchScope,this.currentSearchQuery,{currentPage:n.currentPage,elementsPerPage:n.pageSize})}),(0,d.v7)()).subscribe(n=>{this.ePeople$.next(n.payload),this.pageInfoState$.next(n.payload.pageInfo)})}isActive(t){return this.getActiveEPerson().pipe((0,u.T)(n=>t===n))}getActiveEPerson(){return this.epersonService.getActiveEPerson()}deleteEPerson(t){if((0,p.a4)(t.id)){const n=this.modalService.open(ee.M);n.componentInstance.name=this.dsoNameService.getName(t),n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,F.s)(1)).subscribe(i=>{i&&(0,p.a4)(t.id)&&this.epersonService.deleteEPerson(t).pipe((0,d.qD)()).subscribe(s=>{s.hasSucceeded?this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:this.dsoNameService.getName(t)})):this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.deleted.success",{id:t.id,statusCode:s.statusCode,errorMessage:s.errorMessage}))})})}}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){this.subs.filter(t=>(0,p.a4)(t)).forEach(t=>t.unsubscribe())}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}getEditEPeoplePage(t){return(0,_.Ax)(t)}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(V.EPersonDataService),e.rXU(b.c$),e.rXU(U.I),e.rXU(z.AuthorizationDataService),e.rXU(f.ze),e.rXU(R.Ix),e.rXU(v.Bq),e.rXU(W.m),e.rXU(J.B),e.rXU(O.f))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-epeople-registry"]],standalone:!0,features:[e.aNF],decls:46,vars:40,consts:[[1,"container"],[1,"epeople-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success","addEPerson-button",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline","ml-1"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"ngSubmit","formGroup"],["name","scope","id","scope","formControlName","scope","aria-label","Search scope",1,"form-control"],["value","metadata"],["value","email"],[1,"flex-grow-1","mr-3","ml-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"search-button","btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","epeople",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm","access-control-editEPersonButton",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["class","delete-button btn btn-outline-danger btn-sm access-control-deleteEPersonButton",3,"title","click",4,"ngIf"],[1,"delete-button","btn","btn-outline-danger","btn-sm","access-control-deleteEPersonButton",3,"click","title"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(n,i){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"div")(8,"button",5),e.nrm(9,"i",6),e.j41(10,"span",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"h2",8),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"form",9),e.bIt("ngSubmit",function(){return i.search(i.searchForm.value)}),e.j41(17,"div")(18,"select",10)(19,"option",11),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"option",12),e.EFF(23),e.nI1(24,"translate"),e.k0s()()(),e.j41(25,"div",13)(26,"div",14),e.nrm(27,"input",15),e.nI1(28,"translate"),e.nI1(29,"translate"),e.j41(30,"span",16)(31,"button",17),e.nrm(32,"i",18),e.EFF(33),e.nI1(34,"translate"),e.k0s()()()(),e.j41(35,"div")(36,"button",19),e.bIt("click",function(){return i.clearFormAndResetResult()}),e.EFF(37),e.nI1(38,"translate"),e.k0s()()(),e.DNE(39,pt,1,0,"ds-loading",20),e.nI1(40,"async"),e.DNE(41,dt,21,21,"ds-pagination",21),e.nI1(42,"async"),e.nI1(43,"async"),e.DNE(44,mt,3,3,"div",22),e.nI1(45,"async"),e.k0s()()()),2&n){let s,l;e.R7$(5),e.JRh(e.bMT(6,14,i.labelPrefix+"head")),e.R7$(3),e.Y8G("routerLink","create"),e.R7$(3),e.JRh(e.bMT(12,16,i.labelPrefix+"button.add")),e.R7$(3),e.SpI(" ",e.bMT(15,18,i.labelPrefix+"search.head")," "),e.R7$(2),e.Y8G("formGroup",i.searchForm),e.R7$(4),e.JRh(e.bMT(21,20,i.labelPrefix+"search.scope.metadata")),e.R7$(3),e.JRh(e.bMT(24,22,i.labelPrefix+"search.scope.email")),e.R7$(4),e.Y8G("placeholder",e.bMT(28,24,i.labelPrefix+"search.placeholder")),e.BMQ("aria-label",e.bMT(29,26,i.labelPrefix+"search.placeholder")),e.R7$(6),e.SpI(" ",e.bMT(34,28,i.labelPrefix+"search.button")," "),e.R7$(4),e.JRh(e.bMT(38,30,i.labelPrefix+"button.see-all")),e.R7$(2),e.Y8G("ngIf",e.bMT(40,32,i.searching$)),e.R7$(2),e.Y8G("ngIf",(null==(s=e.bMT(42,34,i.pageInfoState$))?null:s.totalElements)>0&&!0!==e.bMT(43,36,i.searching$)),e.R7$(3),e.Y8G("ngIf",0===(null==(l=e.bMT(45,38,i.pageInfoState$))?null:l.totalElements))}},dependencies:[b.h,b.D9,R.iI,R.Wk,g.Jj,g.bT,f.X1,f.qT,f.xH,f.y7,f.me,f.wz,f.BC,f.cb,f.j4,f.JD,te.v,X.e,g.YU,g.Sq],encapsulation:2})}return a})();var E=o(63016),oe=o(88627),ft=o(24447),bt=o(21706),vt=o(31940),H=o(7172),le=o(82831),_t=o(24866),ce=o(28022),pe=o(36590),M=o(24106),St=o(73204);class It{static createValidator(r){return t=>r.getEPersonByEmail(t.value).pipe((0,d.yd)(),(0,u.T)(n=>n.payload?{emailTaken:!0}:null))}}const ue=a=>[a];function Pt(a,r){1&a&&e.nrm(0,"div")}function yt(a,r){if(1&a&&(e.j41(0,"h1",14),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,1,t.messagePrefix+".create"))}}function xt(a,r){if(1&a&&(e.j41(0,"h1",14),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,1,t.messagePrefix+".edit"))}}function Ct(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",15)(1,"button",16),e.nI1(2,"async"),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.resetPassword())}),e.nrm(3,"i",17),e.EFF(4),e.nI1(5,"translate"),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(),e.Y8G("disabled",!0!==e.bMT(2,2,t.canReset$)),e.R7$(3),e.SpI(" ",e.bMT(5,4,"admin.access-control.epeople.actions.reset")," ")}}function Et(a,r){if(1&a){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.impersonate())}),e.nrm(1,"i",20),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"admin.access-control.epeople.actions.impersonate")," "))}function Rt(a,r){if(1&a){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.stopImpersonating())}),e.nrm(1,"i",20),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"admin.access-control.epeople.actions.stop-impersonating")," "))}function Ft(a,r){if(1&a&&(e.j41(0,"div",15),e.DNE(1,Et,4,3,"button",18)(2,Rt,4,3,"button",18),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Y8G("ngIf",!t.isImpersonated),e.R7$(),e.Y8G("ngIf",t.isImpersonated)}}function Tt(a,r){if(1&a){const t=e.RV6();e.j41(0,"button",21),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.delete())}),e.nrm(1,"i",22),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&a&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"admin.access-control.epeople.actions.delete")," "))}function kt(a,r){1&a&&e.nrm(0,"ds-loading",23),2&a&&e.Y8G("showMessage",!1)}function Gt(a,r){1&a&&e.nrm(0,"ds-loading",23),2&a&&e.Y8G("showMessage",!1)}function $t(a,r){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td",31),e.EFF(2),e.k0s(),e.j41(3,"td",31)(4,"a",32),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(3);return e.Njj(s.groupsDataService.startEditingNewGroup(i))}),e.EFF(5),e.k0s()(),e.j41(6,"td",31),e.EFF(7),e.k0s()()}if(2&a){const t=r.$implicit,n=e.XpG(3);e.R7$(2),e.JRh(t.id),e.R7$(2),e.Y8G("routerLink",e.eq3(4,ue,n.groupsDataService.getGroupEditPageRouterLink(t))),e.R7$(),e.SpI(" ",n.dsoNameService.getName(t)," "),e.R7$(2),e.JRh(n.dsoNameService.getName(void 0))}}function jt(a,r){if(1&a){const t=e.RV6();e.j41(0,"ds-pagination",26),e.nI1(1,"async"),e.bIt("pageChange",function(i){e.eBV(t);const s=e.XpG(2);return e.Njj(s.onPageChange(i))}),e.j41(2,"div",27)(3,"table",28)(4,"thead")(5,"tr")(6,"th",29),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",29),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",29),e.EFF(13),e.nI1(14,"translate"),e.k0s()()(),e.j41(15,"tbody"),e.DNE(16,$t,8,6,"tr",30),e.nI1(17,"async"),e.k0s()()()()}if(2&a){let t,n;const i=e.XpG(2);e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,8,i.groups$))||null==t.payload?null:t.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,10,i.messagePrefix+".table.id")),e.R7$(3),e.JRh(e.bMT(11,12,i.messagePrefix+".table.name")),e.R7$(3),e.JRh(e.bMT(14,14,i.messagePrefix+".table.collectionOrCommunity")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(17,16,i.groups$))||null==n.payload?null:n.payload.page)}}function Nt(a,r){if(1&a&&(e.j41(0,"div",33)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div")(5,"button",34),e.EFF(6),e.nI1(7,"translate"),e.k0s()()()),2&a){const t=e.XpG(2);e.R7$(2),e.JRh(e.bMT(3,3,t.messagePrefix+".memberOfNoGroups")),e.R7$(3),e.Y8G("routerLink",e.eq3(7,ue,t.groupsDataService.getGroupRegistryRouterLink())),e.R7$(),e.JRh(e.bMT(7,5,t.messagePrefix+".goToGroups"))}}function Dt(a,r){if(1&a&&(e.j41(0,"div")(1,"h2"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.DNE(4,Gt,1,1,"ds-loading",12),e.nI1(5,"async"),e.nI1(6,"dsHasNoValue"),e.DNE(7,jt,18,18,"ds-pagination",24),e.nI1(8,"async"),e.DNE(9,Nt,8,9,"div",25),e.nI1(10,"async"),e.k0s()),2&a){let t,n;const i=e.XpG();e.R7$(2),e.JRh(e.bMT(3,4,i.messagePrefix+".groupsEPersonIsMemberOf")),e.R7$(2),e.Y8G("ngIf",e.bMT(6,8,e.bMT(5,6,i.groups$))),e.R7$(3),e.Y8G("ngIf",(null==(t=e.bMT(8,10,i.groups$))||null==t.payload?null:t.payload.totalElements)>0),e.R7$(2),e.Y8G("ngIf",0===(null==(n=e.bMT(10,12,i.groups$))||null==n.payload?null:n.payload.totalElements))}}let ge=(()=>{class a{constructor(t,n,i,s,l,m,h,c,x,S,G,Q,q,Ie,Pe){this.changeDetectorRef=t,this.epersonService=n,this.groupsDataService=i,this.formBuilderService=s,this.translateService=l,this.notificationsService=m,this.authService=h,this.authorizationService=c,this.modalService=x,this.paginationService=S,this.requestService=G,this.epersonRegistrationService=Q,this.dsoNameService=q,this.route=Ie,this.router=Pe,this.labelPrefix="admin.access-control.epeople.form.",this.formId="eperson-form",this.messagePrefix="admin.access-control.epeople.form",this.formLayout={firstName:{grid:{host:"row"}},lastName:{grid:{host:"row"}},email:{grid:{host:"row"}},canLogIn:{grid:{host:"col col-sm-6 d-inline-block"}},requireCertificate:{grid:{host:"col col-sm-6 d-inline-block"}}},this.submitForm=new e.bkB,this.cancelForm=new e.bkB,this.subs=[],this.config=Object.assign(new k.W,{id:"gem",pageSize:5,currentPage:1}),this.isImpersonated=!1,this.displayResetPassword=!1,this.submitLabel="form.create",this.subs.push(this.epersonService.getActiveEPerson().subscribe(K=>{this.epersonInitial=K,(0,p.a4)(K)&&(this.isImpersonated=this.authService.isImpersonatingUser(K.id),this.displayResetPassword=!0,this.submitLabel="form.submit")}))}ngOnInit(){this.initialisePage()}initialisePage(){this.subs.push(this.epersonService.findById(this.route.snapshot.params.id).subscribe(t=>{this.epersonService.editEPerson(t.payload)})),(0,N.z)([this.translateService.get(`${this.messagePrefix}.firstName`),this.translateService.get(`${this.messagePrefix}.lastName`),this.translateService.get(`${this.messagePrefix}.email`),this.translateService.get(`${this.messagePrefix}.canLogIn`),this.translateService.get(`${this.messagePrefix}.requireCertificate`),this.translateService.get(`${this.messagePrefix}.emailHint`)]).subscribe(([t,n,i,s,l,m])=>{this.firstName=new I.rA_({id:"firstName",label:t,name:"firstName",validators:{required:null},required:!0}),this.lastName=new I.rA_({id:"lastName",label:n,name:"lastName",validators:{required:null},required:!0}),this.email=new I.rA_({id:"email",label:i,name:"email",validators:{required:null,pattern:"^[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"},required:!0,errorMessages:{emailTaken:"error.validation.emailTaken",pattern:"error.validation.NotValidEmail"},hint:m}),this.canLogIn=new I.M7d({id:"canLogIn",label:s,name:"canLogIn",value:null==this.epersonInitial||this.epersonInitial.canLogIn}),this.requireCertificate=new I.M7d({id:"requireCertificate",label:l,name:"requireCertificate",value:null!=this.epersonInitial&&this.epersonInitial.requireCertificate}),this.formModel=[this.firstName,this.lastName,this.email,this.canLogIn,this.requireCertificate],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.subs.push(this.epersonService.getActiveEPerson().subscribe(c=>{null!=c&&(this.groups$=this.groupsDataService.findListByHref(c._links.groups.href,{currentPage:1,elementsPerPage:this.config.pageSize})),this.formGroup.patchValue({firstName:null!=c?c.firstMetadataValue("eperson.firstname"):"",lastName:null!=c?c.firstMetadataValue("eperson.lastname"):"",email:null!=c?c.email:"",canLogIn:null==c||c.canLogIn,requireCertificate:null!=c&&c.requireCertificate}),null===c&&this.formGroup.controls.email&&(this.formGroup.controls.email.setAsyncValidators(It.createValidator(this.epersonService)),this.emailValueChangeSubscribe=this.email.valueChanges.pipe((0,oe.B)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()}))}));const h=this.epersonService.getActiveEPerson();this.groups$=h.pipe((0,P.n)(c=>(0,N.z)([(0,E.of)(c),this.paginationService.getFindListOptions(this.config.id,{currentPage:1,elementsPerPage:this.config.pageSize})])),(0,P.n)(([c,x])=>null!=c?this.groupsDataService.findListByHref(c._links.groups.href,x,!0,!0,(0,M.s)("object")):(0,E.of)(void 0))),this.groupsPageInfoState$=this.groups$.pipe((0,u.T)(c=>c.payload.pageInfo)),this.canImpersonate$=h.pipe((0,P.n)(c=>(0,p.a4)(c)?this.authorizationService.isAuthorized(D._.LoginOnBehalfOf,c.self):(0,E.of)(!1))),this.canDelete$=h.pipe((0,P.n)(c=>this.authorizationService.isAuthorized(D._.CanDelete,(0,p.a4)(c)?c.self:void 0))),this.canReset$=(0,E.of)(!0)})}onCancel(){this.epersonService.cancelEditEPerson(),this.cancelForm.emit(),this.router.navigate([(0,_.bL)()])}onSubmit(){this.epersonService.getActiveEPerson().pipe((0,F.s)(1)).subscribe(t=>{const n={metadata:{"eperson.firstname":[{value:this.firstName.value}],"eperson.lastname":[{value:this.lastName.value}]},email:this.email.value,canLogIn:this.canLogIn.value,requireCertificate:this.requireCertificate.value};null==t?this.createNewEPerson(n):this.editEPerson(t,n)})}createNewEPerson(t){const n=Object.assign(new le.f,t);this.epersonService.create(n).pipe((0,d.qD)()).subscribe(s=>{s.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.created.success",{name:this.dsoNameService.getName(n)})),this.submitForm.emit(n),this.epersonService.clearEPersonRequests(),this.router.navigateByUrl((0,_.bL)())):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.created.failure",{name:this.dsoNameService.getName(n)})),this.cancelForm.emit())}),this.showNotificationIfEmailInUse(n,"created")}editEPerson(t,n){const i=Object.assign(new le.f,{id:t.id,metadata:{"eperson.firstname":[{value:this.firstName.value?this.firstName.value:t.firstMetadataValue("eperson.firstname")}],"eperson.lastname":[{value:this.lastName.value?this.lastName.value:t.firstMetadataValue("eperson.lastname")}]},email:(0,p.a4)(n.email)?n.email:t.email,canLogIn:(0,p.a4)(n.canLogIn)?n.canLogIn:t.canLogIn,requireCertificate:(0,p.a4)(n.requireCertificate)?n.requireCertificate:t.requireCertificate,_links:t._links});this.epersonService.updateEPerson(i).pipe((0,d.qD)()).subscribe(l=>{l.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.edited.success",{name:this.dsoNameService.getName(i)})),this.submitForm.emit(i),this.router.navigateByUrl((0,_.bL)())):(this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification.edited.failure",{name:this.dsoNameService.getName(i)})),this.cancelForm.emit())}),null!=n.email&&n.email!==t.email&&this.showNotificationIfEmailInUse(i,"edited")}onPageChange(t){this.updateGroups({currentPage:t,elementsPerPage:this.config.pageSize})}impersonate(){this.authService.impersonate(this.epersonInitial.id),this.isImpersonated=!0}delete(){this.epersonService.getActiveEPerson().pipe((0,F.s)(1),(0,P.n)(t=>{const n=this.modalService.open(ee.M);return n.componentInstance.name=this.dsoNameService.getName(t),n.componentInstance.headerLabel="confirmation-modal.delete-eperson.header",n.componentInstance.infoLabel="confirmation-modal.delete-eperson.info",n.componentInstance.cancelLabel="confirmation-modal.delete-eperson.cancel",n.componentInstance.confirmLabel="confirmation-modal.delete-eperson.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,F.s)(1),(0,P.n)(i=>i&&(0,p.a4)(t.id)?(this.canDelete$=(0,E.of)(!1),this.epersonService.deleteEPerson(t).pipe((0,d.qD)(),(0,u.T)(s=>({restResponse:s,eperson:t})))):(0,E.of)(null)),(0,ft.j)(()=>this.canDelete$=(0,E.of)(!0)))})).subscribe(({restResponse:t,eperson:n})=>{t?.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.labelPrefix+"notification.deleted.success",{name:this.dsoNameService.getName(n)})),this.router.navigate([(0,_.bL)()])):this.notificationsService.error(`Error occurred when trying to delete EPerson with id: ${n?.id} with code: ${t?.statusCode} and message: ${t?.errorMessage}`),this.cancelForm.emit()})}stopImpersonating(){this.authService.stopImpersonatingAndRefresh(),this.isImpersonated=!1}resetPassword(){(0,p.a4)(this.epersonInitial.email)&&this.epersonRegistrationService.registerEmail(this.epersonInitial.email,null,_t.TYPE_REQUEST_FORGOT).pipe((0,d.qD)()).subscribe(t=>{t.hasSucceeded?this.notificationsService.success(this.translateService.get("admin.access-control.epeople.actions.reset"),this.translateService.get("forgot-email.form.success.content",{email:this.epersonInitial.email})):this.notificationsService.error(this.translateService.get("forgot-email.form.error.head"),this.translateService.get("forgot-email.form.error.content",{email:this.epersonInitial.email}))})}ngOnDestroy(){this.subs.filter(t=>(0,p.a4)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id),(0,p.a4)(this.emailValueChangeSubscribe)&&this.emailValueChangeSubscribe.unsubscribe()}showNotificationIfEmailInUse(t,n){this.subs.push(this.epersonService.searchByScope("email",t.email,{currentPage:1,elementsPerPage:0}).pipe((0,d.yd)(),(0,d.Bo)()).subscribe(i=>{i.totalElements>0&&this.notificationsService.error(this.translateService.get(this.labelPrefix+"notification."+n+".failure.emailInUse",{name:this.dsoNameService.getName(t),email:t.email}))}))}updateGroups(t){this.subs.push(this.epersonService.getActiveEPerson().subscribe(n=>{this.groups$=this.groupsDataService.findListByHref(n._links.groups.href,t)}))}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(e.gRc),e.rXU(V.EPersonDataService),e.rXU(H.GroupDataService),e.rXU(ce.j),e.rXU(b.c$),e.rXU(U.I),e.rXU(bt.uR),e.rXU(z.AuthorizationDataService),e.rXU(v.Bq),e.rXU(W.m),e.rXU(J.B),e.rXU(vt.f),e.rXU(O.f),e.rXU(R.nX),e.rXU(R.Ix))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-eperson-form"]],outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},standalone:!0,features:[e.aNF],decls:23,vars:25,consts:[["createHeader",""],["editHeader",""],[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],[3,"submitForm","formId","formModel","formGroup","formLayout","displayCancel","submitLabel"],["before","",1,"btn-group"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["between","","class","btn-group",4,"ngIf"],["after","","class","btn btn-danger delete-button","type","button",3,"click",4,"ngIf"],[3,"showMessage",4,"ngIf"],[4,"ngIf"],[1,"border-bottom","pb-2"],["between","",1,"btn-group"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-key"],["class","btn btn-primary","type","button",3,"click",4,"ngIf"],["type","button",1,"btn","btn-primary",3,"click"],[1,"fa","fa-user-secret"],["after","","type","button",1,"btn","btn-danger","delete-button",3,"click"],[1,"fas","fa-trash"],[3,"showMessage"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage","pageChange",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"pageChange","paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"click","routerLink"],["role","alert",1,"alert","alert-info","w-100","mb-2"],[1,"btn","btn-primary",3,"routerLink"]],template:function(n,i){if(1&n){const s=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4),e.DNE(3,Pt,1,0,"div",5),e.nI1(4,"async"),e.DNE(5,yt,3,3,"ng-template",null,0,e.C5r)(7,xt,3,3,"ng-template",null,1,e.C5r),e.j41(9,"ds-form",6),e.bIt("submitForm",function(){return e.eBV(s),e.Njj(i.onSubmit())}),e.j41(10,"div",7)(11,"button",8),e.bIt("click",function(){return e.eBV(s),e.Njj(i.onCancel())}),e.nrm(12,"i",9),e.EFF(13),e.nI1(14,"translate"),e.k0s()(),e.DNE(15,Ct,6,6,"div",10)(16,Ft,3,2,"div",10),e.nI1(17,"async"),e.DNE(18,Tt,4,3,"button",11),e.nI1(19,"async"),e.k0s(),e.DNE(20,kt,1,1,"ds-loading",12)(21,Dt,11,14,"div",13),e.nI1(22,"async"),e.k0s()()()}if(2&n){const s=e.sdS(6),l=e.sdS(8);e.R7$(3),e.Y8G("ngIf",e.bMT(4,15,i.epersonService.getActiveEPerson()))("ngIfThen",l)("ngIfElse",s),e.R7$(6),e.Y8G("formId",i.formId)("formModel",i.formModel)("formGroup",i.formGroup)("formLayout",i.formLayout)("displayCancel",!1)("submitLabel",i.submitLabel),e.R7$(4),e.SpI(" ",e.bMT(14,17,i.messagePrefix+".return")," "),e.R7$(2),e.Y8G("ngIf",i.displayResetPassword),e.R7$(),e.Y8G("ngIf",e.bMT(17,19,i.canImpersonate$)),e.R7$(2),e.Y8G("ngIf",e.bMT(19,21,i.canDelete$)),e.R7$(2),e.Y8G("ngIf",!i.formGroup),e.R7$(),e.Y8G("ngIf",e.bMT(22,23,i.epersonService.getActiveEPerson()))}},dependencies:[pe.s,g.bT,g.pM,g.Jj,b.h,b.D9,te.v,X.e,R.Wk,St.n],encapsulation:2})}return a})();var Mt=o(88663),Bt=o(73958);const Lt=[(0,M.s)("groups")];let wt=(()=>{class a{constructor(t,n){this.ePersonService=t,this.store=n}resolve(t,n){const i=this.ePersonService.findById(t.params.id,!0,!1,...Lt).pipe((0,d.qD)());return i.subscribe(s=>{this.store.dispatch(new Mt.j(n.url,s.payload))}),i}static#e=this.\u0275fac=function(n){return new(n||a)(e.KVO(V.EPersonDataService),e.KVO(Bt.il))};static#t=this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var At=o(41483),de=o(17178),Xt=o(86722),Ot=o(68605),Vt=o(67873),me=o(60875),Ut=o(63434),Yt=o(58751),zt=o(82376),Jt=o(96858),Wt=o(16700),he=o(81727),Ht=o(33370);const Qt=()=>["top","right","bottom"],qt=a=>({content:"admin.access-control.groups.form.tooltip.editGroup.addSubgroups",id:"edit-group-add-subgroups",iconPlacement:"right",tooltipPlacement:a}),fe=a=>[a],be=a=>({name:a});function Kt(a,r){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td",18),e.EFF(2),e.k0s(),e.j41(3,"td",18)(4,"a",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.groupDataService.startEditingNewGroup(i))}),e.EFF(5),e.k0s()(),e.j41(6,"td",18),e.EFF(7),e.nI1(8,"async"),e.k0s(),e.j41(9,"td",18)(10,"div",20)(11,"button",21),e.nI1(12,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.deleteSubgroupFromGroup(i))}),e.nrm(13,"i",22),e.k0s()()()()}if(2&a){let t;const n=r.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(n.id),e.R7$(2),e.Y8G("routerLink",e.eq3(10,fe,i.groupDataService.getGroupEditPageRouterLink(n))),e.R7$(),e.SpI(" ",i.dsoNameService.getName(n)," "),e.R7$(2),e.JRh(i.dsoNameService.getName(null==(t=e.bMT(8,5,n.object))?null:t.payload)),e.R7$(4),e.FS9("title",e.i5U(12,7,i.messagePrefix+".table.edit.buttons.remove",e.eq3(12,be,i.dsoNameService.getName(n))))}}function Zt(a,r){if(1&a&&(e.j41(0,"ds-pagination",13),e.nI1(1,"async"),e.j41(2,"div",14)(3,"table",15)(4,"thead")(5,"tr")(6,"th",16),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",16),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",16),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,Kt,14,14,"tr",17),e.nI1(20,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,9,i.subGroups$))||null==t.payload?null:t.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,11,i.messagePrefix+".table.id")),e.R7$(3),e.JRh(e.bMT(11,13,i.messagePrefix+".table.name")),e.R7$(3),e.JRh(e.bMT(14,15,i.messagePrefix+".table.collectionOrCommunity")),e.R7$(3),e.JRh(e.bMT(17,17,i.messagePrefix+".table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(20,19,i.subGroups$))||null==n.payload?null:n.payload.page)}}function en(a,r){if(1&a&&(e.j41(0,"div",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".no-subgroups-yet")," ")}}function tn(a,r){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".search.head")," ")}}function nn(a,r){if(1&a){const t=e.RV6();e.j41(0,"tr")(1,"td",18),e.EFF(2),e.k0s(),e.j41(3,"td",18)(4,"a",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.groupDataService.startEditingNewGroup(i))}),e.EFF(5),e.k0s()(),e.j41(6,"td",18),e.EFF(7),e.nI1(8,"async"),e.k0s(),e.j41(9,"td",18)(10,"div",20)(11,"button",25),e.nI1(12,"translate"),e.bIt("click",function(){const i=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.addSubgroupToGroup(i))}),e.nrm(13,"i",26),e.k0s()()()()}if(2&a){let t;const n=r.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(n.id),e.R7$(2),e.Y8G("routerLink",e.eq3(10,fe,i.groupDataService.getGroupEditPageRouterLink(n))),e.R7$(),e.SpI(" ",i.dsoNameService.getName(n)," "),e.R7$(2),e.JRh(i.dsoNameService.getName(null==(t=e.bMT(8,5,n.object))?null:t.payload)),e.R7$(4),e.FS9("title",e.i5U(12,7,i.messagePrefix+".table.edit.buttons.add",e.eq3(12,be,i.dsoNameService.getName(n))))}}function an(a,r){if(1&a&&(e.j41(0,"ds-pagination",13),e.nI1(1,"async"),e.j41(2,"div",14)(3,"table",24)(4,"thead")(5,"tr")(6,"th",16),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",16),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",16),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th",18),e.EFF(16),e.nI1(17,"translate"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,nn,14,14,"tr",17),e.nI1(20,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.configSearch)("collectionSize",null==(t=e.bMT(1,9,i.searchResults$))||null==t.payload?null:t.payload.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,11,i.messagePrefix+".table.id")),e.R7$(3),e.JRh(e.bMT(11,13,i.messagePrefix+".table.name")),e.R7$(3),e.JRh(e.bMT(14,15,i.messagePrefix+".table.collectionOrCommunity")),e.R7$(3),e.JRh(e.bMT(17,17,i.messagePrefix+".table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(20,19,i.searchResults$))||null==n.payload?null:n.payload.page)}}function sn(a,r){if(1&a&&(e.j41(0,"div",23),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".no-items")," ")}}var L=function(a){return a[a.Members=0]="Members",a[a.ActiveGroup=1]="ActiveGroup",a[a.SearchResults=2]="SearchResults",a}(L||{});let rn=(()=>{class a{constructor(t,n,i,s,l,m,h){this.groupDataService=t,this.translateService=n,this.notificationsService=i,this.formBuilder=s,this.paginationService=l,this.router=m,this.dsoNameService=h,this.searchResults$=new y.t(void 0),this.subGroups$=new y.t(void 0),this.subs=new Map,this.configSearch=Object.assign(new k.W,{id:"ssgl",pageSize:5,currentPage:1}),this.config=Object.assign(new k.W,{id:"sgl",pageSize:5,currentPage:1}),this.currentSearchQuery=""}ngOnInit(){this.searchForm=this.formBuilder.group({query:""}),this.subs.set(L.ActiveGroup,this.groupDataService.getActiveGroup().subscribe(t=>{null!=t&&(this.groupBeingEdited=t,this.retrieveSubGroups(),this.search({query:""}))})),this.subGroupsPageInfoState$=this.subGroups$.pipe((0,u.T)(t=>t?.payload?.pageInfo))}retrieveSubGroups(){this.unsubFrom(L.Members),this.subs.set(L.Members,this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,P.n)(t=>this.groupDataService.findListByHref(this.groupBeingEdited._links.subgroups.href,{currentPage:t.currentPage,elementsPerPage:t.pageSize},!0,!0,(0,M.s)("object")))).subscribe(t=>{this.subGroups$.next(t)}))}deleteSubgroupFromGroup(t){this.groupDataService.getActiveGroup().pipe((0,F.s)(1)).subscribe(n=>{if(null!=n){const i=this.groupDataService.deleteSubGroupFromGroup(n,t);this.showNotifications("deleteSubgroup",i,this.dsoNameService.getName(t),n),null!=this.currentSearchQuery&&this.search({query:this.currentSearchQuery})}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}addSubgroupToGroup(t){this.groupDataService.getActiveGroup().pipe((0,F.s)(1)).subscribe(n=>{if(null!=n)if(n.uuid!==t.uuid){const i=this.groupDataService.addSubGroupToGroup(n,t);this.showNotifications("addSubgroup",i,this.dsoNameService.getName(t),n),null!=this.currentSearchQuery&&this.search({query:this.currentSearchQuery})}else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.subgroupToAddIsActiveGroup"));else this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure.noActiveGroup"))})}search(t){this.unsubFrom(L.SearchResults),this.subs.set(L.SearchResults,this.paginationService.getCurrentPagination(this.configSearch.id,this.configSearch).pipe((0,P.n)(n=>{const i=t.query;return null!=i&&this.currentSearchQuery!==i&&this.groupBeingEdited&&(this.currentSearchQuery=i,this.paginationService.resetPage(this.configSearch.id)),this.searchDone=!0,this.groupDataService.searchNonMemberGroups(this.currentSearchQuery,this.groupBeingEdited.id,{currentPage:n.currentPage,elementsPerPage:n.pageSize},!1,!0,(0,M.s)("object"))}),(0,d.bD)(),(0,u.T)(n=>{if(!n.hasFailed)return n;this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure",{cause:n.errorMessage}))})).subscribe(n=>{this.searchResults$.next(n)}))}unsubFrom(t){this.subs.has(t)&&(this.subs.get(t).unsubscribe(),this.subs.delete(t))}ngOnDestroy(){for(const t of this.subs.keys())this.unsubFrom(t);this.paginationService.clearPagination(this.config.id),this.paginationService.clearPagination(this.configSearch.id)}showNotifications(t,n,i,s){n.pipe((0,d.qD)()).subscribe(l=>{l.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.success."+t,{name:i})),this.groupDataService.clearGroupLinkRequests(s._links.subgroups.href)):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.failure."+t,{name:i}))})}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(H.GroupDataService),e.rXU(b.c$),e.rXU(U.I),e.rXU(f.ze),e.rXU(W.m),e.rXU(R.Ix),e.rXU(O.f))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-subgroups-list"]],inputs:{messagePrefix:"messagePrefix"},standalone:!0,features:[e.aNF],decls:30,vars:29,consts:[[1,"border-bottom","pb-2"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],["id","search",1,"border-bottom","pb-2"],[4,"dsContextHelp"],[1,"d-flex","justify-content-between",3,"ngSubmit","formGroup"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group","mr-3"],["type","text","name","query","id","query","formControlName","query","aria-label","Search input",1,"form-control"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary","float-right",3,"click"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","subgroupsOfGroup",1,"table","table-striped","table-hover","table-bordered"],["scope","col",1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle"],[3,"click","routerLink"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-danger","btn-sm","deleteButton",3,"click","title"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"],["id","groupsSearch",1,"table","table-striped","table-hover","table-bordered"],[1,"btn","btn-outline-primary","btn-sm","addButton",3,"click","title"],[1,"fas","fa-plus","fa-fw"]],template:function(n,i){if(1&n&&(e.qex(0),e.j41(1,"h3",0),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"h4"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.DNE(7,Zt,21,21,"ds-pagination",1),e.nI1(8,"async"),e.DNE(9,en,3,3,"div",2),e.nI1(10,"async"),e.j41(11,"h4",3),e.DNE(12,tn,3,3,"span",4),e.k0s(),e.j41(13,"form",5),e.bIt("ngSubmit",function(){return i.search(i.searchForm.value)}),e.j41(14,"div",6)(15,"div",7),e.nrm(16,"input",8),e.j41(17,"span",9)(18,"button",10),e.nrm(19,"i",11),e.EFF(20),e.nI1(21,"translate"),e.k0s()()()(),e.j41(22,"div")(23,"button",12),e.bIt("click",function(){return i.clearFormAndResetResult()}),e.EFF(24),e.nI1(25,"translate"),e.k0s()()(),e.DNE(26,an,21,21,"ds-pagination",1),e.nI1(27,"async"),e.DNE(28,sn,3,3,"div",2),e.nI1(29,"async"),e.bVm()),2&n){let s,l,m,h;e.R7$(2),e.JRh(e.bMT(3,10,i.messagePrefix+".head")),e.R7$(3),e.JRh(e.bMT(6,12,i.messagePrefix+".headSubgroups")),e.R7$(2),e.Y8G("ngIf",(null==(s=e.bMT(8,14,i.subGroups$))||null==s.payload?null:s.payload.totalElements)>0),e.R7$(2),e.Y8G("ngIf",0===(null==(l=e.bMT(10,16,i.subGroups$))||null==l.payload?null:l.payload.totalElements)),e.R7$(3),e.Y8G("dsContextHelp",e.eq3(27,qt,e.lJ4(26,Qt))),e.R7$(),e.Y8G("formGroup",i.searchForm),e.R7$(7),e.SpI(" ",e.bMT(21,18,i.messagePrefix+".search.button")," "),e.R7$(4),e.SpI(" ",e.bMT(25,20,i.messagePrefix+".button.see-all")," "),e.R7$(2),e.Y8G("ngIf",(null==(m=e.bMT(27,22,i.searchResults$))||null==m.payload?null:m.payload.totalElements)>0),e.R7$(2),e.Y8G("ngIf",0===(null==(h=e.bMT(29,24,i.searchResults$))||null==h.payload?null:h.payload.totalElements)&&i.searchDone)}},dependencies:[R.Wk,g.Jj,g.Sq,he.G,b.h,b.D9,f.X1,f.qT,f.me,f.BC,f.cb,f.j4,f.JD,X.e,g.bT],encapsulation:2})}return a})();class on{static createValidator(r){return t=>r.searchGroups(t.value,{currentPage:1,elementsPerPage:100}).pipe((0,d.Ar)(),(0,u.T)(n=>n.filter(i=>i.name===t.value)),(0,u.T)(n=>n.length>0?{groupExists:!0}:null))}}const ln=()=>["right","bottom"],cn=a=>({content:"admin.access-control.groups.form.tooltip.editGroupPage",id:"edit-group-page",iconPlacement:"right",tooltipPlacement:a}),pn=(a,r,t)=>({name:a,comcol:r,comcolEditRolesRoute:t});function un(a,r){1&a&&e.nrm(0,"div")}function gn(a,r){if(1&a&&(e.j41(0,"h1",14),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.JRh(e.bMT(2,1,t.messagePrefix+".head.create"))}}function dn(a,r){if(1&a&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+".head.edit")," ")}}function mn(a,r){1&a&&(e.j41(0,"h1",14),e.DNE(1,dn,3,3,"span",15),e.k0s()),2&a&&(e.R7$(),e.Y8G("dsContextHelp",e.eq3(2,cn,e.lJ4(1,ln))))}function hn(a,r){if(1&a&&e.nrm(0,"ds-alert",16),2&a){const t=e.XpG();e.Y8G("type",t.AlertTypeEnum.Warning)("content",t.messagePrefix+".alert.permanent")}}function fn(a,r){if(1&a&&(e.nrm(0,"ds-alert",16),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"translate")),2&a){let t;const n=e.XpG();e.Y8G("type",n.AlertTypeEnum.Warning)("content",e.i5U(4,8,n.messagePrefix+".alert.workflowGroup",e.sMw(11,pn,n.dsoNameService.getName(null==(t=e.bMT(1,2,n.getLinkedDSO(n.groupBeingEdited)))?null:t.payload),null==(t=e.bMT(2,4,n.getLinkedDSO(n.groupBeingEdited)))||null==t.payload?null:t.payload.type,e.bMT(3,6,n.getLinkedEditRolesRoute(n.groupBeingEdited)))))}}function bn(a,r){if(1&a){const t=e.RV6();e.j41(0,"div",17)(1,"button",18),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.delete())}),e.nrm(2,"i",19),e.EFF(3),e.nI1(4,"translate"),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(3),e.SpI(" ",e.bMT(4,1,t.messagePrefix+".actions.delete")," ")}}function vn(a,r){if(1&a&&e.nrm(0,"ds-members-list",20),2&a){const t=e.XpG();e.Y8G("messagePrefix",t.messagePrefix+".members-list")}}function _n(a,r){if(1&a&&e.nrm(0,"ds-subgroups-list",20),2&a){const t=e.XpG();e.Y8G("messagePrefix",t.messagePrefix+".subgroups-list")}}let ve=(()=>{class a{constructor(t,n,i,s,l,m,h,c,x,S,G,Q,q){this.groupDataService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=i,this.formBuilderService=s,this.translateService=l,this.notificationsService=m,this.route=h,this.router=c,this.authorizationService=x,this.modalService=S,this.requestService=G,this.changeDetectorRef=Q,this.dsoNameService=q,this.messagePrefix="admin.access-control.groups.form",this.formId="group-form",this.formLayout={groupName:{grid:{host:"row"}},groupDescription:{grid:{host:"row"}}},this.submitForm=new e.bkB,this.cancelForm=new e.bkB,this.subs=[],this.AlertTypeEnum=Wt.v}ngOnInit(){this.initialisePage()}initialisePage(){this.subs.push(this.route.params.subscribe(t=>{"newGroup"!==t.groupId&&this.setActiveGroup(t.groupId)})),this.canEdit$=this.groupDataService.getActiveGroup().pipe((0,p.Az)(),(0,P.n)(t=>(0,N.z)([this.authorizationService.isAuthorized(D._.CanDelete,(0,p.hj)(t)?t.self:void 0),this.hasLinkedDSO(t)]).pipe((0,u.T)(([n,i])=>n&&!i)))),(0,N.z)([this.translateService.get(`${this.messagePrefix}.groupName`),this.translateService.get(`${this.messagePrefix}.groupCommunity`),this.translateService.get(`${this.messagePrefix}.groupDescription`)]).subscribe(([t,n,i])=>{this.groupName=new I.rA_({id:"groupName",label:t,name:"groupName",validators:{required:null},required:!0}),this.groupCommunity=new I.rA_({id:"groupCommunity",label:n,name:"groupCommunity",required:!1,readOnly:!0}),this.groupDescription=new I.Zex({id:"groupDescription",label:i,name:"groupDescription",required:!1,spellCheck:Xt.c.form.spellCheck}),this.formModel=[this.groupName,this.groupDescription],this.formGroup=this.formBuilderService.createFormGroup(this.formModel),this.formGroup.controls.groupName&&(this.formGroup.controls.groupName.setAsyncValidators(on.createValidator(this.groupDataService)),this.groupNameValueChangeSubscribe=this.groupName.valueChanges.pipe((0,oe.B)(300)).subscribe(()=>{this.changeDetectorRef.detectChanges()})),this.subs.push((0,N.z)([this.groupDataService.getActiveGroup(),this.canEdit$,this.groupDataService.getActiveGroup().pipe((0,At.p)(s=>(0,p.a4)(s)),(0,P.n)(s=>this.getLinkedDSO(s).pipe((0,d.ak)())))]).subscribe(([s,l,m])=>{null!=s&&(this.formGroup.controls.groupName.clearAsyncValidators(),this.groupBeingEdited=s,m?.name?this.formGroup.controls.groupCommunity||(this.formBuilderService.insertFormGroupControl(1,this.formGroup,this.formModel,this.groupCommunity),this.formGroup.patchValue({groupName:s.name,groupCommunity:m?.name??"",groupDescription:s.firstMetadataValue("dc.description")})):(this.formModel=[this.groupName,this.groupDescription],this.formGroup.patchValue({groupName:s.name,groupDescription:s.firstMetadataValue("dc.description")})),setTimeout(()=>{(!l||s.permanent)&&this.formGroup.disable()},200))}))})}onCancel(){this.groupDataService.cancelEditGroup(),this.cancelForm.emit(),this.router.navigate([(0,_.mK)()])}onSubmit(){this.groupDataService.getActiveGroup().pipe((0,F.s)(1)).subscribe(t=>{null===t?this.createNewGroup({name:this.groupName.value,metadata:{"dc.description":[{value:this.groupDescription.value}]}}):this.editGroup(t)})}createNewGroup(t){const n=Object.assign(new Ut.Y,t);this.groupDataService.create(n).pipe((0,d.qD)()).subscribe(i=>{i.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.created.success",{name:n.name})),this.submitForm.emit(n),(0,p.hj)(i.payload)&&(this.setActiveGroupWithLink(i.payload._links.self.href),this.groupDataService.clearGroupsRequests(),this.router.navigateByUrl((0,_.xl)(i.payload.uuid)))):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.created.failure",{name:n.name})),this.showNotificationIfNameInUse(n,"created"),this.cancelForm.emit())})}showNotificationIfNameInUse(t,n){this.subs.push(this.groupDataService.searchGroups(t.name,{currentPage:1,elementsPerPage:0}).pipe((0,d.yd)(),(0,d.Bo)()).subscribe(i=>{i.totalElements>0&&this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification."+n+".failure.groupNameInUse",{name:this.dsoNameService.getName(t)}))}))}editGroup(t){let n=[];(0,p.a4)(this.groupDescription.value)&&(n=[...n,{op:"add",path:"/metadata/dc.description",value:this.groupDescription.value}]),(0,p.a4)(this.groupName.value)&&(n=[...n,{op:"replace",path:"/name",value:this.groupName.value}]),this.groupDataService.patch(t,n).pipe((0,d.qD)()).subscribe(i=>{i.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.edited.success",{name:this.dsoNameService.getName(i.payload)})),this.submitForm.emit(i.payload)):(this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.edited.failure",{name:this.dsoNameService.getName(t)})),this.cancelForm.emit())})}setActiveGroup(t){this.groupDataService.cancelEditGroup(),this.groupDataService.findById(t).pipe((0,d.yd)(),(0,d.Bo)()).subscribe(n=>{this.groupDataService.editGroup(n)})}setActiveGroupWithLink(t){this.groupDataService.getActiveGroup().pipe((0,F.s)(1)).subscribe(n=>{null===n&&(this.groupDataService.cancelEditGroup(),this.groupDataService.findByHref(t,!1,!1,(0,M.s)("subgroups"),(0,M.s)("epersons"),(0,M.s)("object")).pipe((0,d.yd)(),(0,d.Bo)()).subscribe(i=>{this.groupDataService.editGroup(i)}))})}delete(){this.groupDataService.getActiveGroup().pipe((0,F.s)(1)).subscribe(t=>{const n=this.modalService.open(ee.M);n.componentInstance.name=this.dsoNameService.getName(t),n.componentInstance.headerLabel=this.messagePrefix+".delete-group.modal.header",n.componentInstance.infoLabel=this.messagePrefix+".delete-group.modal.info",n.componentInstance.cancelLabel=this.messagePrefix+".delete-group.modal.cancel",n.componentInstance.confirmLabel=this.messagePrefix+".delete-group.modal.confirm",n.componentInstance.brandColor="danger",n.componentInstance.confirmIcon="fas fa-trash",n.componentInstance.response.pipe((0,F.s)(1)).subscribe(i=>{i&&(0,p.a4)(t.id)&&this.groupDataService.delete(t.id).pipe((0,d.qD)()).subscribe(s=>{s.hasSucceeded?(this.notificationsService.success(this.translateService.get(this.messagePrefix+".notification.deleted.success",{name:this.dsoNameService.getName(t)})),this.onCancel()):this.notificationsService.error(this.translateService.get(this.messagePrefix+".notification.deleted.failure.title",{name:this.dsoNameService.getName(t)}),this.translateService.get(this.messagePrefix+".notification.deleted.failure.content",{cause:s.errorMessage}))})})})}ngOnDestroy(){this.groupDataService.cancelEditGroup(),this.subs.filter(t=>(0,p.a4)(t)).forEach(t=>t.unsubscribe()),(0,p.a4)(this.groupNameValueChangeSubscribe)&&this.groupNameValueChangeSubscribe.unsubscribe()}hasLinkedDSO(t){if((0,p.a4)(t)&&(0,p.a4)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,u.T)(n=>(0,p.a4)(n)&&(0,p.a4)(n.payload)),(0,de.W)(()=>(0,E.of)(!1)))}getLinkedDSO(t){if((0,p.a4)(t)&&(0,p.a4)(t._links.object.href))return void 0===t.object?this.dSpaceObjectDataService.findByHref(t._links.object.href):t.object}getLinkedEditRolesRoute(t){if((0,p.a4)(t)&&(0,p.a4)(t._links.object.href))return this.getLinkedDSO(t).pipe((0,u.T)(n=>{if((0,p.a4)(n)&&(0,p.a4)(n.payload))switch(n.payload.type){case zt.E.type.value:return(0,Vt.EU)(n.payload.id);case Yt.p.type.value:return(0,Ot.BW)(n.payload.id)}}))}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(H.GroupDataService),e.rXU(V.EPersonDataService),e.rXU(me.DSpaceObjectDataService),e.rXU(ce.j),e.rXU(b.c$),e.rXU(U.I),e.rXU(R.nX),e.rXU(R.Ix),e.rXU(z.AuthorizationDataService),e.rXU(v.Bq),e.rXU(J.B),e.rXU(e.gRc),e.rXU(O.f))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-group-form"]],hostBindings:function(n,i){1&n&&e.bIt("beforeunload",function(){return i.ngOnDestroy()},!1,e.tSv)},outputs:{submitForm:"submitForm",cancelForm:"cancelForm"},standalone:!0,features:[e.aNF],decls:24,vars:24,consts:[["createHeader",""],["editHeader",""],[1,"container"],[1,"group-form","row"],[1,"col-12"],[4,"ngIf","ngIfThen","ngIfElse"],[3,"type","content",4,"ngIf"],[3,"submitForm","formId","formModel","formGroup","formLayout","displayCancel"],["before","",1,"btn-group"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],["after","","class","btn-group",4,"ngIf"],[1,"mb-5"],[3,"messagePrefix",4,"ngIf"],[1,"border-bottom","pb-2"],[4,"dsContextHelp"],[3,"type","content"],["after","",1,"btn-group"],["type","button",1,"btn","btn-danger","delete-button",3,"click"],[1,"fa","fa-trash"],[3,"messagePrefix"]],template:function(n,i){if(1&n){const s=e.RV6();e.j41(0,"div",2)(1,"div",3)(2,"div",4),e.DNE(3,un,1,0,"div",5),e.nI1(4,"async"),e.DNE(5,gn,3,3,"ng-template",null,0,e.C5r)(7,mn,2,4,"ng-template",null,1,e.C5r)(9,hn,1,2,"ds-alert",6)(10,fn,5,15,"ds-alert",6),e.nI1(11,"async"),e.nI1(12,"async"),e.j41(13,"ds-form",7),e.bIt("submitForm",function(){return e.eBV(s),e.Njj(i.onSubmit())}),e.j41(14,"div",8)(15,"button",9),e.bIt("click",function(){return e.eBV(s),e.Njj(i.onCancel())}),e.nrm(16,"i",10),e.EFF(17),e.nI1(18,"translate"),e.k0s()(),e.DNE(19,bn,5,3,"div",11),e.nI1(20,"async"),e.k0s(),e.j41(21,"div",12),e.DNE(22,vn,1,1,"ds-members-list",13),e.k0s(),e.DNE(23,_n,1,1,"ds-subgroups-list",13),e.k0s()()()}if(2&n){const s=e.sdS(6),l=e.sdS(8);e.R7$(3),e.Y8G("ngIf",e.bMT(4,14,i.groupDataService.getActiveGroup()))("ngIfThen",l)("ngIfElse",s),e.R7$(6),e.Y8G("ngIf",null==i.groupBeingEdited?null:i.groupBeingEdited.permanent),e.R7$(),e.Y8G("ngIf",!0!==e.bMT(11,16,i.canEdit$)&&e.bMT(12,18,i.groupDataService.getActiveGroup())),e.R7$(3),e.Y8G("formId",i.formId)("formModel",i.formModel)("formGroup",i.formGroup)("formLayout",i.formLayout)("displayCancel",!1),e.R7$(4),e.SpI(" ",e.bMT(18,20,i.messagePrefix+".return"),""),e.R7$(2),e.Y8G("ngIf",e.bMT(20,22,i.canEdit$)&&!(null!=i.groupBeingEdited&&i.groupBeingEdited.permanent)),e.R7$(3),e.Y8G("ngIf",void 0!==i.groupBeingEdited),e.R7$(),e.Y8G("ngIf",void 0!==i.groupBeingEdited)}},dependencies:[pe.s,Jt.C,g.bT,g.Jj,b.h,b.D9,he.G,Ht.v,rn],encapsulation:2})}return a})();var Sn=o(90087),In=o(25744);const Pn=(a,r)=>(0,e.WQX)(In.Y).getEndpoint("groups").pipe((0,u.T)(i=>`${i}/${a?.params?.groupId}`));var xn=o(76564),Cn=o(82040),En=o(45670);class Rn{}var Fn=o(98985);const _e=a=>({name:a});function Tn(a,r){1&a&&e.nrm(0,"ds-loading")}function kn(a,r){if(1&a&&(e.j41(0,"button",30),e.nI1(1,"translate"),e.nrm(2,"i",31),e.k0s()),2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.FS9("title",e.i5U(1,2,n.messagePrefix+"table.edit.buttons.edit",e.eq3(5,_e,n.dsoNameService.getName(t.group)))),e.Y8G("routerLink",n.groupService.getGroupEditPageRouterLink(t.group))}}function Gn(a,r){1&a&&(e.j41(0,"button",32),e.nI1(1,"translate"),e.nrm(2,"i",31),e.k0s()),2&a&&e.Y8G("disabled",!0)("ngbTooltip",e.bMT(1,2,"admin.access-control.epeople.table.edit.buttons.edit-disabled"))}function $n(a,r){if(1&a){const t=e.RV6();e.j41(0,"button",33),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,s=e.XpG(2);return e.Njj(s.deleteGroup(i))}),e.nrm(2,"i",34),e.k0s()}if(2&a){const t=e.XpG().$implicit,n=e.XpG(2);e.FS9("title",e.i5U(1,1,n.messagePrefix+"table.edit.buttons.remove",e.eq3(4,_e,n.dsoNameService.getName(t.group))))}}function jn(a,r){if(1&a&&(e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.nI1(7,"async"),e.k0s(),e.j41(8,"td"),e.EFF(9),e.k0s(),e.j41(10,"td")(11,"div",25),e.qex(12,26),e.DNE(13,kn,3,7,"button",27)(14,Gn,3,4,"button",28),e.bVm(),e.DNE(15,$n,3,6,"button",29),e.k0s()()()),2&a){let t;const n=r.$implicit,i=e.XpG(2);e.R7$(2),e.JRh(n.group.id),e.R7$(2),e.JRh(i.dsoNameService.getName(n.group)),e.R7$(2),e.JRh(i.dsoNameService.getName(null==(t=e.bMT(7,8,n.group.object))?null:t.payload)),e.R7$(3),e.JRh((null==n.epersons?null:n.epersons.totalElements)+(null==n.subgroups?null:n.subgroups.totalElements)),e.R7$(3),e.Y8G("ngSwitch",n.ableToEdit),e.R7$(),e.Y8G("ngSwitchCase",!0),e.R7$(),e.Y8G("ngSwitchCase",!1),e.R7$(),e.Y8G("ngIf",!(null!=n.group&&n.group.permanent)&&n.ableToDelete)}}function Nn(a,r){if(1&a&&(e.j41(0,"ds-pagination",20),e.nI1(1,"async"),e.j41(2,"div",21)(3,"table",22)(4,"thead")(5,"tr")(6,"th",23),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",23),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",23),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th",23),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"th"),e.EFF(19),e.nI1(20,"translate"),e.k0s()()(),e.j41(21,"tbody"),e.DNE(22,jn,16,10,"tr",24),e.nI1(23,"async"),e.k0s()()()()),2&a){let t,n;const i=e.XpG();e.Y8G("paginationOptions",i.config)("collectionSize",null==(t=e.bMT(1,10,i.pageInfoState$))?null:t.totalElements)("hideGear",!0)("hidePagerWhenSinglePage",!0),e.R7$(7),e.JRh(e.bMT(8,12,i.messagePrefix+"table.id")),e.R7$(3),e.JRh(e.bMT(11,14,i.messagePrefix+"table.name")),e.R7$(3),e.JRh(e.bMT(14,16,i.messagePrefix+"table.collectionOrCommunity")),e.R7$(3),e.JRh(e.bMT(17,18,i.messagePrefix+"table.members")),e.R7$(3),e.JRh(e.bMT(20,20,i.messagePrefix+"table.edit")),e.R7$(3),e.Y8G("ngForOf",null==(n=e.bMT(23,22,i.groupsDto$))?null:n.page)}}function Dn(a,r){if(1&a&&(e.j41(0,"div",35),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,t.messagePrefix+"no-items")," ")}}const Se=(a,r,t)=>a.touched&&!t||a.errors?.emailTaken&&t,w=[{provide:I.P3,useValue:Se}],Bn=[{path:_.P5,component:ht,resolve:{breadcrumb:C.S},providers:w,data:{title:"admin.access-control.epeople.title",breadcrumbKey:"admin.access-control.epeople"},canActivate:[T.Y]},{path:`${_.P5}/create`,component:ge,resolve:{breadcrumb:C.S},providers:w,data:{title:"admin.access-control.epeople.add.title",breadcrumbKey:"admin.access-control.epeople.add"},canActivate:[T.Y]},{path:`${_.P5}/:id/edit`,component:ge,resolve:{breadcrumb:C.S,ePerson:wt},providers:w,data:{title:"admin.access-control.epeople.edit.title",breadcrumbKey:"admin.access-control.epeople.edit"},canActivate:[T.Y]},{path:_.w4,component:(()=>{class a{constructor(t,n,i,s,l,m,h,c,x,S,G){this.groupService=t,this.ePersonDataService=n,this.dSpaceObjectDataService=i,this.translateService=s,this.notificationsService=l,this.formBuilder=m,this.routeService=h,this.authorizationService=c,this.paginationService=x,this.requestService=S,this.dsoNameService=G,this.messagePrefix="admin.access-control.groups.",this.config=Object.assign(new k.W,{id:"gl",pageSize:5,currentPage:1}),this.groupsDto$=new y.t({}),this.deletedGroupsIds=[],this.pageInfoState$=new y.t(void 0),this.loading$=new y.t(!1),this.subs=[],this.currentSearchQuery="",this.searchForm=this.formBuilder.group({query:this.currentSearchQuery})}ngOnInit(){this.search({query:this.currentSearchQuery})}search(t){(0,p.a4)(this.searchSub)&&(this.searchSub.unsubscribe(),this.subs=this.subs.filter(n=>n!==this.searchSub)),this.searchSub=this.paginationService.getCurrentPagination(this.config.id,this.config).pipe((0,Cn.M)(()=>this.loading$.next(!0)),(0,P.n)(n=>{const i=t.query;return null!=i&&this.currentSearchQuery!==i&&(this.currentSearchQuery=i,this.paginationService.updateRouteWithUrl(this.config.id,[],{page:1})),this.groupService.searchGroups(this.currentSearchQuery.trim(),{currentPage:n.currentPage,elementsPerPage:n.pageSize},!0,!0,(0,M.s)("object"))}),(0,d.v7)(),(0,d.Bo)(),(0,P.n)(n=>0===n.page.length?(0,E.of)((0,A.g)(n.pageInfo,[])):this.authorizationService.isAuthorized(D._.AdministratorOf).pipe((0,P.n)(i=>(0,N.z)([...n.page.map(s=>(0,p.a4)(s)&&!this.deletedGroupsIds.includes(s.id)?(0,N.z)([this.authorizationService.isAuthorized(D._.CanDelete,s.self),this.canManageGroup$(i,s),this.hasLinkedDSO(s),this.getSubgroups(s),this.getMembers(s)]).pipe((0,u.T)(([l,m,h,c,x])=>{const S=new Rn;return S.ableToDelete=l&&!h,S.ableToEdit=m,S.group=s,S.subgroups=c.payload,S.epersons=x.payload,S})):xn.w)]).pipe((0,En.U)([]),(0,u.T)(s=>(0,A.g)(n.pageInfo,s))))))).subscribe(n=>{this.groupsDto$.next(n),this.pageInfoState$.next(n.pageInfo),this.loading$.next(!1)}),this.subs.push(this.searchSub)}canManageGroup$(t,n){return t?(0,E.of)(!0):this.authorizationService.isAuthorized(D._.CanManageGroup,n.self)}deleteGroup(t){(0,p.a4)(t.group.id)&&this.groupService.delete(t.group.id).pipe((0,d.qD)()).subscribe(n=>{n.hasSucceeded?(this.deletedGroupsIds=[...this.deletedGroupsIds,t.group.id],this.notificationsService.success(this.translateService.get(this.messagePrefix+"notification.deleted.success",{name:this.dsoNameService.getName(t.group)}))):this.notificationsService.error(this.translateService.get(this.messagePrefix+"notification.deleted.failure.title",{name:this.dsoNameService.getName(t.group)}),this.translateService.get(this.messagePrefix+"notification.deleted.failure.content",{cause:n.errorMessage}))})}getMembers(t){return this.ePersonDataService.findListByHref(t._links.epersons.href,{currentPage:1,elementsPerPage:1}).pipe((0,d.yd)())}getSubgroups(t){return this.groupService.findListByHref(t._links.subgroups.href,{currentPage:1,elementsPerPage:1}).pipe((0,d.yd)())}hasLinkedDSO(t){return this.dSpaceObjectDataService.findByHref(t._links.object.href).pipe((0,d.yd)(),(0,u.T)(n=>(0,p.a4)(n)&&(0,p.a4)(n.payload)),(0,de.W)(()=>(0,E.of)(!1)))}clearFormAndResetResult(){this.searchForm.patchValue({query:""}),this.search({query:""})}ngOnDestroy(){this.cleanupSubscribes(),this.paginationService.clearPagination(this.config.id)}cleanupSubscribes(){(0,p.a4)(this.paginationSub)&&this.paginationSub.unsubscribe(),this.subs.filter(t=>(0,p.a4)(t)).forEach(t=>t.unsubscribe()),this.paginationService.clearPagination(this.config.id)}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(H.GroupDataService),e.rXU(V.EPersonDataService),e.rXU(me.DSpaceObjectDataService),e.rXU(b.c$),e.rXU(U.I),e.rXU(f.ze),e.rXU(Fn.v$),e.rXU(z.AuthorizationDataService),e.rXU(W.m),e.rXU(J.B),e.rXU(O.f))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["ds-groups-registry"]],standalone:!0,features:[e.aNF],decls:38,vars:34,consts:[[1,"container"],[1,"groups-registry","row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom","mb-3"],["id","header",1,"pb-2"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline","ml-1"],["id","search",1,"border-bottom","pb-2"],[1,"d-flex","justify-content-between",3,"ngSubmit","formGroup"],[1,"flex-grow-1","mr-3"],[1,"form-group","input-group"],["type","text","name","query","id","query","formControlName","query",1,"form-control",3,"placeholder"],[1,"input-group-append"],["type","submit",1,"search-button","btn","btn-primary"],[1,"fas","fa-search"],[1,"btn","btn-secondary",3,"click"],[4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage",4,"ngIf"],["class","alert alert-info w-100 mb-2","role","alert",4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"table-responsive"],["id","groups",1,"table","table-striped","table-hover","table-bordered"],["scope","col"],[4,"ngFor","ngForOf"],[1,"btn-group","edit-field"],[3,"ngSwitch"],["class","btn btn-outline-primary btn-sm btn-edit",3,"routerLink","title",4,"ngSwitchCase"],["class","btn btn-outline-primary btn-sm btn-edit","placement","left",3,"disabled","ngbTooltip",4,"ngSwitchCase"],["class","btn btn-outline-danger btn-sm btn-delete",3,"title","click",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],["placement","left",1,"btn","btn-outline-primary","btn-sm","btn-edit",3,"disabled","ngbTooltip"],[1,"btn","btn-outline-danger","btn-sm","btn-delete",3,"click","title"],[1,"fas","fa-trash-alt","fa-fw"],["role","alert",1,"alert","alert-info","w-100","mb-2"]],template:function(n,i){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"div")(8,"button",5),e.nrm(9,"i",6),e.j41(10,"span",7),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"h2",8),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"form",9),e.bIt("ngSubmit",function(){return i.search(i.searchForm.value)}),e.j41(17,"div",10)(18,"div",11),e.nrm(19,"input",12),e.nI1(20,"translate"),e.nI1(21,"translate"),e.j41(22,"span",13)(23,"button",14),e.nrm(24,"i",15),e.EFF(25),e.nI1(26,"translate"),e.k0s()()()(),e.j41(27,"div")(28,"button",16),e.bIt("click",function(){return i.clearFormAndResetResult()}),e.EFF(29),e.nI1(30,"translate"),e.k0s()()(),e.DNE(31,Tn,1,0,"ds-loading",17),e.nI1(32,"async"),e.DNE(33,Nn,24,24,"ds-pagination",18),e.nI1(34,"async"),e.nI1(35,"async"),e.DNE(36,Dn,3,3,"div",19),e.nI1(37,"async"),e.k0s()()()),2&n){let s,l;e.R7$(5),e.JRh(e.bMT(6,12,i.messagePrefix+"head")),e.R7$(3),e.Y8G("routerLink","create"),e.R7$(3),e.JRh(e.bMT(12,14,i.messagePrefix+"button.add")),e.R7$(3),e.JRh(e.bMT(15,16,i.messagePrefix+"search.head")),e.R7$(2),e.Y8G("formGroup",i.searchForm),e.R7$(3),e.Y8G("placeholder",e.bMT(20,18,i.messagePrefix+"search.placeholder")),e.BMQ("aria-label",e.bMT(21,20,i.messagePrefix+"search.placeholder")),e.R7$(6),e.SpI(" ",e.bMT(26,22,i.messagePrefix+"search.button")," "),e.R7$(4),e.SpI(" ",e.bMT(30,24,i.messagePrefix+"button.see-all")," "),e.R7$(2),e.Y8G("ngIf",e.bMT(32,26,i.loading$)),e.R7$(2),e.Y8G("ngIf",(null==(s=e.bMT(34,28,i.pageInfoState$))?null:s.totalElements)>0&&!0!==e.bMT(35,30,i.loading$)),e.R7$(3),e.Y8G("ngIf",0===(null==(l=e.bMT(37,32,i.pageInfoState$))?null:l.totalElements))}},dependencies:[te.v,b.h,b.D9,R.Wk,f.X1,f.qT,f.me,f.BC,f.cb,f.j4,f.JD,g.Jj,g.bT,X.e,g.ux,g.e1,v.n8,v.md,g.Sq],encapsulation:2})}return a})(),resolve:{breadcrumb:C.S},providers:w,data:{title:"admin.access-control.groups.title",breadcrumbKey:"admin.access-control.groups"},canActivate:[j.i]},{path:`${_.w4}/create`,component:ve,resolve:{breadcrumb:C.S},providers:w,data:{title:"admin.access-control.groups.title.addGroup",breadcrumbKey:"admin.access-control.groups.addGroup"},canActivate:[j.i]},{path:`${_.w4}/:groupId/edit`,component:ve,resolve:{breadcrumb:C.S},providers:w,data:{title:"admin.access-control.groups.title.singleGroup",breadcrumbKey:"admin.access-control.groups.singleGroup"},canActivate:[(a=Pn,r)=>(0,Sn.h)(()=>(0,E.of)([D._.CanManageGroup]),a,r)]},{path:"bulk-access",component:ot,resolve:{breadcrumb:C.S},data:{title:"admin.access-control.bulk-access.title",breadcrumbKey:"admin.access-control.bulk-access"},canActivate:[T.Y]}]},72553:(Z,$,o)=>{o.d($,{Q:()=>I});class I{constructor(j,T){this.text=j,this.url=T}}},32588:(Z,$,o)=>{o.d($,{S:()=>Y});var I=o(53107),C=o(72683),j=o(67044),T=o(63016),_=o(72553);let y=(()=>{class u{getBreadcrumbs(B,g){return(0,T.of)([new _.Q(B+".breadcrumbs",g)])}static#e=this.\u0275fac=function(g){return new(g||u)};static#t=this.\u0275prov=I.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})();const Y=(u,ne,B=(0,I.WQX)(y))=>{const g=u.data.breadcrumbKey;if((0,C.Tn)(g))throw new Error('You provided an i18nBreadcrumbResolver for url "'+u.url+"\" but no breadcrumbKey in the route's data");return{provider:B,key:g,url:(0,j.F)(u)}}},88663:(Z,$,o)=>{o.d($,{j:()=>j});const C={RESOLVED:(0,o(83770).N)("dspace/resolver/RESOLVED")};class j{constructor(_,b){this.type=C.RESOLVED,this.payload={url:_,dso:b}}}}}]);