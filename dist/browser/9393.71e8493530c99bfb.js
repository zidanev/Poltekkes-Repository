(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9393],{72553:(U,b,r)=>{"use strict";r.d(b,{Q:()=>i});class i{constructor(C,h){this.text=C,this.url=h}}},32588:(U,b,r)=>{"use strict";r.d(b,{S:()=>M});var i=r(53107),u=r(72683),C=r(67044),h=r(63016),I=r(72553);let S=(()=>{class p{getBreadcrumbs(g,n){return(0,h.of)([new I.Q(g+".breadcrumbs",n)])}static#e=this.\u0275fac=function(n){return new(n||p)};static#t=this.\u0275prov=i.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})();const M=(p,f,g=(0,i.WQX)(S))=>{const n=p.data.breadcrumbKey;if((0,u.Tn)(n))throw new Error('You provided an i18nBreadcrumbResolver for url "'+p.url+"\" but no breadcrumbKey in the route's data");return{provider:g,key:n,url:(0,C.F)(p)}}},14690:(U,b,r)=>{"use strict";r.r(b),r.d(b,{ProfilePageMetadataFormComponent:()=>j});var i=r(54460),u=r(89593),C=r(87599),h=r.n(C),I=r(86722),O=r(31363),M=(r(82831),r(12007)),p=r(72683),f=r(28022),g=r(36590),n=r(79224),c=r(53107),k=r(69685);function y(B,A){if(1&B&&c.nrm(0,"ds-form",1),2&B){const d=c.XpG();c.Y8G("formId","profile-page-metadata-form-id")("formModel",d.formModel)("formGroup",d.formGroup)("displaySubmit",!1)("displayCancel",!1)}}let j=(()=>{class B{constructor(d,E,v,t){this.formBuilderService=d,this.translate=E,this.epersonService=v,this.notificationsService=t,this.formModel=[new u.rA_({id:"email",name:"email",readOnly:!0,disabled:!0}),new u.rA_({id:"firstname",name:"eperson.firstname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"},autoComplete:"given-name"}),new u.rA_({id:"lastname",name:"eperson.lastname",required:!0,validators:{required:null},errorMessages:{required:"This field is required"},autoComplete:"family-name"}),new u.rA_({id:"phone",name:"eperson.phone",autoComplete:"tel"}),new u.z4z({id:"language",name:"eperson.language"})],this.LABEL_PREFIX="profile.metadata.form.label.",this.ERROR_PREFIX="profile.metadata.form.error.",this.NOTIFICATION_PREFIX="profile.metadata.form.notifications."}ngOnInit(){this.activeLangs=I.c.languages.filter(d=>!0===d.active),this.setFormValues(),this.updateFieldTranslations(),this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()})}setFormValues(){this.formModel.forEach(d=>{d.value="email"===d.name?this.user.email:this.user.firstMetadataValue(d.name),"language"===d.id&&(d.options=this.activeLangs.map(E=>Object.assign({value:E.code,label:E.label})))}),this.formGroup=this.formBuilderService.createFormGroup(this.formModel)}updateFieldTranslations(){this.formModel.forEach(d=>{d.label=this.translate.instant(this.LABEL_PREFIX+d.id),(0,p.hj)(d.validators)&&(d.errorMessages={},Object.keys(d.validators).forEach(E=>{d.errorMessages[E]=this.translate.instant(this.ERROR_PREFIX+d.id+"."+E)}))})}updateProfile(){if(!this.formGroup.valid)return!1;const d=h()(this.user.metadata);let E=!1;return this.formModel.filter(v=>"email"!==v.id).forEach(v=>{d.hasOwnProperty(v.name)&&d[v.name].length>0?(0,p.a4)(v.value)?d[v.name][0].value!==v.value&&(d[v.name][0].value=v.value,E=!0):(d[v.name]=[],E=!0):(0,p.a4)(v.value)&&(d[v.name]=[{value:v.value,language:null}],E=!0)}),E&&this.epersonService.update(Object.assign(h()(this.user),{metadata:d})).pipe((0,M.yd)(),(0,M.Bo)()).subscribe(v=>{this.user=v,this.setFormValues(),this.notificationsService.success(this.translate.instant(this.NOTIFICATION_PREFIX+"success.title"),this.translate.instant(this.NOTIFICATION_PREFIX+"success.content"))}),E}static#e=this.\u0275fac=function(E){return new(E||B)(c.rXU(f.j),c.rXU(k.c$),c.rXU(O.EPersonDataService),c.rXU(n.I))};static#t=this.\u0275cmp=c.VBU({type:B,selectors:[["ds-base-profile-page-metadata-form"]],inputs:{user:"user"},standalone:!0,features:[c.aNF],decls:1,vars:1,consts:[[3,"formId","formModel","formGroup","displaySubmit","displayCancel",4,"ngIf"],[3,"formId","formModel","formGroup","displaySubmit","displayCancel"]],template:function(E,v){1&E&&c.DNE(0,y,1,5,"ds-form",0),2&E&&c.Y8G("ngIf",v.formModel)},dependencies:[g.s,i.bT],encapsulation:2})}return B})()},83468:(U,b,r)=>{"use strict";r.d(b,{O:()=>S}),r(82831);var u=r(21124),h=(r(14690),r(53107));const I=["*"];function O(M,p){}let S=(()=>{class M extends u.J{constructor(){super(...arguments),this.inAndOutputNames=["user"]}getComponentName(){return"ProfilePageMetadataFormComponent"}importThemedComponent(f){return r(46020)(`./${f}/app/profile-page/profile-page-metadata-form/profile-page-metadata-form.component`)}importUnthemedComponent(){return Promise.resolve().then(r.bind(r,14690))}static#e=this.\u0275fac=(()=>{let f;return function(n){return(f||(f=h.xGo(M)))(n||M)}})();static#t=this.\u0275cmp=h.VBU({type:M,selectors:[["ds-profile-page-metadata-form"]],inputs:{user:"user"},standalone:!0,features:[h.Vt3,h.aNF],ngContentSelectors:I,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(g,n){1&g&&(h.NAR(),h.DNE(0,O,0,0,"ng-template",null,0,h.C5r),h.j41(2,"div",null,1),h.SdG(4),h.k0s())},encapsulation:2})}return M})()},13892:(U,b,r)=>{"use strict";r.d(b,{g:()=>ee});var i=r(54460),u=r(69685),C=r(61299),h=r(71217),I=r(37610),O=r(22867),S=r(47947),M=r(82040),p=r(27035),f=r(21706),n=(r(82831),r(12792)),c=r(12007),k=r(14922),y=r(72683),j=r(79224),B=r(24106),A=r(63524),d=r(63016),E=r(67811),v=r(51206),t=r(63496),e=r(53107);let N=(()=>{class l{constructor(s){this.searchService=s}hasProfilesToSuggest(s){return this.searchForSuggestions(s).pipe((0,c.qD)(),(0,S.T)(a=>(0,y.hj)(a)&&a.hasSucceeded&&a.payload?.page?.length>0))}searchForSuggestions(s){const a=this.personQueryData(s);return(0,y.Im)(a)?(0,d.of)((0,v.Wh)()):this.lookup(a)}lookup(s){return(0,y.Im)(s)?(0,d.of)((0,v.Wh)()):this.searchService.search(new t.C({configuration:"eperson_claims",query:s}),null,!1,!0)}personQueryData(s){return s&&s.email?"person.email:"+s.email:null}static#e=this.\u0275fac=function(a){return new(a||l)(e.KVO(E.S))};static#t=this.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var L=r(83116),x=(r(47587),r(88842)),X=r(15497),V=r(2771),W=r(79599),K=r(47637),G=r(2155),m=r(95968);function F(l,$){if(1&l){const s=e.RV6();e.j41(0,"div",9)(1,"button",16,0),e.bIt("click",function(){const P=e.eBV(s).$implicit,R=e.XpG();return e.Njj(R.selectItem(P.indexableObject))}),e.nrm(3,"ds-listable-object-component-loader",17),e.k0s()()}if(2&l){const s=$.$implicit,a=e.XpG();e.R7$(),e.FS9("title",a.dsoNameService.getName(s.indexableObject)),e.R7$(2),e.Y8G("object",s)("viewMode",a.viewMode)("linkType",a.linkTypes.None)}}let o=(()=>{class l extends V.${constructor(s,a,P,R,z){super(s,a),this.activeModal=s,this.route=a,this.router=P,this.profileClaimService=R,this.dsoNameService=z,this.listEntries$=new h.t(null),this.viewMode=x.n.ListElement,this.linkTypes=W.n,this.checked=!1,this.create=new e.bkB}ngOnInit(){this.profileClaimService.searchForSuggestions(this.dso).pipe((0,c.qD)()).subscribe(s=>this.listEntries$.next(s))}selectItem(s){this.close(),this.navigate(s)}navigate(s){this.router.navigate([(0,X._o)(s)])}toggleCheckbox(){this.checked=!this.checked}createFromScratch(){this.create.emit(),this.close()}static#e=this.\u0275fac=function(a){return new(a||l)(e.rXU(G.Lw),e.rXU(m.nX),e.rXU(m.Ix),e.rXU(N),e.rXU(L.f))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["ds-profile-claim-item-modal"]],inputs:{dso:"dso"},outputs:{create:"create"},standalone:!0,features:[e.Vt3,e.aNF],decls:27,vars:17,consts:[["listEntryElement",""],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],["role","alert",1,"alert","alert-info"],[1,"dropdown-divider"],[1,"scrollable-menu","list-group","container"],["class","row",4,"ngFor","ngForOf"],[1,"row"],[1,"col-md","mt-2"],[1,"modal-footer"],[1,"mr-5"],["type","checkbox",3,"change","checked"],["type","submit",1,"btn","btn-primary","ml-5","mr-2",3,"click","disabled"],[1,"fas","fa-plus"],[1,"list-group-item","list-group-item-action","border-0","list-entry",3,"click","title"],[3,"object","viewMode","linkType"]],template:function(a,P){if(1&a&&(e.j41(0,"div")(1,"div",1)(2,"h4"),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"button",2),e.bIt("click",function(){return P.close()}),e.j41(6,"span",3),e.EFF(7,"\xd7"),e.k0s()()(),e.j41(8,"div",4)(9,"div",5),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.nrm(12,"div",6),e.j41(13,"div",7),e.DNE(14,F,4,4,"div",8),e.nI1(15,"async"),e.j41(16,"div",9),e.nrm(17,"div",10),e.k0s()()(),e.j41(18,"div",11)(19,"div",12)(20,"input",13),e.bIt("change",function(){return P.toggleCheckbox()}),e.k0s(),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.j41(23,"button",14),e.bIt("click",function(){return P.createFromScratch()}),e.nrm(24,"i",15),e.EFF(25),e.nI1(26,"translate"),e.k0s()()()),2&a){let R;e.R7$(3),e.JRh(e.bMT(4,7,"dso-selector.claim.item.head")),e.R7$(7),e.SpI(" ",e.bMT(11,9,"dso-selector.claim.item.body")," "),e.R7$(4),e.Y8G("ngForOf",null==(R=e.bMT(15,11,P.listEntries$))?null:R.payload.page),e.R7$(6),e.Y8G("checked",P.checked),e.R7$(),e.SpI(" ",e.bMT(22,13,"dso-selector.claim.item.not-mine-label")," "),e.R7$(2),e.Y8G("disabled",!P.checked),e.R7$(2),e.SpI(" ",e.bMT(26,15,"dso-selector.claim.item.create-from-scratch")," ")}},dependencies:[K.v,i.Jj,u.h,u.D9,i.Sq],encapsulation:2})}return l})();function _(l,$){if(1&l){const s=e.RV6();e.j41(0,"div")(1,"p"),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"p",3)(5,"span",4),e.EFF(6),e.nI1(7,"translate"),e.k0s(),e.j41(8,"ui-switch",5),e.nI1(9,"translate"),e.nI1(10,"translate"),e.bIt("change",function(){e.eBV(s);const P=e.XpG().ngVar,R=e.XpG();return e.Njj(R.toggleProfileVisibility(P))}),e.k0s()()()}if(2&l){const s=e.XpG().ngVar;e.R7$(2),e.JRh(e.bMT(3,5,"researcher.profile.associated")),e.R7$(4),e.JRh(e.bMT(7,7,"researcher.profile.status")),e.R7$(2),e.Y8G("checkedLabel",e.bMT(9,9,"researcher.profile.public.visibility"))("uncheckedLabel",e.bMT(10,11,"researcher.profile.private.visibility"))("checked",s.visible)}}function T(l,$){1&l&&(e.j41(0,"div")(1,"p"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&l&&(e.R7$(2),e.JRh(e.bMT(3,1,"researcher.profile.not.associated")))}function D(l,$){1&l&&(e.j41(0,"span"),e.nrm(1,"i",7),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&l&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"researcher.profile.action.processing")," "))}function Y(l,$){1&l&&(e.j41(0,"span"),e.nrm(1,"i",8),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&l&&(e.R7$(2),e.SpI(" \xa0",e.bMT(3,1,"researcher.profile.create.new")," "))}function w(l,$){if(1&l){const s=e.RV6();e.j41(0,"button",6),e.nI1(1,"async"),e.bIt("click",function(){e.eBV(s);const P=e.XpG(2);return e.Njj(P.createProfile())}),e.DNE(2,D,4,3,"span",1),e.nI1(3,"async"),e.DNE(4,Y,4,3,"span",1),e.nI1(5,"async"),e.k0s()}if(2&l){const s=e.XpG(2);e.Y8G("disabled",e.bMT(1,3,s.isProcessingCreate())),e.R7$(2),e.Y8G("ngIf",e.bMT(3,5,s.isProcessingCreate())),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(5,7,s.isProcessingCreate()))}}function J(l,$){1&l&&(e.j41(0,"span"),e.nrm(1,"i",7),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&l&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"researcher.profile.action.processing")," "))}function H(l,$){1&l&&(e.j41(0,"span"),e.nrm(1,"i",11),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&l&&(e.R7$(2),e.SpI(" \xa0",e.bMT(3,1,"researcher.profile.delete")," "))}function Z(l,$){if(1&l){const s=e.RV6();e.qex(0),e.j41(1,"button",6),e.bIt("click",function(){e.eBV(s);const P=e.XpG().ngVar,R=e.XpG();return e.Njj(R.viewProfile(P))}),e.nrm(2,"i",9),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"button",10),e.bIt("click",function(){e.eBV(s);const P=e.XpG().ngVar,R=e.XpG();return e.Njj(R.deleteProfile(P))}),e.DNE(6,J,4,3,"span",1),e.nI1(7,"async"),e.DNE(8,H,4,3,"span",1),e.nI1(9,"async"),e.k0s(),e.bVm()}if(2&l){const s=e.XpG().ngVar,a=e.XpG();e.R7$(),e.Y8G("disabled",!s),e.R7$(2),e.SpI(" ",e.bMT(4,5,"researcher.profile.view")," "),e.R7$(2),e.Y8G("disabled",!s),e.R7$(),e.Y8G("ngIf",e.bMT(7,7,a.isProcessingDelete())),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(9,9,a.isProcessingDelete()))}}function q(l,$){if(1&l&&(e.j41(0,"div"),e.DNE(1,_,11,13,"div",1)(2,T,4,3,"div",1)(3,w,6,9,"button",2)(4,Z,10,11,"ng-container",1),e.k0s()),2&l){const s=$.ngVar;e.R7$(),e.Y8G("ngIf",s),e.R7$(),e.Y8G("ngIf",!s),e.R7$(),e.Y8G("ngIf",!s),e.R7$(),e.Y8G("ngIf",s)}}let ee=(()=>{class l{constructor(s,a,P,R,z,te,re){this.researcherProfileService=s,this.profileClaimService=a,this.translationService=P,this.notificationService=R,this.authService=z,this.router=te,this.modalService=re,this.researcherProfile$=new h.t(null),this.processingDelete$=new h.t(!1),this.processingCreate$=new h.t(!1)}ngOnInit(){this.initResearchProfile()}createProfile(){this.processingCreate$.next(!0),this.authService.getAuthenticatedUserFromStore().pipe((0,I.s)(1),(0,O.n)(s=>this.profileClaimService.hasProfilesToSuggest(s))).subscribe(s=>{if(s){this.processingCreate$.next(!1);const a=this.modalService.open(o);a.componentInstance.dso=this.user,a.componentInstance.create.pipe((0,I.s)(1)).subscribe(()=>{this.createProfileFromScratch()})}else this.createProfileFromScratch()})}viewProfile(s){null!=this.researcherProfileItemId&&this.router.navigate(["items",this.researcherProfileItemId])}deleteProfile(s){const a=this.modalService.open(k.M);a.componentInstance.headerLabel="confirmation-modal.delete-profile.header",a.componentInstance.infoLabel="confirmation-modal.delete-profile.info",a.componentInstance.cancelLabel="confirmation-modal.delete-profile.cancel",a.componentInstance.confirmLabel="confirmation-modal.delete-profile.confirm",a.componentInstance.brandColor="danger",a.componentInstance.confirmIcon="fas fa-trash",a.componentInstance.response.pipe((0,I.s)(1)).subscribe(P=>{P&&(this.processingDelete$.next(!0),this.researcherProfileService.delete(s.id).pipe((0,c.qD)(),(0,S.T)(R=>R.isSuccess)).subscribe(R=>{R&&(this.researcherProfile$.next(null),this.researcherProfileItemId=null),this.processingDelete$.next(!1)}))})}toggleProfileVisibility(s){this.researcherProfileService.setVisibility(s,!s.visible).pipe((0,c.qD)()).subscribe(a=>{a.hasSucceeded?this.researcherProfile$.next(a.payload):this.notificationService.error(null,this.translationService.get("researcher.profile.change-visibility.fail"))})}isProcessingDelete(){return this.processingDelete$.asObservable()}isProcessingCreate(){return this.processingCreate$.asObservable()}createProfileFromScratch(){this.processingCreate$.next(!0),this.researcherProfileService.create().pipe((0,c.qD)()).subscribe(s=>{this.processingCreate$.next(!1),s.isSuccess?(this.initResearchProfile(),this.notificationService.success(null,this.translationService.get("researcher.profile.create.success"))):this.notificationService.error(null,this.translationService.get("researcher.profile.create.fail"))})}initResearchProfile(){this.researcherProfileService.findById(this.user.id,!1,!0,(0,B.s)("item")).pipe((0,c.ak)(),(0,M.M)(s=>this.researcherProfile$.next(s)),(0,p.Z)(s=>this.researcherProfileService.findRelatedItemId(s))).subscribe(s=>{(0,y.hj)(s)&&(this.researcherProfileItemId=s)})}static#e=this.\u0275fac=function(a){return new(a||l)(e.rXU(n.ResearcherProfileDataService),e.rXU(N),e.rXU(u.c$),e.rXU(j.I),e.rXU(f.uR),e.rXU(m.Ix),e.rXU(G.Bq))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["ds-profile-page-researcher-form"]],inputs:{user:"user"},standalone:!0,features:[e.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],["class","btn btn-primary mr-2",3,"disabled","click",4,"ngIf"],[1,"align-items-center","researcher-profile-switch"],[1,"mr-3"],[3,"change","checkedLabel","uncheckedLabel","checked"],[1,"btn","btn-primary","mr-2",3,"click","disabled"],[1,"fas","fa-circle-notch","fa-spin"],[1,"fas","fa-plus"],[1,"fas","fa-info-circle"],[1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-trash-alt"]],template:function(a,P){1&a&&(e.DNE(0,q,5,4,"div",0),e.nI1(1,"async")),2&a&&e.Y8G("ngVar",e.bMT(1,1,P.researcherProfile$))},dependencies:[i.bT,i.Jj,u.h,u.D9,C.z,C.S,A.r],encapsulation:2})}return l})()},19393:(U,b,r)=>{"use strict";r.r(b),r.d(b,{ROUTES:()=>M});var i=r(32588),u=r(21124),h=(r(62562),r(53107));const I=["*"];function O(p,f){}const M=[{path:"",pathMatch:"full",component:(()=>{class p extends u.J{getComponentName(){return"ProfilePageComponent"}importThemedComponent(g){return r(86930)(`./${g}/app/profile-page/profile-page.component`)}importUnthemedComponent(){return Promise.resolve().then(r.bind(r,62562))}static#e=this.\u0275fac=(()=>{let g;return function(c){return(g||(g=h.xGo(p)))(c||p)}})();static#t=this.\u0275cmp=h.VBU({type:p,selectors:[["ds-profile-page"]],standalone:!0,features:[h.Vt3,h.aNF],ngContentSelectors:I,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(n,c){1&n&&(h.NAR(),h.DNE(0,O,0,0,"ng-template",null,0,h.C5r),h.j41(2,"div",null,1),h.SdG(4),h.k0s())},encapsulation:2})}return p})(),resolve:{breadcrumb:i.S},data:{breadcrumbKey:"profile",title:"profile.title"}}]},62562:(U,b,r)=>{"use strict";r.r(b),r.d(b,{ProfilePageComponent:()=>G});var i=r(54460),u=r(69685),C=r(71217),h=r(41483),I=r(22867),O=r(82040),S=r(21706),M=r(83116),p=r(84195),f=r(77304),g=r(36556),n=r(31363),c=r(12007),k=r(74549),y=r(72683),j=r(79224),B=r(24106),A=r(63524),d=r(83468),E=r(13892),v=r(16840),t=r(53107);function e(m,F){if(1&m){const o=t.RV6();t.j41(0,"div",12)(1,"div",4),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",5)(5,"ds-profile-page-security-form",13),t.bIt("isInvalid",function(T){t.eBV(o);const D=t.XpG(3);return t.Njj(D.setInvalid(T))})("passwordValue",function(T){t.eBV(o);const D=t.XpG(3);return t.Njj(D.setPasswordValue(T))})("currentPasswordValue",function(T){t.eBV(o);const D=t.XpG(3);return t.Njj(D.setCurrentPasswordValue(T))}),t.k0s()()()}2&m&&(t.R7$(2),t.JRh(t.bMT(3,2,"profile.card.security")),t.R7$(3),t.Y8G("FORM_PREFIX","profile.security.form."))}function N(m,F){if(1&m&&(t.j41(0,"li",18),t.EFF(1),t.k0s()),2&m){const o=F.$implicit,_=t.XpG(5);t.R7$(),t.JRh(_.dsoNameService.getName(o))}}function L(m,F){if(1&m&&(t.j41(0,"div")(1,"h2",15),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",16),t.DNE(5,N,2,1,"li",17),t.k0s()()),2&m){const o=t.XpG().ngVar;t.R7$(2),t.JRh(t.bMT(3,2,"profile.groups.head")),t.R7$(3),t.Y8G("ngForOf",o)}}function Q(m,F){if(1&m&&(t.qex(0),t.DNE(1,L,6,4,"div",14),t.bVm()),2&m){const o=F.ngVar;t.R7$(),t.Y8G("ngIf",(null==o?null:o.length)>0)}}function x(m,F){if(1&m&&(t.j41(0,"li",18),t.EFF(1),t.k0s()),2&m){const o=F.$implicit,_=t.XpG(5);t.R7$(),t.SpI(" ",_.dsoNameService.getName(o)," ")}}function X(m,F){if(1&m&&(t.j41(0,"div",20)(1,"h2",15),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",16),t.DNE(5,x,2,1,"li",17),t.k0s()()),2&m){const o=t.XpG().ngVar;t.R7$(2),t.JRh(t.bMT(3,2,"profile.special.groups.head")),t.R7$(3),t.Y8G("ngForOf",o)}}function V(m,F){if(1&m&&(t.qex(0),t.DNE(1,X,6,4,"div",19),t.bVm()),2&m){const o=F.ngVar;t.R7$(),t.Y8G("ngIf",(null==o?null:o.length)>0)}}function W(m,F){if(1&m){const o=t.RV6();t.j41(0,"div",2)(1,"h1"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.qex(4),t.j41(5,"div",3)(6,"div",4),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"div",5)(10,"div",6),t.nrm(11,"ds-profile-page-researcher-form",7),t.k0s(),t.nrm(12,"ds-suggestions-notification"),t.k0s()(),t.bVm(),t.j41(13,"div",3)(14,"div",4),t.EFF(15),t.nI1(16,"translate"),t.k0s(),t.j41(17,"div",5),t.nrm(18,"ds-profile-page-metadata-form",7),t.k0s()(),t.DNE(19,e,6,4,"div",8),t.nI1(20,"async"),t.j41(21,"div",9)(22,"button",10),t.bIt("click",function(){t.eBV(o);const T=t.XpG(2);return t.Njj(T.updateProfile())}),t.nrm(23,"i",11),t.EFF(24),t.nI1(25,"translate"),t.k0s()(),t.DNE(26,Q,2,1,"ng-container",0),t.nI1(27,"async"),t.DNE(28,V,2,1,"ng-container",0),t.nI1(29,"async"),t.k0s()}if(2&m){let o,_;const T=t.XpG().ngVar,D=t.XpG();t.R7$(2),t.JRh(t.bMT(3,9,"profile.title")),t.R7$(5),t.JRh(t.bMT(8,11,"profile.card.researcher")),t.R7$(4),t.Y8G("user",T),t.R7$(4),t.JRh(t.bMT(16,13,"profile.card.identify")),t.R7$(3),t.Y8G("user",T),t.R7$(),t.Y8G("ngIf",t.bMT(20,15,D.canChangePassword$)),t.R7$(5),t.SpI(" ",t.bMT(25,17,"profile.form.submit"),""),t.R7$(2),t.Y8G("ngVar",null==(o=t.bMT(27,19,D.groupsRD$))||null==o.payload?null:o.payload.page),t.R7$(2),t.Y8G("ngVar",null==(_=t.bMT(29,21,D.specialGroupsRD$))||null==_.payload?null:_.payload.page)}}function K(m,F){if(1&m&&(t.qex(0),t.DNE(1,W,30,23,"div",1),t.bVm()),2&m){const o=F.ngVar;t.R7$(),t.Y8G("ngIf",o)}}let G=(()=>{class m{constructor(o,_,T,D,Y,w,J){this.authService=o,this.notificationsService=_,this.translate=T,this.epersonService=D,this.authorizationService=Y,this.configurationService=w,this.dsoNameService=J,this.NOTIFICATIONS_PREFIX="profile.notifications.",this.PASSWORD_NOTIFICATIONS_PREFIX="profile.security.form.notifications.",this.isResearcherProfileEnabled$=new C.t(!1)}ngOnInit(){this.user$=this.authService.getAuthenticatedUserFromStore().pipe((0,h.p)(o=>(0,y.a4)(o.id)),(0,I.n)(o=>this.epersonService.findById(o.id,!0,!0,(0,B.s)("groups"))),(0,c.v7)(),(0,c.Bo)(),(0,O.M)(o=>this.currentUser=o)),this.groupsRD$=this.user$.pipe((0,I.n)(o=>o.groups)),this.canChangePassword$=this.user$.pipe((0,I.n)(o=>this.authorizationService.isAuthorized(g._.CanChangePassword,o._links.self.href))),this.specialGroupsRD$=this.authService.getSpecialGroupsFromAuthStatus(),this.configurationService.findByPropertyName("researcher-profile.entity-type").pipe((0,c.qD)()).subscribe(o=>{this.isResearcherProfileEnabled$.next(o.hasSucceeded&&o.payload.values.length>0)})}updateProfile(){const o=this.metadataForm.compRef.instance.updateProfile(),_=this.updateSecurity();!o&&!_&&this.notificationsService.warning(this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"warning.no-changes.content"))}setInvalid(o){this.invalidSecurity=o}updateSecurity(){const o=(0,y.hj)(this.password);return this.invalidSecurity&&this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.general")),!this.invalidSecurity&&o&&this.epersonService.patch(this.currentUser,[{op:"add",path:"/password",value:{new_password:this.password,current_password:this.currentPassword}}]).pipe((0,c.qD)()).subscribe(T=>{T.hasSucceeded?this.notificationsService.success(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.title"),this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"success.content")):this.notificationsService.error(this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.title"),this.getPasswordErrorMessage(T))}),o}setPasswordValue(o){this.password=o}setCurrentPasswordValue(o){this.currentPassword=o}submit(){this.updateProfile()}isResearcherProfileEnabled(){return this.isResearcherProfileEnabled$.asObservable()}getPasswordErrorMessage(o){return o.hasFailed&&(0,y.hj)(o.errorMessage)?this.translate.instant(o.errorMessage):this.translate.instant(this.PASSWORD_NOTIFICATIONS_PREFIX+"error.change-failed")}static#e=this.\u0275fac=function(_){return new(_||m)(t.rXU(S.uR),t.rXU(j.I),t.rXU(u.c$),t.rXU(n.EPersonDataService),t.rXU(f.AuthorizationDataService),t.rXU(p.ConfigurationDataService),t.rXU(M.f))};static#t=this.\u0275cmp=t.VBU({type:m,selectors:[["ds-base-profile-page"]],viewQuery:function(_,T){if(1&_&&t.GBs(d.O,5),2&_){let D;t.mGM(D=t.lsd())&&(T.metadataForm=D.first)}},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngIf"],[1,"container"],[1,"card","mb-4"],[1,"card-header"],[1,"card-body"],[1,"mb-4"],[3,"user"],["class","card mb-4 security-section",4,"ngIf"],[1,"col-12","text-right","pr-0"],[1,"btn","btn-primary",3,"click"],[1,"fas","fa-edit"],[1,"card","mb-4","security-section"],[3,"isInvalid","passwordValue","currentPasswordValue","FORM_PREFIX"],[4,"ngIf"],[1,"mt-4"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],["data-test","specialGroups",4,"ngIf"],["data-test","specialGroups"]],template:function(_,T){1&_&&(t.DNE(0,K,2,1,"ng-container",0),t.nI1(1,"async")),2&_&&t.Y8G("ngVar",t.bMT(1,1,T.user$))},dependencies:[d.O,v.q,i.Jj,u.h,u.D9,E.g,A.r,i.bT,i.Sq,k.w]})}return m})()},46020:(U,b,r)=>{var i={"./custom/app/profile-page/profile-page-metadata-form/profile-page-metadata-form.component":[61983,1983]};function u(C){if(!r.o(i,C))return Promise.resolve().then(()=>{var O=new Error("Cannot find module '"+C+"'");throw O.code="MODULE_NOT_FOUND",O});var h=i[C],I=h[0];return r.e(h[1]).then(()=>r(I))}u.keys=()=>Object.keys(i),u.id=46020,U.exports=u},86930:(U,b,r)=>{var i={"./custom/app/profile-page/profile-page.component":[1357,1357]};function u(C){if(!r.o(i,C))return Promise.resolve().then(()=>{var O=new Error("Cannot find module '"+C+"'");throw O.code="MODULE_NOT_FOUND",O});var h=i[C],I=h[0];return r.e(h[1]).then(()=>r(I))}u.keys=()=>Object.keys(i),u.id=86930,U.exports=u},61299:(U,b,r)=>{"use strict";r.d(b,{S:()=>M,z:()=>p});var i=r(53107),u=r(10936),C=r(54460);const h=["*"];function I(f,g){if(1&f&&(i.j41(0,"label",2)(1,"span",3),i.EFF(2),i.k0s(),i.j41(3,"span",4),i.EFF(4),i.k0s()()),2&f){const n=i.XpG();i.R7$(),i.xc7("color",n.getColor("checkedTextColor")),i.BMQ("aria-label",n.checkedLabel),i.R7$(),i.JRh(n.checkedLabel),i.R7$(),i.xc7("color",n.getColor("uncheckedTextColor")),i.BMQ("aria-label",n.uncheckedLabel),i.R7$(),i.JRh(n.uncheckedLabel)}}const O=new i.nKC("UI_SWITCH_OPTIONS"),S={provide:u.kq,useExisting:(0,i.Rfq)(()=>M),multi:!0};let M=(()=>{class f{constructor(n={},c){this.cdr=c,this.change=new i.bkB,this.changeEvent=new i.bkB,this.valueChange=new i.bkB,this.onTouchedCallback=k=>{},this.onChangeCallback=k=>{},this.size=n&&n.size||"medium",this.color=n&&n.color,this.switchOffColor=n&&n.switchOffColor,this.switchColor=n&&n.switchColor,this.defaultBgColor=n&&n.defaultBgColor,this.defaultBoColor=n&&n.defaultBoColor,this.checkedLabel=n&&n.checkedLabel,this.uncheckedLabel=n&&n.uncheckedLabel,this.checkedTextColor=n&&n.checkedTextColor,this.uncheckedTextColor=n&&n.uncheckedTextColor}set checked(n){this._checked=!1!==n}get checked(){return this._checked}set disabled(n){this._disabled=!1!==n}get disabled(){return this._disabled}set reverse(n){this._reverse=!1!==n}get reverse(){return this._reverse}set loading(n){this._loading=!1!==n}get loading(){return this._loading}getColor(n=""){return"borderColor"===n?this.defaultBoColor:"switchColor"===n?this.reverse?this.checked&&this.switchOffColor||this.switchColor:this.checked?this.switchColor:this.switchOffColor||this.switchColor:"checkedTextColor"===n?this.reverse?this.uncheckedTextColor:this.checkedTextColor:"uncheckedTextColor"===n?this.reverse?this.checkedTextColor:this.uncheckedTextColor:this.reverse?this.checked?this.defaultBgColor:this.color:this.checked?this.color:this.defaultBgColor}onClick(n){this.disabled||(this.checked=!this.checked,this.change.emit(this.checked),this.valueChange.emit(this.checked),this.changeEvent.emit(n),this.onChangeCallback(this.checked),this.onTouchedCallback(this.checked),this.cdr.markForCheck())}onToggle(n){this.disabled||(this.beforeChange?this._beforeChange=this.beforeChange.subscribe(c=>{c&&this.onClick(n)}):this.onClick(n))}writeValue(n){n!==this.checked&&(this.checked=!!n),this.onChangeCallback(this.checked),this.cdr&&this.cdr.markForCheck()}registerOnChange(n){this.onChangeCallback=n}registerOnTouched(n){this.onTouchedCallback=n}setDisabledState(n){this.disabled=n}ngOnDestroy(){this._beforeChange&&this._beforeChange.unsubscribe()}}return f.\u0275fac=function(n){return new(n||f)(i.rXU(O,8),i.rXU(i.gRc))},f.\u0275cmp=i.VBU({type:f,selectors:[["ui-switch"]],hostBindings:function(n,c){1&n&&i.bIt("click",function(y){return c.onToggle(y)})},inputs:{size:"size",color:"color",switchOffColor:"switchOffColor",switchColor:"switchColor",defaultBgColor:"defaultBgColor",defaultBoColor:"defaultBoColor",checkedLabel:"checkedLabel",uncheckedLabel:"uncheckedLabel",checkedTextColor:"checkedTextColor",uncheckedTextColor:"uncheckedTextColor",beforeChange:"beforeChange",ariaLabel:"ariaLabel",checked:"checked",disabled:"disabled",reverse:"reverse",loading:"loading"},outputs:{change:"change",changeEvent:"changeEvent",valueChange:"valueChange"},features:[i.Jv_([S])],ngContentSelectors:h,decls:4,vars:21,consts:[["type","button","role","switch",1,"switch"],["class","switch-pane",4,"ngIf"],[1,"switch-pane"],[1,"switch-label-checked"],[1,"switch-label-unchecked"]],template:function(n,c){1&n&&(i.NAR(),i.j41(0,"button",0),i.DNE(1,I,5,8,"label",1),i.j41(2,"small"),i.SdG(3),i.k0s()()),2&n&&(i.xc7("background-color",c.getColor())("border-color",c.getColor("borderColor")),i.AVh("checked",c.checked)("disabled",c.disabled)("loading",c.loading)("switch-large","large"===c.size)("switch-medium","medium"===c.size)("switch-small","small"===c.size),i.BMQ("aria-checked",c.checked)("aria-label",c.ariaLabel),i.R7$(),i.Y8G("ngIf",c.checkedLabel||c.uncheckedLabel),i.R7$(),i.xc7("background",c.getColor("switchColor")))},dependencies:[C.bT],encapsulation:2}),f})(),p=(()=>{class f{static forRoot(n){return{ngModule:f,providers:[{provide:O,useValue:n||{}}]}}}return f.\u0275fac=function(n){return new(n||f)},f.\u0275mod=i.$C({type:f}),f.\u0275inj=i.G2t({imports:[C.MD,u.YN,u.YN]}),f})()}}]);