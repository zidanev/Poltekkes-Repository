"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[8750],{68750:(Ye,B,a)=>{a.r(B),a.d(B,{ROUTES:()=>Be});var z=a(32588),H=a(63016),Y=a(36556);const w=(0,a(80599).L)(()=>(0,H.of)(Y._.IsCollectionAdmin));var W=a(59390),Q=a(99794),Z=a(81263),q=a(61305),u=a(54460),C=a(2155),h=a(69685),y=a(71217),T=a(76627),p=a(47947),f=a(22867),tt=a(30593),$=a(37610),U=a(83116),x=a(89632),et=a(17584),nt=a(69509),r=a(12007),ot=a(67811),it=a(3631),V=a(82506),O=a(2566),d=a(72683),F=a(79224),M=a(10936),m=a(95968),st=a(15497),at=a(96606),J=a(21548),ct=a(51661),G=a(63524),rt=a(79944),lt=a(52867),t=a(53107);const A=()=>["dc.contributor.author","dc.creator","dc.contributor.*"],ut=o=>["/collections",o],dt=(o,c)=>({"btn-danger":o,"btn-primary":c});function pt(o,c){1&o&&(t.j41(0,"th",10),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.JRh(t.bMT(2,1,"item.select.table.collection")))}function mt(o,c){if(1&o&&(t.j41(0,"a",14),t.EFF(1),t.k0s()),2&o){const e=t.XpG().ngVar,n=t.XpG(5);t.Y8G("routerLink",t.eq3(2,ut,null==e?null:e.id)),t.R7$(),t.SpI(" ",n.dsoNameService.getName(e)," ")}}function ht(o,c){if(1&o&&(t.j41(0,"span"),t.DNE(1,mt,2,4,"a",15),t.k0s()),2&o){const e=c.ngVar;t.R7$(),t.Y8G("ngIf",e)}}function ft(o,c){if(1&o&&(t.j41(0,"td"),t.DNE(1,ht,2,1,"span",1),t.nI1(2,"async"),t.k0s()),2&o){let e;const n=t.XpG().$implicit;t.R7$(),t.Y8G("ngVar",null==(e=t.bMT(2,1,n.dso.owningCollection))?null:e.payload)}}function gt(o,c){if(1&o&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&o){const e=t.XpG().$implicit;t.R7$(),t.JRh(e.dso.firstMetadataValue(t.lJ4(1,A)))}}function bt(o,c){if(1&o){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"input",12,0),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"translate"),t.bIt("change",function(){const i=t.eBV(e).$implicit,s=t.XpG(3);return t.Njj(s.switch(i.dso.id))}),t.k0s()(),t.DNE(7,ft,3,3,"td",13),t.j41(8,"td"),t.DNE(9,gt,2,2,"span",13),t.k0s(),t.j41(10,"td")(11,"a",14),t.EFF(12),t.k0s()()()}if(2&o){const e=c.$implicit,n=t.sdS(3),i=t.XpG(3);t.R7$(2),t.FS9("name",e.dso.id),t.Y8G("disabled",!1===t.bMT(4,8,e.canSelect$))("ngModel",t.bMT(5,10,e.selected$)),t.BMQ("aria-label",t.bMT(6,12,n.checked?"item.select.table.deselect":"item.select.table.select")),t.R7$(5),t.Y8G("ngIf",!i.hideCollection),t.R7$(2),t.Y8G("ngIf",e.dso.hasMetadata(t.lJ4(14,A))),t.R7$(2),t.Y8G("routerLink",e.route),t.R7$(),t.JRh(i.dsoNameService.getName(e.dso))}}function vt(o,c){if(1&o&&(t.j41(0,"ds-pagination",5)(1,"div",6)(2,"table",7)(3,"thead")(4,"tr")(5,"th")(6,"span",8),t.EFF(7),t.nI1(8,"translate"),t.k0s()(),t.DNE(9,pt,3,3,"th",9),t.j41(10,"th",10),t.EFF(11),t.nI1(12,"translate"),t.k0s(),t.j41(13,"th",10),t.EFF(14),t.nI1(15,"translate"),t.k0s()()(),t.j41(16,"tbody"),t.DNE(17,bt,13,15,"tr",11),t.nI1(18,"async"),t.k0s()()()()),2&o){const e=t.XpG().ngVar,n=t.XpG();t.Y8G("paginationOptions",n.paginationOptions)("sortOptions",n.sortOptions)("collectionSize",null==e||null==e.payload?null:e.payload.totalElements)("hidePagerWhenSinglePage",!0)("hideGear",!0),t.R7$(7),t.JRh(t.bMT(8,10,"item.select.table.selected")),t.R7$(2),t.Y8G("ngIf",!n.hideCollection),t.R7$(2),t.JRh(t.bMT(12,12,"item.select.table.author")),t.R7$(3),t.JRh(t.bMT(15,14,"item.select.table.title")),t.R7$(3),t.Y8G("ngForOf",t.bMT(18,16,n.selectItems$))}}function _t(o,c){1&o&&(t.j41(0,"div",16),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"item.select.empty")," "))}function St(o,c){1&o&&(t.nrm(0,"ds-error",17),t.nI1(1,"translate")),2&o&&t.FS9("message",t.bMT(1,1,"error.items"))}function It(o,c){1&o&&(t.nrm(0,"ds-loading",17),t.nI1(1,"translate")),2&o&&t.FS9("message",t.bMT(1,1,"loading.items"))}function Ct(o,c){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"button",18),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.onCancel())}),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",19),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.confirmSelected())}),t.EFF(5),t.nI1(6,"translate"),t.k0s()()}if(2&o){const e=c.ngVar,n=t.XpG(2);t.R7$(2),t.JRh(t.bMT(3,4,n.cancelButton)),t.R7$(2),t.Y8G("ngClass",t.l_i(8,dt,n.dangerConfirm,!n.dangerConfirm))("disabled",0===(null==e?null:e.length)),t.R7$(),t.SpI(" ",t.bMT(6,6,n.confirmButton)," ")}}function Tt(o,c){if(1&o&&(t.qex(0),t.DNE(1,vt,19,18,"ds-pagination",2)(2,_t,3,3,"div",3)(3,St,2,3,"ds-error",4)(4,It,2,3,"ds-loading",4)(5,Ct,7,11,"div",1),t.nI1(6,"async"),t.bVm()),2&o){const e=c.ngVar,n=t.XpG();t.R7$(),t.Y8G("ngIf",(null==e||null==e.payload?null:e.payload.totalElements)>0),t.R7$(),t.Y8G("ngIf",0===(null==e||null==e.payload?null:e.payload.totalElements)||0===(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)),t.R7$(),t.Y8G("ngIf",null==e?null:e.hasFailed),t.R7$(),t.Y8G("ngIf",!e||(null==e?null:e.isLoading)),t.R7$(),t.Y8G("ngVar",t.bMT(6,5,n.selectedIds$))}}let Rt=(()=>{class o extends lt.h{constructor(){super(...arguments),this.hideCollection=!1}ngOnInit(){super.ngOnInit(),(0,d.hj)(this.confirmButton)||(this.confirmButton="item.select.confirm"),this.selectItems$=this.dsoRD$.pipe((0,d.Az)(),(0,r.Hz)(),(0,p.T)(e=>e.page.map(n=>Object.assign(new rt.A,{dso:n,canSelect$:this.canSelect(n),selected$:this.getSelected(n.id),route:(0,st._o)(n)}))))}static#t=this.\u0275fac=(()=>{let e;return function(i){return(e||(e=t.xGo(o)))(i||o)}})();static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-item-select"]],inputs:{hideCollection:"hideCollection"},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["selectItemBtn",""],[4,"ngVar"],[3,"paginationOptions","sortOptions","collectionSize","hidePagerWhenSinglePage","hideGear",4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],[3,"paginationOptions","sortOptions","collectionSize","hidePagerWhenSinglePage","hideGear"],[1,"table-responsive","mt-2"],["id","item-select",1,"table","table-striped","table-hover"],[1,"sr-only"],["scope","col",4,"ngIf"],["scope","col"],[4,"ngFor","ngForOf"],["type","checkbox",1,"item-checkbox",3,"change","disabled","ngModel","name"],[4,"ngIf"],[3,"routerLink"],[3,"routerLink",4,"ngIf"],["role","alert",1,"alert","alert-info","w-100"],[3,"message"],[1,"btn","btn-outline-secondary","item-cancel","float-left",3,"click"],[1,"btn","item-confirm","float-right",3,"click","ngClass","disabled"]],template:function(n,i){1&n&&(t.DNE(0,Tt,7,7,"ng-container",1),t.nI1(1,"async")),2&n&&t.Y8G("ngVar",t.bMT(1,1,i.dsoRD$))},dependencies:[G.r,u.bT,ct.e,u.pM,M.YN,M.Zm,M.BC,M.vS,m.Wk,at.A,J.v,u.YU,u.Jj,h.h,h.D9],encapsulation:2})}return o})();var yt=a(63496),$t=a(85941),L=a(24106);const Ft=["tabs"],Mt=o=>({name:o});function jt(o,c){if(1&o){const e=t.RV6();t.j41(0,"div",11)(1,"ds-item-select",12),t.nI1(2,"async"),t.bIt("confirm",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.mapItems(i,!0))})("cancel",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onCancel())}),t.k0s()()}if(2&o){let e;const n=t.XpG();t.R7$(),t.Y8G("key","browse")("dsoRD$",n.collectionItemsRD$)("paginationOptions",null==(e=t.bMT(2,7,n.searchOptions$))?null:e.pagination)("confirmButton","collection.edit.item-mapper.remove")("cancelButton","collection.edit.item-mapper.cancel")("dangerConfirm",!0)("hideCollection",!0)}}function Gt(o,c){if(1&o){const e=t.RV6();t.j41(0,"div")(1,"ds-item-select",18),t.nI1(2,"async"),t.bIt("confirm",function(i){t.eBV(e);const s=t.XpG(2);return t.Njj(s.mapItems(i))})("cancel",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.onCancel())}),t.k0s()()}if(2&o){let e;const n=t.XpG(2);t.R7$(),t.Y8G("key","map")("dsoRD$",n.mappedItemsRD$)("paginationOptions",null==(e=t.bMT(2,6,n.searchOptions$))?null:e.pagination)("featureId",n.FeatureIds.CanManageMappings)("confirmButton","collection.edit.item-mapper.confirm")("cancelButton","collection.edit.item-mapper.cancel")}}function Et(o,c){1&o&&(t.j41(0,"div",19),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"collection.edit.item-mapper.no-search")," "))}function Dt(o,c){if(1&o){const e=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"ds-search-form",15),t.nI1(3,"async"),t.nI1(4,"async"),t.nI1(5,"translate"),t.bIt("submitSearch",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.performedSearch=!0)}),t.k0s()()(),t.DNE(6,Gt,3,8,"div",16)(7,Et,3,3,"div",17)}if(2&o){let e,n;const i=t.XpG();t.R7$(2),t.Y8G("query",null==(e=t.bMT(3,7,i.searchOptions$))?null:e.query)("scope",null==(n=t.bMT(4,9,i.searchOptions$))?null:n.scope)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",t.bMT(5,11,"collection.edit.item-mapper.search-form.placeholder")),t.R7$(4),t.Y8G("ngIf",i.performedSearch),t.R7$(),t.Y8G("ngIf",!i.performedSearch)}}let Nt=(()=>{class o{constructor(e,n,i,s,l,g,b,_){this.route=e,this.router=n,this.searchConfigService=i,this.searchService=s,this.notificationsService=l,this.itemDataService=g,this.translateService=b,this.dsoNameService=_,this.FeatureIds=Y._,this.defaultSortOptions=new x.z("dc.title",x.U.ASC),this.performedSearch=!1}ngOnInit(){this.collectionRD$=this.route.parent.data.pipe((0,p.T)(e=>e.dso),(0,r.yd)()),this.collectionName$=this.collectionRD$.pipe((0,p.T)(e=>this.dsoNameService.getName(e.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadItemLists()}loadItemLists(){this.shouldUpdate$=new y.t(!0);const e=(0,T.z)(this.collectionRD$,this.searchOptions$,this.shouldUpdate$);this.collectionItemsRD$=e.pipe((0,f.n)(([n,i,s])=>(!0===s&&this.shouldUpdate$.next(!1),this.itemDataService.findListByHref(n.payload._links.mappedItems.href,Object.assign(i,{currentPage:i.pagination.currentPage,elementsPerPage:i.pagination.pageSize,sort:this.defaultSortOptions}),!s,!1,(0,L.s)("owningCollection")).pipe((0,r.v7)())))),this.mappedItemsRD$=e.pipe((0,f.n)(([n,i,s])=>this.searchService.search(Object.assign(new yt.C(i),{query:this.buildQuery(n.payload.id,i.query),scope:void 0,dsoTypes:[nt.W.ITEM],sort:this.defaultSortOptions}),1e4,void 0,void 0,(0,L.s)("owningCollection")).pipe((0,r.jY)(),(0,tt.Z)(void 0))))}mapItems(e,n){const i=this.collectionRD$.pipe((0,r.yd)(),(0,p.T)(s=>s.payload),(0,f.n)(s=>(0,T.z)(e.map(l=>n?this.itemDataService.removeMappingFromCollection(l,s.id).pipe((0,r.qD)()):this.itemDataService.mapToCollection(l,s._links.self.href).pipe((0,r.qD)())))));this.showNotifications(i,n)}showNotifications(e,n){const i=n?"unmap":"map";e.subscribe(s=>{const l=s.filter(b=>b.hasSucceeded),g=s.filter(b=>b.hasFailed);l.length>0&&((0,T.z)(this.translateService.get(`collection.edit.item-mapper.notifications.${i}.success.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${i}.success.content`,{amount:l.length})).subscribe(([_,R])=>{this.notificationsService.success(_,R)}),this.shouldUpdate$.next(!0)),g.length>0&&(0,T.z)(this.translateService.get(`collection.edit.item-mapper.notifications.${i}.error.head`),this.translateService.get(`collection.edit.item-mapper.notifications.${i}.error.content`,{amount:g.length})).subscribe(([_,R])=>{this.notificationsService.error(_,R)}),this.switchToFirstTab()})}tabChange(e){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(e,n){const i=`-location.coll:"${e}"`;return(0,d.hj)(n)?`${i} AND ${n}`:i}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.collectionRD$.pipe((0,r.yd)(),(0,r.Bo)(),(0,$.s)(1)).subscribe(e=>{this.router.navigate(["/collections/",e.id])})}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(m.nX),t.rXU(m.Ix),t.rXU(V.EN),t.rXU(ot.S),t.rXU(F.I),t.rXU(et.ItemDataService),t.rXU(h.c$),t.rXU(U.f))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-item-mapper"]],viewQuery:function(n,i){if(1&n&&t.GBs(Ft,5),2&n){let s;t.mGM(s=t.lsd())&&(i.tabs=s.first)}},standalone:!0,features:[t.Jv_([{provide:V.EN,useClass:it.g}]),t.aNF],decls:25,vars:24,consts:[["tabs","ngbNav"],[1,"container"],[1,"row"],[1,"col-12"],["id","collection-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"navChange","destroyOnHide"],["role","presentation","data-test","browseTab",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],["role","presentation","data-test","mapTab",3,"ngbNavItem"],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm","hideCollection"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"submitSearch","query","scope","currentUrl","inPlaceSearch","searchPlaceholder"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","featureId","confirmButton","cancelButton"],["role","alert",1,"alert","alert-info","w-100"]],template:function(n,i){if(1&n){const s=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"p",4),t.nI1(7,"async"),t.nI1(8,"translate"),t.j41(9,"p"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"ul",5,0),t.bIt("navChange",function(g){return t.eBV(s),t.Njj(i.tabChange(g))}),t.j41(14,"li",6)(15,"a",7),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.DNE(18,jt,3,9,"ng-template",8),t.k0s(),t.j41(19,"li",9)(20,"a",7),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.DNE(23,Dt,8,13,"ng-template",8),t.k0s()(),t.nrm(24,"div",10),t.k0s()()()}if(2&n){const s=t.sdS(13);t.R7$(4),t.JRh(t.bMT(5,9,"collection.edit.item-mapper.head")),t.R7$(2),t.Y8G("innerHTML",t.i5U(8,13,"collection.edit.item-mapper.collection",t.eq3(22,Mt,t.bMT(7,11,i.collectionName$))),t.npT),t.R7$(4),t.JRh(t.bMT(11,16,"collection.edit.item-mapper.description")),t.R7$(2),t.Y8G("destroyOnHide",!0),t.R7$(2),t.Y8G("ngbNavItem","browseTab"),t.R7$(2),t.JRh(t.bMT(17,18,"collection.edit.item-mapper.tabs.browse")),t.R7$(3),t.Y8G("ngbNavItem","mapTab"),t.R7$(2),t.JRh(t.bMT(22,20,"collection.edit.item-mapper.tabs.map")),t.R7$(3),t.Y8G("ngbNavOutlet",s)}},dependencies:[$t.d,C.Pv,C.Um,C.X9,C.sy,C.Ri,C.m_,h.h,h.D9,u.Jj,Rt,u.bT],data:{animation:[O.qG,O.Ws]},changeDetection:0})}return o})();var kt=a(93068);function Xt(o,c){1&o&&t.nrm(0,"ds-access-control-form-container",1),2&o&&t.Y8G("itemRD",c.ngIf)("showLimitToSpecificBitstreams",!1)}let Bt=(()=>{class o{constructor(e){this.route=e}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,p.T)(e=>e.dso)).pipe((0,r.yd)())}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(m.nX))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-access-control"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["titleMessage","collection-access-control-title",3,"itemRD","showLimitToSpecificBitstreams",4,"ngIf"],["titleMessage","collection-access-control-title",3,"itemRD","showLimitToSpecificBitstreams"]],template:function(n,i){1&n&&(t.DNE(0,Xt,1,2,"ds-access-control-form-container",0),t.nI1(1,"async")),2&n&&t.Y8G("ngIf",t.bMT(1,1,i.itemRD$))},dependencies:[kt.o,u.bT,u.Jj]})}return o})();var E=a(1703),Yt=a(60519);let Ut=(()=>{class o{constructor(e){this.route=e}ngOnInit(){this.dsoRD$=this.route.parent.parent.data.pipe((0,E.$)(),(0,p.T)(e=>e.dso))}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(m.nX))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-authorizations"]],standalone:!0,features:[t.aNF],decls:3,vars:4,consts:[[1,"container"],[3,"resourceType","resourceUUID"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0),t.nrm(1,"ds-resource-policies",1),t.nI1(2,"async"),t.k0s()),2&n){let s;t.R7$(),t.Y8G("resourceType","collection")("resourceUUID",null==(s=t.bMT(2,2,i.dsoRD$))||null==s.payload?null:s.payload.id)}},dependencies:[Yt.e,u.Jj],encapsulation:2})}return o})();var j=a(41483),xt=a(62230);const Vt=o=>({collection:o});let Ot=(()=>{class o{constructor(e,n){this.route=e,this.dsoNameService=n}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,$.s)(1),(0,p.T)(e=>e.dso)),this.collectionName$=this.dsoRD$.pipe((0,j.p)(e=>(0,d.a4)(e)),(0,p.T)(e=>this.dsoNameService.getName(e.payload)))}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(m.nX),t.rXU(U.f))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-curate"]],standalone:!0,features:[t.aNF],decls:7,vars:11,consts:[[1,"container"],[3,"dsoHandle"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0)(1,"h2"),t.EFF(2),t.nI1(3,"async"),t.nI1(4,"translate"),t.k0s(),t.nrm(5,"ds-curation-form",1),t.nI1(6,"async"),t.k0s()),2&n){let s;t.R7$(2),t.JRh(t.i5U(4,4,"collection.curate.header",t.eq3(9,Vt,t.bMT(3,2,i.collectionName$)))),t.R7$(3),t.Y8G("dsoHandle",null==(s=t.bMT(6,7,i.dsoRD$))?null:s.payload.handle)}},dependencies:[xt.X,h.h,h.D9,u.Jj],encapsulation:2})}return o})();var D=a(8109),Jt=a(96929),N=a(9843),At=a(58751),Lt=a(47376),Pt=a(59503),zt=a(31876),P=a(68605);function Ht(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.addItemTemplate())}),t.nrm(1,"i",9),t.j41(2,"span",10),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"collection.edit.template.add-button"),""))}function Kt(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.deleteItemTemplate())}),t.nrm(1,"i",12),t.j41(2,"span",10),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"collection.edit.template.delete-button"),""))}function wt(o,c){if(1&o&&(t.j41(0,"button",13),t.nI1(1,"async"),t.nrm(2,"i",14),t.j41(3,"span",10),t.EFF(4),t.nI1(5,"translate"),t.k0s()()),2&o){let e;const n=t.XpG(2);t.Y8G("routerLink","/collections/"+(null==(e=t.bMT(1,2,n.dsoRD$))?null:e.payload.uuid)+"/itemtemplate"),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"collection.edit.template.edit-button"),"")}}function Wt(o,c){if(1&o&&(t.j41(0,"div",2)(1,"span",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",4),t.DNE(5,Ht,5,3,"button",5)(6,Kt,5,3,"button",6)(7,wt,6,6,"button",7),t.k0s()()),2&o){const e=c.ngVar;t.R7$(2),t.JRh(t.bMT(3,4,"collection.edit.template.label")),t.R7$(3),t.Y8G("ngIf",!(null!=e&&e.payload)),t.R7$(),t.Y8G("ngIf",null==e?null:e.payload),t.R7$(),t.Y8G("ngIf",null==e?null:e.payload)}}let Qt=(()=>{class o extends Pt.W{constructor(e,n,i,s,l,g,b,_){super(e,i,s,l,g),this.collectionDataService=e,this.itemTemplateService=n,this.router=i,this.route=s,this.notificationsService=l,this.translate=g,this.requestService=b,this.chd=_,this.frontendURL="/collections/",this.type=At.p.type}ngOnInit(){this.router.events.subscribe(e=>{(e instanceof m.wF||e instanceof m.OY&&e.routerEvent instanceof m.wF)&&(super.ngOnInit(),this.initTemplateItem(),this.chd.detectChanges())})}initTemplateItem(){this.itemTemplateRD$=this.dsoRD$.pipe((0,r.ak)(),(0,f.n)(e=>this.itemTemplateService.findByCollectionID(e.uuid)))}addItemTemplate(){const e=this.dsoRD$.pipe((0,r.ak)()),n=e.pipe((0,f.n)(s=>this.itemTemplateService.createByCollectionID(new Lt.q,s.uuid).pipe((0,r.ak)()))),i=e.pipe((0,f.n)(s=>this.itemTemplateService.getCollectionEndpoint(s.id)));(0,T.z)(e,n,i).subscribe(([s,l,g])=>{this.requestService.setStaleByHrefSubstring(g),this.router.navigate([(0,P.dv)(s.uuid)])})}deleteItemTemplate(){this.dsoRD$.pipe((0,r.ak)(),(0,f.n)(e=>this.itemTemplateService.findByCollectionID(e.uuid)),(0,r.ak)(),(0,f.n)(e=>this.itemTemplateService.delete(e.uuid)),(0,r.qD)(),(0,p.T)(e=>(0,d.a4)(e)&&e.hasSucceeded)).subscribe(e=>{e?this.notificationsService.success(null,this.translate.get("collection.edit.template.notifications.delete.success")):this.notificationsService.error(null,this.translate.get("collection.edit.template.notifications.delete.error")),this.initTemplateItem()})}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(D.CollectionDataService),t.rXU(Jt.d),t.rXU(m.Ix),t.rXU(m.nX),t.rXU(F.I),t.rXU(h.c$),t.rXU(N.B),t.rXU(t.gRc))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-metadata"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:7,consts:[["class","container-fluid mb-2",4,"ngVar"],[3,"submitForm","back","finish","dso","isCreation"],[1,"container-fluid","mb-2"],[1,"d-inline-block","mb-2"],[1,"button-row","space-children-mr"],["class","btn btn-success",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],["class","btn btn-primary",3,"routerLink",4,"ngIf"],[1,"btn","btn-success",3,"click"],["aria-hidden","true",1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[1,"btn","btn-danger",3,"click"],["aria-hidden","true",1,"fas","fa-trash-alt"],[1,"btn","btn-primary",3,"routerLink"],["aria-hidden","true",1,"fas","fa-edit"]],template:function(n,i){if(1&n&&(t.DNE(0,Wt,8,6,"div",0),t.nI1(1,"async"),t.j41(2,"ds-collection-form",1),t.nI1(3,"async"),t.bIt("submitForm",function(l){return i.onSubmit(l)})("back",function(){return i.navigateToHomePage()})("finish",function(){return i.navigateToHomePage()}),t.k0s()),2&n){let s;t.Y8G("ngVar",t.bMT(1,3,i.itemTemplateRD$)),t.R7$(2),t.Y8G("dso",null==(s=t.bMT(3,5,i.dsoRD$))?null:s.payload)("isCreation",!1)}},dependencies:[zt.q,m.Wk,u.Jj,h.h,h.D9,u.bT,G.r],encapsulation:2})}return o})();var Zt=a(34115);function qt(o,c){if(1&o&&(t.nrm(0,"ds-comcol-role",1),t.nI1(1,"async")),2&o){const e=c.$implicit,n=t.XpG();t.Y8G("dso",t.bMT(1,2,n.collection$))("comcolRole",e)}}let te=(()=>{class o{constructor(e){this.route=e}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,E.$)(),(0,p.T)(e=>e.dso)),this.collection$=this.dsoRD$.pipe((0,r.yd)(),(0,r.Bo)()),this.comcolRoles$=this.collection$.pipe((0,p.T)(e=>{let n=(0,d.a4)(e._links.workflowGroups)?e._links.workflowGroups:[];return Array.isArray(n)||(n=[n]),[{name:"collection-admin",href:e._links.adminGroup.href},{name:"submitters",href:e._links.submittersGroup.href},{name:"item_read",href:e._links.itemReadGroup.href},{name:"bitstream_read",href:e._links.bitstreamReadGroup.href},...n]}))}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(m.nX))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-roles"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[3,"dso","comcolRole",4,"ngFor","ngForOf"],[3,"dso","comcolRole"]],template:function(n,i){1&n&&(t.DNE(0,qt,2,4,"ds-comcol-role",0),t.nI1(1,"async")),2&n&&t.Y8G("ngForOf",t.bMT(1,1,i.comcolRoles$))},dependencies:[Zt.J,u.Sq,u.Jj],encapsulation:2})}return o})();var S=a(89593),ee=a(87599),k=a.n(ee),ne=a(86722),oe=a(89247),I=a(9815),ie=a(36590),se=a(8891),X=a(82040),ae=a(78052),ce=a(58268),re=a(72578),le=a(78745),v=a(33707),ue=a(27691);function de(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2).ngVar,s=t.XpG();return t.Njj(s.testConfiguration(i))}),t.j41(1,"span"),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}if(2&o){const e=t.XpG(3);t.Y8G("disabled",!e.isEnabled),t.R7$(2),t.JRh(t.bMT(3,2,"collection.source.controls.test.submit"))}}function pe(o,c){1&o&&(t.j41(0,"button",9),t.nrm(1,"span",10),t.j41(2,"span"),t.EFF(3),t.nI1(4,"translate"),t.k0s()()),2&o&&(t.Y8G("disabled",!0),t.R7$(3),t.JRh(t.bMT(4,2,"collection.source.controls.test.running")))}function me(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG(3);return t.Njj(i.importNow())}),t.j41(1,"span",12),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}if(2&o){const e=t.XpG(3);t.Y8G("disabled",!e.isEnabled),t.R7$(2),t.JRh(t.bMT(3,2,"collection.source.controls.import.submit"))}}function he(o,c){1&o&&(t.j41(0,"button",13),t.nrm(1,"span",10),t.j41(2,"span",12),t.EFF(3),t.nI1(4,"translate"),t.k0s()()),2&o&&(t.Y8G("disabled",!0),t.R7$(3),t.JRh(t.bMT(4,2,"collection.source.controls.import.running")))}function fe(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",11),t.bIt("click",function(){t.eBV(e);const i=t.XpG(3);return t.Njj(i.resetAndReimport())}),t.j41(1,"span",12),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}if(2&o){const e=t.XpG(3);t.Y8G("disabled",!e.isEnabled),t.R7$(2),t.SpI("\xa0",t.bMT(3,2,"collection.source.controls.reset.submit"),"")}}function ge(o,c){1&o&&(t.j41(0,"button",13),t.nrm(1,"span",10),t.j41(2,"span",12),t.EFF(3),t.nI1(4,"translate"),t.k0s()()),2&o&&(t.Y8G("disabled",!0),t.R7$(3),t.SpI("\xa0",t.bMT(4,2,"collection.source.controls.reset.running"),""))}function be(o,c){if(1&o&&(t.j41(0,"div",2)(1,"h3"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div")(5,"span",3),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.j41(8,"span"),t.EFF(9),t.k0s()(),t.j41(10,"div")(11,"span",3),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"span"),t.EFF(15),t.nI1(16,"translate"),t.k0s()(),t.j41(17,"div")(18,"span",3),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"span"),t.EFF(22),t.nI1(23,"translate"),t.k0s()(),t.j41(24,"div")(25,"span",3),t.EFF(26),t.nI1(27,"translate"),t.k0s(),t.j41(28,"span"),t.EFF(29),t.nI1(30,"translate"),t.k0s()(),t.DNE(31,de,4,4,"button",4),t.nI1(32,"async"),t.DNE(33,pe,5,4,"button",5),t.nI1(34,"async"),t.DNE(35,me,4,4,"button",6),t.nI1(36,"async"),t.DNE(37,he,5,4,"button",7),t.nI1(38,"async"),t.DNE(39,fe,4,4,"button",6),t.nI1(40,"async"),t.DNE(41,ge,5,4,"button",7),t.nI1(42,"async"),t.k0s()),2&o){const e=t.XpG().ngVar,n=t.XpG();t.R7$(2),t.JRh(t.bMT(3,15,"collection.source.controls.head")),t.R7$(4),t.JRh(t.bMT(7,17,"collection.source.controls.harvest.status")),t.R7$(3),t.JRh(null==e?null:e.harvestStatus),t.R7$(3),t.JRh(t.bMT(13,19,"collection.source.controls.harvest.start")),t.R7$(3),t.JRh(null!=e&&e.harvestStartTime?null==e?null:e.harvestStartTime:t.bMT(16,21,"collection.source.controls.harvest.no-information")),t.R7$(4),t.JRh(t.bMT(20,23,"collection.source.controls.harvest.last")),t.R7$(3),t.JRh(null!=e&&e.lastHarvested?null==e?null:e.lastHarvested:t.bMT(23,25,"collection.source.controls.harvest.no-information")),t.R7$(4),t.JRh(t.bMT(27,27,"collection.source.controls.harvest.message")),t.R7$(3),t.JRh(null!=e&&e.message?null==e?null:e.message:t.bMT(30,29,"collection.source.controls.harvest.no-information")),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(32,31,n.testConfigRunning$)),t.R7$(2),t.Y8G("ngIf",t.bMT(34,33,n.testConfigRunning$)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(36,35,n.importRunning$)),t.R7$(2),t.Y8G("ngIf",t.bMT(38,37,n.importRunning$)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(40,39,n.reImportRunning$)),t.R7$(2),t.Y8G("ngIf",t.bMT(42,41,n.reImportRunning$))}}function ve(o,c){if(1&o&&(t.j41(0,"div"),t.DNE(1,be,43,43,"div",1),t.k0s()),2&o){const e=t.XpG();t.R7$(),t.Y8G("ngIf",e.shouldShow)}}let _e=(()=>{class o{constructor(e,n,i,s,l,g,b,_){this.scriptDataService=e,this.processDataService=n,this.requestService=i,this.notificationsService=s,this.collectionService=l,this.translateService=g,this.httpClient=b,this.bitstreamService=_,this.subs=[],this.autoRefreshIDs=[],this.testConfigRunning$=new y.t(!1),this.importRunning$=new y.t(!1),this.reImportRunning$=new y.t(!1)}ngOnInit(){this.contentSource$=this.collectionService.findByHref(this.collection._links.self.href,!1).pipe((0,r.Hz)(),(0,f.n)(e=>this.collectionService.getContentSource(e.uuid,!1)),(0,r.Hz)())}testConfiguration(e){this.testConfigRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-g",value:null},{name:"-a",value:e.oaiSource},{name:"-i",value:(new le.f).Serialize(e.oaiSetId)}],[]).pipe((0,r.qD)(),(0,X.M)(n=>{n.hasFailed&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.submit.error")),this.testConfigRunning$.next(!1))}),(0,j.p)(n=>n.hasSucceeded&&(0,d.a4)(n.payload)),(0,f.n)(n=>(this.autoRefreshIDs.push(n.payload.processId),this.processDataService.autoRefreshUntilCompletion(n.payload.processId))),(0,p.T)(n=>n.payload)).subscribe(n=>{n.processStatus.toString()===v.K[v.K.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.test.failed")),this.testConfigRunning$.next(!1)),n.processStatus.toString()===v.K[v.K.COMPLETED].toString()&&(this.bitstreamService.findByHref(n._links.output.href).pipe((0,r.ak)()).subscribe(i=>{this.httpClient.get(i._links.content.href,{responseType:"text"}).subscribe(s=>{const l=s.replaceAll(new RegExp(".*\\@(.*)","g"),"$1").replaceAll("The script has started","").replaceAll("The script has completed","");this.notificationsService.info(this.translateService.get("collection.source.controls.test.completed"),l)})}),this.testConfigRunning$.next(!1))}))}importNow(){this.importRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-r",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,r.qD)(),(0,X.M)(e=>{e.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.import.submit.error")),this.importRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.import.submit.success"))}),(0,j.p)(e=>e.hasSucceeded&&(0,d.a4)(e.payload)),(0,f.n)(e=>(this.autoRefreshIDs.push(e.payload.processId),this.processDataService.autoRefreshUntilCompletion(e.payload.processId))),(0,p.T)(e=>e.payload)).subscribe(e=>{e.processStatus.toString()===v.K[v.K.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.import.failed")),this.importRunning$.next(!1)),e.processStatus.toString()===v.K[v.K.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.import.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.importRunning$.next(!1))}))}resetAndReimport(){this.reImportRunning$.next(!0),this.subs.push(this.scriptDataService.invoke("harvest",[{name:"-o",value:null},{name:"-c",value:this.collection.uuid}],[]).pipe((0,r.qD)(),(0,X.M)(e=>{e.hasFailed?(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.submit.error")),this.reImportRunning$.next(!1)):this.notificationsService.success(this.translateService.get("collection.source.controls.reset.submit.success"))}),(0,j.p)(e=>e.hasSucceeded&&(0,d.a4)(e.payload)),(0,f.n)(e=>(this.autoRefreshIDs.push(e.payload.processId),this.processDataService.autoRefreshUntilCompletion(e.payload.processId))),(0,p.T)(e=>e.payload)).subscribe(e=>{e.processStatus.toString()===v.K[v.K.FAILED].toString()&&(this.notificationsService.error(this.translateService.get("collection.source.controls.reset.failed")),this.reImportRunning$.next(!1)),e.processStatus.toString()===v.K[v.K.COMPLETED].toString()&&(this.notificationsService.success(this.translateService.get("collection.source.controls.reset.completed")),this.requestService.setStaleByHrefSubstring(this.collection._links.self.href),this.reImportRunning$.next(!1))}))}ngOnDestroy(){this.subs.forEach(e=>{(0,d.a4)(e)&&e.unsubscribe()}),this.autoRefreshIDs.forEach(e=>{this.processDataService.stopAutoRefreshing(e)})}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(re.ScriptDataService),t.rXU(ce.ProcessDataService),t.rXU(N.B),t.rXU(F.I),t.rXU(D.CollectionDataService),t.rXU(h.c$),t.rXU(ue.Qq),t.rXU(ae.BitstreamDataService))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-source-controls"]],inputs:{isEnabled:"isEnabled",collection:"collection",shouldShow:"shouldShow"},standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[[4,"ngVar"],["class","container-fluid space-children-mr",4,"ngIf"],[1,"container-fluid","space-children-mr"],[1,"font-weight-bold"],["class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["class","btn btn-secondary",3,"disabled",4,"ngIf"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],["class","btn btn-primary",3,"disabled",4,"ngIf"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"btn","btn-secondary",3,"disabled"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","spinner-button"],[1,"btn","btn-primary",3,"click","disabled"],[1,"d-none","d-sm-inline"],[1,"btn","btn-primary",3,"disabled"]],template:function(n,i){1&n&&(t.DNE(0,ve,2,1,"div",0),t.nI1(1,"async")),2&n&&t.Y8G("ngVar",t.bMT(1,1,i.contentSource$))},dependencies:[h.h,h.D9,u.Jj,u.bT,G.r],styles:[".spinner-button[_ngcontent-%COMP%]{margin-bottom:calc((var(--bs-line-height-base) * 1rem - var(--bs-font-size-base)) / 2)}"]})}return o})();function Se(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",14),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.discard())}),t.nrm(2,"i",15),t.j41(3,"span",6),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}if(2&o){const e=t.XpG();t.Y8G("disabled",!0!==t.bMT(1,2,e.hasChanges$)),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.metadata.discard-button"),"")}}function Ie(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",16),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.reinstate())}),t.nrm(1,"i",17),t.j41(2,"span",6),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"item.edit.metadata.reinstate-button"),""))}function Ce(o,c){if(1&o){const e=t.RV6();t.j41(0,"div",18)(1,"input",19),t.bIt("change",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.changeExternalSource())}),t.k0s(),t.j41(2,"label",20),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}if(2&o){const e=t.XpG();t.R7$(),t.Y8G("checked",(null==e.contentSource?null:e.contentSource.harvestType)!==e.harvestTypeNone),t.R7$(2),t.JRh(t.bMT(4,2,"collection.edit.tabs.source.external"))}}function Te(o,c){1&o&&(t.nrm(0,"ds-loading",21),t.nI1(1,"translate")),2&o&&t.Y8G("message",t.bMT(1,1,"loading.content-source"))}function Re(o,c){1&o&&(t.j41(0,"h3"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(),t.JRh(t.bMT(2,1,"collection.edit.tabs.source.form.head")))}function ye(o,c){if(1&o){const e=t.RV6();t.j41(0,"ds-form",22),t.bIt("dfChange",function(i){t.eBV(e);const s=t.XpG();return t.Njj(s.onChange(i))})("submitForm",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onSubmit())})("cancel",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onCancel())}),t.k0s()}if(2&o){const e=t.XpG();t.Y8G("formId","collection-source-form-id")("formGroup",e.formGroup)("formModel",e.formModel)("formLayout",e.formLayout)("displaySubmit",!1)("displayCancel",!1)}}function $e(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",14),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.discard())}),t.nrm(2,"i",15),t.j41(3,"span",6),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}if(2&o){const e=t.XpG(2);t.Y8G("disabled",!0!==t.bMT(1,2,e.hasChanges$)),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.metadata.discard-button"),"")}}function Fe(o,c){if(1&o){const e=t.RV6();t.j41(0,"button",16),t.bIt("click",function(){t.eBV(e);const i=t.XpG(2);return t.Njj(i.reinstate())}),t.nrm(1,"i",17),t.j41(2,"span",6),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&o&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"item.edit.metadata.reinstate-button"),""))}function Me(o,c){if(1&o){const e=t.RV6();t.j41(0,"div",23)(1,"div",10)(2,"div",24)(3,"div",25),t.DNE(4,$e,6,6,"button",2),t.nI1(5,"async"),t.DNE(6,Fe,5,3,"button",3),t.nI1(7,"async"),t.j41(8,"button",4),t.nI1(9,"async"),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.onSubmit())}),t.nrm(10,"i",5),t.j41(11,"span",6),t.EFF(12),t.nI1(13,"translate"),t.k0s()()()()()()}if(2&o){const e=t.XpG();t.R7$(4),t.Y8G("ngIf",!0!==t.bMT(5,4,e.isReinstatable$)),t.R7$(2),t.Y8G("ngIf",t.bMT(7,6,e.isReinstatable$)),t.R7$(2),t.Y8G("disabled",!0!==t.bMT(9,8,e.hasChanges$)||!e.isValid()||e.initialHarvestType===e.harvestTypeNone&&e.contentSource.harvestType===e.initialHarvestType),t.R7$(4),t.SpI("\xa0",t.bMT(13,10,"item.edit.metadata.save-button"),"")}}let je=(()=>{class o extends se.F{constructor(e,n,i,s,l,g,b,_,R){super(e,n,i,s),this.objectUpdatesService=e,this.notificationsService=n,this.translateService=i,this.router=s,this.location=l,this.formService=g,this.route=b,this.collectionService=_,this.requestService=R,this.LABEL_KEY_PREFIX="collection.edit.tabs.source.form.",this.ERROR_KEY_PREFIX="collection.edit.tabs.source.form.errors.",this.OPTIONS_KEY_PREFIX="collection.edit.tabs.source.form.options.",this.oaiSourceModel=new S.rA_({id:"oaiSource",name:"oaiSource",required:!0,validators:{required:null},errorMessages:{required:"You must provide a set id of the target collection."}}),this.oaiSetIdModel=new S.rA_({id:"oaiSetId",name:"oaiSetId"}),this.metadataConfigIdModel=new S.z4z({id:"metadataConfigId",name:"metadataConfigId"}),this.harvestTypeModel=new S.tK_({id:"harvestType",name:"harvestType",options:[{value:I.s.Metadata},{value:I.s.MetadataAndRef},{value:I.s.MetadataAndBitstreams}]}),this.inputModels=[this.oaiSourceModel,this.oaiSetIdModel,this.metadataConfigIdModel,this.harvestTypeModel],this.formModel=[new S.iO5({id:"oaiSourceContainer",group:[this.oaiSourceModel]}),new S.iO5({id:"oaiSetContainer",group:[this.oaiSetIdModel,this.metadataConfigIdModel]}),new S.iO5({id:"harvestTypeContainer",group:[this.harvestTypeModel]})],this.formLayout={oaiSource:{grid:{host:"col-12 d-inline-block"}},oaiSetId:{grid:{host:"col col-sm-6 d-inline-block"}},metadataConfigId:{grid:{host:"col col-sm-6 d-inline-block"}},harvestType:{grid:{host:"col-12",option:"btn-outline-secondary"}},oaiSetContainer:{grid:{host:"row"}},oaiSourceContainer:{grid:{host:"row"}},harvestTypeContainer:{grid:{host:"row"}}},this.harvestTypeNone=I.s.None,this.previouslySelectedHarvestType=I.s.Metadata,this.displayedNotifications=[],this.subs=[]}ngOnInit(){super.ngOnInit(),this.notificationsPrefix="collection.edit.tabs.source.notifications.",this.discardTimeOut=ne.c.collection.edit.undoTimeout,this.formGroup=this.formService.createFormGroup(this.formModel),this.collectionRD$=this.route.parent.data.pipe((0,E.$)(),(0,p.T)(e=>e.dso)),this.collectionRD$.pipe((0,r.yd)(),(0,p.T)(e=>e.payload.uuid),(0,f.n)(e=>this.collectionService.getContentSource(e)),(0,r.qD)()).subscribe(e=>{this.initializeOriginalContentSource(e.payload)}),this.updateFieldTranslations(),this.subs.push(this.translateService.onLangChange.subscribe(()=>{this.updateFieldTranslations()}))}initializeOriginalContentSource(e){this.contentSource=e,this.initialHarvestType=e.harvestType,this.initializeMetadataConfigs();const n=k()(this.contentSource);this.objectUpdatesService.initialize(this.url,[n],new Date),this.update$=this.objectUpdatesService.getFieldUpdates(this.url,[n]).pipe((0,p.T)(i=>i[n.uuid])),this.subs.push(this.update$.subscribe(i=>{if(i){const s=i.field;let l;(0,d.a4)(this.contentSource)&&(0,d.hj)(this.contentSource.metadataConfigs)&&(l=this.contentSource.metadataConfigs[0].id),(0,d.a4)(s)&&(0,d.a4)(s.metadataConfigId)&&(l=s.metadataConfigId),(0,d.a4)(s)&&(this.formGroup.patchValue({oaiSourceContainer:{oaiSource:s.oaiSource},oaiSetContainer:{oaiSetId:s.oaiSetId,metadataConfigId:l},harvestTypeContainer:{harvestType:s.harvestType}}),this.contentSource=k()(s)),this.contentSource.metadataConfigId=l}}))}initializeMetadataConfigs(){this.metadataConfigIdModel.options=this.contentSource.metadataConfigs.map(e=>Object.assign({value:e.id,label:e.label})),this.metadataConfigIdModel.options.length>0&&this.formGroup.patchValue({oaiSetContainer:{metadataConfigId:this.metadataConfigIdModel.options[0].value}})}updateFieldTranslations(){this.inputModels.forEach(e=>{this.updateFieldTranslation(e)})}updateFieldTranslation(e){e.label=this.translateService.instant(this.LABEL_KEY_PREFIX+e.id),(0,d.hj)(e.validators)&&(e.errorMessages={},Object.keys(e.validators).forEach(n=>{e.errorMessages[n]=this.translateService.instant(this.ERROR_KEY_PREFIX+e.id+"."+n)})),e instanceof S.X7I&&(0,d.hj)(e.options)&&e.options.forEach(n=>{(0,d.Tn)(n.label)&&(n.label=this.translateService.instant(this.OPTIONS_KEY_PREFIX+e.id+"."+n.value))})}onChange(e){this.updateContentSourceField(e.model,!0),this.saveFieldUpdate()}onSubmit(){this.collectionRD$.pipe((0,r.yd)(),(0,p.T)(e=>e.payload.uuid),(0,f.n)(e=>this.collectionService.getHarvesterEndpoint(e)),(0,$.s)(1)).subscribe(e=>this.requestService.removeByHrefSubstring(e)),this.requestService.setStaleByHrefSubstring(this.contentSource._links.self.href),this.collectionRD$.pipe((0,r.yd)(),(0,p.T)(e=>e.payload.uuid),(0,f.n)(e=>this.collectionService.updateContentSource(e,this.contentSource)),(0,$.s)(1)).subscribe(e=>{(0,d.a4)(e.harvestType)?(this.clearNotifications(),this.initializeOriginalContentSource(e),this.displayedNotifications.push(this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved")))):this.displayedNotifications.push(e)})}onCancel(){this.location.back()}isValid(){return this.contentSource.harvestType===I.s.None||this.formGroup.valid}changeExternalSource(){this.contentSource.harvestType===I.s.None?this.contentSource.harvestType=this.previouslySelectedHarvestType:(this.previouslySelectedHarvestType=this.contentSource.harvestType,this.contentSource.harvestType=I.s.None),this.updateContentSource(!1)}updateContentSource(e){this.inputModels.forEach(n=>{this.updateContentSourceField(n,e)}),this.saveFieldUpdate()}updateContentSourceField(e,n){(0,d.a4)(e.value)&&(e.id!==this.harvestTypeModel.id||n)&&(this.contentSource[e.id]=e.value)}saveFieldUpdate(){this.objectUpdatesService.saveAddFieldUpdate(this.url,k()(this.contentSource))}clearNotifications(){this.displayedNotifications.forEach(e=>{this.notificationsService.remove(e)}),this.displayedNotifications=[]}ngOnDestroy(){this.subs.forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(oe.F),t.rXU(F.I),t.rXU(h.c$),t.rXU(m.Ix),t.rXU(u.aZ),t.rXU(S.J9r),t.rXU(m.nX),t.rXU(D.CollectionDataService),t.rXU(N.B))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-collection-source"]],standalone:!0,features:[t.Vt3,t.aNF],decls:24,vars:27,consts:[[1,"container-fluid"],[1,"d-inline-block","float-right","space-children-mr"],["class"," btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-save"],[1,"d-none","d-sm-inline"],["class","form-check mb-4",4,"ngIf"],[3,"message",4,"ngIf"],[4,"ngIf"],[1,"row"],[3,"formId","formGroup","formModel","formLayout","displaySubmit","displayCancel","dfChange","submitForm","cancel",4,"ngIf"],["class","container mt-2",4,"ngIf"],[3,"isEnabled","shouldShow","collection"],[1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-times"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"form-check","mb-4"],["type","checkbox","id","externalSourceCheck",1,"form-check-input",3,"change","checked"],["for","externalSourceCheck",1,"form-check-label"],[3,"message"],[3,"dfChange","submitForm","cancel","formId","formGroup","formModel","formLayout","displaySubmit","displayCancel"],[1,"container","mt-2"],[1,"col-12"],[1,"d-inline-block","float-right","ml-1","space-children-mr"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,Se,6,6,"button",2),t.nI1(3,"async"),t.DNE(4,Ie,5,3,"button",3),t.nI1(5,"async"),t.j41(6,"button",4),t.nI1(7,"async"),t.bIt("click",function(){return i.onSubmit()}),t.nrm(8,"i",5),t.j41(9,"span",6),t.EFF(10),t.nI1(11,"translate"),t.k0s()()(),t.j41(12,"h2"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.DNE(15,Ce,5,4,"div",7)(16,Te,2,3,"ds-loading",8)(17,Re,3,3,"h3",9),t.k0s(),t.j41(18,"div",10),t.DNE(19,ye,1,6,"ds-form",11),t.k0s(),t.DNE(20,Me,14,12,"div",12),t.nrm(21,"ds-collection-source-controls",13),t.nI1(22,"async"),t.nI1(23,"async")),2&n){let s;t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(3,13,i.isReinstatable$)),t.R7$(2),t.Y8G("ngIf",t.bMT(5,15,i.isReinstatable$)),t.R7$(2),t.Y8G("disabled",!0!==t.bMT(7,17,i.hasChanges$)||!i.isValid()||i.initialHarvestType===i.harvestTypeNone&&i.contentSource.harvestType===i.initialHarvestType),t.R7$(4),t.SpI("\xa0",t.bMT(11,19,"item.edit.metadata.save-button"),""),t.R7$(3),t.JRh(t.bMT(14,21,"collection.edit.tabs.source.head")),t.R7$(2),t.Y8G("ngIf",i.contentSource),t.R7$(),t.Y8G("ngIf",!i.contentSource),t.R7$(),t.Y8G("ngIf",i.contentSource&&(null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone),t.R7$(2),t.Y8G("ngIf",i.formGroup&&i.contentSource&&(null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone),t.R7$(),t.Y8G("ngIf",(null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone),t.R7$(),t.Y8G("isEnabled",!0!==t.bMT(22,23,i.hasChanges$))("shouldShow",(null==i.contentSource?null:i.contentSource.harvestType)!==i.harvestTypeNone)("collection",null==(s=t.bMT(23,25,i.collectionRD$))?null:s.payload)}},dependencies:[u.Jj,h.h,h.D9,u.bT,J.v,ie.s,_e],encapsulation:2})}return o})();var Ge=a(72934);const Ee=o=>({active:o}),De=o=>[o];function Ne(o,c){if(1&o&&(t.j41(0,"li",14)(1,"a",15),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&o){const e=c.$implicit,n=t.XpG();t.R7$(),t.Y8G("ngClass",t.eq3(7,Ee,e===n.currentPage))("routerLink",t.eq3(9,De,"./"+e)),t.BMQ("aria-selected",e===n.currentPage)("data-test",e),t.R7$(),t.SpI(" ",t.bMT(3,5,n.type+".edit.tabs."+e+".head")," ")}}function ke(o,c){if(1&o&&(t.j41(0,"a",16),t.nI1(1,"async"),t.nrm(2,"i",17),t.EFF(3),t.nI1(4,"translate"),t.k0s()),2&o){let e;const n=t.XpG();t.Y8G("routerLink",n.getPageUrl(null==(e=t.bMT(1,2,n.dsoRD$))?null:e.payload)),t.R7$(3),t.SpI(" ",t.bMT(4,4,n.type+".edit.return")," ")}}const Be=[{path:"",resolve:{breadcrumb:z.S},data:{breadcrumbKey:"collection.edit"},component:(()=>{class o extends Ge.M{constructor(e,n){super(e,n),this.router=e,this.route=n,this.type="collection"}getPageUrl(e){return(0,P.JW)(e.id)}static#t=this.\u0275fac=function(n){return new(n||o)(t.rXU(m.Ix),t.rXU(m.nX))};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["ds-edit-collection"]],standalone:!0,features:[t.Vt3,t.aNF],decls:21,vars:11,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"d-flex","justify-content-between","border-bottom"],[1,"my-auto"],["data-test","delete-button",1,"btn","btn-danger",3,"routerLink"],["aria-hidden","true",1,"fas","fa-trash"],[1,"pt-2"],["role","tablist",1,"nav","nav-tabs","justify-content-start","mb-2"],["class","nav-item","role","presentation",4,"ngFor","ngForOf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"col-12","text-right"],["class","btn btn-outline-secondary",3,"routerLink",4,"ngIf"],["role","presentation",1,"nav-item"],["role","tab",1,"nav-link",3,"ngClass","routerLink"],[1,"btn","btn-outline-secondary",3,"routerLink"],["aria-hidden","true",1,"fas","fa-arrow-left"]],template:function(n,i){if(1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div",4)(8,"a",5),t.nI1(9,"async"),t.nrm(10,"i",6),t.EFF(11),t.nI1(12,"translate"),t.k0s()()(),t.j41(13,"div",7)(14,"ul",8),t.DNE(15,Ne,4,11,"li",9),t.k0s(),t.j41(16,"div",10)(17,"div",11),t.nrm(18,"router-outlet"),t.k0s(),t.j41(19,"div",12),t.DNE(20,ke,5,6,"a",13),t.k0s()()()()()()),2&n){let s;t.R7$(5),t.JRh(t.bMT(6,5,i.type+".edit.head")),t.R7$(3),t.Y8G("routerLink",("community"===i.type?"/communities/":"/collections/")+(null==(s=t.bMT(9,7,i.dsoRD$))?null:s.payload.uuid)+"/delete"),t.R7$(3),t.SpI(" ",t.bMT(12,9,i.type+".edit.delete"),""),t.R7$(4),t.Y8G("ngForOf",i.pages),t.R7$(5),t.Y8G("ngIf",!i.hideReturnButton)}},dependencies:[m.Wk,h.h,h.D9,u.YU,u.Sq,m.n3,u.bT,u.Jj],encapsulation:2})}return o})(),canActivate:[w],children:[{path:"",redirectTo:"metadata",pathMatch:"full"},{path:"metadata",component:Qt,data:{title:"collection.edit.tabs.metadata.title",hideReturnButton:!0,showBreadcrumbs:!0}},{path:"roles",component:te,data:{title:"collection.edit.tabs.roles.title",showBreadcrumbs:!0}},{path:"source",component:je,data:{title:"collection.edit.tabs.source.title",showBreadcrumbs:!0}},{path:"curate",component:Ot,data:{title:"collection.edit.tabs.curate.title",showBreadcrumbs:!0}},{path:"access-control",component:Bt,data:{title:"collection.edit.tabs.access-control.title",showBreadcrumbs:!0}},{path:"authorizations",data:{showBreadcrumbs:!0},children:[{path:"create",resolve:{resourcePolicyTarget:q.Q},component:W.m,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:Z.n},component:Q._,data:{title:"resource-policies.edit.page.title"}},{path:"",component:Ut,data:{title:"collection.edit.tabs.authorizations.title",showBreadcrumbs:!0}}]},{path:"mapper",component:Nt,data:{title:"collection.edit.tabs.item-mapper.title",hideReturnButton:!0,showBreadcrumbs:!0}}]}]}}]);