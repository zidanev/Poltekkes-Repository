(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[5266,8799,4845,6768,7636,9003,5546,9510],{32588:(W,B,o)=>{"use strict";o.d(B,{S:()=>P});var p=o(53107),D=o(72683),v=o(67044),S=o(63016),d=o(72553);let C=(()=>{class L{getBreadcrumbs(M,m){return(0,S.of)([new d.Q(M+".breadcrumbs",m)])}static#t=this.\u0275fac=function(m){return new(m||L)};static#e=this.\u0275prov=p.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})();const P=(L,y,M=(0,p.WQX)(C))=>{const m=L.data.breadcrumbKey;if((0,D.Tn)(m))throw new Error('You provided an i18nBreadcrumbResolver for url "'+L.url+"\" but no breadcrumbKey in the route's data");return{provider:M,key:m,url:(0,v.F)(L)}}},16397:(W,B,o)=>{"use strict";o.d(B,{O:()=>S});var p=o(47947),D=o(2887),v=o(12007);class S extends D.W{findByHref(u,C=!0,P=!0,...L){return super.findByHref(u,C,P,...L).pipe((0,v.qD)(),(0,p.T)(y=>{if(y.hasFailed)throw new Error("Couldn't retrieve the config");return y}))}findByName(u,C=!0,P=!0,...L){return super.findById(u,C,P,...L)}}},14845:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionAccessesConfigDataService:()=>C});var p=o(45122),D=o(25718),v=o(9843),S=o(25744),d=o(16397),u=o(53107);let C=(()=>{class P extends d.O{constructor(y,M,m,c){super("submissionaccessoptions",y,M,m,c),this.requestService=y,this.rdbService=M,this.objectCache=m,this.halService=c}findByHref(y,M=!0,m=!0,...c){return super.findByHref(y,M,m,...c)}static#t=this.\u0275fac=function(M){return new(M||P)(u.KVO(v.B),u.KVO(p.o),u.KVO(D.$),u.KVO(S.Y))};static#e=this.\u0275prov=u.jDH({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})()},9510:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionFormsConfigDataService:()=>C});var p=o(45122),D=o(25718),v=o(9843),S=o(25744),d=o(16397),u=o(53107);let C=(()=>{class P extends d.O{constructor(y,M,m,c){super("submissionforms",y,M,m,c),this.requestService=y,this.rdbService=M,this.objectCache=m,this.halService=c}findByHref(y,M=!0,m=!0,...c){return super.findByHref(y,M,m,...c)}static#t=this.\u0275fac=function(M){return new(M||P)(u.KVO(v.B),u.KVO(p.o),u.KVO(D.$),u.KVO(S.Y))};static#e=this.\u0275prov=u.jDH({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})()},38799:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionUploadsConfigDataService:()=>C});var p=o(45122),D=o(25718),v=o(9843),S=o(25744),d=o(16397),u=o(53107);let C=(()=>{class P extends d.O{constructor(y,M,m,c){super("submissionuploads",y,M,m,c),this.requestService=y,this.rdbService=M,this.objectCache=m,this.halService=c}findByHref(y,M=!0,m=!0,...c){return super.findByHref(y,M,m,...c)}static#t=this.\u0275fac=function(M){return new(M||P)(u.KVO(v.B),u.KVO(p.o),u.KVO(D.$),u.KVO(S.Y))};static#e=this.\u0275prov=u.jDH({token:P,factory:P.\u0275fac,providedIn:"root"})}return P})()},51142:(W,B,o)=>{"use strict";o.d(B,{C:()=>L});var p=o(75988),D=o(72683),v=o(9577),S=o(36302),d=o(20857),u=o(8841),C=o(53107),P=o(73958);let L=(()=>{class y{constructor(m){this.store=m}add(m,c,g=!1,h=!1){this.store.dispatch(new u.X2(m.rootElement,m.subRootElement,m.path,this.prepareValue(c,h,g)))}replace(m,c,g=!1){(0,D.Tn)(c)||"object"==typeof c&&(0,D.Tn)(c.value)?this.remove(m):this.store.dispatch(new u.kM(m.rootElement,m.subRootElement,m.path,this.prepareValue(c,g,!1)))}move(m,c){this.store.dispatch(new u.td(m.rootElement,m.subRootElement,c,m.path))}remove(m){this.store.dispatch(new u.QZ(m.rootElement,m.subRootElement,m.path))}flushOperation(m){this.store.dispatch(new u.qy(m.rootElement,m.subRootElement,m.path))}prepareValue(m,c,g){let h=null;return(0,D.a4)(m)&&(c?h=m:Array.isArray(m)?(h=[],m.forEach(t=>{h.push("object"==typeof t?this.prepareObjectValue(t):new S.e(t))})):h="object"==typeof m?this.prepareObjectValue(m):new S.e(m)),g&&!Array.isArray(h)?[h]:h}prepareObjectValue(m){let c=Object.create({});return(0,D.Im)(m)||m instanceof S.e?c=m:m instanceof Date?c=new S.e((0,p.Sd)(m)):m instanceof d.b?c=this.prepareAuthorityValue(m):m instanceof v.r?c=new S.e(m.value,m.language):m.hasOwnProperty("authority")?c=new S.e(m.value,m.language,m.authority):(0,p.z5)(m)?c=new S.e((0,p.$T)(m)):m.hasOwnProperty("value")?c=new S.e(m.value):Object.keys(m).forEach(g=>{c[g]="object"==typeof m[g]?this.prepareObjectValue(m[g]):m[g]}),c}prepareAuthorityValue(m){let c;return c=(0,D.hj)(m.authority)?new S.e(m.value,m.language,m.authority):new S.e(m.value,m.language),c}static#t=this.\u0275fac=function(c){return new(c||y)(C.KVO(P.il))};static#e=this.\u0275prov=C.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}return y})()},79003:(W,B,o)=>{"use strict";o.r(B),o.d(B,{ResourcePolicyDataService:()=>U});var p=o(27691),D=o(47947),v=o(1703),S=o(72683),d=o(79224),u=o(45122),C=o(99120),P=o(25718),L=o(45926),y=o(83951),M=o(2887),m=o(2868),c=o(12350),g=o(82114),h=o(36705),t=o(70210),T=o(9843),x=o(92312),I=o(31363),N=o(7172),G=o(25744),E=o(12007),j=o(53107);let U=(()=>{class X extends M.W{constructor(J,$,Q,H,Z,q,ot,nt){super("resourcepolicies",J,$,Q,H),this.requestService=J,this.rdbService=$,this.objectCache=Q,this.halService=H,this.notificationsService=Z,this.comparator=q,this.ePersonService=ot,this.groupService=nt,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new L.V(this.linkPath,J,$,Q,H,Z,this.responseMsToLive),this.searchData=new c.X(this.linkPath,J,$,Q,H,this.responseMsToLive),this.patchData=new m.n(this.linkPath,J,$,Q,H,q,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new y.I(this.linkPath,J,$,Q,H,Z,this.responseMsToLive,this.constructIdEndpoint)}create(J,$,Q,H){const Z=[];return Z.push(new C.x("resource",$)),(0,S.hj)(Q)?Z.push(new C.x("eperson",Q)):(0,S.hj)(H)&&Z.push(new C.x("group",H)),this.createData.create(J,...Z)}delete(J){return this.deleteData.delete(J).pipe((0,E.qD)(),(0,D.T)($=>$.hasSucceeded))}update(J){return this.patchData.update(J)}getDefaultAccessConditionsFor(J,$){return this.findListByHref(J._links.defaultAccessConditions.href,$)}searchByEPerson(J,$,Q=!0,H=!0,...Z){const q=new h._;return q.searchParams=[new C.x("uuid",J)],(0,S.hj)($)&&q.searchParams.push(new C.x("resource",$)),this.searchData.searchBy(this.searchByEPersonMethod,q,Q,H,...Z)}searchByGroup(J,$,Q=!0,H=!0,...Z){const q=new h._;return q.searchParams=[new C.x("uuid",J)],(0,S.hj)($)&&q.searchParams.push(new C.x("resource",$)),this.searchData.searchBy(this.searchByGroupMethod,q,Q,H,...Z)}searchByResource(J,$,Q=!0,H=!0,...Z){const q=new h._;return q.searchParams=[new C.x("uuid",J)],(0,S.hj)($)&&q.searchParams.push(new C.x("action",$)),this.searchData.searchBy(this.searchByResourceMethod,q,Q,H,...Z)}updateTarget(J,$,Q,H){const q=("eperson"===H?this.ePersonService:this.groupService).getIDHrefObs(Q),ot=Object.create({});let nt=new p.Lr;nt=nt.append("Content-Type","text/uri-list"),ot.headers=nt;const et=this.requestService.generateRequestId();return q.pipe((0,v.$)()).subscribe(gt=>{const ht=new t.v_(et,$+"/"+H,gt,ot);Object.assign(ht,{getResponseParser:()=>x.M}),this.requestService.send(ht)}),this.rdbService.buildFromRequestUUIDAndAwait(et,()=>this.invalidateByHref($))}static#t=this.\u0275fac=function($){return new($||X)(j.KVO(T.B),j.KVO(u.o),j.KVO(P.$),j.KVO(G.Y),j.KVO(d.I),j.KVO(g.Y),j.KVO(I.EPersonDataService),j.KVO(N.GroupDataService))};static#e=this.\u0275prov=j.jDH({token:X,factory:X.\u0275fac,providedIn:"root"})}return X})()},23864:(W,B,o)=>{"use strict";o.d(B,{X:()=>D});var p=o(24106);const D=[(0,p.s)("item"),(0,p.s)("collection")]},87504:(W,B,o)=>{"use strict";o.d(B,{S:()=>S});var p=o(22867),D=o(12007),v=o(23864);const S=(d,u,C)=>C.findById(d.params.id,!0,!1,...v.X).pipe((0,D.qD)(),(0,p.n)(P=>P.payload.item),(0,D.qD)())},80155:(W,B,o)=>{"use strict";o.d(B,{q:()=>S});var p=o(47947),D=o(12007),v=o(23864);class S{constructor(u,C){this.dataService=u,this.breadcrumbService=C}resolve(u,C){return this.dataService.findById(u.params.id,!0,!1,...v.X).pipe((0,D.qD)(),(0,D.Bo)(),(0,p.T)(P=>({provider:this.breadcrumbService,key:P})))}}},57636:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionCcLicenseDataService:()=>P});var p=o(45122),D=o(25718),v=o(48548),S=o(94937),d=o(9843),u=o(25744),C=o(53107);let P=(()=>{class L extends v.L{constructor(M,m,c,g){super("submissioncclicenses",M,m,c,g),this.requestService=M,this.rdbService=m,this.objectCache=c,this.halService=g,this.linkPath="submissioncclicenses",this.findAllData=new S.H(this.linkPath,M,m,c,g,this.responseMsToLive)}findAll(M,m,c,...g){return this.findAllData.findAll(M,m,c,...g)}static#t=this.\u0275fac=function(m){return new(m||L)(C.KVO(d.B),C.KVO(p.o),C.KVO(D.$),C.KVO(u.Y))};static#e=this.\u0275prov=C.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})()},16768:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionCcLicenseUrlDataService:()=>m});var p=o(22867),D=o(47947),v=o(45122),S=o(99120),d=o(25718),u=o(48548),C=o(12350),P=o(9843),L=o(25744),y=o(12007),M=o(53107);let m=(()=>{class c extends u.L{constructor(h,t,T,x){super("submissioncclicenseUrls-search",h,t,T,x),this.requestService=h,this.rdbService=t,this.objectCache=T,this.halService=x,this.searchData=new C.X(this.linkPath,h,t,T,x,this.responseMsToLive,(I,N)=>`${I}/${N}`)}getCcLicenseLink(h,t){return this.searchData.getSearchByHref("rightsByQuestions",{searchParams:[new S.x("license",h.id),...h.fields.map(T=>new S.x(`answer_${T.id}`,t.get(T).id))]}).pipe((0,p.n)(T=>this.findByHref(T)),(0,y.yd)(),(0,y.Bo)(),(0,D.T)(T=>T.url))}searchBy(h,t,T,x,...I){return this.searchData.searchBy(h,t,T,x,...I)}static#t=this.\u0275fac=function(t){return new(t||c)(M.KVO(P.B),M.KVO(v.o),M.KVO(d.$),M.KVO(L.Y))};static#e=this.\u0275prov=M.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},47225:(W,B,o)=>{"use strict";o.d(B,{i:()=>m});var p=o(63016),D=o(76627),v=o(22867),S=o(31829),d=o(72683),u=o(64340),C=o(73579),P=o(83116),L=o(8109),y=o(12007),M=o(53107);let m=(()=>{class c{constructor(h,t,T,x){this.dsoNameService=h,this.dsoBreadcrumbsService=t,this.submissionService=T,this.collectionService=x}getBreadcrumbs(h){return(0,d.Im)(h)?(0,p.of)([]):(0,D.z)([h.collection.pipe((0,y.qD)(),(0,y.Bo)()),this.submissionService.getSubmissionCollectionId(h.id)]).pipe((0,v.n)(([t,T])=>(0,d.a4)(T)?this.collectionService.findById(T).pipe((0,y.qD)(),(0,y.Bo)()):(0,p.of)(t)),(0,v.n)(t=>this.dsoBreadcrumbsService.getBreadcrumbs(t,(0,S.wN)(t))))}static#t=this.\u0275fac=function(t){return new(t||c)(M.KVO(P.f),M.KVO(C.U),M.KVO(u.E),M.KVO(L.CollectionDataService))};static#e=this.\u0275prov=M.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}return c})()},9577:(W,B,o)=>{"use strict";o.d(B,{r:()=>p});class p{constructor(v,S){this.value=v,this.language=S}}},54100:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionEditComponent:()=>t});var p=o(71217),D=o(22867),v=o(41483),S=o(88627),d=o(17584),u=o(12007),C=o(91917),P=o(72683),L=o(79224),y=o(62647),M=o(64340),m=o(11750),c=o(53107),g=o(95968),h=o(69685);let t=(()=>{class T{constructor(I,N,G,E,j,U,X,k){this.changeDetectorRef=I,this.notificationsService=N,this.route=G,this.router=E,this.itemDataService=j,this.submissionService=U,this.translate=X,this.submissionJsonPatchOperationsService=k,this.collectionModifiable=null,this.subs=[],this.itemLink$=new p.t(void 0)}ngOnInit(){this.collectionModifiable=this.route.snapshot.data?.collectionModifiable??null,this.subs.push(this.route.paramMap.pipe((0,D.n)(I=>this.submissionService.retrieveSubmission(I.get("id"))),(0,v.p)(I=>(0,P.Pe)(I))).subscribe(I=>{if(I.hasSucceeded)if((0,P.Im)(I.payload))this.notificationsService.info(null,this.translate.get("submission.general.cannot_submit")),this.router.navigate(["/mydspace"]);else{const{errors:N}=I.payload;this.submissionErrors=(0,m.A)(N),this.submissionId=I.payload.id.toString(),this.collectionId=I.payload.collection.id,this.selfUrl=I.payload._links.self.href,this.sections=I.payload.sections,this.itemLink$.next(I.payload._links.item.href),this.item=I.payload.item,this.submissionDefinition=I.payload.submissionDefinition}else 404===I.statusCode&&this.router.navigate(["/404"],{skipLocationChange:!0})}),this.itemLink$.pipe((0,P.VT)(),(0,D.n)(I=>this.itemDataService.findByHref(I)),(0,u.v7)(),(0,S.B)(300)).subscribe(I=>{this.item=I.payload,this.changeDetectorRef.detectChanges()}))}ngOnDestroy(){this.subs.filter(I=>(0,P.a4)(I)).forEach(I=>I.unsubscribe()),this.submissionJsonPatchOperationsService.deletePendingJsonPatchOperations()}static#t=this.\u0275fac=function(N){return new(N||T)(c.rXU(c.gRc),c.rXU(L.I),c.rXU(g.nX),c.rXU(g.Ix),c.rXU(d.ItemDataService),c.rXU(M.E),c.rXU(h.c$),c.rXU(C.U))};static#e=this.\u0275cmp=c.VBU({type:T,selectors:[["ds-base-submission-edit"]],standalone:!0,features:[c.aNF],decls:2,vars:8,consts:[[1,"submission-submit-container"],[3,"collectionId","sections","selfUrl","submissionDefinition","submissionErrors","item","collectionModifiable","submissionId"]],template:function(N,G){1&N&&(c.j41(0,"div",0),c.nrm(1,"ds-submission-form",1),c.k0s()),2&N&&(c.R7$(),c.Y8G("collectionId",G.collectionId)("sections",G.sections)("selfUrl",G.selfUrl)("submissionDefinition",G.submissionDefinition)("submissionErrors",G.submissionErrors)("item",G.item)("collectionModifiable",G.collectionModifiable)("submissionId",G.submissionId))},dependencies:[y.a]})}return T})()},40756:(W,B,o)=>{"use strict";o.d(B,{r:()=>u});var p=o(21124),v=(o(54100),o(53107));const S=["*"];function d(C,P){}let u=(()=>{class C extends p.J{getComponentName(){return"SubmissionEditComponent"}importThemedComponent(L){return o(9048)(`./${L}/app/submission/edit/submission-edit.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,54100))}static#t=this.\u0275fac=(()=>{let L;return function(M){return(L||(L=v.xGo(C)))(M||C)}})();static#e=this.\u0275cmp=v.VBU({type:C,selectors:[["ds-submission-edit"]],standalone:!0,features:[v.Vt3,v.aNF],ngContentSelectors:S,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(y,M){1&y&&(v.NAR(),v.DNE(0,d,0,0,"ng-template",null,0,v.C5r),v.j41(2,"div",null,1),v.SdG(4),v.k0s())},encapsulation:2})}return C})()},62647:(W,B,o)=>{"use strict";o.d(B,{a:()=>Js});var p=o(54460),D=o(75884),v=o.n(D),S=o(63016),d=o(41483),u=o(47947),C=o(66645),P=o(22867),L=o(21706),M=(o(99168),o(25744)),c=(o(47376),o(72683)),g=o(21548),h=o(96013),t=o(53107),T=o(2155),x=o(69685),I=o(96858),N=o(16700),G=o(46087),E=o.n(G),j=o(64340),U=o(38755),X=o(25941),k=o(55445);let J=(()=>{class n{constructor(e,i,s){this.changeDetectorRef=e,this.submissionService=i,this.sectionService=s,this.mandatory=!0,this.genericSectionErrors=[],this.allSectionErrors=[],this.active=!0,this.sectionState=this.mandatory,this.subs=[]}ngOnInit(){this.valid=this.sectionService.isSectionValid(this.submissionId,this.sectionId).pipe((0,u.T)(e=>(e&&this.resetErrors(),e))),this.subs.push(this.sectionService.getShownSectionErrors(this.submissionId,this.sectionId,this.sectionType).subscribe(e=>{(0,c.hj)(e)?e.forEach(i=>{(0,U.A)(i.path).forEach(r=>{r.fieldId?this.allSectionErrors.push(i.message):this.genericSectionErrors=E()(this.genericSectionErrors.concat(i.message))})}):this.resetErrors()}),this.submissionService.getActiveSectionId(this.submissionId).subscribe(e=>{const i=this.active;this.active=e===this.sectionId,i!==this.active&&(this.changeDetectorRef.detectChanges(),!this.active&&(0,c.Pe)(e)&&this.submissionService.dispatchSave(this.submissionId))})),this.enabled=this.sectionService.isSectionEnabled(this.submissionId,this.sectionId)}ngOnDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}sectionChange(e){this.sectionState=e.nextState}isOpen(){return this.sectionState}isMandatory(){return this.mandatory}isSectionActive(){return this.active}isEnabled(){return this.enabled}isValid(){return this.valid}removeSection(e,i){this.sectionService.removeSection(e,i)}hasGenericErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0}hasErrors(){return this.genericSectionErrors&&this.genericSectionErrors.length>0||this.allSectionErrors&&this.allSectionErrors.length>0}getErrors(){return this.genericSectionErrors}setFocus(e){this.active||this.submissionService.setActiveSection(this.submissionId,this.sectionId)}isInfo(){return this.sectionService.getIsInformational(this.sectionType)}removeError(e){this.genericSectionErrors.splice(e)}resetErrors(){(0,c.hj)(this.genericSectionErrors)&&this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionId),this.genericSectionErrors=[],this.allSectionErrors=[]}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(j.E),t.rXU(X.c))};static#e=this.\u0275dir=t.FsC({type:n,selectors:[["","dsSection",""]],inputs:{mandatory:"mandatory",sectionId:"sectionId",sectionType:"sectionType",submissionId:"submissionId"},exportAs:["sectionRef"],standalone:!0})}return n})();var $=o(89593),Q=o(76627),H=o(37610),Z=o(27035),q=o(14845),ot=o(65067),nt=o(51142),et=o(12007),gt=o(91917),ft=o(75988),ht=o(28022),a=o(36590),vt=o(50120),Ut=o(5038),$t=o(80773),Ot=o.n($t),Et=o(20857),Rt=o(35873),At=o(9577),St=o(36302);let Dt=(()=>{class n{constructor(e,i){this.formBuilder=e,this.operationsBuilder=i}dispatchOperationsFromEvent(e,i,s,r){switch(i.type){case"remove":this.dispatchOperationsFromRemoveEvent(e,i,s);break;case"change":this.dispatchOperationsFromChangeEvent(e,i,s,r);break;case"move":this.dispatchOperationsFromMoveEvent(e,i,s)}}getArrayIndexFromEvent(e){let i;return(0,c.hj)(e)&&((0,$.hDs)(e)?(0,c.kZ)(e.context)?this.isPartOfArrayOfGroup(e.model)&&(i=e.model.parent.parent.index):i=e.context.index:i=e?.index),(0,c.EA)(i)?i:0}isPartOfArrayOfGroup(e){return(0,c.Pe)(e.parent)&&e.parent.type===$.wnr&&e.parent.parent&&e.parent.parent.context&&e.parent.parent.context.type===$.WlY}getQualdropValueMap(e){const i=new Map;return(this.formBuilder.isQualdropGroup(e.model)?e.model.parent.context:e.model.parent.parent.context).groups.forEach(r=>{const _=r.group[0],f=i.get(_.qualdropId)?i.get(_.qualdropId):[];_.value&&(f.push(_.value),i.set(_.qualdropId,f))}),i}getFieldPathFromEvent(e){const i=this.getArrayIndexFromEvent(e),s=this.getFieldPathSegmentedFromChangeEvent(e);return(0,c.EA)(i)?s+"/"+i:s}getQualdropItemPathFromEvent(e){const i=this.getArrayIndexFromEvent(e),s=new Map;let r=null;return(this.formBuilder.isQualdropGroup(e.model)?e.model.parent.context:e.model.parent.parent.context).groups.forEach((f,R)=>{const V=f.group[0],tt=s.get(V.qualdropId)?s.get(V.qualdropId):[];V.value&&(tt.push(V.value),s.set(V.qualdropId,tt)),R===i&&(r=V.qualdropId+"/"+(tt.length-1))}),r}getFieldPathSegmentedFromChangeEvent(e){let i;return i=this.formBuilder.isQualdropGroup(e.model)?e.model.qualdropId:this.formBuilder.isQualdropGroup(e.model.parent)?e.model.parent.qualdropId:this.formBuilder.getId(e.model),i}getFieldValueFromChangeEvent(e){let i;const s=e.model.value;if(this.formBuilder.isModelInCustomGroup(e.model))i=e.model.parent.value;else if(this.formBuilder.isRelationGroup(e.model))i=e.model.getGroupValue();else if(e.model.hasLanguages){const r=e.model.language;e.model.hasAuthority?Array.isArray(s)?(s.forEach((_,f)=>{_=Object.assign(new Et.b,_,{language:r}),s[f]=_}),i=s):i=Object.assign(new Et.b,s,{language:r}):i=new St.e(s,r)}else i=(0,ft.z5)(s)?new St.e((0,ft.$T)(s)):s instanceof At.r||s instanceof Et.b||s instanceof Rt.M||Ot()(s)?s:new St.e(s);return i}getValueMap(e){const i=new Map;return e.forEach(s=>{Object.keys(s).forEach(r=>{const _=i.get(r)?i.get(r):[];_.push(s[r]),i.set(r,_)})}),i}dispatchOperationsFromRemoveEvent(e,i,s){const r=this.getFieldPathFromEvent(i),_=this.getFieldValueFromChangeEvent(i);this.formBuilder.isQualdropGroup(i.model)?this.dispatchOperationsFromMap(this.getQualdropValueMap(i),e,i,s):i.context&&i.context instanceof $.fHx?this.handleArrayGroupPatch(e,i,i.context.context,s):((0,c.hj)(_)&&"string"==typeof _||(0,c.hj)(_)&&_ instanceof St.e&&_.hasValue())&&this.operationsBuilder.remove(e.getPath(r))}dispatchOperationsFromAddEvent(e,i){const s=this.getFieldPathSegmentedFromChangeEvent(i),r=(0,Ut.Go)(this.getFieldValueFromChangeEvent(i));(0,c.hj)(r)&&(r.place=this.getArrayIndexFromEvent(i),(0,c.a4)(i.group)&&(0,c.a4)(i.group.value)&&(1===i.group.value.map(f=>Object.values(f)).reduce((f,R)=>f.concat(R)).filter(f=>(0,c.hj)(f)).length?this.operationsBuilder.add(e.getPath([s]),[r],!1):this.operationsBuilder.add(e.getPath([s,"-"]),r,!1)))}dispatchOperationsFromChangeEvent(e,i,s,r){if(i.context&&i.context instanceof $.fHx)return void this.handleArrayGroupPatch(e,i,i.context.context,s);const _=this.getFieldPathFromEvent(i),f=this.getFieldPathSegmentedFromChangeEvent(i),R=this.getFieldValueFromChangeEvent(i);if(this.formBuilder.isQualdropGroup(i.model.parent)||this.formBuilder.isQualdropGroup(i.model))this.dispatchOperationsFromMap(this.getQualdropValueMap(i),e,i,s);else if(this.formBuilder.isRelationGroup(i.model))this.dispatchOperationsFromMap(this.getValueMap(R),e,i,s);else if(this.formBuilder.hasArrayGroupValue(i.model))this.operationsBuilder.add(e.getPath(f),R,!0);else if(s.isPathEqual(this.formBuilder.getPath(i.model))||r&&(0,c.hj)(s.value)){if((0,c.a4)(i.$event)&&(0,c.a4)(i.$event.previousIndex))if(i.$event.previousIndex<0)this.operationsBuilder.add(e.getPath(f),R,!0);else{const V=e.getPath(_),tt=e.getPath(f+"/"+i.$event.previousIndex);(0,c.hj)(tt.path)&&(0,c.hj)(V.path)&&tt.path!==V.path&&this.operationsBuilder.move(V,tt.path)}else R.hasValue()?this.operationsBuilder.replace(e.getPath(_),R):0===this.getArrayIndexFromEvent(i)?this.operationsBuilder.remove(e.getPath(f)):this.operationsBuilder.remove(e.getPath(_));s.delete()}else R.hasValue()&&((0,c.b0)(this.getArrayIndexFromEvent(i))||0===this.getArrayIndexFromEvent(i)?this.operationsBuilder.add(e.getPath(f),R,!0):this.operationsBuilder.add(e.getPath(_),R))}dispatchOperationsFromMap(e,i,s,r){const _=e;if("remove"===s.type){const f=this.getQualdropItemPathFromEvent(s);this.operationsBuilder.remove(i.getPath(f))}else r.isPathEqual(this.formBuilder.getPath(s.model))&&r.value.forEach((f,R)=>{const V=_.get(R);V?(v()(f,V)||this.operationsBuilder.add(i.getPath(R),V,!0),_.delete(R)):V||this.operationsBuilder.remove(i.getPath(R))}),_.forEach((f,R)=>{1===f.length&&(0,c.kZ)(f[0])?this.operationsBuilder.remove(i.getPath(R)):this.operationsBuilder.add(i.getPath(R),f,!0)});r.delete()}dispatchOperationsFromMoveEvent(e,i,s){return this.handleArrayGroupPatch(e,i.$event,i.$event.arrayModel,s)}handleArrayGroupPatch(e,i,s,r){const _=this.formBuilder.getValueFromModel([s]),f=this.getFieldPathSegmentedFromChangeEvent(i);(0,c.hj)(_)?this.operationsBuilder.add(e.getPath(f),_[f],!1):r.isPathEqual(this.formBuilder.getPath(i.model))&&this.operationsBuilder.remove(e.getPath(f))}static#t=this.\u0275fac=function(i){return new(i||n)(t.KVO(ht.j),t.KVO(nt.C))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Tt=o(30593);let mt=(()=>{class n{constructor(e,i,s){this.injectedCollectionId=e,this.injectedSectionData=i,this.injectedSubmissionId=s,this.collectionId=e,this.sectionData=i,this.submissionId=s}ngOnInit(){this.onSectionInit(),this.updateSectionStatus()}updateSectionStatus(){this.sectionStatusSub=this.getSectionStatus().pipe((0,d.p)(e=>(0,c.EA)(e)),(0,Tt.Z)(!0)).subscribe(e=>{this.sectionService.setSectionStatus(this.submissionId,this.sectionData.id,e)})}ngOnDestroy(){(0,c.a4)(this.sectionStatusSub)&&this.sectionStatusSub.unsubscribe(),this.onSectionDestroy()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-section-model"]],decls:0,vars:0,template:function(i,s){},encapsulation:2})}return n})();const Gt={id:"discoverable",name:"discoverable"},Lt={element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}},K={id:"accessConditionGroup",group:[]},bt={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},b={id:"accessCondition",groupFactory:null},F={grid:{group:"form-row pt-4"}},O={id:"name",label:"submission.sections.accesses.form.access-condition-label",hint:"submission.sections.accesses.form.access-condition-hint",options:[]},Y={element:{host:"col-12",label:"col-form-label name-label"}},A={id:"startDate",label:"submission.sections.accesses.form.from-label",hint:"submission.sections.accesses.form.from-hint",placeholder:"submission.sections.accesses.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:$.AjF,operator:$.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-from"}},w={element:{label:"col-form-label"},grid:{host:"col-6"}},z={id:"endDate",label:"submission.sections.accesses.form.until-label",hint:"submission.sections.accesses.form.until-hint",placeholder:"submission.sections.accesses.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:$.AjF,operator:$.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.accesses.form.date-required-until"}},ut={element:{label:"col-form-label"},grid:{host:"col-6"}};var at=o(80451),pt=o(73958);let Mt=(()=>{class n{constructor(e){this.store=e}getAccessesData(e,i){return this.store.select((0,at.on)(e,i)).pipe((0,d.p)(s=>(0,c.EA)(s)),(0,C.F)())}static#t=this.\u0275fac=function(i){return new(i||n)(t.KVO(pt.il))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Nt=["formRef"];function Vt(n,l){if(1&n){const e=t.RV6();t.j41(0,"ds-form",2,0),t.bIt("dfChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onChange(s))})("removeArrayItem",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onRemove(s))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("formId",e.formId)("formModel",e.formModel)("displaySubmit",!1)("displayCancel",!1)}}let Xt=(()=>{class n extends mt{constructor(e,i,s,r,_,f,R,V,tt,lt,dt){super(void 0,lt,dt),this.sectionService=e,this.formBuilderService=i,this.accessesConfigService=s,this.accessesService=r,this.formOperationsService=_,this.operationsBuilder=f,this.formService=R,this.translate=V,this.operationsService=tt,this.injectedSectionData=lt,this.injectedSubmissionId=dt,this.subs=[]}initModelData(e){this.accessesData.accessConditions.forEach((i,s)=>{Array.of("name","startDate","endDate").filter(r=>i.hasOwnProperty(r)&&(0,c.hj)(i[r])).forEach(r=>{const _=this.formBuilderService.findById(r,e,s);if(_)if(_.type===$.fQD){const f=new Date(i[r]);_.value={year:f.getUTCFullYear(),month:f.getUTCMonth()+1,day:f.getUTCDate()}}else _.value=i[r]})})}onChange(e){if(e.model.type===$.eU4){const i=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),s=this.formOperationsService.getFieldValueFromChangeEvent(e);this.operationsBuilder.replace(this.pathCombiner.getPath(i),s.value,!0)}else{if(e.model.id===O.id){const i=e.control.parent.get("startDate"),s=e.control.parent.get("endDate");i?.markAsUntouched(),s?.markAsUntouched(),i?.setValue(null),s?.setValue(null),e.control.parent.markAsDirty()}this.formService.validateAllFormFields(this.formRef.formGroup),this.formService.isValid(this.formId).pipe((0,H.s)(1),(0,d.p)(i=>i),(0,Z.Z)(()=>this.formService.getFormData(this.formId)),(0,H.s)(1)).subscribe(i=>{const s=[];i.accessCondition.map(r=>r.accessConditionGroup).filter(r=>(0,c.hj)(r)).forEach(r=>{let _;if(this.availableAccessConditionOptions.filter(f=>(0,c.Pe)(r.name)&&f.name===r.name[0].value).forEach(f=>_=f),_){const f=Object.assign({},r);if(f.name=this.retrieveValueFromField(r.name),_.hasStartDate){if(r.startDate){const R=this.retrieveValueFromField(r.startDate);f.startDate=(0,ft.Sd)(R)}}else delete f.startDate;if(_.hasEndDate){if(r.endDate){const R=this.retrieveValueFromField(r.endDate);f.endDate=(0,ft.Sd)(R)}}else delete f.endDate;s.push(f)}}),this.operationsBuilder.add(this.pathCombiner.getPath("accessConditions"),s,!0)})}}onRemove(e){const s="accessConditions/"+this.formOperationsService.getArrayIndexFromEvent(e);this.operationsBuilder.remove(this.pathCombiner.getPath(s))}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new ot.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id);const e=this.accessesConfigService.findByHref(this.sectionData.config,!0,!1).pipe((0,et.yd)(),(0,u.T)(s=>s.payload)),i=this.accessesService.getAccessesData(this.submissionId,this.sectionData.id);(0,Q.z)([e,i]).subscribe(([s,r])=>{this.availableAccessConditionOptions=(0,c.hj)(s.accessConditionOptions)?s.accessConditionOptions:[],this.canChangeDiscoverable=!!s.canChangeDiscoverable,this.accessesData=r,this.formModel=this.buildFileEditForm()})}getSectionStatus(){return(0,S.of)(!0)}buildFileEditForm(){const e=[];if(this.canChangeDiscoverable){const it=Object.assign({},Gt,{label:this.translate.instant("submission.sections.accesses.form.discoverable-label"),hint:this.translate.instant("submission.sections.accesses.form.discoverable-description"),value:this.accessesData.discoverable});e.push(new $.M7d(it,Lt))}const i=Object.assign({},O),s=Object.assign({},b),r=[];for(const it of this.availableAccessConditionOptions)r.push({label:it.name,value:it.name});i.options=r;const _=[],f=[];let R,V;this.availableAccessConditionOptions.forEach(it=>{if(it.hasStartDate&&(_.push({id:"name",value:it.name}),it.maxStartDate)){const rt=new Date(it.maxStartDate);R={year:rt.getUTCFullYear(),month:rt.getUTCMonth()+1,day:rt.getUTCDate()}}if(it.hasEndDate&&(f.push({id:"name",value:it.name}),it.maxEndDate)){const rt=new Date(it.maxEndDate);V={year:rt.getUTCFullYear(),month:rt.getUTCMonth()+1,day:rt.getUTCDate()}}});const tt={relations:[{match:$.AjF,operator:$.fXj,when:_}]},lt={relations:[{match:$.AjF,operator:$.fXj,when:f}]},dt=_.length>0,Ct=f.length>0;return s.groupFactory=()=>{const it=new $.z4z(i,Y),rt=Object.assign({},A,tt);R&&(rt.max=R);const Ft=Object.assign({},z,lt);V&&(Ft.max=V);const Hs=new $.dku(rt,w),Qs=new $.dku(Ft,ut),xt=Object.assign({},K);return xt.group=[it],dt&&xt.group.push(Hs),Ct&&xt.group.push(Qs),[new $.iO5(xt,bt)]},s.initialCount=(0,c.hj)(this.accessesData.accessConditions)?this.accessesData.accessConditions.length:1,e.push(new $.UqU(s,F)),this.initModelData(e),e}retrieveValueFromField(e){const i=Array.isArray(e)?e[0]:e;return i?i.value:void 0}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(X.c),t.rXU(ht.j),t.rXU(q.SubmissionAccessesConfigDataService),t.rXU(Mt),t.rXU(Dt),t.rXU(nt.C),t.rXU(vt.u),t.rXU(x.c$),t.rXU(gt.U),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-section-accesses"]],viewQuery:function(i,s){if(1&i&&t.GBs(Nt,5),2&i){let r;t.mGM(r=t.lsd())&&(s.formRef=r.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:1,vars:1,consts:[["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","removeArrayItem",4,"ngIf"],[3,"dfChange","removeArrayItem","formId","formModel","displaySubmit","displayCancel"]],template:function(i,s){1&i&&t.DNE(0,Vt,2,4,"ds-form",1),2&i&&t.Y8G("ngIf",!!s.formModel)},dependencies:[a.s,p.bT],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]})}return n})();var Yt=o(84195),st=o(57636),ct=o(16768);const Pt=[[["",8,"selection"]],[["",8,"menu"]]],kt=[".selection",".menu"];function Kt(n,l){if(1&n&&(t.j41(0,"div",4)(1,"span",5),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&n){const e=t.XpG();t.R7$(2),t.SpI(" ",t.bMT(3,1,e.label)," ")}}let It=(()=>{class n{constructor(){this.toggled=new t.bkB,this.close=new t.bkB}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-select"]],inputs:{label:"label",disabled:"disabled"},outputs:{toggled:"toggled",close:"close"},standalone:!0,features:[t.aNF],ngContentSelectors:kt,decls:8,vars:2,consts:[["ngbDropdown","",1,"btn-group",3,"openChange"],["class","input-group-prepend",4,"ngIf"],["aria-describedby","dsSelectMenuLabel","id","dsSelectMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary","selection",3,"blur","click","disabled"],["ngbDropdownMenu","","id","dsSelectDropdownMenu","aria-labelledby","dsSelectMenuButton",1,"dropdown-menu"],[1,"input-group-prepend"],["id","dsSelectMenuLabel",1,"input-group-text"]],template:function(i,s){1&i&&(t.NAR(Pt),t.j41(0,"div")(1,"div",0),t.bIt("openChange",function(_){return s.toggled.emit(_)}),t.DNE(2,Kt,4,3,"div",1),t.j41(3,"button",2),t.bIt("blur",function(_){return s.close.emit(_)})("click",function(_){return s.close.emit(_)}),t.SdG(4),t.k0s(),t.j41(5,"div",3)(6,"div"),t.SdG(7,1),t.k0s()()()()),2&i&&(t.R7$(2),t.Y8G("ngIf",s.label),t.R7$(),t.Y8G("disabled",s.disabled))},dependencies:[T.zH,T.tg,T.do,T.U0,p.bT,x.h,x.D9]})}return n})();var jt=o(63524);function oe(n,l){1&n&&(t.j41(0,"span"),t.nrm(1,"ds-loading"),t.k0s())}function ae(n,l){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.getSelectedCcLicense().name," ")}}function re(n,l){1&n&&(t.qex(0),t.EFF(1),t.nI1(2,"translate"),t.bVm()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.change")," "))}function ce(n,l){1&n&&(t.qex(0),t.EFF(1),t.nI1(2,"translate"),t.bVm()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.select")," "))}function le(n,l){if(1&n&&(t.j41(0,"span"),t.DNE(1,re,3,3,"ng-container",4)(2,ce,3,3,"ng-container",4),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",e.storedCcLicenseLink),t.R7$(),t.Y8G("ngIf",!e.storedCcLicenseLink)}}function de(n,l){1&n&&(t.j41(0,"button",8),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.none")," "))}function me(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.selectCcLicense(s))}),t.EFF(1),t.k0s()}if(2&n){const e=l.$implicit;t.R7$(),t.SpI(" ",e.name," ")}}function ue(n,l){if(1&n&&(t.j41(0,"div",11)(1,"h5"),t.EFF(2),t.k0s(),t.nrm(3,"div",21),t.k0s()),2&n){const e=l.$implicit;t.R7$(2),t.SpI(" ",e.label," "),t.R7$(),t.Y8G("innerHTML",e.description,t.npT)}}function pe(n,l){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"div",16)(2,"div")(3,"h4"),t.EFF(4),t.k0s(),t.nrm(5,"div",17),t.k0s(),t.j41(6,"button",18),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.closeInfoModal())}),t.j41(7,"span",19),t.EFF(8,"\xd7"),t.k0s()()(),t.j41(9,"div",20),t.DNE(10,ue,4,2,"div",10),t.k0s()()}if(2&n){const e=t.XpG().$implicit;t.R7$(4),t.SpI(" ",e.label," "),t.R7$(),t.Y8G("innerHTML",e.description,t.npT),t.R7$(5),t.Y8G("ngForOf",e.enums)}}function _e(n,l){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=t.XpG().ngVar;t.R7$(),t.SpI(" ",e.label," ")}}function he(n,l){1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.ccLicense.option.select")," "))}function fe(n,l){if(1&n&&(t.qex(0,3),t.DNE(1,_e,2,1,"span",4)(2,he,3,3,"span",4),t.bVm()),2&n){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e),t.R7$(),t.Y8G("ngIf",!e)}}function be(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2).$implicit,_=t.XpG(2);return t.Njj(_.selectOption(_.getSelectedCcLicense(),r,s))}),t.EFF(1),t.k0s()}if(2&n){const e=l.$implicit;t.R7$(),t.SpI(" ",e.label," ")}}function ge(n,l){if(1&n&&(t.j41(0,"ds-select",2),t.DNE(1,fe,3,2,"ng-container",22),t.qex(2,5),t.j41(3,"div",23),t.DNE(4,be,2,1,"button",7),t.k0s(),t.bVm(),t.k0s()),2&n){const e=t.XpG().$implicit,i=t.XpG(2);t.Y8G("disabled","jurisdiction"===e.id&&void 0!==i.defaultJurisdiction&&"none"!==i.defaultJurisdiction),t.R7$(),t.Y8G("ngVar",i.getSelectedOption(i.getSelectedCcLicense(),e)),t.R7$(3),t.Y8G("ngForOf",e.enums)}}function ve(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",25)(1,"div",26),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2).$implicit,_=t.XpG(2);return t.Njj(_.selectOption(_.getSelectedCcLicense(),r,s))}),t.nrm(2,"input",27),t.j41(3,"span"),t.EFF(4),t.k0s()()()}if(2&n){const e=l.$implicit,i=t.XpG(2).$implicit,s=t.XpG(2);t.R7$(2),t.FS9("title",e.label),t.Y8G("checked",s.isSelectedOption(s.getSelectedCcLicense(),i,e)),t.R7$(2),t.JRh(e.label)}}function Se(n,l){if(1&n&&(t.qex(0),t.DNE(1,ve,5,3,"div",24),t.bVm()),2&n){const e=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",e.enums)}}function Ie(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",11)(1,"div",12)(2,"div"),t.EFF(3),t.k0s(),t.j41(4,"button",13),t.bIt("click",function(){t.eBV(e);const s=t.sdS(7),r=t.XpG(2);return t.Njj(r.openInfoModal(s))}),t.nrm(5,"i",14),t.k0s()(),t.DNE(6,pe,11,3,"ng-template",null,0,t.C5r)(8,ge,5,3,"ds-select",15)(9,Se,2,1,"ng-container",4),t.k0s()}if(2&n){const e=l.$implicit;t.R7$(2),t.ZvI("font-weight-bold ",e.id,""),t.R7$(),t.SpI(" ",e.label," "),t.R7$(5),t.Y8G("ngIf",(null==e.enums?null:e.enums.length)>5),t.R7$(),t.Y8G("ngIf",(null==e.enums?null:e.enums.length)<=5)}}function Ce(n,l){if(1&n&&(t.qex(0),t.DNE(1,Ie,10,6,"div",10),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.getSelectedCcLicense().fields)}}function Ee(n,l){1&n&&(t.j41(0,"div"),t.nrm(1,"ds-loading"),t.k0s())}function De(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",30)(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"a",31),t.EFF(5),t.k0s(),t.j41(6,"div",32)(7,"div",26),t.bIt("click",function(){t.eBV(e);const s=t.XpG(3);return t.Njj(s.setAccepted(!s.accepted))}),t.nrm(8,"input",33),t.j41(9,"span"),t.EFF(10),t.nI1(11,"translate"),t.k0s()()()()}if(2&n){const e=t.XpG().ngVar,i=t.XpG(2);t.R7$(2),t.SpI(" ",t.bMT(3,5,"submission.sections.ccLicense.link")," "),t.R7$(2),t.FS9("href",e,t.B4B),t.R7$(),t.SpI(" ",e," "),t.R7$(3),t.Y8G("checked",i.accepted),t.R7$(2),t.SpI(" ",t.bMT(11,7,"submission.sections.ccLicense.confirmation"),"")}}function Te(n,l){if(1&n&&(t.qex(0),t.DNE(1,Ee,2,0,"div",4)(2,De,12,9,"div",29),t.bVm()),2&n){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",!e),t.R7$(),t.Y8G("ngIf",e)}}function Me(n,l){if(1&n&&(t.qex(0),t.DNE(1,Te,3,2,"ng-container",28),t.nI1(2,"async"),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.getCcLicenseLink$()))}}let ye=(()=>{class n extends mt{get storedCcLicenseLink(){return this.data.uri}get accepted(){return void 0===this.data.accepted?!!this.data.uri:this.data.accepted}constructor(e,i,s,r,_,f,R,V,tt){super(R,V,tt),this.modalService=e,this.sectionService=i,this.submissionCcLicensesDataService=s,this.submissionCcLicenseUrlDataService=r,this.operationsBuilder=_,this.configService=f,this.injectedCollectionId=R,this.injectedSectionData=V,this.injectedSubmissionId=tt,this.isLoading=!0,this.subscriptions=[]}get data(){return this.sectionData.data}selectCcLicense(e){this.getSelectedCcLicense()&&this.getSelectedCcLicense().id===e.id||(this.setAccepted(!1),this.updateSectionData({ccLicense:{id:e.id,fields:{}},uri:void 0}))}getSelectedCcLicense(){return this.submissionCcLicenses&&this.data.ccLicense?this.submissionCcLicenses.filter(e=>e.id===this.data.ccLicense.id)[0]:null}selectOption(e,i,s){this.isSelectedOption(e,i,s)||this.updateSectionData({ccLicense:{id:e.id,fields:Object.assign({},this.data.ccLicense.fields,{[i.id]:s})},accepted:!1})}getSelectedOption(e,i){return"jurisdiction"===i.id&&void 0!==this.defaultJurisdiction&&"none"!==this.defaultJurisdiction?i.enums.find(s=>s.id===this.defaultJurisdiction):this.data.ccLicense.fields[i.id]}isSelectedOption(e,i,s){return this.getSelectedOption(e,i)&&this.getSelectedOption(e,i).id===s.id}getCcLicenseLink$(){if(this.storedCcLicenseLink)return(0,S.of)(this.storedCcLicenseLink);if(!this.getSelectedCcLicense()||this.getSelectedCcLicense().fields.some(i=>!this.getSelectedOption(this.getSelectedCcLicense(),i)))return;const e=this.getSelectedCcLicense();return this.submissionCcLicenseUrlDataService.getCcLicenseLink(e,new Map(e.fields.map(i=>[i,this.getSelectedOption(e,i)])))}openInfoModal(e){this.modalRef=this.modalService.open(e)}closeInfoModal(){this.modalRef.close()}getSectionStatus(){return(0,S.of)(this.accepted)}onSectionDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new ot.S("sections",this.sectionData.id),this.subscriptions.push(this.sectionService.getSectionState(this.submissionId,this.sectionData.id,k.l.CcLicense).pipe((0,d.p)(e=>(0,c.hj)(e)&&((0,c.hj)(e.data)||(0,c.hj)(e.errorsToShow))),(0,C.F)(),(0,u.T)(e=>e.data)).subscribe(e=>{if(this.data.accepted!==e.accepted){const i=this.pathCombiner.getPath("uri");e.accepted?this.getCcLicenseLink$().pipe((0,H.s)(1)).subscribe(s=>{this.operationsBuilder.add(i,s.toString(),!1,!0)}):this.data.uri&&this.operationsBuilder.remove(i)}this.sectionData.data=e}),this.submissionCcLicensesDataService.findAll({elementsPerPage:9999}).pipe((0,et.yd)(),(0,et.Bo)(),(0,u.T)(e=>e.page)).subscribe(e=>this.submissionCcLicenses=e),this.configService.findByPropertyName("cc.license.jurisdiction").pipe((0,et.qD)(),(0,et.Bo)()).subscribe(e=>{this.defaultJurisdiction=void 0===e||0===e.values.length?"":e.values[0]}))}setAccepted(e){this.updateSectionData({accepted:e}),this.updateSectionStatus()}updateSectionData(e){this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,Object.assign({},this.data,e))}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(T.Bq),t.rXU(X.c),t.rXU(st.SubmissionCcLicenseDataService),t.rXU(ct.SubmissionCcLicenseUrlDataService),t.rXU(nt.C),t.rXU(Yt.ConfigurationDataService),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-cc-licenses"]],standalone:!0,features:[t.Vt3,t.aNF],decls:11,vars:8,consts:[["infoModal",""],[1,"mb-4","ccLicense-select"],[3,"disabled"],[1,"selection"],[4,"ngIf"],[1,"menu"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"d-flex","flex-row"],[1,"btn","btn-outline-info","btn-sm","ml-2",3,"click"],[1,"fas","fa-question"],[3,"disabled",4,"ngIf"],[1,"modal-header","mb-4"],[3,"innerHTML"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"font-weight-light",3,"innerHTML"],["class","selection",4,"ngVar"],[1,"options-select-menu","overflow-auto"],["class","d-flex flex-row m-1",4,"ngFor","ngForOf"],[1,"d-flex","flex-row","m-1"],[3,"click"],["type","radio",1,"mr-1",3,"title","checked"],[4,"ngVar"],["class","mt-2 p-4 bg-light text-dark",4,"ngIf"],[1,"mt-2","p-4","bg-light","text-dark"],["target","_blank","rel","noopener noreferrer",1,"license-link",3,"href"],[1,"m-2"],["type","checkbox","title","accepted",1,"mr-2",3,"checked"]],template:function(i,s){1&i&&(t.j41(0,"div",1)(1,"ds-select",2),t.qex(2,3),t.DNE(3,oe,2,0,"span",4)(4,ae,2,1,"span",4)(5,le,3,2,"span",4),t.bVm(),t.qex(6,5),t.DNE(7,de,3,3,"button",6)(8,me,2,1,"button",7),t.bVm(),t.k0s()(),t.DNE(9,Ce,2,1,"ng-container",4)(10,Me,3,3,"ng-container",4)),2&i&&(t.R7$(),t.Y8G("disabled",!s.submissionCcLicenses),t.R7$(2),t.Y8G("ngIf",!s.submissionCcLicenses),t.R7$(),t.Y8G("ngIf",s.getSelectedCcLicense()),t.R7$(),t.Y8G("ngIf",s.submissionCcLicenses&&!s.getSelectedCcLicense()),t.R7$(2),t.Y8G("ngIf",0===(null==s.submissionCcLicenses?null:s.submissionCcLicenses.length)),t.R7$(),t.Y8G("ngForOf",s.submissionCcLicenses),t.R7$(),t.Y8G("ngIf",s.getSelectedCcLicense()),t.R7$(),t.Y8G("ngIf",s.getCcLicenseLink$()))},dependencies:[x.h,x.D9,p.bT,g.v,p.Jj,jt.r,p.Sq,It],styles:[".options-select-menu[_ngcontent-%COMP%]{max-height:25vh}"]})}return n})();var Fe=o(84562),Oe=o(87913),Re=o(15497);function Pe(n,l){1&n&&(t.qex(0),t.j41(1,"div",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.bVm()),2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"submission.sections.duplicates.none")))}function je(n,l){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.Lme(" ",t.bMT(2,2,"item.preview."+e.key)," ",e.value," ")}}function Be(n,l){1&n&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.in-workspace")))}function xe(n,l){1&n&&(t.j41(0,"p"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.duplicates.in-workflow")))}function Ue(n,l){if(1&n&&(t.j41(0,"div",6)(1,"a",7),t.EFF(2),t.k0s(),t.DNE(3,je,3,4,"div",8)(4,Be,3,3,"p",2)(5,xe,3,3,"p",2),t.k0s()),2&n){const e=l.$implicit,i=t.XpG(3);t.R7$(),t.Y8G("href",i.getItemLink(e.uuid),t.B4B),t.R7$(),t.JRh(e.title),t.R7$(),t.Y8G("ngForOf",i.Metadata.toViewModelList(e.metadata)),t.R7$(),t.Y8G("ngIf",e.workspaceItemId),t.R7$(),t.Y8G("ngIf",e.workflowItemId)}}function $e(n,l){if(1&n&&(t.qex(0),t.j41(1,"div",4),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.DNE(4,Ue,6,5,"div",5),t.bVm()),2&n){const e=t.XpG().ngVar;t.R7$(2),t.JRh(t.bMT(3,2,"submission.sections.duplicates.detected")),t.R7$(2),t.Y8G("ngForOf",null==e?null:e.potentialDuplicates)}}function Ae(n,l){if(1&n&&(t.j41(0,"div",1),t.DNE(1,Pe,4,3,"ng-container",2)(2,$e,5,4,"ng-container",2),t.k0s()),2&n){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",0===(null==e?null:e.potentialDuplicates.length)),t.R7$(),t.Y8G("ngIf",(null==e?null:e.potentialDuplicates.length)>0)}}let Ge=(()=>{class n extends mt{constructor(e,i,s,r,_,f){super(r,_,f),this.translate=e,this.sectionService=i,this.submissionService=s,this.injectedCollectionId=r,this.injectedSectionData=_,this.injectedSubmissionId=f,this.Metadata=Fe.O,this.AlertTypeEnum=N.v,this.isLoading=!0,this.subs=[]}ngOnInit(){super.ngOnInit()}onSectionInit(){this.isLoading=!1}isReadOnly(){return!0}onSectionDestroy(){}getSectionStatus(){return(0,S.of)(!this.isLoading)}getDuplicateData(){return this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType)}getItemLink(e){return new Oe.t((0,Re.Fy)(),e).toString()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(x.c$),t.rXU(X.c),t.rXU(j.E),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-duplicates"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["class","text-sm-left",4,"ngVar"],[1,"text-sm-left"],[4,"ngIf"],[1,"alert","alert-success","w-100"],[1,"alert","alert-warning","w-100"],["class","ds-duplicate",4,"ngFor","ngForOf"],[1,"ds-duplicate"],["target","_blank",3,"href"],[4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.DNE(0,Ae,3,2,"div",0),t.nI1(1,"async")),2&i&&t.Y8G("ngVar",t.bMT(1,1,s.getDuplicateData()))},dependencies:[jt.r,p.bT,p.Jj,x.h,x.D9,p.Sq],encapsulation:2})}return n})();var Le=o(83649),Zt=o.n(Le),yt=o(82040),Wt=o(25814),qt=o(86722),Ne=o(25718),Ve=o(9510),Xe=o(9843),Ye=o(88829),ke=o(21139),Ke=o(26589),wt=o(95143);class We{constructor(l=null,e=null){this._path=l,this._value=e}get path(){return this._path}set path(l){this._path=l}get value(){return this._value}set value(l){this._value=l}delete(){this._value=null,this._path=null}isPathEqual(l){return this._path&&v()(this._path,l)}}var we=o(79224),Je=o(65131),Jt=o(24106);const He=["formRef"];function Qe(n,l){1&n&&t.nrm(0,"ds-loading",3)}function ze(n,l){if(1&n){const e=t.RV6();t.j41(0,"ds-form",4,0),t.bIt("dfChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onChange(s))})("dfFocus",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onFocus(s))})("remove",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onRemove(s))})("ngbEvent",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onCustomEvent(s))})("removeArrayItem",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onRemove(s))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("formId",e.formId)("formModel",e.formModel)("displaySubmit",!1)("displayCancel",!1)}}let Ze=(()=>{class n extends mt{constructor(e,i,s,r,_,f,R,V,tt,lt,dt,Ct,it,rt,Ft){super(it,rt,Ft),this.cdr=e,this.formBuilderService=i,this.formOperationsService=s,this.formService=r,this.formConfigService=_,this.notificationsService=f,this.sectionService=R,this.submissionService=V,this.translate=tt,this.submissionObjectService=lt,this.objectCache=dt,this.requestService=Ct,this.injectedCollectionId=it,this.injectedSectionData=rt,this.injectedSubmissionId=Ft,this.isUpdating=!1,this.isLoading=!0,this.fieldsOnTheirWayToBeRemoved=new Map,this.formData=Object.create({}),this.previousValue=new We,this.subs=[],this.isSectionReadonly=!1}onSectionInit(){this.pathCombiner=new ot.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.sectionService.dispatchSetSectionFormId(this.submissionId,this.sectionData.id,this.formId),this.formConfigService.findByHref(this.sectionData.config).pipe((0,u.T)(e=>e.payload),(0,yt.M)(e=>this.formConfig=e),(0,Z.Z)(()=>(0,Q.z)([this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType),this.submissionObjectService.findById(this.submissionId,!0,!1,(0,Jt.s)("item")).pipe((0,et.yd)(),(0,et.Bo)()),this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope())])),(0,H.s)(1)).subscribe(([e,i,s])=>{(0,c.b0)(this.formModel)&&(this.submissionObject=i,this.isSectionReadonly=s,this.initForm(e,this.sectionData.errorsToShow,this.sectionData.serverValidationErrors),this.sectionData.data=e,this.subscriptions(),this.isLoading=!1,this.cdr.detectChanges())})}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}getSectionStatus(){const e=this.formService.isValid(this.formId),i=this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,u.T)(s=>(0,c.Im)(s)));return(0,Q.z)([e,i]).pipe((0,u.T)(([s,r])=>s&&r))}hasMetadataEnrichment(e){const i={};Object.keys(e).forEach(_=>{this.inCurrentSubmissionScope(_)&&(i[_]=e[_])});const s=[],r=(0,Je.iv)(i,this.formData);return Object.keys(r).forEach(_=>{r[_].forEach(f=>{f.hasOwnProperty("value")&&Zt()(this.formData[_],{value:f.value})<0&&s.push(f)})}),(0,c.hj)(s)}inCurrentSubmissionScope(e){switch(this.formConfig?.rows.find(s=>s.fields?.[0]?.selectableMetadata?s.fields?.[0]?.selectableMetadata?.[0]?.metadata===e:!!s.fields?.[0]?.selectableRelationship&&s.fields?.[0]?.selectableRelationship.relationshipType===e.replace(/^relationship\./g,""))?.fields?.[0]?.scope){case wt.L.WorkspaceItem.valueOf():return this.submissionObject.type===ke.F.type.value;case wt.L.WorkflowItem.valueOf():return this.submissionObject.type===Ye.t.type.value;default:return!0}}initForm(e,i,s){try{this.formModel=this.formBuilderService.modelFromConfiguration(this.submissionId,this.formConfig,this.collectionId,e,this.submissionService.getSubmissionScope(),this.isSectionReadonly);const r=this.sectionService.computeSectionConfiguredMetadata(this.formConfig);this.sectionService.updateSectionData(this.submissionId,this.sectionData.id,e,i,s,r)}catch(r){const f={message:this.translate.instant("error.submission.sections.init-form-error")+r.toString(),path:"/sections/"+this.sectionData.id};r instanceof Error&&console.error(r.stack),this.sectionService.setSectionError(this.submissionId,this.sectionData.id,f)}}updateForm(e){const i=e.data,s=e.errorsToShow;(0,c.hj)(i)&&!v()(i,this.sectionData.data)?(this.sectionData.data=i,this.hasMetadataEnrichment(i)?(this.isUpdating=!0,this.formModel=null,this.cdr.detectChanges(),this.initForm(i,s,e.serverValidationErrors),this.checksForErrors(s),this.isUpdating=!1,this.cdr.detectChanges()):((0,c.hj)(s)||(0,c.hj)(this.sectionData.errorsToShow))&&this.checksForErrors(s)):((0,c.hj)(s)||(0,c.hj)(this.sectionData.errorsToShow))&&this.checksForErrors(s)}checksForErrors(e){this.formService.isFormInitialized(this.formId).pipe((0,Wt.I)(i=>!0===i&&!this.isUpdating)).subscribe(()=>{this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,e,this.sectionData.errorsToShow),this.sectionData.errorsToShow=e,this.cdr.detectChanges()})}subscriptions(){this.subs.push(this.formService.getFormData(this.formId).pipe((0,C.F)()).subscribe(e=>{this.formData=e}),this.sectionService.getSectionState(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,d.p)(e=>(0,c.hj)(e)&&((0,c.hj)(e.data)||(0,c.hj)(e.errorsToShow))),(0,C.F)()).subscribe(e=>{this.fieldsOnTheirWayToBeRemoved=new Map,this.sectionMetadata=e.metadata,this.updateForm(e)}))}onChange(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(this.formBuilderService.getId(e.model),this.formOperationsService.getArrayIndexFromEvent(e)));const i=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),s=this.formOperationsService.getFieldValueFromChangeEvent(e);(-1!==qt.c.submission.autosave.metadata.indexOf(i)&&(0,c.hj)(s)||this.hasRelatedCustomError(i))&&this.submissionService.dispatchSave(this.submissionId)}hasRelatedCustomError(e){const i=Zt()(this.sectionData.errorsToShow,{path:this.pathCombiner.getPath(e).path});if(-1!==i){const r=this.sectionData.errorsToShow[i].message.replace("error.validation.","");return!qt.c.form.validatorMap.hasOwnProperty(r)}return!1}onFocus(e){const i=this.formOperationsService.getFieldValueFromChangeEvent(e),s=this.formBuilderService.getPath(e.model);this.formBuilderService.hasMappedGroupValue(e.model)?(this.previousValue.path=s,this.previousValue.value=this.formOperationsService.getQualdropValueMap(e)):(0,c.hj)(i)&&("object"==typeof i&&(0,c.hj)(i.value)||"string"==typeof i)&&(this.previousValue.path=s,this.previousValue.value=i)}onRemove(e){const i=this.formBuilderService.getId(e.model),s=this.formOperationsService.getArrayIndexFromEvent(e);if(this.fieldsOnTheirWayToBeRemoved.has(i)){const r=this.fieldsOnTheirWayToBeRemoved.get(i);r.push(s),this.fieldsOnTheirWayToBeRemoved.set(i,r)}else this.fieldsOnTheirWayToBeRemoved.set(i,[s]);this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,this.hasStoredValue(i,s))}hasStoredValue(e,i){return!!(0,c.hj)(this.sectionData.data)&&this.sectionData.data.hasOwnProperty(e)&&(0,c.hj)(this.sectionData.data[e][i])&&!this.isFieldToRemove(e,i)}isFieldToRemove(e,i){return this.fieldsOnTheirWayToBeRemoved.has(e)&&this.fieldsOnTheirWayToBeRemoved.get(e).includes(i)}onCustomEvent(e){this.formOperationsService.dispatchOperationsFromEvent(this.pathCombiner,e,this.previousValue,null)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(ht.j),t.rXU(Dt),t.rXU(vt.u),t.rXU(Ve.SubmissionFormsConfigDataService),t.rXU(we.I),t.rXU(X.c),t.rXU(j.E),t.rXU(x.c$),t.rXU(Ke.$),t.rXU(Ne.$),t.rXU(Xe.B),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-form"]],viewQuery:function(i,s){if(1&i&&t.GBs(He,5),2&i){let r;t.mGM(r=t.lsd())&&(s.formRef=r.first)}},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:2,consts:[["formRef","formComponent"],["message","Loading...",4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel","dfChange","dfFocus","remove","ngbEvent","removeArrayItem",4,"ngIf"],["message","Loading..."],[3,"dfChange","dfFocus","remove","ngbEvent","removeArrayItem","formId","formModel","displaySubmit","displayCancel"]],template:function(i,s){1&i&&t.DNE(0,Qe,1,0,"ds-loading",1)(1,ze,2,4,"ds-form",2),2&i&&(t.Y8G("ngIf",s.isLoading),t.R7$(),t.Y8G("ngIf",!s.isLoading&&s.formModel))},dependencies:[a.s,g.v,p.bT]})}return n})();var qe=o(51698);function ti(n,l){if(1&n&&(t.qex(0),t.j41(1,"li"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.bVm()),2&n){const e=t.XpG().$implicit;t.R7$(2),t.Lme("",t.bMT(3,2,"submission.sections.identifiers."+e.identifierType+"_label")," ",e.value,"")}}function ei(n,l){if(1&n&&(t.qex(0),t.DNE(1,ti,4,4,"ng-container",1),t.bVm()),2&n){const e=l.$implicit,i=t.XpG(2).ngVar;t.R7$(),t.Y8G("ngIf",i.displayTypes.includes(e.identifierType)&&e.value)}}function ii(n,l){if(1&n&&(t.qex(0),t.j41(1,"div")(2,"span"),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"ul"),t.DNE(6,ei,2,1,"ng-container",2),t.k0s()(),t.bVm()),2&n){const e=t.XpG().ngVar;t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.identifiers.info")),t.R7$(3),t.Y8G("ngForOf",e.identifiers)}}function ni(n,l){if(1&n&&(t.qex(0),t.DNE(1,ii,7,4,"ng-container",1),t.bVm()),2&n){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e&&e.identifiers)}}let si=(()=>{class n extends mt{constructor(e,i,s,r,_,f){super(r,_,f),this.translate=e,this.sectionService=i,this.submissionService=s,this.injectedCollectionId=r,this.injectedSectionData=_,this.injectedSubmissionId=f,this.AlertTypeEnum=N.v,this.isLoading=!0,this.identifierData$=new qe.c,this.subs=[]}ngOnInit(){super.ngOnInit()}onSectionInit(){this.isLoading=!1,this.identifierData$=this.getIdentifierData()}isReadOnly(){return!0}onSectionDestroy(){}getSectionStatus(){return(0,S.of)(!this.isLoading)}getIdentifierData(){return this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(x.c$),t.rXU(X.c),t.rXU(j.E),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-identifiers"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[[4,"ngVar"],[4,"ngIf"],[4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.DNE(0,ni,2,1,"ng-container",0),t.nI1(1,"async")),2&i&&t.Y8G("ngVar",t.bMT(1,1,s.getIdentifierData()))},dependencies:[x.h,x.D9,p.Sq,p.bT,p.Jj,jt.r],encapsulation:2})}return n})();var Ht=o(8109);const oi={granted:{element:{container:"custom-control custom-checkbox pl-1",control:"custom-control-input",label:"custom-control-label pt-1"}}},ai=[{id:"granted",label:"submission.sections.license.granted-label",required:!0,value:!1,validators:{required:null},errorMessages:{required:"submission.sections.license.required",notgranted:"submission.sections.license.notgranted"},type:"CHECKBOX"}],ri=["formRef"];function ci(n,l){if(1&n){const e=t.RV6();t.j41(0,"ds-form",3,0),t.bIt("dfChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onChange(s))}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("formId",e.formId)("formModel",e.formModel)("formLayout",e.formLayout)("displaySubmit",e.displaySubmit)("displayCancel",!1)}}let li=(()=>{class n extends mt{constructor(e,i,s,r,_,f,R,V,tt,lt,dt,Ct){super(lt,dt,Ct),this.changeDetectorRef=e,this.collectionDataService=i,this.formBuilderService=s,this.formOperationsService=r,this.formService=_,this.operationsBuilder=f,this.sectionService=R,this.submissionService=V,this.translateService=tt,this.injectedCollectionId=lt,this.injectedSectionData=dt,this.injectedSubmissionId=Ct,this.formLayout=oi,this.displaySubmit=!1,this.subs=[]}onSectionInit(){this.pathCombiner=new ot.S("sections",this.sectionData.id),this.formId=this.formService.getUniqueId(this.sectionData.id),this.formModel=this.formBuilderService.fromJSON(ai);const e=this.formBuilderService.findById("granted",this.formModel);e.label&&(e.label=this.translateService.instant(e.label)),e.value=this.sectionData.data.granted,this.licenseText$=this.collectionDataService.findById(this.collectionId,!0,!0,(0,Jt.s)("license")).pipe((0,d.p)(i=>(0,c.EA)(i.payload)),(0,Z.Z)(i=>i.payload.license),(0,Wt.I)(i=>(0,c.EA)(i.payload)),(0,u.T)(i=>i.payload.text),(0,Tt.Z)("")),this.subs.push(this.sectionService.isSectionReadOnly(this.submissionId,this.sectionData.id,this.submissionService.getSubmissionScope()).pipe((0,H.s)(1),(0,d.p)(i=>i)).subscribe(()=>{e.disabled=!0}),this.sectionService.getSectionErrors(this.submissionId,this.sectionData.id).pipe((0,d.p)(i=>(0,c.hj)(i)),(0,C.F)()).subscribe(i=>{const s=i.map(r=>"/sections/license"===r.path?e.checked?null:Object.assign({},r,{path:"/sections/license/granted"}):r).filter(r=>(0,c.Pe)(r));(0,c.hj)(s)?(this.sectionService.checkSectionErrors(this.submissionId,this.sectionData.id,this.formId,s),this.sectionData.errors=i):this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)}))}ngAfterViewChecked(){this.changeDetectorRef.detectChanges()}getSectionStatus(){const e=this.formBuilderService.findById("granted",this.formModel);return e.valueChanges.pipe((0,u.T)(i=>!0===i),(0,Tt.Z)(e.value))}onChange(e){const i=this.formOperationsService.getFieldPathSegmentedFromChangeEvent(e),s=this.formOperationsService.getFieldValueFromChangeEvent(e);s?(this.operationsBuilder.add(this.pathCombiner.getPath(i),s.value.toString(),!1,!0),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)):this.operationsBuilder.remove(this.pathCombiner.getPath(i)),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU(ht.j),t.rXU(Dt),t.rXU(vt.u),t.rXU(nt.C),t.rXU(X.c),t.rXU(j.E),t.rXU(x.c$),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-license"]],viewQuery:function(i,s){if(1&i&&t.GBs(ri,5),2&i){let r;t.mGM(r=t.lsd())&&(s.formRef=r.first)}},standalone:!0,features:[t.Jv_([]),t.Vt3,t.aNF],decls:5,vars:4,consts:[["formRef","formComponent"],[1,"mb-5","preserve-line-breaks",3,"innerHTML"],[3,"formId","formModel","formLayout","displaySubmit","displayCancel","dfChange",4,"ngIf"],[3,"dfChange","formId","formModel","formLayout","displaySubmit","displayCancel"]],template:function(i,s){1&i&&(t.nrm(0,"span",1),t.nI1(1,"async"),t.nrm(2,"br")(3,"br"),t.DNE(4,ci,2,5,"ds-form",2)),2&i&&(t.Y8G("innerHTML",t.bMT(1,2,s.licenseText$),t.npT),t.R7$(4),t.Y8G("ngIf",s.formModel))},dependencies:[a.s,p.bT,p.Jj]})}return n})();var te=o(59055),di=o(76772),mi=o(55546);const ui=n=>({"border-danger":n}),pi=n=>({"bg-light":n}),_i=n=>({pattern:n});function hi(n,l){1&n&&(t.j41(0,"button",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.dropdown.no-data")," "))}function fi(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",24),t.bIt("click",function(){t.eBV(e);const s=t.XpG().index,r=t.XpG(3).$implicit,_=t.XpG(2);return t.Njj(_.onChange(r.pattern,s,null))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.dropdown.select-none")," "))}function bi(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",25),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG().index,_=t.XpG(3).$implicit,f=t.XpG(2);return t.Njj(f.onChange(_.pattern,r,s))}),t.j41(1,"b"),t.EFF(2),t.k0s(),t.nrm(3,"br"),t.EFF(4),t.k0s()}if(2&n){const e=l.$implicit,i=t.XpG().index,s=t.XpG(3).$implicit,r=t.XpG(2);t.Y8G("ngClass",t.eq3(3,pi,(null==r.ldnServiceByPattern[s.pattern].services[i]?null:r.ldnServiceByPattern[s.pattern].services[i].id)===e.id)),t.R7$(2),t.SpI(" ",e.name," "),t.R7$(2),t.SpI(" ",e.description," ")}}function gi(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",26),t.nI1(1,"translate"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG().index,r=t.XpG(3).$implicit,_=t.XpG(2);return t.Njj(_.removeService(r,s))}),t.j41(3,"span"),t.nrm(4,"i",27),t.k0s()()}if(2&n){const e=t.XpG().index;t.AVh("mt-2",e>0),t.FS9("title",t.bMT(1,4,"form.remove")),t.BMQ("aria-label",t.bMT(2,6,"form.remove"))}}function vi(n,l){if(1&n&&(t.j41(0,"small",28),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG(4).$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"submission.section.section-coar-notify.small.notification",t.eq3(4,_i,e.pattern))," ")}}function Si(n,l){if(1&n&&(t.j41(0,"small",30),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,e.message)," ")}}function Ii(n,l){if(1&n&&(t.qex(0),t.DNE(1,Si,3,3,"small",29),t.nI1(2,"async"),t.bVm()),2&n){const e=t.XpG().index,i=t.XpG(3).$implicit,s=t.XpG(2);t.R7$(),t.Y8G("ngForOf",t.bMT(2,1,s.getShownSectionErrors$(i.pattern,e)))}}function Ci(n,l){if(1&n&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2).index,i=t.XpG(3).$implicit,s=t.XpG(2);t.R7$(),t.SpI(" ",s.ldnServiceByPattern[i.pattern].services[e].description," ")}}function Ei(n,l){1&n&&(t.j41(0,"span",36),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.section.section-coar-notify.selection.no-description")," "))}function Di(n,l){if(1&n&&(t.j41(0,"div",31)(1,"div",32),t.nrm(2,"i",33),t.j41(3,"div",34)(4,"div"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.DNE(7,Ci,2,1,"div",35)(8,Ei,3,3,"ng-template",null,1,t.C5r),t.k0s()()()),2&n){const e=t.sdS(9),i=t.XpG().index,s=t.XpG(3).$implicit,r=t.XpG(2);t.R7$(5),t.JRh(t.bMT(6,3,"submission.section.section-coar-notify.selection.description")),t.R7$(2),t.Y8G("ngIf",null==r.ldnServiceByPattern[s.pattern].services[i]?null:r.ldnServiceByPattern[s.pattern].services[i].description)("ngIfElse",e)}}function Ti(n,l){1&n&&(t.j41(0,"div",8)(1,"div",37)(2,"div",34)(3,"span"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()()),2&n&&(t.R7$(4),t.SpI(" ",t.bMT(5,1,"submission.section.section-coar-notify.notification.error")," "))}function Mi(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",38),t.bIt("click",function(){t.eBV(e);const s=t.XpG(4).$implicit,r=t.XpG(2);return t.Njj(r.addNewService(s))}),t.nrm(1,"i",39),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.sections.general.add-more")," "))}function yi(n,l){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"div",8)(2,"div",9,0)(4,"div",10),t.nrm(5,"i",11),t.j41(6,"input",12),t.nI1(7,"async"),t.bIt("click",function(){t.eBV(e);const s=t.sdS(3);return t.Njj(s.open())}),t.k0s()(),t.j41(8,"div",13)(9,"div",14),t.DNE(10,hi,3,3,"button",15),t.nI1(11,"async"),t.DNE(12,fi,3,3,"button",16),t.nI1(13,"async"),t.DNE(14,bi,5,5,"button",17),t.nI1(15,"async"),t.k0s()()(),t.DNE(16,gi,5,8,"button",18),t.k0s(),t.DNE(17,vi,3,6,"small",19)(18,Ii,3,3,"ng-container",3),t.nI1(19,"async"),t.DNE(20,Di,10,5,"div",20)(21,Ti,6,3,"div",21),t.nI1(22,"async"),t.j41(23,"div",8),t.DNE(24,Mi,4,3,"div",22),t.k0s()()}if(2&n){let e,i,s,r,_;const f=l.index,R=t.XpG(3).$implicit,V=t.XpG(2);t.R7$(2),t.AVh("mt-2",f>0),t.R7$(2),t.BMQ("aria-label",R.pattern+".dropdown"),t.R7$(2),t.Y8G("readonly",!0)("ngClass",t.eq3(31,ui,(null==(e=t.bMT(7,19,V.getShownSectionErrors$(R.pattern,f)))?null:e.length)>0))("value",null==V.ldnServiceByPattern[R.pattern].services[f]?null:V.ldnServiceByPattern[R.pattern].services[f].name),t.BMQ("aria-label",R.pattern+".dropdownanchor"),t.R7$(3),t.Y8G("infiniteScrollDistance",2)("infiniteScrollThrottle",50)("scrollWindow",!1),t.R7$(),t.Y8G("ngIf",0===(null==(i=t.bMT(11,21,V.filterServices(R.pattern)))?null:i.length)),t.R7$(2),t.Y8G("ngIf",(null==(s=t.bMT(13,23,V.filterServices(R.pattern)))?null:s.length)>0),t.R7$(2),t.Y8G("ngForOf",t.bMT(15,25,V.filterServices(R.pattern))),t.R7$(2),t.Y8G("ngIf",V.ldnServiceByPattern[R.pattern].services.length>1),t.R7$(),t.Y8G("ngIf",!V.ldnServiceByPattern[R.pattern].services[f]&&f===V.ldnServiceByPattern[R.pattern].services.length-1),t.R7$(),t.Y8G("ngIf",(null==(r=t.bMT(19,27,V.getShownSectionErrors$(R.pattern,f)))?null:r.length)>0),t.R7$(2),t.Y8G("ngIf",V.ldnServiceByPattern[R.pattern].services[f]),t.R7$(),t.Y8G("ngIf",(null==(_=t.bMT(22,29,V.getShownSectionErrors$(R.pattern,f)))?null:_.length)>0),t.R7$(3),t.Y8G("ngIf",R.multipleRequest&&f===V.ldnServiceByPattern[R.pattern].services.length-1)}}function Fi(n,l){if(1&n&&(t.j41(0,"div"),t.DNE(1,yi,25,33,"div",7),t.k0s()),2&n){const e=t.XpG(2).$implicit,i=t.XpG(2);t.R7$(),t.Y8G("ngForOf",i.ldnServiceByPattern[e.pattern].services)}}function Oi(n,l){if(1&n&&(t.j41(0,"div")(1,"label",6),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.DNE(4,Fi,2,1,"div",3),t.k0s()),2&n){const e=t.XpG().$implicit,i=t.XpG(2);t.R7$(2),t.SpI(" ",t.bMT(3,2,"submission.section.section-coar-notify.control."+e.pattern+".label")," "),t.R7$(2),t.Y8G("ngIf",null==i.ldnServiceByPattern[e.pattern]?null:i.ldnServiceByPattern[e.pattern].services.length)}}function Ri(n,l){if(1&n&&(t.j41(0,"div",5),t.DNE(1,Oi,5,4,"div",3),t.nI1(2,"async"),t.k0s()),2&n){let e;const i=l.$implicit,s=t.XpG(2);t.R7$(),t.Y8G("ngIf",(null==(e=t.bMT(2,1,s.filterServices(i.pattern)))?null:e.length)>0)}}function Pi(n,l){if(1&n&&(t.qex(0),t.DNE(1,Ri,3,3,"div",4),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.patterns)}}function ji(n,l){1&n&&(t.qex(0),t.j41(1,"p"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.bVm()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.section.section-coar-notify.info.no-pattern")," "))}let Bi=(()=>{class n extends mt{constructor(e,i,s,r,_,f,R,V){super(f,R,V),this.ldnServicesService=e,this.operationsBuilder=i,this.sectionService=s,this.coarNotifyConfigDataService=r,this.chd=_,this.injectedCollectionId=f,this.injectedSectionData=R,this.injectedSubmissionId=V,this.hasSectionData=!1,this.patterns=[],this.ldnServiceByPattern={},this.previousServices={},this.fieldsOnTheirWayToBeRemoved=new Map,this.subs=[],this.filteredServicesByPattern={}}onSectionInit(){this.setCoarNotifyConfig(),this.getSectionServerErrorsAndSetErrorsToDisplay(),this.pathCombiner=new ot.S("sections",this.sectionData.id)}setCoarNotifyConfig(){this.subs.push(this.coarNotifyConfigDataService.findAll().pipe((0,et.qD)()).subscribe(e=>{e.hasSucceeded&&(this.patterns=e.payload.page[0].patterns,this.initSelectedServicesByPattern())}))}onChange(e,i,s){if(this.ldnServiceByPattern[e].services[i]?.id===s?.id)return;this.previousServices[e]||(this.previousServices[e]={services:[],allowsMultipleRequests:this.patterns.find(_=>_.pattern===e)?.multipleRequest}),this.previousServices[e].services[i]=this.ldnServiceByPattern[e].services[i],this.ldnServiceByPattern[e].services[i]=s;const r=(0,c.a4)(this.previousServices[e].services[i])&&this.previousServices[e].services[i].id!==s?.id;r&&(this.operationsBuilder.flushOperation(this.pathCombiner.getPath([e,"-"])),this.filteredServicesByPattern[e]?.includes(this.previousServices[e].services[i])&&this.operationsBuilder.remove(this.pathCombiner.getPath([e,i.toString()]))),(!r||s?.id&&r)&&this.operationsBuilder.add(this.pathCombiner.getPath([e,"-"]),[s.id],!1,!0),this.previousServices[e].services[i]=this.ldnServiceByPattern[e].services[i],this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id),this.chd.detectChanges()}initSelectedServicesByPattern(){this.patterns.forEach(e=>{(0,c.a4)(this.sectionData.data[e.pattern])?this.subs.push(this.filterServices(e.pattern).subscribe(i=>{this.ldnServiceByPattern[e.pattern]||(this.ldnServiceByPattern[e.pattern]={services:[],allowsMultipleRequests:e.multipleRequest}),this.ldnServiceByPattern[e.pattern].services=i.filter(s=>{const r=this.sectionData.data[e.pattern].find(_=>_.id===s.id);return this.addService(e,r),this.sectionData.data[e.pattern].includes(s.uuid)})})):(this.ldnServiceByPattern[e.pattern]={services:[],allowsMultipleRequests:e.multipleRequest},this.addService(e,null))})}addService(e,i){this.ldnServiceByPattern[e.pattern]||(this.ldnServiceByPattern[e.pattern]={services:[],allowsMultipleRequests:e.multipleRequest}),this.ldnServiceByPattern[e.pattern].services.push(i)}removeService(e,i){this.ldnServiceByPattern[e.pattern]&&(this.ldnServiceByPattern[e.pattern].services.splice(i,1),this.previousServices[e.pattern]?.services.splice(i,1),this.operationsBuilder.flushOperation(this.pathCombiner.getPath([e.pattern,"-"])),this.sectionService.dispatchRemoveSectionErrors(this.submissionId,this.sectionData.id)),this.ldnServiceByPattern[e.pattern].services.length||this.addNewService(e)}filterServices(e){return this.ldnServicesService.findByInboundPattern(e).pipe((0,et.qD)(),(0,yt.M)(i=>{if(i.hasFailed)throw new Error(`Failed to retrieve services for pattern ${e}`)}),(0,d.p)(i=>i.hasSucceeded),(0,et.Bo)(),(0,et.W8)(),(0,yt.M)(i=>{this.filteredServicesByPattern[e]||(this.filteredServicesByPattern[e]=[]),0===this.filteredServicesByPattern[e].length&&this.filteredServicesByPattern[e].push(...i)}),(0,u.T)(i=>i.filter(s=>(this.hasSectionData||(this.hasSectionData=this.hasInboundPattern(s,e)),this.hasInboundPattern(s,e)))))}hasInboundPattern(e,i){return e.notifyServiceInboundPatterns.some(s=>s.pattern===i)}getSectionServerErrorsAndSetErrorsToDisplay(){this.subs.push(this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,H.s)(1),(0,d.p)(e=>(0,c.hj)(e))).subscribe(e=>{(0,c.hj)(e)&&e.forEach(i=>{this.sectionService.setSectionError(this.submissionId,this.sectionData.id,i)})}))}getShownSectionErrors$(e,i){return this.sectionService.getShownSectionErrors(this.submissionId,this.sectionData.id,this.sectionData.sectionType).pipe((0,H.s)(1),(0,d.p)(s=>(0,c.hj)(s)),(0,u.T)(s=>s.filter(r=>r.path.includes(`${e}/${i}`))))}getSectionStatus(){return this.sectionService.getSectionServerErrors(this.submissionId,this.sectionData.id).pipe((0,u.T)(e=>(0,c.Im)(e)))}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}addNewService(e){this.ldnServiceByPattern[e.pattern].services.push(null)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(di.LdnServicesService),t.rXU(nt.C),t.rXU(X.c),t.rXU(mi.CoarNotifyConfigDataService),t.rXU(t.gRc),t.rXU("collectionIdProvider"),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-coar-notify"]],standalone:!0,features:[t.Jv_([T.tg]),t.Vt3,t.aNF],decls:3,vars:2,consts:[["myDropdown","ngbDropdown"],["noDesc",""],[1,"container-fluid"],[4,"ngIf"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"row","col-form-label"],[4,"ngFor","ngForOf"],[1,"row"],["ngbDropdown","",1,"flex-grow-1"],[1,"position-relative","right-addon"],["ngbDropdownToggle","","aria-hidden","true",1,"position-absolute","scrollable-dropdown-toggle"],["type","text",1,"form-control","w-100","scrollable-dropdown-input",3,"click","readonly","ngClass","value"],["ngbDropdownMenu","","aria-haspopup","true","aria-expanded","false",1,"dropdown-menu","scrollable-dropdown-menu","w-100"],["role","listbox","infiniteScroll","",1,"scrollable-menu",3,"infiniteScrollDistance","infiniteScrollThrottle","scrollWindow"],["class","dropdown-item collection-item text-truncate w-100",4,"ngIf"],["class","dropdown-item collection-item text-truncate w-100",3,"click",4,"ngIf"],["class","dropdown-item collection-item text-truncate w-100",3,"ngClass","click",4,"ngFor","ngForOf"],["type","button","class","btn btn-secondary ml-2","role","button",3,"mt-2","title","click",4,"ngIf"],["class","row text-muted",4,"ngIf"],["class","row mt-1",4,"ngIf"],["class","row",4,"ngIf"],["class","btn btn-link mt-2 pl-0",3,"click",4,"ngIf"],[1,"dropdown-item","collection-item","text-truncate","w-100"],[1,"dropdown-item","collection-item","text-truncate","w-100",3,"click"],[1,"dropdown-item","collection-item","text-truncate","w-100",3,"click","ngClass"],["type","button","role","button",1,"btn","btn-secondary","ml-2",3,"click","title"],["aria-hidden","true",1,"fas","fa-trash"],[1,"row","text-muted"],["class","row text-danger",4,"ngFor","ngForOf"],[1,"row","text-danger"],[1,"row","mt-1"],[1,"alert","alert-info","w-100","d-flex","align-items-center","flex-row"],[1,"fa-solid","fa-circle-info","fa-xl","ml-2"],[1,"ml-4"],[4,"ngIf","ngIfElse"],[1,"text-muted"],[1,"alert","alert-danger","w-100","d-flex","align-items-center","flex-row"],[1,"btn","btn-link","mt-2","pl-0",3,"click"],[1,"fas","fa-plus"]],template:function(i,s){1&i&&(t.j41(0,"div",2),t.DNE(1,Pi,2,1,"ng-container",3)(2,ji,4,3,"ng-container",3),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",(null==s.patterns?null:s.patterns.length)>0),t.R7$(),t.Y8G("ngIf",!s.hasSectionData))},dependencies:[p.bT,p.Sq,p.Jj,x.h,x.D9,T.zH,T.tg,T.do,T.U0,p.YU,te.eO,te.DP],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}.scrollable-dropdown-loading[_ngcontent-%COMP%]{background-color:var(--bs-primary);color:#fff;height:calc(var(--bs-spacer) * 2)!important;line-height:calc(var(--bs-spacer) * 2);position:sticky;bottom:0}.scrollable-dropdown-menu[_ngcontent-%COMP%]{left:0!important;margin-bottom:var(--bs-spacer);z-index:1000}.scrollable-dropdown-toggle[_ngcontent-%COMP%]{padding:.7rem .7rem 0}.scrollable-dropdown-input[readonly][_ngcontent-%COMP%]{background-color:#fff}.toggle-icon[_ngcontent-%COMP%]{padding:.7rem .7rem 0}.ds-form-input-addon[_ngcontent-%COMP%]{border-top-right-radius:0!important;border-bottom-right-radius:0!important;border-right:0!important}.ds-form-input-btn[_ngcontent-%COMP%]{border:var(--bs-input-btn-border-width) solid var(--bs-input-border-color);border-top-left-radius:0;border-bottom-left-radius:0;border-left:0}.ds-form-input-btn[_ngcontent-%COMP%]:focus{box-shadow:none!important}button.ds-form-add-more[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none!important}.ds-form-input-value[_ngcontent-%COMP%]{border-top-left-radius:0!important;border-bottom-left-radius:0!important}.fa-spin[_ngcontent-%COMP%]{pointer-events:none}.left-addon[_ngcontent-%COMP%]   .far[_ngcontent-%COMP%], .left-addon[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%], .left-addon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{left:0}.right-addon[_ngcontent-%COMP%]   .far[_ngcontent-%COMP%], .right-addon[_ngcontent-%COMP%]   .fas[_ngcontent-%COMP%], .right-addon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{right:0}.left-addon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-left:calc(var(--bs-spacer) * 2.25)}.right-addon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-right:calc(var(--bs-spacer) * 2.25)}"]})}return n})();var Qt=o(71217);function xi(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4),t.EFF(7),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.id")),t.R7$(4),t.SpI("",e.metadata.id," ")}}function Ui(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.date.created")),t.R7$(4),t.SpI("",t.i5U(8,4,e.metadata.dateCreated,"d MMMM Y H:mm:ss zzzz")," ")}}function $i(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.record.information.date.modified")),t.R7$(4),t.SpI("",t.i5U(8,4,e.metadata.dateModified,"d MMMM Y H:mm:ss zzzz")," ")}}function Ai(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",5)(6,"p",4)(7,"a",6),t.EFF(8),t.k0s()()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,3,"submission.sections.sherpa.record.information.uri")),t.R7$(4),t.Y8G("href",e.metadata.uri,t.B4B),t.R7$(),t.JRh(e.metadata.uri)}}let Gi=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-metadata-information"]],inputs:{metadata:"metadata"},standalone:!0,features:[t.aNF],decls:5,vars:4,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-8"],["target","_blank",3,"href"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,xi,8,4,"div",1)(2,Ui,9,7,"div",1)(3,$i,9,7,"div",1)(4,Ai,9,5,"div",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.id)),t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.dateCreated)),t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.dateModified)),t.R7$(),t.Y8G("ngIf",!(null==s.metadata||!s.metadata.uri)))},dependencies:[p.bT,x.h,x.D9,p.vh]})}return n})();function Li(n,l){if(1&n&&(t.j41(0,"p",4),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.SpI("",e," ")}}function Ni(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,Li,2,1,"p",5),t.k0s()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.title")),t.R7$(3),t.Y8G("ngForOf",e.journal.titles)}}function Vi(n,l){if(1&n&&(t.j41(0,"p",4),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.SpI("",e," ")}}function Xi(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3),t.DNE(6,Vi,2,1,"p",5),t.k0s()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.issns")),t.R7$(3),t.Y8G("ngForOf",e.journal.issns)}}function Yi(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3)(6,"p",4)(7,"a",6),t.EFF(8),t.k0s()()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,3,"submission.sections.sherpa.publication.information.url")),t.R7$(4),t.FS9("href",e.journal.url,t.B4B),t.R7$(),t.SpI(" ",e.journal.url," ")}}function ki(n,l){if(1&n&&(t.j41(0,"div",3)(1,"p",4)(2,"a",6),t.EFF(3),t.k0s()()()),2&n){const e=l.$implicit;t.R7$(2),t.FS9("href",e.uri,t.B4B),t.R7$(),t.SpI(" ",e.name," ")}}function Ki(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.DNE(5,ki,4,2,"div",7),t.k0s()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.publishers")),t.R7$(2),t.Y8G("ngForOf",e.journal.publishers)}}function Wi(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3)(6,"p",4),t.EFF(7),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.romeoPub")),t.R7$(4),t.SpI(" ",e.journal.romeoPub," ")}}function wi(n,l){if(1&n&&(t.j41(0,"div",2)(1,"div",3)(2,"p",4),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",3)(6,"p",4),t.EFF(7),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.sherpa.publication.information.zetoPub")),t.R7$(4),t.SpI(" ",e.journal.zetoPub," ")}}let Ji=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-publication-information"]],inputs:{journal:"journal"},standalone:!0,features:[t.aNF],decls:7,vars:6,consts:[[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],["class","m-1",4,"ngFor","ngForOf"],["target","_blank","rel","noopener noreferrer",3,"href"],["class","col-4",4,"ngFor","ngForOf"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,Ni,7,4,"div",1)(2,Xi,7,4,"div",1)(3,Yi,9,5,"div",1)(4,Ki,6,4,"div",1)(5,Wi,8,4,"div",1)(6,wi,8,4,"div",1),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.titles)&&s.journal.titles.length>0),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.issns)&&s.journal.issns.length>0),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.url)),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.publishers)&&s.journal.publishers.length>0),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.romeoPub)),t.R7$(),t.Y8G("ngIf",!(null==s.journal||!s.journal.zetoPub)))},dependencies:[p.bT,x.h,x.D9,p.Sq]})}return n})();function Hi(n,l){if(1&n&&(t.j41(0,"span"),t.nrm(1,"i",16),t.EFF(2),t.k0s()),2&n){const e=t.XpG();t.R7$(2),t.Lme(" ",e.version.embargo.amount," ",null==e.version.embargo?null:e.version.embargo.units[0],"")}}function Qi(n,l){1&n&&(t.j41(0,"span"),t.nrm(1,"i",16),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.sections.sherpa.publisher.policy.noembargo"),""))}function zi(n,l){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.SpI("+",e.version.locations.length-1,"")}}function Zi(n,l){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.DNE(2,zi,2,1,"span",17),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.SpI(" ",e.version.locations[0]," "),t.R7$(),t.Y8G("ngIf",e.version.locations.length>1)}}function qi(n,l){1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.sherpa.publisher.policy.nolocation")))}function tn(n,l){1&n&&t.nrm(0,"span",18)}function en(n,l){1&n&&t.nrm(0,"span",19)}function nn(n,l){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=t.XpG(3);t.R7$(),t.Lme("",e.version.embargo.amount," ",e.version.embargo.units,"")}}function sn(n,l){1&n&&(t.j41(0,"p",24),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"submission.sections.sherpa.publisher.policy.noembargo")))}function on(n,l){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",16),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,nn,2,2,"p",26)(8,sn,3,3,"ng-template",null,3,t.C5r),t.k0s()()),2&n){const e=t.sdS(9),i=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,3,"submission.sections.sherpa.publisher.policy.embargo"),""),t.R7$(3),t.Y8G("ngIf",!!i.version.embargo)("ngIfElse",e)}}function an(n,l){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.JRh(e)}}function rn(n,l){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",27),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,an,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.license"),""),t.R7$(3),t.Y8G("ngForOf",e.version.licenses)}}function cn(n,l){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.JRh(e)}}function ln(n,l){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",29),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,cn,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.prerequisites"),""),t.R7$(3),t.Y8G("ngForOf",e.version.prerequisites)}}function dn(n,l){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.JRh(e)}}function mn(n,l){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",10),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,dn,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.location"),""),t.R7$(3),t.Y8G("ngForOf",e.version.locations)}}function un(n,l){if(1&n&&(t.j41(0,"p",24),t.EFF(1),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.JRh(e)}}function pn(n,l){if(1&n&&(t.j41(0,"div",22)(1,"div",23)(2,"p",24),t.nrm(3,"i",30),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",25),t.DNE(7,un,2,1,"p",28),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(4),t.SpI(" ",t.bMT(5,2,"submission.sections.sherpa.publisher.policy.conditions"),""),t.R7$(3),t.Y8G("ngForOf",e.version.conditions)}}function _n(n,l){if(1&n&&(t.j41(0,"div",20),t.DNE(1,on,10,5,"div",21)(2,rn,8,4,"div",21)(3,ln,8,4,"div",21)(4,mn,8,4,"div",21)(5,pn,8,4,"div",21),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.embargo||null==e.version||!e.version.embargo.amount)),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.licenses)&&e.version.licenses.length>0),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.prerequisites)&&e.version.prerequisites.length>0),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.locations)&&e.version.locations.length>0),t.R7$(),t.Y8G("ngIf",!(null==e.version||!e.version.conditions)&&e.version.conditions.length>0)}}let hn=(()=>{class n{constructor(){this.isCollapsed=!0}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-content-accordion"]],inputs:{version:"version"},standalone:!0,features:[t.aNF],decls:22,vars:15,consts:[["noEmbargoTitle",""],["noLocations",""],["collapse","ngbCollapse"],["noEmbargo",""],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle",3,"click"],[1,"d-flex"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0","mr-4",3,"click"],[4,"ngIf","ngIfElse"],[1,"m-1","ml-4"],[1,"far","fa-folder-open"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],["class","ml-4",4,"ngIf"],[1,"fas","fa-hourglass-half"],[4,"ngIf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[1,"ml-4"],["class","row",4,"ngIf"],[1,"row"],[1,"col-4"],[1,"m-1"],[1,"col-6"],["class","m-1",4,"ngIf","ngIfElse"],[1,"fas","fa-certificate"],["class","m-1",4,"ngFor","ngForOf"],[1,"fas","fa-exclamation-circle"],[1,"fas","fa-tasks"]],template:function(i,s){if(1&i){const r=t.RV6();t.j41(0,"div",4)(1,"div",5),t.bIt("click",function(){t.eBV(r);const f=t.sdS(20);return t.Njj(f.toggle())}),t.j41(2,"div",6)(3,"button",7),t.bIt("click",function(f){return t.eBV(r),t.Njj(f.preventDefault())}),t.EFF(4),t.nI1(5,"titlecase"),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div"),t.DNE(8,Hi,3,2,"span",8)(9,Qi,4,3,"ng-template",null,0,t.C5r),t.j41(11,"span",9),t.nrm(12,"i",10),t.DNE(13,Zi,3,2,"span",8)(14,qi,3,3,"ng-template",null,1,t.C5r),t.k0s()()(),t.j41(16,"div",11),t.DNE(17,tn,1,0,"span",12)(18,en,1,0,"span",13),t.k0s()(),t.j41(19,"div",14,2),t.DNE(21,_n,6,5,"div",15),t.k0s()()}if(2&i){const r=t.sdS(10),_=t.sdS(15),f=t.sdS(20);t.R7$(3),t.BMQ("aria-expanded",!f.collapsed),t.R7$(),t.Lme(" ",t.bMT(5,11,s.version.articleVersion)," ",t.bMT(6,13,"submission.sections.sherpa.publisher.policy.version")," "),t.R7$(4),t.Y8G("ngIf",!(null==s.version||!s.version.embargo||null==s.version||!s.version.embargo.amount))("ngIfElse",r),t.R7$(5),t.Y8G("ngIf",!(null==s.version||!s.version.locations)&&s.version.locations.length>0)("ngIfElse",_),t.R7$(4),t.Y8G("ngIf",f.collapsed),t.R7$(),t.Y8G("ngIf",!f.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("ngIf",!!s.version)}},dependencies:[p.Sq,x.h,x.D9,p.bT,T.HC,T.$G,p.PV]})}return n})();function fn(n,l){1&n&&t.nrm(0,"ds-content-accordion",3),2&n&&t.Y8G("version",l.$implicit)}function bn(n,l){if(1&n&&(t.j41(0,"li")(1,"a",8),t.EFF(2),t.k0s()()),2&n){const e=l.$implicit;t.R7$(),t.FS9("href",e.key,t.B4B),t.R7$(),t.JRh(e.value)}}function gn(n,l){if(1&n&&(t.j41(0,"div",4)(1,"div",5)(2,"p",6),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"ul"),t.DNE(6,bn,3,2,"li",7),t.nI1(7,"keyvalue"),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.SpI(" ",t.bMT(4,2,"submission.sections.sherpa.publisher.policy.more.information")," "),t.R7$(3),t.Y8G("ngForOf",t.bMT(7,4,e.policy.urls))}}let vn=(()=>{class n{constructor(){this.AlertTypeEnum=N.v}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-publisher-policy"]],inputs:{policy:"policy"},standalone:!0,features:[t.aNF],decls:3,vars:2,consts:[[1,"ml-4"],[3,"version",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],[3,"version"],[1,"row"],[1,"col-12"],[1,"m-1"],[4,"ngFor","ngForOf"],["target","_blank","rel","noopener noreferrer",3,"href"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,fn,1,1,"ds-content-accordion",1)(2,gn,8,6,"div",2),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngForOf",s.policy.permittedVersions),t.R7$(),t.Y8G("ngIf",!(null==s.policy||!s.policy.urls)))},dependencies:[hn,x.h,x.D9,p.lG,p.Sq,p.bT]})}return n})();function Sn(n,l){1&n&&t.nrm(0,"ds-alert",4),2&n&&t.Y8G("type","alert-info")("content","submission.sections.sherpa-policy.title-empty")}function In(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",5)(1,"ds-alert",6),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div")(5,"button",7),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.refresh())}),t.j41(6,"span"),t.nrm(7,"i",8),t.EFF(8),t.nI1(9,"translate"),t.k0s()()()()}2&n&&(t.R7$(),t.Y8G("type","alert-info"),t.R7$(),t.SpI(" ",t.bMT(3,3,"submission.sections.sherpa.publisher.policy.description")," "),t.R7$(6),t.SpI(" ",t.bMT(9,5,"submission.sections.sherpa.publisher.policy.refresh")," "))}function Cn(n,l){1&n&&t.nrm(0,"span",21)}function En(n,l){1&n&&t.nrm(0,"span",22)}function Dn(n,l){1&n&&t.nrm(0,"span",21)}function Tn(n,l){1&n&&t.nrm(0,"span",22)}function Mn(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",11)(1,"div",12),t.bIt("click",function(){t.eBV(e);const s=t.sdS(9);return t.Njj(s.toggle())}),t.j41(2,"button",13),t.bIt("click",function(s){return t.eBV(e),t.Njj(s.preventDefault())}),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",14),t.DNE(6,Dn,1,0,"span",15)(7,Tn,1,0,"span",16),t.k0s()(),t.j41(8,"div",17,0),t.nrm(10,"ds-publisher-policy",23),t.k0s()()}if(2&n){const e=l.$implicit,i=t.sdS(9),s=t.XpG(4);t.R7$(2),t.BMQ("aria-expanded",!i.collapsed),t.R7$(),t.SpI(" ",t.bMT(4,6,"submission.sections.sherpa.publisher.policy")," "),t.R7$(3),t.Y8G("ngIf",i.collapsed),t.R7$(),t.Y8G("ngIf",!i.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("policy",e)}}function yn(n,l){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",11)(2,"div",12),t.bIt("click",function(){t.eBV(e);const s=t.sdS(10);return t.Njj(s.toggle())}),t.j41(3,"button",13),t.bIt("click",function(s){return t.eBV(e),t.Njj(s.preventDefault())}),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",14),t.DNE(7,Cn,1,0,"span",15)(8,En,1,0,"span",16),t.k0s()(),t.j41(9,"div",17,0),t.nrm(11,"ds-publication-information",19),t.k0s()(),t.DNE(12,Mn,11,8,"div",20),t.bVm()}if(2&n){const e=l.$implicit,i=t.sdS(10),s=t.XpG(3);t.R7$(3),t.BMQ("aria-expanded",!i.collapsed),t.R7$(),t.SpI(" ",t.bMT(5,7,"submission.sections.sherpa.publication.information")," "),t.R7$(3),t.Y8G("ngIf",i.collapsed),t.R7$(),t.Y8G("ngIf",!i.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("journal",e),t.R7$(),t.Y8G("ngForOf",e.policies)}}function Fn(n,l){1&n&&t.nrm(0,"span",21)}function On(n,l){1&n&&t.nrm(0,"span",22)}function Rn(n,l){if(1&n){const e=t.RV6();t.qex(0),t.DNE(1,yn,13,9,"ng-container",10),t.j41(2,"div",11)(3,"div",12),t.bIt("click",function(){t.eBV(e);const s=t.sdS(11);return t.Njj(s.toggle())}),t.j41(4,"button",13),t.bIt("click",function(s){return t.eBV(e),t.Njj(s.preventDefault())}),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div",14),t.DNE(8,Fn,1,0,"span",15)(9,On,1,0,"span",16),t.k0s()(),t.j41(10,"div",17,0),t.nrm(12,"ds-metadata-information",18),t.k0s()(),t.bVm()}if(2&n){const e=t.sdS(11),i=t.XpG().ngVar,s=t.XpG();t.R7$(),t.Y8G("ngForOf",i.journals),t.R7$(3),t.BMQ("aria-expanded",!e.collapsed),t.R7$(),t.SpI(" ",t.bMT(6,7,"submission.sections.sherpa.record.information")," "),t.R7$(3),t.Y8G("ngIf",e.collapsed),t.R7$(),t.Y8G("ngIf",!e.collapsed),t.R7$(),t.Y8G("ngbCollapse",s.isCollapsed),t.R7$(2),t.Y8G("metadata",i.metadata)}}function Pn(n,l){if(1&n&&(t.qex(0),t.nrm(1,"ds-alert",4),t.nI1(2,"translate"),t.bVm()),2&n){const e=t.XpG().ngVar,i=t.XpG();t.R7$(),t.Y8G("type",i.AlertTypeEnum.Error)("content",e.message?e.message:t.bMT(2,2,"submission.sections.sherpa.error.message"))}}function jn(n,l){if(1&n&&(t.qex(0),t.DNE(1,Rn,13,9,"ng-container",9)(2,Pn,3,4,"ng-container",9),t.bVm()),2&n){const e=l.ngVar,i=t.XpG();t.R7$(),t.Y8G("ngIf",!i.hasNoData()&&!!e&&!e.error),t.R7$(),t.Y8G("ngIf",!!e&&e.error)}}let Bn=(()=>{class n extends mt{constructor(e,i,s,r,_){super(void 0,r,_),this.sectionService=e,this.operationsBuilder=i,this.submissionService=s,this.injectedSectionData=r,this.injectedSubmissionId=_,this.sherpaPoliciesData$=new Qt.t(null),this.subs=[],this.isCollapsed=!1,this.AlertTypeEnum=N.v}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onSectionInit(){this.pathCombiner=new ot.S("sections",this.sectionData.id),this.subs.push(this.sectionService.getSectionData(this.submissionId,this.sectionData.id,this.sectionData.sectionType).subscribe(e=>{this.sherpaPoliciesData$.next(e)}))}getSectionStatus(){return(0,S.of)(!0)}hasNoData(){return(0,c.Im)(this.sherpaPoliciesData$.value)}refresh(){this.operationsBuilder.remove(this.pathCombiner.getPath("retrievalTime")),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionData.id)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(X.c),t.rXU(nt.C),t.rXU(j.E),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-section-sherpa-policies"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:5,consts:[["collapse","ngbCollapse"],[3,"type","content",4,"ngIf"],["class","d-flex flex-column flex-nowrap mt-2 mb-4",4,"ngIf"],[4,"ngVar"],[3,"type","content"],[1,"d-flex","flex-column","flex-nowrap","mt-2","mb-4"],[3,"type"],["type","button","data-test","refresh-btn",1,"btn","btn-secondary","float-right",3,"click"],[1,"fas","fa-sync"],[4,"ngIf"],[4,"ngFor","ngForOf"],["data-test","collapse",1,"mb-3","border-bottom"],[1,"w-100","d-flex","justify-content-between","collapse-toggle","mb-3",3,"click"],["type","button","aria-controls","collapseExample",1,"btn","btn-link","p-0",3,"click"],[1,"d-inline-block"],["class","fas fa-chevron-down",4,"ngIf"],["class","fas fa-chevron-up",4,"ngIf"],[3,"ngbCollapse"],[3,"metadata"],[3,"journal"],["class","mb-3 border-bottom","data-test","collapse",4,"ngFor","ngForOf"],[1,"fas","fa-chevron-down"],[1,"fas","fa-chevron-up"],[3,"policy"]],template:function(i,s){if(1&i&&(t.DNE(0,Sn,1,2,"ds-alert",1)(1,In,10,7,"div",2)(2,jn,3,2,"ng-container",3),t.nI1(3,"async")),2&i){let r;t.Y8G("ngIf",s.hasNoData()),t.R7$(),t.Y8G("ngIf",!s.hasNoData()),t.R7$(),t.Y8G("ngVar",null==(r=t.bMT(3,3,s.sherpaPoliciesData$))?null:r.sherpaResponse)}},dependencies:[Gi,T.HC,T.$G,I.C,x.h,x.D9,vn,p.bT,Ji,p.Jj,jt.r,p.Sq]})}return n})();var ee=o(83116),xn=o(38799),Un=o(7172),$n=o(79003),An=o(30664),ie=(o(451),o(21124));o(68991);const Gn=["*"];function Ln(n,l){}let Nn=(()=>{class n extends ie.J{constructor(){super(...arguments),this.inAndOutputNames=["availableAccessConditionOptions","isPrimary","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"]}getComponentName(){return"SubmissionSectionUploadFileComponent"}importThemedComponent(e){return o(96682)(`./${e}/app/submission/sections/upload/file/section-upload-file.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,68991))}static#t=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}})();static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-upload-section-file"]],inputs:{availableAccessConditionOptions:"availableAccessConditionOptions",isPrimary:"isPrimary",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:Gn,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(i,s){1&i&&(t.NAR(),t.DNE(0,Ln,0,0,"ng-template",null,0,t.C5r),t.j41(2,"div",null,1),t.SdG(4),t.k0s())},encapsulation:2})}return n})();var Vn=o(47346);const ne=n=>({collectionName:n});function Xn(n,l){if(1&n&&(t.qex(0),t.EFF(1),t.nI1(2,"translate"),t.bVm()),2&n){const e=t.XpG(3);t.R7$(),t.SpI(" ",t.i5U(2,1,"submission.sections.upload.header.policy.default.nolist",t.eq3(4,ne,e.collectionName))," ")}}function Yn(n,l){if(1&n&&(t.qex(0),t.EFF(1),t.nI1(2,"translate"),t.bVm()),2&n){const e=t.XpG(3);t.R7$(),t.SpI(" ",t.i5U(2,1,"submission.sections.upload.header.policy.default.withlist",t.eq3(4,ne,e.collectionName))," ")}}function kn(n,l){if(1&n&&(t.j41(0,"div",4)(1,"div",9)(2,"ds-alert",10),t.DNE(3,Xn,3,6,"ng-container",11)(4,Yn,3,6,"ng-container",11),t.nrm(5,"span",12)(6,"ds-submission-section-upload-access-conditions",13),t.k0s()()()),2&n){const e=t.XpG(2);t.R7$(2),t.Y8G("type",e.AlertTypeEnum.Warning),t.R7$(),t.Y8G("ngIf",1===e.collectionPolicyType),t.R7$(),t.Y8G("ngIf",2===e.collectionPolicyType),t.R7$(2),t.Y8G("accessConditions",e.collectionDefaultAccessConditions)}}function Kn(n,l){if(1&n&&(t.qex(0),t.nrm(1,"ds-submission-upload-section-file",14),t.nI1(2,"async"),t.j41(3,"div",4)(4,"div",7),t.nrm(5,"hr"),t.k0s()(),t.bVm()),2&n){const e=l.$implicit,i=l.index,s=t.XpG(2);t.R7$(),t.Y8G("isPrimary",s.primaryBitstreamUUID?s.primaryBitstreamUUID===e.uuid:null)("availableAccessConditionOptions",s.availableAccessConditionOptions)("collectionId",s.collectionId)("collectionPolicyType",s.collectionPolicyType)("configMetadataForm",t.bMT(2,10,s.configMetadataForm$))("fileId",e.uuid)("fileIndex",i)("fileName",s.fileNames[i])("sectionId",s.sectionData.id)("submissionId",s.submissionId)}}function Wn(n,l){if(1&n&&(t.qex(0),t.DNE(1,kn,7,4,"div",3),t.j41(2,"div",4)(3,"div",5)(4,"span",6),t.EFF(5),t.nI1(6,"translate"),t.k0s()()(),t.j41(7,"div",4)(8,"div",7),t.nrm(9,"hr"),t.k0s()(),t.DNE(10,Kn,6,12,"ng-container",8),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",e.collectionDefaultAccessConditions.length>0),t.R7$(4),t.JRh(t.bMT(6,3,"bitstream.edit.form.primaryBitstream.label")),t.R7$(5),t.Y8G("ngForOf",e.fileList)}}function wn(n,l){1&n&&(t.j41(0,"div",4)(1,"div",7)(2,"h3",15)(3,"span",16),t.EFF(4),t.nI1(5,"translate"),t.k0s()()()()),2&n&&(t.R7$(4),t.JRh(t.bMT(5,1,"submission.sections.upload.no-file-uploaded")))}let Qn=(()=>{class n extends mt{constructor(e,i,s,r,_,f,R,V,tt,lt,dt){super(void 0,lt,dt),this.bitstreamService=e,this.changeDetectorRef=i,this.collectionDataService=s,this.groupService=r,this.resourcePolicyService=_,this.sectionService=f,this.submissionService=R,this.uploadsConfigService=V,this.dsoNameService=tt,this.injectedSectionData=lt,this.injectedSubmissionId=dt,this.AlertTypeEnum=N.v,this.primaryBitstreamUUID=null,this.fileList=[],this.fileNames=[],this.collectionDefaultAccessConditions=[],this.required$=new Qt.t(!0),this.subs=[]}onSectionInit(){const e=this.uploadsConfigService.findByHref(this.sectionData.config,!0,!1,(0,Jt.s)("metadata")).pipe((0,et.yd)(),(0,u.T)(i=>i.payload));this.configMetadataForm$=e.pipe((0,P.n)(i=>i.metadata.pipe((0,et.yd)(),(0,u.T)(s=>s.payload)))),this.subs.push(this.submissionService.getSubmissionObject(this.submissionId).pipe((0,d.p)(i=>(0,c.EA)(i)&&!i.isLoading),(0,d.p)(i=>(0,c.b0)(this.collectionId)||this.collectionId!==i.collection),(0,yt.M)(i=>this.collectionId=i.collection),(0,Z.Z)(i=>this.collectionDataService.findById(i.collection)),(0,d.p)(i=>(0,c.EA)(i.payload)),(0,yt.M)(i=>this.collectionName=this.dsoNameService.getName(i.payload)),(0,Z.Z)(()=>e)).subscribe(i=>{this.required$.next(i.required),this.availableAccessConditionOptions=(0,c.hj)(i.accessConditionOptions)?i.accessConditionOptions:[],this.collectionPolicyType=this.availableAccessConditionOptions.length>0?2:1,this.changeDetectorRef.detectChanges()}),(0,Q.z)([this.configMetadataForm$,this.bitstreamService.getUploadedFilesData(this.submissionId,this.sectionData.id)]).pipe((0,d.p)(([i,s])=>(0,c.hj)(i)&&(0,c.hj)(s)),(0,C.F)()).subscribe(([i,{primary:s,files:r}])=>{this.primaryBitstreamUUID=s,this.fileList=r,this.fileNames=Array.from(r,_=>this.getFileName(i,_)),this.changeDetectorRef.detectChanges()}))}getFileName(e,i){const s=e.rows[0].fields[0].selectableMetadata[0].metadata;let r;return r=(0,c.hj)(i.metadata)&&(0,c.hj)(i.metadata[s])?i.metadata[s][0].display:i.uuid,r}getSectionStatus(){return(0,Q.z)(this.required$,this.bitstreamService.getUploadedFileList(this.submissionId,this.sectionData.id),(e,i)=>!e||(0,c.EA)(i)&&i.length>0)}onSectionDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(Vn.i),t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU(Un.GroupDataService),t.rXU($n.ResourcePolicyDataService),t.rXU(X.c),t.rXU(j.E),t.rXU(xn.SubmissionUploadsConfigDataService),t.rXU(ee.f),t.rXU("sectionDataProvider"),t.rXU("submissionIdProvider"))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-upload"]],standalone:!0,features:[t.Vt3,t.aNF],decls:4,vars:5,consts:[["noFileUploaded",""],[3,"content","dismissible","type"],[4,"ngIf","ngIfElse"],["class","row",4,"ngIf"],[1,"row"],[1,"col-md-2"],[1,"text-left","font-weight-bold"],[1,"col-md-12"],[4,"ngFor","ngForOf"],[1,"col-sm-12"],[3,"type"],[4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[3,"isPrimary","availableAccessConditionOptions","collectionId","collectionPolicyType","configMetadataForm","fileId","fileIndex","fileName","sectionId","submissionId"],[1,"text-center"],[1,"text-muted"]],template:function(i,s){if(1&i&&(t.nrm(0,"ds-alert",1),t.DNE(1,Wn,11,5,"ng-container",2)(2,wn,6,3,"ng-template",null,0,t.C5r)),2&i){const r=t.sdS(3);t.Y8G("content","submission.sections.upload.info")("dismissible",!0)("type",s.AlertTypeEnum.Info),t.R7$(),t.Y8G("ngIf",s.fileList.length>0)("ngIfElse",r)}},dependencies:[Nn,An._,p.bT,I.C,x.h,x.D9,p.Sq,p.Jj]})}return n})();const _t=new Map;_t.set(k.l.AccessesCondition,Xt),_t.set(k.l.License,li),_t.set(k.l.CcLicense,ye),_t.set(k.l.SherpaPolicies,Bn),_t.set(k.l.Upload,Qn),_t.set(k.l.SubmissionForm,Ze),_t.set(k.l.Identifiers,si),_t.set(k.l.CoarNotify,Bi),_t.set(k.l.Duplicates,Ge);const Zn=["sectionRef"],qn=n=>({"section-focus":n}),se=n=>({"text-white":n}),ts=n=>({sectionHeader:n});function es(n,l){1&n&&(t.nrm(0,"i",18),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.warnings.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.warnings.aria")))}function is(n,l){1&n&&(t.nrm(0,"i",19),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.errors.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.errors.aria")))}function ns(n,l){1&n&&(t.nrm(0,"i",20),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.valid.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.valid.aria")))}function ss(n,l){1&n&&(t.nrm(0,"i",21),t.nI1(1,"translate"),t.nI1(2,"translate")),2&n&&(t.FS9("title",t.bMT(1,2,"submission.sections.status.info.title")),t.BMQ("aria-label",t.bMT(2,4,"submission.sections.status.info.aria")))}function os(n,l){if(1&n&&t.nrm(0,"span",22),2&n){t.XpG(3);const e=t.sdS(1);t.Y8G("ngClass",t.eq3(1,se,e.isInfo()))}}function as(n,l){1&n&&t.nrm(0,"span",23)}function rs(n,l){if(1&n){const e=t.RV6();t.j41(0,"a",24),t.bIt("click",function(s){t.eBV(e);const r=t.XpG(3);return t.Njj(r.removeSection(s))}),t.nrm(1,"i",25),t.k0s()}}function cs(n,l){if(1&n&&(t.j41(0,"span",8),t.EFF(1),t.nI1(2,"translate"),t.k0s(),t.j41(3,"div",9),t.DNE(4,es,3,6,"i",10),t.nI1(5,"async"),t.DNE(6,is,3,6,"i",11)(7,ns,3,6,"i",12),t.nI1(8,"async"),t.DNE(9,ss,3,6,"i",13),t.j41(10,"a",14),t.nI1(11,"translate"),t.nI1(12,"translate"),t.nI1(13,"translate"),t.DNE(14,os,1,3,"span",15)(15,as,1,0,"span",16),t.k0s(),t.DNE(16,rs,2,0,"a",17),t.k0s()),2&n){const e=t.XpG(2),i=t.sdS(1);t.Y8G("ngClass",t.eq3(24,se,i.isInfo())),t.R7$(),t.JRh(t.bMT(2,11,"submission.sections."+e.sectionData.header)),t.R7$(3),t.Y8G("ngIf",!0!==t.bMT(5,13,i.isValid())&&!i.hasErrors()&&!i.isInfo()),t.R7$(2),t.Y8G("ngIf",i.hasErrors()&&!i.isInfo()),t.R7$(),t.Y8G("ngIf",t.bMT(8,15,i.isValid())&&!i.hasErrors()&&!i.isInfo()),t.R7$(2),t.Y8G("ngIf",i.isInfo()),t.R7$(),t.Y8G("title",t.bMT(11,17,i.isOpen()?"submission.sections.toggle.close":"submission.sections.toggle.open")),t.BMQ("aria-label",t.i5U(13,21,i.isOpen()?"submission.sections.toggle.aria.close":"submission.sections.toggle.aria.open",t.eq3(26,ts,t.bMT(12,19,"submission.sections."+e.sectionData.header)))),t.R7$(4),t.Y8G("ngIf",i.isOpen()),t.R7$(),t.Y8G("ngIf",!i.isOpen()),t.R7$(),t.Y8G("ngIf",!i.isMandatory())}}function ls(n,l){if(1&n){const e=t.RV6();t.j41(0,"ds-alert",31),t.bIt("close",function(){const s=t.eBV(e).index;t.XpG(4);const r=t.sdS(1);return t.Njj(r.removeError(s))}),t.k0s()}if(2&n){const e=l.$implicit,i=t.XpG(4);t.Y8G("content",e)("dismissible",!0)("type",i.AlertTypeEnum.Error)}}function ds(n,l){if(1&n&&(t.j41(0,"div",29),t.DNE(1,ls,1,3,"ds-alert",30),t.k0s()),2&n){const e=t.XpG(3),i=t.sdS(1);t.Mz_("id","sectionGenericError_",e.sectionData.id,""),t.R7$(),t.Y8G("ngForOf",i.getErrors())}}function ms(n,l){1&n&&t.eu8(0)}function us(n,l){if(1&n){const e=t.RV6();t.DNE(0,ds,2,3,"div",26),t.j41(1,"div",27),t.bIt("click",function(s){t.eBV(e),t.XpG(2);const r=t.sdS(1);return t.Njj(r.setFocus(s))}),t.DNE(2,ms,1,0,"ng-container",28),t.k0s()}if(2&n){const e=t.XpG(2),i=t.sdS(1);t.Y8G("ngIf",i.hasGenericErrors()),t.R7$(),t.Mz_("id","sectionContent_",e.sectionData.id,""),t.R7$(),t.Y8G("ngComponentOutlet",e.getSectionContent())("ngComponentOutletInjector",e.objectInjector)}}function ps(n,l){if(1&n){const e=t.RV6();t.j41(0,"ngb-accordion",4,1),t.bIt("panelChange",function(s){t.eBV(e),t.XpG();const r=t.sdS(1);return t.Njj(r.sectionChange(s))}),t.j41(2,"ngb-panel",5),t.DNE(3,cs,17,28,"ng-template",6)(4,us,3,5,"ng-template",7),t.k0s()()}if(2&n){const e=t.XpG(),i=t.sdS(1);t.FS9("activeIds",e.sectionData.id),t.Y8G("destroyOnHide",!1),t.R7$(2),t.FS9("id",e.sectionData.id),t.Y8G("type",i.isInfo()?"info":"")}}let _s=(()=>{class n{constructor(e){this.injector=e,this.AlertTypeEnum=N.v}ngOnInit(){this.objectInjector=t.zZn.create({providers:[{provide:"collectionIdProvider",useFactory:()=>this.collectionId,deps:[]},{provide:"sectionDataProvider",useFactory:()=>this.sectionData,deps:[]},{provide:"submissionIdProvider",useFactory:()=>this.submissionId,deps:[]}],parent:this.injector})}removeSection(e){e.preventDefault(),e.stopPropagation(),this.sectionRef.removeSection(this.submissionId,this.sectionData.id)}getSectionContent(){return function zn(n){return _t.get(n)}(this.sectionData.sectionType)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.zZn))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-section-container"]],viewQuery:function(i,s){if(1&i&&t.GBs(Zn,5),2&i){let r;t.mGM(r=t.lsd())&&(s.sectionRef=r.first)}},inputs:{collectionId:"collectionId",sectionData:"sectionData",submissionId:"submissionId"},standalone:!0,features:[t.aNF],decls:4,vars:11,consts:[["sectionRef","sectionRef"],["acc","ngbAccordion"],["dsSection","",3,"ngClass","mandatory","submissionId","sectionType","sectionId"],[3,"activeIds","destroyOnHide","panelChange",4,"ngIf"],[3,"panelChange","activeIds","destroyOnHide"],[3,"id","type"],["ngbPanelTitle",""],["ngbPanelContent",""],["tabindex","0",1,"float-left","section-title",3,"ngClass"],[1,"d-inline-block","float-right"],["class","fas fa-exclamation-circle text-warning mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-exclamation-circle text-danger mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-check-circle text-success mr-3","role","img",3,"title",4,"ngIf"],["class","fas fa-info-circle mr-3 text-white","role","img",3,"title",4,"ngIf"],["tabindex","0","role","button",1,"close",3,"title"],["class","fas fa-chevron-up fa-fw",3,"ngClass",4,"ngIf"],["class","fas fa-chevron-down fa-fw",4,"ngIf"],["href","javascript:void(0);","class","close mr-3",3,"click",4,"ngIf"],["role","img",1,"fas","fa-exclamation-circle","text-warning","mr-3",3,"title"],["role","img",1,"fas","fa-exclamation-circle","text-danger","mr-3",3,"title"],["role","img",1,"fas","fa-check-circle","text-success","mr-3",3,"title"],["role","img",1,"fas","fa-info-circle","mr-3","text-white",3,"title"],[1,"fas","fa-chevron-up","fa-fw",3,"ngClass"],[1,"fas","fa-chevron-down","fa-fw"],["href","javascript:void(0);",1,"close","mr-3",3,"click"],["aria-hidden","true","tabindex","0",1,"fas","fa-trash-o"],[3,"id",4,"ngIf"],[3,"click","id"],[4,"ngComponentOutlet","ngComponentOutletInjector"],[3,"id"],[3,"content","dismissible","type","close",4,"ngFor","ngForOf"],[3,"close","content","dismissible","type"]],template:function(i,s){if(1&i&&(t.j41(0,"div",2,0),t.DNE(2,ps,5,4,"ngb-accordion",3),t.nI1(3,"async"),t.k0s()),2&i){const r=t.sdS(1);t.Y8G("ngClass",t.eq3(9,qn,r.isSectionActive()))("mandatory",s.sectionData.mandatory)("submissionId",s.submissionId)("sectionType",s.sectionData.sectionType)("sectionId",s.sectionData.id),t.BMQ("id","section_"+s.sectionData.id),t.R7$(2),t.Y8G("ngIf",t.bMT(3,7,r.isEnabled()))}},dependencies:[I.C,p.Sq,T._f,T.W1,T.CT,T.sb,T.t3,p.OI,x.h,x.D9,p.YU,p.bT,p.Jj,J],styles:["[_nghost-%COMP%]     .card{margin-bottom:var(--ds-submission-sections-margin-bottom);overflow:unset}.section-focus[_ngcontent-%COMP%]{border-radius:var(--bs-border-radius);box-shadow:var(--bs-btn-focus-box-shadow)}[_nghost-%COMP%]     .card:first-of-type{border-bottom:var(--bs-card-border-width) solid var(--bs-card-border-color)!important;border-bottom-left-radius:var(--bs-card-border-radius)!important;border-bottom-right-radius:var(--bs-card-border-radius)!important}[_nghost-%COMP%]     .card-header button{box-shadow:none!important;width:100%}"]})}return n})();var Bt=o(87349),hs=o(63186),fs=o(63200);function bs(n,l){if(1&n&&(t.j41(0,"div",3)(1,"div",4)(2,"span",5),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",6)(6,"span",5),t.EFF(7),t.nI1(8,"async"),t.k0s()()()),2&n){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,2,"submission.sections.general.collection")),t.R7$(4),t.JRh(t.bMT(8,4,e.selectedCollectionName$))}}function gs(n,l){1&n&&(t.j41(0,"span"),t.nrm(1,"i",13),t.k0s())}function vs(n,l){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.JRh(t.bMT(2,1,e.selectedCollectionName$))}}function Ss(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",7,0),t.bIt("openChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.toggled(s))}),t.j41(2,"div",4)(3,"span",8),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"button",9),t.nI1(7,"async"),t.bIt("blur",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.onClose())})("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.onClose())}),t.DNE(8,gs,2,0,"span",10),t.nI1(9,"async"),t.DNE(10,vs,3,3,"span",10),t.nI1(11,"async"),t.k0s(),t.j41(12,"div",11)(13,"ds-collection-dropdown",12),t.bIt("selectionChange",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onSelect(s))}),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(4),t.SpI(" ",t.bMT(5,4,"submission.sections.general.collection")," "),t.R7$(2),t.Y8G("disabled",t.bMT(7,6,e.processingChange$)||!1===e.collectionModifiable||e.isReadonly),t.R7$(2),t.Y8G("ngIf",t.bMT(9,8,e.processingChange$)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(11,10,e.processingChange$))}}let Is=(()=>{class n{constructor(e,i,s,r,_,f,R){this.cdr=e,this.collectionDataService=i,this.operationsBuilder=s,this.operationsService=r,this.submissionService=_,this.sectionsService=f,this.dsoNameService=R,this.collectionModifiable=null,this.isReadonly=!1,this.collectionChange=new t.bkB,this.processingChange$=new Qt.t(!1),this.subs=[]}ngOnChanges(e){(0,c.a4)(e.currentCollectionId)&&(0,c.a4)(e.currentCollectionId.currentValue)&&(this.selectedCollectionId=this.currentCollectionId,this.selectedCollectionName$=this.collectionDataService.findById(this.currentCollectionId).pipe((0,Wt.I)(i=>(0,c.hj)(i.payload)),(0,u.T)(i=>this.dsoNameService.getName(i.payload))))}ngOnInit(){this.pathCombiner=new ot.S("sections","collection"),this.available$=this.sectionsService.isSectionTypeAvailable(this.submissionId,k.l.Collection)}ngOnDestroy(){this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onSelect(e){this.processingChange$.next(!0),this.operationsBuilder.replace(this.pathCombiner.getPath(),e.collection.id,!0),this.subs.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections","collection").pipe((0,Z.Z)(i=>this.submissionService.retrieveSubmission(i[0].id).pipe((0,et.ak)()))).subscribe(i=>{this.selectedCollectionId=e.collection.id,this.selectedCollectionName$=(0,S.of)(e.collection.name),this.collectionChange.emit(i),this.submissionService.changeSubmissionCollection(this.submissionId,e.collection.id),this.processingChange$.next(!1),this.cdr.detectChanges()}))}onClose(){this.collectionDropdown?.reset()}toggled(e){e||this.collectionDropdown?.reset()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.gRc),t.rXU(Ht.CollectionDataService),t.rXU(nt.C),t.rXU(gt.U),t.rXU(j.E),t.rXU(X.c),t.rXU(ee.f))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form-collection"]],viewQuery:function(i,s){if(1&i&&t.GBs(hs.CollectionDropdownComponent,5),2&i){let r;t.mGM(r=t.lsd())&&(s.collectionDropdown=r.first)}},inputs:{currentCollectionId:"currentCollectionId",currentDefinition:"currentDefinition",collectionModifiable:"collectionModifiable",submissionId:"submissionId",isReadonly:"isReadonly"},outputs:{collectionChange:"collectionChange"},standalone:!0,features:[t.OA$,t.aNF],decls:5,vars:6,consts:[["collectionControls","ngbDropdown"],["class","input-group mb-3",4,"ngIf"],["ngbDropdown","","class","btn-group input-group",3,"openChange",4,"ngIf"],[1,"input-group","mb-3"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"input-group-append"],["ngbDropdown","",1,"btn-group","input-group",3,"openChange"],["id","collectionControlsMenuLabel",1,"input-group-text"],["aria-describedby","collectionControlsMenuLabel","id","collectionControlsMenuButton","ngbDropdownToggle","",1,"btn","btn-outline-primary",3,"blur","click","disabled"],[4,"ngIf"],["ngbDropdownMenu","","id","collectionControlsDropdownMenu","aria-labelledby","collectionControlsMenuButton",1,"dropdown-menu","p-0"],[3,"selectionChange"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(i,s){1&i&&(t.j41(0,"div"),t.DNE(1,bs,9,6,"div",1),t.nI1(2,"async"),t.DNE(3,Ss,14,12,"div",2),t.nI1(4,"async"),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!0!==t.bMT(2,2,s.available$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,4,s.available$)))},dependencies:[p.MD,p.bT,p.Jj,x.h,x.D9,T.zH,T.tg,T.do,T.U0,fs.m],styles:[".scrollable-menu[_ngcontent-%COMP%]{height:auto;max-height:var(--ds-dropdown-menu-max-height);overflow-x:hidden}.collection-item[_ngcontent-%COMP%]{border-bottom:var(--bs-dropdown-border-width) solid var(--bs-dropdown-border-color)}#collectionControlsDropdownMenu[_ngcontent-%COMP%]{outline:0;left:0!important;box-shadow:var(--bs-btn-focus-box-shadow)}"]})}return n})();var Cs=o(32875),Es=o(75911);function Ds(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",13),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG(2),_=t.sdS(2);return s.preventDefault(),t.Njj(r.confirmDiscard(_))}),t.nrm(4,"i",14),t.EFF(5),t.nI1(6,"translate"),t.k0s()}if(2&n){const e=t.XpG(2);t.Y8G("disabled",t.bMT(1,3,e.processingSaveStatus)||t.bMT(2,5,e.processingDepositStatus)),t.BMQ("data-test",t.bMT(3,7,"discard")),t.R7$(5),t.SpI(" ",t.bMT(6,9,"submission.general.discard.submit")," ")}}function Ts(n,l){1&n&&(t.j41(0,"span"),t.nrm(1,"i",15),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.general.info.saved")," "))}function Ms(n,l){1&n&&(t.j41(0,"span"),t.nrm(1,"i",16),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.general.info.pending-changes")," "))}function ys(n,l){1&n&&(t.j41(0,"div",20),t.EFF(1,"Saving..."),t.k0s()),2&n&&t.xc7("width","100%")}function Fs(n,l){1&n&&(t.j41(0,"div",20),t.EFF(1,"Depositing..."),t.k0s()),2&n&&t.xc7("width","100%")}function Os(n,l){if(1&n&&(t.j41(0,"div",17)(1,"div",18),t.DNE(2,ys,2,2,"div",19),t.nI1(3,"async"),t.DNE(4,Fs,2,2,"div",19),t.nI1(5,"async"),t.k0s()()),2&n){const e=t.XpG(2);t.R7$(2),t.Y8G("ngIf",t.bMT(3,2,e.processingSaveStatus)),t.R7$(2),t.Y8G("ngIf",t.bMT(5,4,e.processingDepositStatus))}}function Rs(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",21),t.nI1(1,"async"),t.nI1(2,"async"),t.nI1(3,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG(2);return t.Njj(r.deposit(s))}),t.j41(4,"span"),t.nrm(5,"i",22),t.EFF(6),t.nI1(7,"translate"),t.k0s()()}if(2&n){const e=t.XpG(2);t.Y8G("disabled",t.bMT(1,3,e.processingSaveStatus)||t.bMT(2,5,e.processingDepositStatus)),t.BMQ("data-test",t.bMT(3,7,"deposit")),t.R7$(6),t.SpI(" ",t.bMT(7,9,"submission.general.deposit"),"")}}function Ps(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",2)(1,"div",3),t.DNE(2,Ds,7,11,"button",4),t.nI1(3,"async"),t.k0s(),t.j41(4,"div",5),t.DNE(5,Ts,4,3,"span",6),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.DNE(9,Ms,4,3,"span",6),t.nI1(10,"async"),t.nI1(11,"async"),t.nI1(12,"async"),t.DNE(13,Os,6,6,"div",7),t.nI1(14,"async"),t.nI1(15,"async"),t.j41(16,"div",8)(17,"button",9),t.nI1(18,"async"),t.nI1(19,"async"),t.nI1(20,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.save(s))}),t.j41(21,"span"),t.nrm(22,"i",10),t.EFF(23),t.nI1(24,"translate"),t.k0s()(),t.j41(25,"button",11),t.nI1(26,"async"),t.nI1(27,"async"),t.nI1(28,"async"),t.nI1(29,"async"),t.nI1(30,"dsBrowserOnly"),t.bIt("click",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.saveLater(s))}),t.j41(31,"span"),t.nrm(32,"i",10),t.EFF(33),t.nI1(34,"translate"),t.k0s()(),t.DNE(35,Rs,8,11,"button",12),t.nI1(36,"async"),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(2),t.Y8G("ngIf",t.bMT(3,15,e.showDepositAndDiscard)),t.R7$(3),t.Y8G("ngIf",!0!==t.bMT(6,17,e.hasUnsavedModification)&&!0!==t.bMT(7,19,e.processingSaveStatus)&&!0!==t.bMT(8,21,e.processingDepositStatus)),t.R7$(4),t.Y8G("ngIf",t.bMT(10,23,e.hasUnsavedModification)&&!0!==t.bMT(11,25,e.processingSaveStatus)&&!0!==t.bMT(12,27,e.processingDepositStatus)),t.R7$(4),t.Y8G("ngIf",t.bMT(14,29,e.processingSaveStatus)||t.bMT(15,31,e.processingDepositStatus)),t.R7$(4),t.Y8G("disabled",t.bMT(18,33,e.processingSaveStatus)||!0!==t.bMT(19,35,e.hasUnsavedModification)),t.BMQ("data-test",t.bMT(20,37,"save")),t.R7$(6),t.SpI(" ",t.bMT(24,39,"submission.general.save"),""),t.R7$(2),t.AVh("btn-primary",!0!==t.bMT(26,41,e.showDepositAndDiscard))("btn-secondary",t.bMT(27,43,e.showDepositAndDiscard)),t.Y8G("disabled",t.bMT(28,45,e.processingSaveStatus)||t.bMT(29,47,e.processingDepositStatus)),t.BMQ("data-test",t.bMT(30,49,"save-for-later")),t.R7$(8),t.SpI(" ",t.bMT(34,51,"submission.general.save-later"),""),t.R7$(2),t.Y8G("ngIf",t.bMT(36,53,e.showDepositAndDiscard))}}function js(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",23)(1,"h4",24),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",25),t.bIt("click",function(){const s=t.eBV(e).dismiss;return t.Njj(s("cancel"))}),t.j41(5,"span",26),t.EFF(6,"\xd7"),t.k0s()()(),t.j41(7,"div",27)(8,"p"),t.EFF(9),t.nI1(10,"translate"),t.k0s()(),t.j41(11,"div",28)(12,"button",29),t.bIt("click",function(){const s=t.eBV(e).close;return t.Njj(s("cancel"))}),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"button",30),t.bIt("click",function(){const s=t.eBV(e).close;return t.Njj(s("ok"))}),t.EFF(16),t.nI1(17,"translate"),t.k0s()()}2&n&&(t.R7$(2),t.JRh(t.bMT(3,4,"submission.general.discard.confirm.title")),t.R7$(7),t.JRh(t.bMT(10,6,"submission.general.discard.confirm.info")),t.R7$(4),t.JRh(t.bMT(14,8,"submission.general.discard.confirm.cancel")),t.R7$(3),t.JRh(t.bMT(17,10,"submission.general.discard.confirm.submit")))}let Bs=(()=>{class n{constructor(e,i,s){this.modalService=e,this.restService=i,this.submissionService=s,this.submissionIsInvalid=(0,S.of)(!0)}ngOnChanges(e){(0,c.hj)(this.submissionId)&&(this.submissionIsInvalid=this.submissionService.getSubmissionStatus(this.submissionId).pipe((0,u.T)(i=>!1===i)),this.processingSaveStatus=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.processingDepositStatus=this.submissionService.getSubmissionDepositProcessingStatus(this.submissionId),this.showDepositAndDiscard=(0,S.of)(this.submissionService.getSubmissionScope()===wt.L.WorkspaceItem),this.hasUnsavedModification=this.submissionService.hasUnsavedModification())}save(e){this.submissionService.dispatchSave(this.submissionId,!0)}saveLater(e){this.submissionService.dispatchSaveForLater(this.submissionId)}deposit(e){this.submissionService.dispatchDeposit(this.submissionId)}confirmDiscard(e){this.modalService.open(e).result.then(i=>{"ok"===i&&this.submissionService.dispatchDiscard(this.submissionId)})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(T.Bq),t.rXU(Cs.O),t.rXU(j.E))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form-footer"]],inputs:{submissionId:"submissionId"},standalone:!0,features:[t.OA$,t.aNF],decls:3,vars:1,consts:[["content",""],["class","row",4,"ngIf"],[1,"row"],[1,"col"],["type","button","id","discard","class","btn btn-danger",3,"disabled","click",4,"ngIf"],[1,"col","text-right","d-flex","justify-content-end","align-items-center"],[4,"ngIf"],["class","col d-flex justify-content-end align-items-center",4,"ngIf"],[1,"ml-2","space-children-mr"],["type","button","id","save",1,"btn","btn-secondary",3,"click","disabled"],[1,"fas","fa-save"],["type","button","id","saveForLater",1,"btn",3,"click","disabled"],["type","button","id","deposit","class","btn btn-success",3,"disabled","click",4,"ngIf"],["type","button","id","discard",1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-trash"],[1,"fas","fa-check-circle"],[1,"fas","fa-exclamation-circle"],[1,"col","d-flex","justify-content-end","align-items-center"],[1,"progress","w-75"],["class","progress-bar progress-bar-striped progress-bar-animated bg-info","role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",3,"width",4,"ngIf"],["role","progressbar","aria-valuenow","100","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","progress-bar-striped","progress-bar-animated","bg-info"],["type","button","id","deposit",1,"btn","btn-success",3,"click","disabled"],[1,"fas","fa-plus"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer","space-children-mr"],["type","button","id","discard_cancel",1,"btn","btn-secondary",3,"click"],["type","button","id","discard_submit",1,"btn","btn-danger",3,"click"]],template:function(i,s){1&i&&t.DNE(0,Ps,37,55,"div",1)(1,js,18,12,"ng-template",null,0,t.C5r),2&i&&t.Y8G("ngIf",!!s.submissionId)},dependencies:[p.MD,p.bT,p.Jj,Es.L,x.h,x.D9]})}return n})();var xs=o(744);const zt=n=>({"w-100":n});function Us(n,l){if(1&n&&(t.qex(0),t.j41(1,"button",6),t.nI1(2,"async"),t.nI1(3,"async"),t.EFF(4),t.nI1(5,"translate"),t.nrm(6,"i",7),t.k0s(),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("disabled",!0!==t.bMT(2,3,e.hasSections$))("ngClass",t.eq3(9,zt,t.bMT(3,5,e.windowService.isXs()))),t.R7$(3),t.SpI(" ",t.bMT(5,7,"submission.sections.general.add-more")," ")}}function $s(n,l){1&n&&(t.j41(0,"button",8),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections.general.no-sections")," "))}function As(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG();return t.Njj(r.addSection(s.id))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}if(2&n){const e=l.$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,"submission.sections."+e.header)," ")}}let Gs=(()=>{class n{constructor(e,i,s){this.sectionService=e,this.submissionService=i,this.windowService=s}ngOnInit(){this.sectionList$=this.submissionService.getDisabledSectionsList(this.submissionId),this.hasSections$=this.sectionList$.pipe((0,u.T)(e=>e.length>0))}addSection(e){this.sectionService.addSection(this.submissionId,e)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(X.c),t.rXU(j.E),t.rXU(xs.CV))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form-section-add"]],inputs:{collectionId:"collectionId",submissionId:"submissionId"},standalone:!0,features:[t.aNF],decls:10,vars:17,consts:[["sectionAdd","ngbDropdown"],["ngbDropdown","","placement","bottom-right",1,"d-inline-block",3,"ngClass"],[4,"ngIf"],["ngbDropdownMenu","","aria-labelledby","sectionControls",1,"sections-dropdown-menu",3,"ngClass"],["class","dropdown-item disabled",4,"ngIf"],["class","dropdown-item",3,"click",4,"ngFor","ngForOf"],["id","sectionControls","ngbDropdownToggle","",1,"btn","btn-outline-primary","dropdown-toggle",3,"disabled","ngClass"],["aria-hidden","true",1,"fa","fa-plus"],[1,"dropdown-item","disabled"],[1,"dropdown-item",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"div",1,0),t.DNE(2,Us,7,11,"ng-container",2),t.nI1(3,"async"),t.j41(4,"div",3),t.nI1(5,"async"),t.DNE(6,$s,3,3,"button",4),t.nI1(7,"async"),t.DNE(8,As,3,3,"button",5),t.nI1(9,"async"),t.k0s()()),2&i&&(t.Y8G("ngClass",t.eq3(13,zt,s.windowService.isXs())),t.R7$(2),t.Y8G("ngIf",t.bMT(3,5,s.hasSections$)),t.R7$(2),t.Y8G("ngClass",t.eq3(15,zt,t.bMT(5,7,s.windowService.isXs()))),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(7,9,s.hasSections$)),t.R7$(2),t.Y8G("ngForOf",t.bMT(9,11,s.sectionList$)))},dependencies:[p.MD,p.YU,p.Sq,p.bT,p.Jj,x.h,x.D9,T.zH,T.tg,T.do,T.U0],styles:[".dropdown-toggle[_ngcontent-%COMP%]:after{display:none}.sections-dropdown-menu[_ngcontent-%COMP%]{z-index:var(--ds-submission-header-z-index)}"]})}return n})();o(53466);const Ls=["*"];function Ns(n,l){}let Vs=(()=>{class n extends ie.J{constructor(){super(...arguments),this.inAndOutputNames=["collectionId","submissionId","uploadFilesOptions"]}getComponentName(){return"SubmissionUploadFilesComponent"}importThemedComponent(e){return o(28767)(`./${e}/app/submission/form/submission-upload-files/submission-upload-files.component.ts`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,53466))}static#t=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}})();static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:Ls,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(i,s){1&i&&(t.NAR(),t.DNE(0,Ns,0,0,"ng-template",null,0,t.C5r),t.j41(2,"div",null,1),t.SdG(4),t.k0s())},encapsulation:2})}return n})();function Xs(n,l){if(1&n&&(t.j41(0,"div",12),t.nrm(1,"ds-submission-upload-files",13)(2,"div",14),t.k0s()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("submissionId",e.submissionId)("collectionId",e.collectionId)("uploadFilesOptions",e.uploadFilesOptions)}}function Ys(n,l){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"ds-submission-form-collection",15),t.bIt("collectionChange",function(s){t.eBV(e);const r=t.XpG(2);return t.Njj(r.onCollectionChange(s))}),t.k0s(),t.bVm()}if(2&n){const e=t.XpG(2);t.R7$(),t.Y8G("currentCollectionId",e.collectionId)("currentDefinition",e.definitionId)("submissionId",e.submissionId)("collectionModifiable",e.collectionModifiable)("isReadonly",e.isSectionReadonly)}}function ks(n,l){if(1&n&&(t.j41(0,"div",6),t.DNE(1,Xs,3,3,"div",7),t.nI1(2,"async"),t.j41(3,"div",8),t.DNE(4,Ys,2,5,"ng-container",9),t.k0s(),t.j41(5,"div",10),t.nrm(6,"ds-submission-form-section-add",11),t.k0s()()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",t.bMT(2,4,e.uploadEnabled$)),t.R7$(3),t.Y8G("ngIf",!e.isSectionHidden),t.R7$(2),t.Y8G("collectionId",e.collectionId)("submissionId",e.submissionId)}}function Ks(n,l){1&n&&t.nrm(0,"ds-loading",16)}function Ws(n,l){if(1&n&&(t.qex(0),t.nrm(1,"ds-submission-section-container",17),t.bVm()),2&n){const e=l.$implicit,i=t.XpG();t.R7$(),t.Y8G("collectionId",i.collectionId)("submissionId",i.submissionId)("sectionData",e)}}function ws(n,l){if(1&n&&(t.j41(0,"div",18),t.nrm(1,"ds-submission-form-footer",19),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("submissionId",e.submissionId)}}let Js=(()=>{class n{constructor(e,i,s,r,_){this.authService=e,this.changeDetectorRef=i,this.halService=s,this.submissionService=r,this.sectionsService=_,this.collectionModifiable=null,this.loading=(0,S.of)(!0),this.uploadFilesOptions=new h.H,this.subs=[],this.isActive=!0}ngOnChanges(e){e.collectionId&&this.collectionId&&e.submissionId&&this.submissionId&&(this.isActive=!0,this.submissionSections=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,d.p)(()=>this.isActive),(0,u.T)(i=>i.isLoading),(0,u.T)(i=>i),(0,C.F)(),(0,P.n)(i=>i?(0,S.of)([]):this.getSectionsList())),this.uploadEnabled$=this.sectionsService.isSectionTypeAvailable(this.submissionId,k.l.Upload),this.loading=this.submissionService.getSubmissionObject(this.submissionId).pipe((0,d.p)(()=>this.isActive),(0,u.T)(i=>i.isLoading),(0,u.T)(i=>i),(0,C.F)()),this.subs.push(this.halService.getEndpoint(this.submissionService.getSubmissionObjectLinkName()).pipe((0,d.p)(i=>(0,c.hj)(i)),(0,C.F)()).subscribe(i=>{this.uploadFilesOptions.authToken=this.authService.buildAuthHeader(),this.uploadFilesOptions.url=i.concat(`/${this.submissionId}`),this.definitionId=this.submissionDefinition.name,this.submissionService.dispatchInit(this.collectionId,this.submissionId,this.selfUrl,this.submissionDefinition,this.sections,this.item,this.submissionErrors),this.changeDetectorRef.detectChanges()})),this.submissionService.startAutoSave(this.submissionId))}getCollectionVisibility(){const e=this.submissionDefinition.sections.page.find(i=>v()(i.sectionType,k.l.Collection));return(0,c.EA)(e.visibility)?e.visibility:null}get isSectionHidden(){const e=this.getCollectionVisibility();return(0,c.a4)(e)&&v()(e.main,Bt.x.HIDDEN)&&v()(e.other,Bt.x.HIDDEN)}get isSectionReadonly(){const e=this.getCollectionVisibility();return(0,c.a4)(e)&&v()(e.main,Bt.x.READONLY)&&v()(e.other,Bt.x.READONLY)}ngOnDestroy(){this.isActive=!1,this.submissionService.stopAutoSave(),this.submissionService.resetAllSubmissionObjects(),this.subs.filter(e=>(0,c.a4)(e)).forEach(e=>e.unsubscribe())}onCollectionChange(e){this.collectionId=e.collection.id,this.definitionId!==e.submissionDefinition.name?(this.sections=e.sections,this.submissionDefinition=e.submissionDefinition,this.definitionId=this.submissionDefinition.name,this.submissionService.resetSubmissionObject(this.collectionId,this.submissionId,e._links.self.href,this.submissionDefinition,this.sections,this.item)):this.changeDetectorRef.detectChanges()}isLoading(){return this.loading}getSectionsList(){return this.submissionService.getSubmissionSections(this.submissionId).pipe((0,d.p)(e=>(0,c.hj)(e)),(0,u.T)(e=>e.filter(i=>!v()(i.sectionType,k.l.Collection))))}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(L.uR),t.rXU(t.gRc),t.rXU(M.Y),t.rXU(j.E),t.rXU(X.c))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-submission-form"]],inputs:{collectionId:"collectionId",item:"item",collectionModifiable:"collectionModifiable",sections:"sections",submissionErrors:"submissionErrors",selfUrl:"selfUrl",submissionDefinition:"submissionDefinition",submissionId:"submissionId"},standalone:!0,features:[t.OA$,t.aNF],decls:10,vars:12,consts:[[1,"container-fluid"],["class","submission-form-header mb-3 d-flex flex-wrap position-sticky",4,"ngIf"],[1,"submission-form-content"],["message","Loading...",4,"ngIf"],[4,"ngFor","ngForOf"],["class","submission-form-footer mt-3 mb-3 position-sticky",4,"ngIf"],[1,"submission-form-header","mb-3","d-flex","flex-wrap","position-sticky"],["class","w-100",4,"ngIf"],[1,"submission-form-header-item","mb-3","mb-sm-0","flex-sm-grow-1","flex-md-grow-0"],[4,"ngIf"],[1,"submission-form-header-item","text-right"],[3,"collectionId","submissionId"],[1,"w-100"],[3,"submissionId","collectionId","uploadFilesOptions"],[1,"clearfix"],[3,"collectionChange","currentCollectionId","currentDefinition","submissionId","collectionModifiable","isReadonly"],["message","Loading..."],[3,"collectionId","submissionId","sectionData"],[1,"submission-form-footer","mt-3","mb-3","position-sticky"],[3,"submissionId"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.DNE(1,ks,7,6,"div",1),t.nI1(2,"async"),t.j41(3,"div",2),t.DNE(4,Ks,1,0,"ds-loading",3),t.nI1(5,"async"),t.DNE(6,Ws,2,3,"ng-container",4),t.nI1(7,"async"),t.k0s(),t.DNE(8,ws,2,1,"div",5),t.nI1(9,"async"),t.k0s()),2&i&&(t.R7$(),t.Y8G("ngIf",!0!==t.bMT(2,4,s.isLoading())),t.R7$(3),t.Y8G("ngIf",t.bMT(5,6,s.isLoading())),t.R7$(2),t.Y8G("ngForOf",t.bMT(7,8,s.submissionSections)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(9,10,s.isLoading())))},dependencies:[p.MD,p.Sq,p.bT,p.Jj,g.v,_s,Bs,Vs,Is,Gs],styles:[".submission-form-header[_ngcontent-%COMP%]{background-color:#fffffff7;padding:calc(var(--bs-spacer) / 2) 0 calc(var(--bs-spacer) / 2) 0;top:0;z-index:var(--ds-submission-header-z-index)}.submission-form-header-item[_ngcontent-%COMP%]{flex-grow:1}.submission-form-footer[_ngcontent-%COMP%]{border-radius:var(--bs-card-border-radius);bottom:0;background-color:var(--bs-gray-400);padding:calc(var(--bs-spacer) / 2);z-index:var(--ds-submission-footer-z-index)}.btn-link-focus[_ngcontent-%COMP%]{font-weight:400;color:#1f7293;text-decoration:none}.btn-link-focus[_ngcontent-%COMP%]:hover{color:#124154;text-decoration:underline}.btn-link-focus[_ngcontent-%COMP%]:disabled, .btn-link-focus.disabled[_ngcontent-%COMP%]{color:#6c757d;pointer-events:none}.btn-link-focus[_ngcontent-%COMP%]:focus, .btn-link-focus.focus[_ngcontent-%COMP%]{text-decoration:underline}"]})}return n})()},53466:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionUploadFilesComponent:()=>x});var p=o(54460),D=o(63016),v=o(1703),S=o(37610),d=o(91917),u=o(6973),C=o(72683),P=o(79224),L=o(44277),M=(o(96013),o(25941)),m=o(55445),c=o(64340),g=o(11750),h=o(53107),t=o(69685);function T(I,N){if(1&I){const G=h.RV6();h.j41(0,"ds-uploader",1),h.bIt("onCompleteItem",function(j){h.eBV(G);const U=h.XpG();return h.Njj(U.onCompleteItem(j))})("onUploadError",function(){h.eBV(G);const j=h.XpG();return h.Njj(j.onUploadError())}),h.k0s()}if(2&I){const G=h.XpG();h.Y8G("dropMsg",G.dropMsg)("dropOverDocumentMsg",G.dropOverDocumentMsg)("enableDragOverDocument",G.enableDragOverDocument)("onBeforeUpload",G.onBeforeUpload)("uploadFilesOptions",G.uploadFilesOptions)}}let x=(()=>{class I{constructor(G,E,j,U,X){this.notificationsService=G,this.operationsService=E,this.sectionService=j,this.submissionService=U,this.translate=X,this.enableDragOverDocument=!0,this.dropOverDocumentMsg="submission.sections.upload.drop-message",this.dropMsg="submission.sections.upload.drop-message",this.subs=[],this.uploadEnabled=(0,D.of)(!1),this.onBeforeUpload=()=>{const k=this.operationsService.jsonPatchByResourceType(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,"sections").subscribe();return this.subs.push(k),k}}ngOnChanges(){this.uploadEnabled=this.sectionService.isSectionTypeAvailable(this.submissionId,m.l.Upload)}onCompleteItem(G){this.subs.push(this.uploadEnabled.pipe((0,v.$)()).subscribe(E=>{if(E){const{sections:j}=G,{errors:U}=G,X=(0,g.A)(U);j&&(0,C.hj)(j)&&Object.keys(j).forEach(k=>{const J=(0,u.Z5)(j[k]),$=X[k];this.sectionService.isSectionType(this.submissionId,k,m.l.Upload).pipe((0,S.s)(1)).subscribe(Q=>{Q&&((0,C.Im)($)?this.notificationsService.success(null,this.translate.get("submission.sections.upload.upload-successful")):this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed")))}),this.sectionService.updateSectionData(this.submissionId,k,J,$,$)})}}))}onUploadError(){this.notificationsService.error(null,this.translate.get("submission.sections.upload.upload-failed"))}ngOnDestroy(){this.subs.filter(G=>(0,C.a4)(G)).forEach(G=>G.unsubscribe())}static#t=this.\u0275fac=function(E){return new(E||I)(h.rXU(P.I),h.rXU(d.U),h.rXU(M.c),h.rXU(c.E),h.rXU(t.c$))};static#e=this.\u0275cmp=h.VBU({type:I,selectors:[["ds-base-submission-upload-files"]],inputs:{collectionId:"collectionId",submissionId:"submissionId",uploadFilesOptions:"uploadFilesOptions"},standalone:!0,features:[h.OA$,h.aNF],decls:1,vars:1,consts:[[3,"dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions","onCompleteItem","onUploadError",4,"ngIf"],[3,"onCompleteItem","onUploadError","dropMsg","dropOverDocumentMsg","enableDragOverDocument","onBeforeUpload","uploadFilesOptions"]],template:function(E,j){1&E&&h.DNE(0,T,1,5,"ds-uploader",0),2&E&&h.Y8G("ngIf",j.uploadFilesOptions.url)},dependencies:[L.y,p.bT],encapsulation:2})}return I})()},55546:(W,B,o)=>{"use strict";o.r(B),o.d(B,{CoarNotifyConfigDataService:()=>t});var p=o(37610),D=o(47947),v=o(45122),S=o(25718),d=o(45926),u=o(83951),C=o(94937),P=o(2887),L=o(2868),y=o(70210),M=o(9843),m=o(25744),c=o(87913),g=o(79224),h=o(53107);let t=(()=>{class T extends P.W{constructor(I,N,G,E,j){super("submissioncoarnotifyconfigs",I,N,G,E),this.requestService=I,this.rdbService=N,this.objectCache=G,this.halService=E,this.notificationsService=j,this.findAllData=new C.H(this.linkPath,I,N,G,E,this.responseMsToLive),this.deleteData=new u.I(this.linkPath,I,N,G,E,j,this.responseMsToLive,this.constructIdEndpoint),this.patchData=new L.n(this.linkPath,I,N,G,E,this.comparator,this.responseMsToLive,this.constructIdEndpoint),this.createData=new d.V(this.linkPath,I,N,G,E,j,this.responseMsToLive)}create(I,...N){return this.createData.create(I,...N)}patch(I,N){return this.patchData.patch(I,N)}update(I){return this.patchData.update(I)}commitUpdates(I){return this.patchData.commitUpdates(I)}createPatchFromCache(I){return this.patchData.createPatchFromCache(I)}findAll(I,N,G,...E){return this.findAllData.findAll(I,N,G,...E)}delete(I,N){return this.deleteData.delete(I,N)}deleteByHref(I,N){return this.deleteData.deleteByHref(I,N)}invoke(I,N,G){const E=this.requestService.generateRequestId();return this.getBrowseEndpoint().pipe((0,p.s)(1),(0,D.T)(j=>new c.t(j,I,"submissioncoarnotifyconfigmodel",N).toString()),(0,D.T)(j=>{const U=this.getInvocationFormData(G);return new y.E0(E,j,U)})).subscribe(j=>this.requestService.send(j)),this.rdbService.buildFromRequestUUID(E)}getInvocationFormData(I){const N=new FormData;return I.forEach(G=>{N.append("file",G)}),N}static#t=this.\u0275fac=function(N){return new(N||T)(h.KVO(M.B),h.KVO(v.o),h.KVO(S.$),h.KVO(m.Y),h.KVO(g.I))};static#e=this.\u0275prov=h.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},30664:(W,B,o)=>{"use strict";o.d(B,{_:()=>M});var p=o(54460),D=o(83116),v=o(7172),S=o(12007),d=o(72683),u=o(53107);function C(m,c){if(1&m&&(u.j41(0,"span",3),u.EFF(1),u.k0s()),2&m){const g=u.XpG().$implicit;u.R7$(),u.E5c(" ",g.name," ",g.startDate," ",g.endDate," ")}}function P(m,c){if(1&m&&(u.j41(0,"span",3),u.EFF(1),u.k0s()),2&m){const g=u.XpG().$implicit;u.R7$(),u.Lme("",g.name," from ",g.endDate,"")}}function L(m,c){if(1&m&&(u.j41(0,"span",4),u.EFF(1),u.k0s()),2&m){const g=u.XpG().$implicit;u.R7$(),u.Lme("",g.name," until ",g.startDate,"")}}function y(m,c){if(1&m&&(u.qex(0),u.DNE(1,C,2,3,"span",1)(2,P,2,2,"span",1)(3,L,2,2,"span",2),u.nrm(4,"br"),u.bVm()),2&m){const g=c.$implicit;u.R7$(),u.Y8G("ngIf","DEFAULT_BITSTREAM_READ"===g.action),u.R7$(),u.Y8G("ngIf","lease"===g.name),u.R7$(),u.Y8G("ngIf","embargo"===g.name)}}let M=(()=>{class m{constructor(g,h){this.dsoNameService=g,this.groupService=h,this.accessConditionsList=[]}ngOnInit(){this.accessConditions.forEach(g=>{(0,d.Im)(g.name)?this.groupService.findByHref(g._links.group.href).pipe((0,S.qD)()).subscribe(h=>{if(h.hasSucceeded){const t=h.payload,T=Object.assign({},g);T.name=this.dsoNameService.getName(t),this.accessConditionsList.push(T)}}):this.accessConditionsList.push(g)})}static#t=this.\u0275fac=function(h){return new(h||m)(u.rXU(D.f),u.rXU(v.GroupDataService))};static#e=this.\u0275cmp=u.VBU({type:m,selectors:[["ds-submission-section-upload-access-conditions"]],inputs:{accessConditions:"accessConditions"},standalone:!0,features:[u.aNF],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["class","badge badge-primary mt-3 mr-2",4,"ngIf"],["class","badge badge-dark mt-3 mr-2",4,"ngIf"],[1,"badge","badge-primary","mt-3","mr-2"],[1,"badge","badge-dark","mt-3","mr-2"]],template:function(h,t){1&h&&u.DNE(0,y,5,3,"ng-container",0),2&h&&u.Y8G("ngForOf",t.accessConditionsList)},dependencies:[p.Sq,p.bT],encapsulation:2})}return m})()},68991:(W,B,o)=>{"use strict";o.r(B),o.d(B,{SubmissionSectionUploadFileComponent:()=>Lt});var p=o(54460),D=o(69685),v=o(71217),S=o(41483),u=(o(451),o(65067)),C=o(51142),P=o(56738),L=o(91917),y=o(72683),M=o(60902),m=o(50120),c=o(89351),g=o(64340),h=o(47346),t=o(89593),T=o(37610),x=o(27035),I=o(11162),N=o(75988),G=o(28022),E=o(36590);const X={id:"metadata",group:[]},k={element:{container:"form-group",label:"col-form-label"},grid:{label:"col-sm-3"}},J={id:"accessConditionGroup",group:[]},$={element:{host:"form-group access-condition-group col",container:"pl-1 pr-1",control:"form-row "}},Q={id:"accessConditions",groupFactory:null},H={grid:{group:"form-row pt-4"}},Z={id:"name",label:"submission.sections.upload.form.access-condition-label",hint:"submission.sections.upload.form.access-condition-hint",options:[]},q={element:{host:"col-12",label:"col-form-label name-label"}},ot={element:{host:"col-12",container:"text-right"}},nt={id:"primary",name:"primary",label:"bitstream.edit.form.primaryBitstream.label"},et={id:"startDate",label:"submission.sections.upload.form.from-label",hint:"submission.sections.upload.form.from-hint",placeholder:"submission.sections.upload.form.from-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:t.AjF,operator:t.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-from"}},gt={element:{label:"col-form-label"},grid:{host:"col-6"}},ft={id:"endDate",label:"submission.sections.upload.form.until-label",hint:"submission.sections.upload.form.until-hint",placeholder:"submission.sections.upload.form.until-placeholder",inline:!1,toggleIcon:"far fa-calendar-alt",relations:[{match:t.AjF,operator:t.fXj,when:[]}],required:!0,validators:{required:null},errorMessages:{required:"submission.sections.upload.form.date-required-until"}},ht={element:{label:"col-form-label"},grid:{host:"col-6"}};var a=o(53107),vt=o(2155);const Ut=["formRef"];function $t(K,bt){if(1&K){const b=a.RV6();a.j41(0,"ds-form",7,0),a.bIt("submitForm",function(){a.eBV(b);const O=a.XpG();return a.Njj(O.onSubmit())})("cancel",function(){a.eBV(b);const O=a.XpG();return a.Njj(O.onModalClose())})("dfChange",function(O){a.eBV(b);const Y=a.XpG();return a.Njj(Y.onChange(O))}),a.k0s()}if(2&K){const b=a.XpG();a.Y8G("formId",b.formId)("formModel",b.formModel)("displaySubmit",!b.isSaving)("displayCancel",!b.isSaving)}}let Ot=(()=>{class K{constructor(b,F,O,Y,A,w,z,ut){this.activeModal=b,this.cdr=F,this.formBuilderService=O,this.formService=Y,this.submissionService=A,this.operationsBuilder=w,this.operationsService=z,this.uploadService=ut,this.formMetadata=[],this.isSaving=!1,this.subscriptions=[]}initModelData(b){this.formBuilderService.findById("primary",b,this.fileIndex).value=this.isPrimary||!1,this.fileData.accessConditions.forEach((O,Y)=>{Array.of("name","startDate","endDate").filter(A=>O.hasOwnProperty(A)&&(0,y.hj)(O[A])).forEach(A=>{const w=this.formBuilderService.findById(A,b,Y);if(w)if(w.type===t.fQD){const z=new Date(O[A]);w.value={year:z.getUTCFullYear(),month:z.getUTCMonth()+1,day:z.getUTCDate()}}else w.value=O[A]})})}onChange(b){"name"===b.model.id&&this.setOptions(b.model,b.control)}onModalClose(){this.activeModal.dismiss()}onSubmit(){this.isSaving=!0,this.saveBitstreamData()}setOptions(b,F){let O=null;if(this.availableAccessConditionOptions.filter(Y=>Y.name===F.value).forEach(Y=>O=Y),(0,y.hj)(O)){const Y=F.parent.get("startDate"),A=F.parent.get("endDate");Y?.markAsUntouched(),A?.markAsUntouched(),Y?.setValue(null),F.parent.markAsDirty(),A?.setValue(null)}}ngOnInit(){this.fileData&&this.formId&&(this.formModel=this.buildFileEditForm(),this.cdr.detectChanges())}ngOnDestroy(){this.unsubscribeAll()}retrieveValueFromField(b){const F=Array.isArray(b)?b[0]:b;return F?F.value:void 0}buildFileEditForm(){const b=Object.assign({},this.configMetadataForm.rows[0].fields[0]);b.repeatable=!1;const F=Object.assign({},this.configMetadataForm,{fields:Object.assign([],this.configMetadataForm.rows[0].fields[0],[this.configMetadataForm.rows[0].fields[0],b])}),O=[];O.push(new I.i(nt,ot));const Y=Object.assign({},X);Y.group=this.formBuilderService.modelFromConfiguration(this.submissionId,F,this.collectionId,this.fileData.metadata,this.submissionService.getSubmissionScope()),O.push(new t.iO5(Y,k));const A=Object.assign({},Z),w=Object.assign({},Q),z=[];if(2===this.collectionPolicyType){for(const st of this.availableAccessConditionOptions)z.push({label:st.name,value:st.name});A.options=z;const ut=[],at=[];let pt,Mt;this.availableAccessConditionOptions.forEach(st=>{if(st.hasStartDate&&(ut.push({id:"name",value:st.name}),st.maxStartDate)){const ct=new Date(st.maxStartDate);pt={year:ct.getUTCFullYear(),month:ct.getUTCMonth()+1,day:ct.getUTCDate()}}if(st.hasEndDate&&(at.push({id:"name",value:st.name}),st.maxEndDate)){const ct=new Date(st.maxEndDate);Mt={year:ct.getUTCFullYear(),month:ct.getUTCMonth()+1,day:ct.getUTCDate()}}});const Nt={relations:[{match:t.AjF,operator:t.fXj,when:ut}]},Vt={relations:[{match:t.AjF,operator:t.fXj,when:at}]},Xt=ut.length>0,Yt=at.length>0;w.groupFactory=()=>{const st=new t.z4z(A,q),ct=Object.assign({},et,Nt);pt&&(ct.max=pt);const Pt=Object.assign({},ft,Vt);Mt&&(Pt.max=Mt);const kt=new t.dku(ct,gt),Kt=new t.dku(Pt,ht),It=Object.assign({},J);return It.group=[st],Xt&&It.group.push(kt),Yt&&It.group.push(Kt),[new t.iO5(It,$)]},w.initialCount=(0,y.hj)(this.fileData.accessConditions)?this.fileData.accessConditions.length:1,O.push(new t.UqU(w,H))}return this.initModelData(O),O}saveBitstreamData(){const b=["files",this.fileIndex];this.formService.validateAllFormFields(this.formRef.formGroup);const F=this.formService.isValid(this.formId).pipe((0,T.s)(1),(0,S.p)(O=>O),(0,x.Z)(()=>this.formService.getFormData(this.formId)),(0,T.s)(1),(0,x.Z)(O=>{this.uploadService.updatePrimaryBitstreamOperation(this.pathCombiner.getPath("primary"),this.isPrimary,O.primary[0],this.fileId),Object.keys(O.metadata).filter(A=>(0,y.hj)(O.metadata[A])).forEach(A=>{const z=`metadata/${A.replace(/_/g,".")}`;this.operationsBuilder.add(this.pathCombiner.getPath([...b,z]),O.metadata[A],!0)}),Object.keys(this.fileData.metadata).filter(A=>(0,y.hj)(this.fileData.metadata[A])).filter(A=>(0,y.Tn)(O.metadata[A])).filter(A=>this.formMetadata.includes(A)).forEach(A=>{const z=`metadata/${A.replace(/_/g,".")}`;this.operationsBuilder.remove(this.pathCombiner.getPath([...b,z]))});const Y=[];return O.hasOwnProperty("accessConditions")&&O.accessConditions.filter(A=>(0,y.Pe)(A)).map(A=>A.accessConditionGroup).filter(A=>(0,y.hj)(A)).forEach(A=>{let w;if(this.availableAccessConditionOptions.filter(z=>(0,y.Pe)(A.name)&&z.name===A.name[0].value).forEach(z=>w=z),w){const z=Object.assign({},A);if(z.name=this.retrieveValueFromField(A.name),w.hasStartDate){if(A.startDate){const ut=this.retrieveValueFromField(A.startDate);let at=new Date(ut);if(w.maxStartDate){const pt=new Date(w.maxStartDate);at>pt&&(at=pt)}z.startDate=(0,N.Sd)(at)}}else delete z.startDate;if(w.hasEndDate){if(A.endDate){const ut=this.retrieveValueFromField(A.endDate);let at=new Date(ut);if(w.maxEndDate){const pt=new Date(w.maxEndDate);at>pt&&(at=pt)}z.endDate=(0,N.Sd)(at)}}else delete z.endDate;Y.push(z)}}),(0,y.hj)(Y)&&this.operationsBuilder.add(this.pathCombiner.getPath([...b,"accessConditions"]),Y,!0),this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement)})).subscribe(O=>{const Y=O[0].sections[this.sectionId];if(!Y)return;const A=Y;this.uploadService.updateFilePrimaryBitstream(this.submissionId,this.sectionId,A.primary),Object.keys(A.files).filter(w=>A.files[w].uuid===this.fileId).forEach(w=>this.uploadService.updateFileData(this.submissionId,this.sectionId,this.fileId,A.files[w])),this.isSaving=!1,this.activeModal.close()});this.subscriptions.push(F)}unsubscribeAll(){this.subscriptions.filter(b=>(0,y.a4)(b)).forEach(b=>b.unsubscribe())}static#t=this.\u0275fac=function(F){return new(F||K)(a.rXU(vt.Lw),a.rXU(a.gRc),a.rXU(G.j),a.rXU(m.u),a.rXU(g.E),a.rXU(C.C),a.rXU(L.U),a.rXU(h.i))};static#e=this.\u0275cmp=a.VBU({type:K,selectors:[["ds-submission-section-upload-file-edit"]],viewQuery:function(F,O){if(1&F&&a.GBs(Ut,5),2&F){let Y;a.mGM(Y=a.lsd())&&(O.formRef=Y.first)}},standalone:!0,features:[a.aNF],decls:10,vars:5,consts:[["formRef","formComponent"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click","disabled"],["aria-hidden","true"],[1,"modal-body"],[3,"formId","formModel","displaySubmit","displayCancel","submitForm","cancel","dfChange",4,"ngIf"],[3,"submitForm","cancel","dfChange","formId","formModel","displaySubmit","displayCancel"]],template:function(F,O){1&F&&(a.j41(0,"div")(1,"div",1)(2,"h4",2),a.EFF(3),a.nI1(4,"translate"),a.k0s(),a.j41(5,"button",3),a.bIt("click",function(){return O.onModalClose()}),a.j41(6,"span",4),a.EFF(7,"\xd7"),a.k0s()()(),a.j41(8,"div",5),a.DNE(9,$t,2,4,"ds-form",6),a.k0s()()),2&F&&(a.R7$(3),a.JRh(a.bMT(4,3,"submission.sections.upload.edit.title")),a.R7$(2),a.Y8G("disabled",O.isSaving),a.R7$(4),a.Y8G("ngIf",O.formModel))},dependencies:[E.s,p.bT,D.h,D.D9],styles:[".access-condition-group{position:relative;top:-2.3rem;margin-bottom:-2.3rem}"]})}return K})();var Et=o(53962);const Rt=K=>({fileName:K});function At(K,bt){if(1&K&&(a.j41(0,"span",21),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&K){const b=a.XpG(2);a.R7$(),a.JRh(a.i5U(2,1,"submission.sections.upload.primary.make",a.eq3(4,Rt,b.fileName)))}}function St(K,bt){if(1&K&&(a.j41(0,"span",21),a.EFF(1),a.nI1(2,"translate"),a.k0s()),2&K){const b=a.XpG(2);a.R7$(),a.JRh(a.i5U(2,1,"submission.sections.upload.primary.remove",a.eq3(4,Rt,b.fileName)))}}function Dt(K,bt){1&K&&a.nrm(0,"i",22)}function Tt(K,bt){1&K&&a.nrm(0,"i",23)}function mt(K,bt){if(1&K){const b=a.RV6();a.qex(0),a.j41(1,"div",2)(2,"div",3)(3,"div",4)(4,"input",5),a.nI1(5,"async"),a.bIt("change",function(O){a.eBV(b);const Y=a.XpG();return a.Njj(Y.togglePrimaryBitstream(O))}),a.k0s(),a.j41(6,"label",6),a.DNE(7,At,3,6,"span",7)(8,St,3,6,"span",7),a.k0s()()(),a.j41(9,"div",8)(10,"div",9)(11,"h3"),a.EFF(12),a.j41(13,"span",10),a.EFF(14),a.nI1(15,"dsFileSize"),a.k0s()()(),a.j41(16,"div",11),a.qex(17),a.j41(18,"ds-file-download-link",12),a.nrm(19,"i",13),a.k0s(),a.j41(20,"button",14),a.nI1(21,"translate"),a.nI1(22,"translate"),a.bIt("click",function(O){a.eBV(b);const Y=a.XpG();return O.preventDefault(),a.Njj(Y.editBitstreamData())}),a.nrm(23,"i",15),a.k0s(),a.j41(24,"button",16),a.nI1(25,"translate"),a.nI1(26,"async"),a.nI1(27,"translate"),a.bIt("click",function(O){a.eBV(b);const Y=a.XpG(),A=a.sdS(2);return O.preventDefault(),a.Njj(Y.confirmDelete(A))}),a.DNE(28,Dt,1,0,"i",17),a.nI1(29,"async"),a.DNE(30,Tt,1,0,"i",18),a.nI1(31,"async"),a.k0s(),a.bVm(),a.k0s(),a.nrm(32,"div",19)(33,"ds-submission-section-upload-file-view",20),a.k0s()(),a.bVm()}if(2&K){const b=a.XpG();a.R7$(4),a.Mz_("id","primaryBitstream",b.fileIndex,""),a.Y8G("disabled",a.bMT(5,22,b.processingSaveStatus$))("checked",b.isPrimary),a.R7$(2),a.Mz_("for","primaryBitstream",b.fileIndex,""),a.R7$(),a.Y8G("ngIf",!b.isPrimary),a.R7$(),a.Y8G("ngIf",b.isPrimary),a.R7$(4),a.SpI("",b.fileName," "),a.R7$(2),a.SpI("(",a.bMT(15,24,null==b.fileData?null:b.fileData.sizeBytes),")"),a.R7$(4),a.Y8G("cssClasses","btn btn-link-focus")("isBlank",!0)("bitstream",b.getBitstream())("enableRequestACopy",!1),a.R7$(2),a.FS9("title",a.bMT(21,26,"submission.sections.upload.edit.title")),a.BMQ("aria-label",a.bMT(22,28,"submission.sections.upload.edit.title")),a.R7$(4),a.FS9("title",a.bMT(25,30,"submission.sections.upload.delete.confirm.title")),a.Y8G("disabled",a.bMT(26,32,b.processingDelete$)),a.BMQ("aria-label",a.bMT(27,34,"submission.sections.upload.delete.confirm.title")),a.R7$(4),a.Y8G("ngIf",a.bMT(29,36,b.processingDelete$)),a.R7$(2),a.Y8G("ngIf",!0!==a.bMT(31,38,b.processingDelete$)),a.R7$(3),a.Y8G("fileData",b.fileData)}}function Gt(K,bt){if(1&K){const b=a.RV6();a.j41(0,"div",24)(1,"h4",25),a.EFF(2),a.nI1(3,"translate"),a.k0s(),a.j41(4,"button",26),a.bIt("click",function(){const O=a.eBV(b).dismiss;return a.Njj(O("cancel"))}),a.j41(5,"span",27),a.EFF(6,"\xd7"),a.k0s()()(),a.j41(7,"div",28)(8,"p"),a.EFF(9),a.nI1(10,"translate"),a.k0s()(),a.j41(11,"div",29)(12,"button",30),a.bIt("click",function(){const O=a.eBV(b).close;return a.Njj(O("cancel"))}),a.EFF(13),a.nI1(14,"translate"),a.k0s(),a.j41(15,"button",31),a.bIt("click",function(){const O=a.eBV(b).close;return a.Njj(O("ok"))}),a.EFF(16),a.nI1(17,"translate"),a.k0s()()}2&K&&(a.R7$(2),a.JRh(a.bMT(3,4,"submission.sections.upload.delete.confirm.title")),a.R7$(7),a.JRh(a.bMT(10,6,"submission.sections.upload.delete.confirm.info")),a.R7$(4),a.JRh(a.bMT(14,8,"submission.sections.upload.delete.confirm.cancel")),a.R7$(3),a.JRh(a.bMT(17,10,"submission.sections.upload.delete.confirm.submit")))}let Lt=(()=>{class K{constructor(b,F,O,Y,A,w){this.formService=b,this.modalService=F,this.operationsBuilder=O,this.operationsService=Y,this.submissionService=A,this.uploadService=w,this.processingDelete$=new v.t(!1),this.subscriptions=[],this.formMetadata=[],this.readMode=!0}ngOnChanges(b){this.availableAccessConditionOptions&&this.subscriptions.push(this.uploadService.getFileData(this.submissionId,this.sectionId,this.fileId).pipe((0,S.p)(F=>(0,y.EA)(F))).subscribe(F=>{this.fileData=F}))}ngOnInit(){this.formId=this.formService.getUniqueId(this.fileId),this.processingSaveStatus$=this.submissionService.getSubmissionSaveProcessingStatus(this.submissionId),this.pathCombiner=new u.S("sections",this.sectionId),this.loadFormMetadata()}confirmDelete(b){this.modalService.open(b).result.then(F=>{"ok"===F&&(this.processingDelete$.next(!0),this.deleteFile())})}getBitstream(){return Object.assign(new P._,{uuid:this.fileData.uuid})}editBitstreamData(){const F=this.modalService.open(Ot,{size:"xl",backdrop:"static"});F.componentInstance.availableAccessConditionOptions=this.availableAccessConditionOptions,F.componentInstance.collectionId=this.collectionId,F.componentInstance.collectionPolicyType=this.collectionPolicyType,F.componentInstance.configMetadataForm=this.configMetadataForm,F.componentInstance.fileData=this.fileData,F.componentInstance.fileId=this.fileId,F.componentInstance.fileIndex=this.fileIndex,F.componentInstance.formId=this.formId,F.componentInstance.sectionId=this.sectionId,F.componentInstance.formMetadata=this.formMetadata,F.componentInstance.pathCombiner=this.pathCombiner,F.componentInstance.submissionId=this.submissionId,F.componentInstance.isPrimary=this.isPrimary}togglePrimaryBitstream(b){this.uploadService.updatePrimaryBitstreamOperation(this.pathCombiner.getPath("primary"),this.isPrimary,b.target.checked,this.fileId),this.submissionService.dispatchSaveSection(this.submissionId,this.sectionId)}ngOnDestroy(){this.unsubscribeAll()}unsubscribeAll(){this.subscriptions.filter(b=>(0,y.a4)(b)).forEach(b=>b.unsubscribe())}loadFormMetadata(){this.configMetadataForm.rows.forEach(b=>{b.fields.forEach(F=>{F.selectableMetadata.forEach(O=>{this.formMetadata.push(O.metadata)})})})}deleteFile(){this.operationsBuilder.remove(this.pathCombiner.getPath(["files",this.fileIndex])),this.isPrimary&&this.operationsBuilder.remove(this.pathCombiner.getPath("primary")),this.subscriptions.push(this.operationsService.jsonPatchByResourceID(this.submissionService.getSubmissionObjectLinkName(),this.submissionId,this.pathCombiner.rootElement,this.pathCombiner.subRootElement).subscribe(()=>{this.isPrimary&&this.uploadService.updateFilePrimaryBitstream(this.submissionId,this.sectionId,null),this.uploadService.removeUploadedFile(this.submissionId,this.sectionId,this.fileId),this.processingDelete$.next(!1)}))}static#t=this.\u0275fac=function(F){return new(F||K)(a.rXU(m.u),a.rXU(vt.Bq),a.rXU(C.C),a.rXU(L.U),a.rXU(g.E),a.rXU(h.i))};static#e=this.\u0275cmp=a.VBU({type:K,selectors:[["ds-base-submission-upload-section-file"]],viewQuery:function(F,O){if(1&F&&a.GBs(Ot,5),2&F){let Y;a.mGM(Y=a.lsd())&&(O.fileEditComp=Y.first)}},inputs:{isPrimary:"isPrimary",availableAccessConditionOptions:"availableAccessConditionOptions",collectionId:"collectionId",collectionPolicyType:"collectionPolicyType",configMetadataForm:"configMetadataForm",fileId:"fileId",fileIndex:"fileIndex",fileName:"fileName",sectionId:"sectionId",submissionId:"submissionId"},standalone:!0,features:[a.OA$,a.aNF],decls:3,vars:1,consts:[["content",""],[4,"ngIf"],[1,"row"],[1,"col-md-2","d-flex","justify-content-center","align-items-center"],[1,"custom-control","custom-switch"],["type","checkbox",1,"custom-control-input",3,"change","id","disabled","checked"],[1,"custom-control-label",3,"for"],["class","sr-only",4,"ngIf"],[1,"col-md-10"],[1,"float-left","w-75"],[1,"text-muted"],[1,"float-right","w-15"],[3,"cssClasses","isBlank","bitstream","enableRequestACopy"],["aria-hidden","true",1,"fa","fa-download","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"click","title"],[1,"fa","fa-edit","fa-2x","text-normal"],[1,"btn","btn-link-focus",3,"click","title","disabled"],["class","fas fa-circle-notch fa-spin fa-2x text-danger",4,"ngIf"],["class","fa fa-trash fa-2x text-danger",4,"ngIf"],[1,"clearfix"],[3,"fileData"],[1,"sr-only"],[1,"fas","fa-circle-notch","fa-spin","fa-2x","text-danger"],[1,"fa","fa-trash","fa-2x","text-danger"],[1,"modal-header"],[1,"modal-title","text-danger"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-danger",3,"click"]],template:function(F,O){1&F&&a.DNE(0,mt,34,40,"ng-container",1)(1,Gt,18,12,"ng-template",null,0,a.C5r),2&F&&a.Y8G("ngIf",O.fileData)},dependencies:[D.h,D.D9,Et.h,p.bT,p.Jj,M.z,c.s]})}return K})()},53962:(W,B,o)=>{"use strict";o.d(B,{h:()=>G});var p=o(54460),D=o(69685),v=o(84562),S=o(72683),d=o(53107);let u=(()=>{class E{transform(U,X){if((0,S.a4)(U)){const k=X&&X.length>0?parseInt(X[0],10):10;return U.length>k?U.substring(0,k)+"...":U}return U}static#t=this.\u0275fac=function(X){return new(X||E)};static#e=this.\u0275pipe=d.EJ8({name:"dsTruncate",type:E,pure:!0,standalone:!0})}return E})();var C=o(30664);const P=()=>["150"],L=E=>({format:E});function y(E,j){if(1&E&&(d.qex(0),d.j41(1,"h5"),d.EFF(2),d.k0s(),d.bVm()),2&E){const U=d.XpG().$implicit;d.R7$(2),d.SpI(" ",U.value," ")}}function M(E,j){if(1&E&&(d.j41(0,"h5")(1,"span",5),d.EFF(2),d.nI1(3,"translate"),d.k0s()()),2&E){const U=d.XpG(4);d.R7$(2),d.Lme("",d.bMT(3,2,"submission.sections.upload.no-entry")," ",U.fileTitleKey,"")}}function m(E,j){if(1&E&&(d.qex(0),d.DNE(1,M,4,4,"h5",0),d.bVm()),2&E){const U=d.XpG().$implicit,X=d.XpG(2);d.R7$(),d.Y8G("ngIf",0===X.metadata[X.fileTitleKey].indexOf(U))}}function c(E,j){if(1&E&&(d.qex(0),d.DNE(1,y,3,1,"ng-container",0)(2,m,2,1,"ng-container",0),d.nrm(3,"span",2),d.bVm()),2&E){const U=j.$implicit;d.R7$(),d.Y8G("ngIf",""!==U.value),d.R7$(),d.Y8G("ngIf",""===U.value)}}function g(E,j){if(1&E&&(d.qex(0),d.EFF(1),d.nI1(2,"dsTruncate"),d.bVm()),2&E){const U=d.XpG().$implicit;d.R7$(),d.SpI(" ",d.i5U(2,1,U.value,d.lJ4(4,P))," ")}}function h(E,j){if(1&E&&(d.j41(0,"span",5),d.EFF(1),d.nI1(2,"translate"),d.k0s()),2&E){const U=d.XpG(4);d.R7$(),d.Lme("",d.bMT(2,2,"submission.sections.upload.no-entry")," ",U.fileDescrKey,"")}}function t(E,j){if(1&E&&(d.qex(0),d.DNE(1,h,3,4,"span",6),d.bVm()),2&E){const U=d.XpG().$implicit,X=d.XpG(2);d.R7$(),d.Y8G("ngIf",0===X.metadata[X.fileDescrKey].indexOf(U))}}function T(E,j){if(1&E&&(d.qex(0),d.DNE(1,g,3,5,"ng-container",0)(2,t,2,1,"ng-container",0),d.nrm(3,"span",2),d.bVm()),2&E){const U=j.$implicit;d.R7$(),d.Y8G("ngIf",""!==U.value),d.R7$(),d.Y8G("ngIf",""===U.value)}}function x(E,j){if(1&E&&(d.qex(0),d.DNE(1,c,4,2,"ng-container",4)(2,T,4,2,"ng-container",4),d.bVm()),2&E){const U=d.XpG();d.R7$(),d.Y8G("ngForOf",U.getAllMetadataValue(U.fileTitleKey)),d.R7$(),d.Y8G("ngForOf",U.getAllMetadataValue(U.fileDescrKey))}}function I(E,j){if(1&E&&(d.j41(0,"div",7),d.EFF(1),d.nI1(2,"translate"),d.k0s()),2&E){const U=d.XpG();d.R7$(),d.SpI(" ",d.i5U(2,1,"admin.registries.bitstream-formats.edit.head",d.eq3(4,L,U.fileFormat))," ")}}function N(E,j){if(1&E&&(d.j41(0,"div",7),d.EFF(1),d.k0s()),2&E){const U=d.XpG();d.R7$(),d.Lme(" Checksum ",U.fileCheckSum.checkSumAlgorithm,": ",U.fileCheckSum.value," ")}}let G=(()=>{class E{constructor(){this.metadata=Object.create({}),this.fileTitleKey="Title",this.fileDescrKey="Description"}ngOnInit(){(0,S.hj)(this.fileData.metadata)&&(this.metadata[this.fileTitleKey]=v.O.all(this.fileData.metadata,"dc.title"),this.metadata[this.fileDescrKey]=v.O.all(this.fileData.metadata,"dc.description")),this.fileCheckSum=this.fileData.checkSum,this.fileFormat=this.fileData.format.shortDescription}getAllMetadataValue(U){return v.O.all(this.metadata,U)}static#t=this.\u0275fac=function(X){return new(X||E)};static#e=this.\u0275cmp=d.VBU({type:E,selectors:[["ds-submission-section-upload-file-view"]],inputs:{fileData:"fileData"},standalone:!0,features:[d.aNF],decls:6,vars:4,consts:[[4,"ngIf"],["class","mt-1",4,"ngIf"],[1,"clearfix"],[3,"accessConditions"],[4,"ngFor","ngForOf"],[1,"text-muted"],["class","text-muted",4,"ngIf"],[1,"mt-1"]],template:function(X,k){1&X&&(d.j41(0,"div"),d.DNE(1,x,3,2,"ng-container",0)(2,I,3,6,"div",1)(3,N,2,2,"div",1),d.nrm(4,"span",2)(5,"ds-submission-section-upload-access-conditions",3),d.k0s()),2&X&&(d.R7$(),d.Y8G("ngIf",k.metadata),d.R7$(),d.Y8G("ngIf",k.fileFormat),d.R7$(),d.Y8G("ngIf",k.fileCheckSum),d.R7$(2),d.Y8G("accessConditions",k.fileData.accessConditions))},dependencies:[C._,D.h,D.D9,u,p.bT,p.Sq],encapsulation:2})}return E})()},47346:(W,B,o)=>{"use strict";o.d(B,{i:()=>y});var p=o(47947),D=o(66645),v=o(41483),S=o(51142),d=o(72683),u=o(45100),C=o(80451),P=o(53107),L=o(73958);let y=(()=>{class M{constructor(c,g){this.store=c,this.operationsBuilder=g}updatePrimaryBitstreamOperation(c,g,h,t){if(null===g&&h)this.operationsBuilder.add(c,t,!1,!0);else if(g!==h){if(h)return void this.operationsBuilder.replace(c,t,!0);this.operationsBuilder.remove(c)}}getUploadedFilesData(c,g){return this.store.select((0,C.on)(c,g)).pipe((0,p.T)(h=>h),(0,D.F)())}getUploadedFileList(c,g){return this.store.select((0,C.Uh)(c,g)).pipe((0,p.T)(h=>h),(0,D.F)())}getFileData(c,g,h){return this.store.select((0,C.Uh)(c,g)).pipe((0,v.p)(t=>!(0,d.b0)(t)),(0,p.T)(t=>{let T;return Object.keys(t).filter(x=>t[x].uuid===h).forEach(x=>T=t[x]),T}),(0,D.F)())}getDefaultPolicies(c,g,h){return this.store.select((0,C.hi)(c,g,h)).pipe((0,p.T)(t=>t),(0,D.F)())}addUploadedFile(c,g,h,t){this.store.dispatch(new u.Bo(c,g,h,t))}updateFilePrimaryBitstream(c,g,h){this.store.dispatch(new u.w7(c,g,h))}updateFileData(c,g,h,t){this.store.dispatch(new u.nt(c,g,h,t))}removeUploadedFile(c,g,h){this.store.dispatch(new u.IE(c,g,h))}static#t=this.\u0275fac=function(g){return new(g||M)(P.KVO(L.il),P.KVO(S.C))};static#e=this.\u0275prov=P.jDH({token:M,factory:M.\u0275fac,providedIn:"root"})}return M})()},46087:(W,B,o)=>{var p=o(2733);W.exports=function D(v){return v&&v.length?p(v):[]}},9048:(W,B,o)=>{var p={"./custom/app/submission/edit/submission-edit.component":[4523,4523]};function D(v){if(!o.o(p,v))return Promise.resolve().then(()=>{var u=new Error("Cannot find module '"+v+"'");throw u.code="MODULE_NOT_FOUND",u});var S=p[v],d=S[0];return o.e(S[1]).then(()=>o(d))}D.keys=()=>Object.keys(p),D.id=9048,W.exports=D},28767:(W,B,o)=>{var p={"./custom/app/submission/form/submission-upload-files/submission-upload-files.component.ts":[6449,6449]};function D(v){if(!o.o(p,v))return Promise.resolve().then(()=>{var u=new Error("Cannot find module '"+v+"'");throw u.code="MODULE_NOT_FOUND",u});var S=p[v],d=S[0];return o.e(S[1]).then(()=>o(d))}D.keys=()=>Object.keys(p),D.id=28767,W.exports=D},96682:(W,B,o)=>{var p={"./custom/app/submission/sections/upload/file/section-upload-file.component":[63095,3095]};function D(v){if(!o.o(p,v))return Promise.resolve().then(()=>{var u=new Error("Cannot find module '"+v+"'");throw u.code="MODULE_NOT_FOUND",u});var S=p[v],d=S[0];return o.e(S[1]).then(()=>o(d))}D.keys=()=>Object.keys(p),D.id=96682,W.exports=D}}]);