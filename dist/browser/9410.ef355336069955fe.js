"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9410,4752,9901],{59410:(X,j,o)=>{o.r(j),o.d(j,{ROUTES:()=>Rt});var k=o(32588),I=o(54460),R=o(2155),P=o(69685),$=o(96779),N=o(92600),y=o(86722),h=o(10936);class m{constructor(r,e=!1){this.id=r,this.hasTooltip=e}}class D{constructor(r,e){this.filters=e,this.id=r,this.key="admin.reports.commons.filters."+r,e.forEach(s=>{s.key=this.key+"."+s.id,s.hasTooltip&&(s.tooltipKey=s.key+".tooltip")})}}var t=o(53107);function B(i,r){if(1&i&&(t.j41(0,"div",9),t.nrm(1,"input",10),t.j41(2,"label",11),t.nI1(3,"translate"),t.EFF(4),t.nI1(5,"translate"),t.k0s()()),2&i){const e=r.$implicit;t.R7$(),t.Mz_("id","flt-",e.id,""),t.FS9("value",e.id),t.FS9("formControlName",e.id),t.R7$(),t.Mz_("for","flt-",e.id,""),t.FS9("title",t.bMT(3,8,e.tooltipKey)),t.R7$(2),t.JRh(t.bMT(5,10,e.key))}}function C(i,r){if(1&i&&(t.j41(0,"fieldset",0)(1,"legend"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.qex(4,7),t.DNE(5,B,6,12,"div",8),t.bVm(),t.k0s()),2&i){const e=r.$implicit,s=t.XpG();t.R7$(2),t.JRh(t.bMT(3,3,e.key)),t.R7$(2),t.Y8G("formGroup",s.filtersForm),t.R7$(),t.Y8G("ngForOf",e.filters)}}class F{static#t=this.FILTERS=[new D("property",[new m("is_item"),new m("is_withdrawn"),new m("is_not_withdrawn"),new m("is_discoverable"),new m("is_not_discoverable")]),new D("bitstream",[new m("has_multiple_originals"),new m("has_no_originals"),new m("has_one_original")]),new D("bitstream_mime",[new m("has_doc_original"),new m("has_image_original"),new m("has_unsupp_type"),new m("has_mixed_original"),new m("has_pdf_original"),new m("has_jpg_original"),new m("has_small_pdf"),new m("has_large_pdf"),new m("has_doc_without_text")]),new D("mime",[new m("has_only_supp_image_type"),new m("has_unsupp_image_type"),new m("has_only_supp_doc_type"),new m("has_unsupp_doc_type")]),new D("bundle",[new m("has_unsupported_bundle"),new m("has_small_thumbnail"),new m("has_original_without_thumbnail"),new m("has_invalid_thumbnail_name"),new m("has_non_generated_thumb"),new m("no_license"),new m("has_license_documentation")]),new D("permission",[new m("has_restricted_original",!0),new m("has_restricted_thumbnail",!0),new m("has_restricted_metadata",!0)])];static formGroup(r){const e={},s=F.FILTERS;for(let n=0;n<s.length;n++){const a=s[n];for(let f=0;f<a.filters.length;f++)e[a.filters[f].id]=new h.MJ(!1)}return r.group(e)}static getFilter(r){const e=F.FILTERS;for(let s=0;s<e.length;s++){const n=e[s];for(let a=0;a<n.filters.length;a++){const f=n.filters[a];if(f.id===r)return f}}}static getGroup(r){const e=F.FILTERS;for(let s=0;s<e.length;s++){const n=e[s];for(let a=0;a<n.filters.length;a++)if(n.filters[a].id===r)return n}}static toQueryString(r){let e="",s=!0;for(const n in r)r[n]&&(s?s=!1:e+="&",e+=`filters=${n}`);return e}allFilters(){return F.FILTERS}setAllFilters(r){const e={},s=F.FILTERS;for(let n=0;n<s.length;n++){const a=s[n];for(let f=0;f<a.filters.length;f++)e[a.filters[f].id]=r}this.filtersForm.setValue(e)}selectAll(){this.setAllFilters(!0)}deselectAll(){this.setAllFilters(!1)}static#e=this.\u0275fac=function(e){return new(e||F)};static#i=this.\u0275cmp=t.VBU({type:F,selectors:[["ds-filters"]],inputs:{filtersForm:"filtersForm"},standalone:!0,features:[t.aNF],decls:19,vars:7,consts:[[1,"row","row-cols-2"],[1,"col-12"],[1,"col-1"],["id","btnSelectAllFilters",1,"btn","btn-light","mt-1","col-4",3,"click"],[1,"col-2"],["id","btnDeselectAllFilters",1,"btn","btn-light","mt-1","col-4",3,"click"],["class","row row-cols-2",4,"ngFor","ngForOf"],[3,"formGroup"],["class","col-6",4,"ngFor","ngForOf"],[1,"col-6"],["type","checkbox",1,"form-check-input","col-1","align-baseline",3,"id","value","formControlName"],[1,"col-11","align-middle",3,"for","title"]],template:function(e,s){1&e&&(t.j41(0,"fieldset",0),t.qex(1),t.j41(2,"span",1),t.EFF(3,"\xa0"),t.k0s(),t.j41(4,"span",2),t.EFF(5,"\xa0"),t.k0s(),t.j41(6,"button",3),t.bIt("click",function(){return s.selectAll()}),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"span",4),t.EFF(10,"\xa0"),t.k0s(),t.j41(11,"button",5),t.bIt("click",function(){return s.deselectAll()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"span",2),t.EFF(15,"\xa0"),t.k0s(),t.j41(16,"span",1),t.EFF(17,"\xa0"),t.k0s(),t.bVm(),t.k0s(),t.DNE(18,C,6,5,"fieldset",6)),2&e&&(t.R7$(7),t.JRh(t.bMT(8,3,"admin.reports.commons.filters.select_all")),t.R7$(5),t.JRh(t.bMT(13,5,"admin.reports.commons.filters.deselect_all")),t.R7$(6),t.Y8G("ngForOf",s.allFilters()))},dependencies:[I.Sq,h.X1,h.Zm,h.BC,h.cb,h.j4,h.JD,P.h,P.D9]})}class b{constructor(){this.values={}}clear(){this.label="",this.handle="",this.communityLabel="",this.communityHandle="",this.nbTotalItems=0,this.values={},this.allFiltersValue=0}deserialize(r){this.clear(),this.label=r.label,this.handle=r.handle,this.communityLabel=r.community_label,this.communityHandle=r.community_handle,this.nbTotalItems=r.nb_total_items;const e=r.values;for(const s in e)e.hasOwnProperty(s)&&(this.values[s]=e[s]);this.allFiltersValue=r.all_filters_value}}class A{constructor(){this.collections=[],this.summary=new b}clear(){this.collections.splice(0,this.collections.length),this.summary.clear()}deserialize(r){this.clear(),this.summary.deserialize(r.summary);const s=r.collections;for(let n=0;n<s.length;n++){const a=s[n],f=new b;f.deserialize(a),this.collections.push(f)}}}const _=["acc"];function E(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.commons.filters")," ")}function l(i,r){if(1&i){const e=t.RV6();t.j41(0,"div",1)(1,"div",11),t.nrm(2,"span",12),t.j41(3,"button",13),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.nrm(6,"ds-filters",14),t.j41(7,"div",11),t.nrm(8,"span",12),t.j41(9,"button",13),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(10),t.nI1(11,"translate"),t.k0s()()()}if(2&i){const e=t.XpG();t.R7$(4),t.JRh(t.bMT(5,3,"admin.reports.button.show-collections")),t.R7$(2),t.Y8G("filtersForm",e.filtersFormGroup()),t.R7$(4),t.JRh(t.bMT(11,5,"admin.reports.button.show-collections"))}}function d(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.collections.collections-report")," ")}function g(i,r){if(1&i&&(t.j41(0,"th"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const e=r.$implicit,s=t.XpG(2);t.R7$(),t.JRh(t.bMT(2,1,"admin.reports.commons.filters."+s.getGroup(e.key)+"."+e.key))}}function T(i,r){if(1&i&&(t.j41(0,"th",19),t.EFF(1),t.k0s()),2&i){const e=r.$implicit;t.R7$(),t.JRh(e.value)}}function M(i,r){if(1&i&&(t.j41(0,"td",19),t.EFF(1),t.k0s()),2&i){const e=r.$implicit,s=t.XpG().$implicit;t.R7$(),t.JRh(s.values[e.key]||0)}}function G(i,r){if(1&i&&(t.j41(0,"tr")(1,"td")(2,"a",21),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"a",21),t.EFF(6),t.k0s()(),t.j41(7,"td",19),t.EFF(8),t.k0s(),t.j41(9,"td",19),t.EFF(10),t.k0s(),t.DNE(11,M,2,1,"td",20),t.nI1(12,"keyvalue"),t.k0s()),2&i){const e=r.$implicit,s=t.XpG(2);t.R7$(2),t.Mz_("href","/handle/",e.communityHandle,"",t.B4B),t.R7$(),t.JRh(e.communityLabel),t.R7$(2),t.Mz_("href","/handle/",e.handle,"",t.B4B),t.R7$(),t.JRh(e.label),t.R7$(2),t.JRh(e.nbTotalItems),t.R7$(2),t.JRh(e.allFiltersValue),t.R7$(),t.Y8G("ngForOf",t.bMT(12,9,s.results.summary.values))}}function x(i,r){if(1&i&&(t.j41(0,"table",15)(1,"thead")(2,"tr",16)(3,"th",17),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"th",17),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"th"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"th"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.DNE(15,g,3,3,"th",18),t.nI1(16,"keyvalue"),t.k0s(),t.j41(17,"tr",16)(18,"th",19),t.EFF(19),t.k0s(),t.j41(20,"th",19),t.EFF(21),t.k0s(),t.DNE(22,T,2,1,"th",20),t.nI1(23,"keyvalue"),t.k0s()(),t.j41(24,"tbody"),t.DNE(25,G,13,11,"tr",18),t.k0s()()),2&i){const e=t.XpG();t.R7$(4),t.JRh(t.bMT(5,9,"admin.reports.collections.community")),t.R7$(3),t.JRh(t.bMT(8,11,"admin.reports.collections.collection")),t.R7$(3),t.JRh(t.bMT(11,13,"admin.reports.collections.nb_items")),t.R7$(3),t.JRh(t.bMT(14,15,"admin.reports.collections.match_all_selected_filters")),t.R7$(2),t.Y8G("ngForOf",t.bMT(16,17,e.results.summary.values)),t.R7$(4),t.JRh(e.results.summary.nbTotalItems),t.R7$(2),t.JRh(e.results.summary.allFiltersValue),t.R7$(),t.Y8G("ngForOf",t.bMT(23,19,e.results.summary.values)),t.R7$(3),t.Y8G("ngForOf",e.results.collections)}}let L=(()=>{class i{constructor(e,s){this.formBuilder=e,this.restService=s,this.results=new A}ngOnInit(){this.queryForm=this.formBuilder.group({filters:F.formGroup(this.formBuilder)})}filtersFormGroup(){return this.queryForm.get("filters")}getGroup(e){return F.getGroup(e).id}submit(){this.getFilteredCollections().subscribe(e=>{this.results.deserialize(e.payload),this.accordionComponent.expand("collections")})}getFilteredCollections(){let e=this.toQueryString();return e.length>0&&(e=`?${e}`),this.restService.request($.D.GET,`${y.c.rest.ssl?"https":"http"}://${y.c.rest.host}:${y.c.rest.port}${y.c.rest.nameSpace}/api/contentreport/filteredcollections${e}`)}toQueryString(){return F.toQueryString(this.queryForm.value.filters)}static#t=this.\u0275fac=function(s){return new(s||i)(t.rXU(h.ok),t.rXU(N.Y))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["ds-report-filtered-collections"]],viewQuery:function(s,n){if(1&s&&t.GBs(_,5),2&s){let a;t.mGM(a=t.lsd())&&(n.accordionComponent=a.first)}},standalone:!0,features:[t.aNF],decls:15,vars:4,consts:[["acc","ngbAccordion"],[1,"container"],[1,"metadata-registry","row"],[1,"col-12"],["id","header",1,"border-bottom","pb-2"],["id","metadatadiv"],["activeIds","filters",3,"closeOthers"],["id","filters"],["ngbPanelTitle",""],["ngbPanelContent",""],["id","collections"],[1,"row"],[1,"col-3"],[1,"btn","btn-primary","mt-1","col-6",3,"click"],[3,"filtersForm"],["id","table",1,"table","table-striped"],[1,"header"],["rowspan","2"],[4,"ngFor","ngForOf"],[1,"num"],["class","num",4,"ngFor","ngForOf"],["rel","noopener noreferrer","target","_blank",3,"href"]],template:function(s,n){1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",5)(7,"ngb-accordion",6,0)(9,"ngb-panel",7),t.DNE(10,E,2,3,"ng-template",8)(11,l,12,7,"ng-template",9),t.k0s(),t.j41(12,"ngb-panel",10),t.DNE(13,d,2,3,"ng-template",8)(14,x,26,21,"ng-template",9),t.k0s()()()()()()),2&s&&(t.R7$(4),t.JRh(t.bMT(5,2,"admin.reports.collections.head")),t.R7$(3),t.Y8G("closeOthers",!0))},dependencies:[P.h,P.D9,R._f,R.W1,R.CT,R.sb,R.t3,F,I.lG,I.Sq],styles:[".num[_ngcontent-%COMP%]{text-align:center}"]})}return i})();var w=o(47947),J=o(8109),K=o(63710),V=o(29901),W=o(44752),S=o(12007),Q=o(72683);class Y{constructor(){this.items=[]}clear(){this.items.splice(0,this.items.length)}deserialize(r,e=0){this.clear(),this.itemCount=r.itemCount;const s=r.items;for(let n=0;n<s.length;n++){const a=s[n];a.index=this.items.length+e+1,this.items.push(a)}}}var H=o(51698);class u{constructor(){this.disabled=!1}static collection(r,e,s=!1){const n=new u;return n.id=r,n.name$=u.toObservable(e),n.disabled=s,n}static collectionLoc(r,e,s=!1){const n=new u;return n.id=r,n.name$=e,n.disabled=s,n}static item(r,e){const s=new u;return s.id=r,s.name$=u.toObservable(e),s}static itemLoc(r,e){const s=new u;return s.id=r,s.name$=e,s}static toObservable(r){return new H.c(e=>{e.next(r),e.complete()})}}class v{static of(r,e,s){const n=new v;return n.id=r,n.label=e,n.predicates=s,n}}let c=(()=>{class i{constructor(){this.field="*"}static#t=this.EXISTS="exists";static#e=this.DOES_NOT_EXIST="doesnt_exist";static#i=this.EQUALS="equals";static#s=this.DOES_NOT_EQUAL="not_equals";static#n=this.LIKE="like";static#r=this.NOT_LIKE="not_like";static#o=this.CONTAINS="contains";static#a=this.DOES_NOT_CONTAIN="doesnt_contain";static#l=this.MATCHES="matches";static#c=this.DOES_NOT_MATCH="doesnt_match";static of(e,s,n=""){const a=new i;return a.field=e,a.operator=s,a.value=n,a}toFormGroup(e){return e.group({field:new h.MJ(this.field),operator:new h.MJ(this.operator),value:new h.MJ(this.value)})}}return i})();const z=["acc"];function q(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.items.section.collectionSelector")," ")}function Z(i,r){if(1&i&&(t.j41(0,"option",20),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&i){const e=r.$implicit;t.Y8G("value",e.id)("disabled",e.disabled),t.R7$(),t.JRh(t.bMT(2,3,e.name$))}}function tt(i,r){if(1&i){const e=t.RV6();t.j41(0,"select",15),t.DNE(1,Z,3,5,"option",16),t.k0s(),t.j41(2,"div",17),t.nrm(3,"span",18),t.j41(4,"button",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(5),t.nI1(6,"translate"),t.k0s()()}if(2&i){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.collections),t.R7$(4),t.JRh(t.bMT(6,2,"admin.reports.items.run"))}}function et(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.items.section.metadataFieldQueries")," ")}function it(i,r){if(1&i&&(t.j41(0,"option",26),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i){const e=r.$implicit;t.Y8G("value",e.id)("selected",e.isDefault),t.R7$(),t.JRh(t.bMT(2,3,e.label))}}function st(i,r){if(1&i&&(t.j41(0,"option",39),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&i){const e=r.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(t.bMT(2,2,e.name$))}}function nt(i,r){if(1&i&&(t.j41(0,"option",39),t.EFF(1),t.nI1(2,"async"),t.nI1(3,"translate"),t.k0s()),2&i){const e=r.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(t.bMT(3,4,t.bMT(2,2,e.name$)))}}function rt(i,r){if(1&i){const e=t.RV6();t.j41(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"select",31),t.DNE(5,st,3,4,"option",32),t.k0s()(),t.j41(6,"div",33)(7,"select",34),t.DNE(8,nt,4,6,"option",32),t.k0s()(),t.j41(9,"div",35),t.nrm(10,"input",36),t.k0s(),t.j41(11,"div",33)(12,"button",37),t.bIt("click",function(){t.eBV(e);const n=t.XpG(2);return t.Njj(n.addQueryPredicate())}),t.EFF(13,"+"),t.k0s(),t.EFF(14," \xa0 "),t.j41(15,"button",38),t.bIt("click",function(){const n=t.eBV(e).index,a=t.XpG(2);return t.Njj(a.deleteQueryPredicate(n))}),t.EFF(16,"\u2013"),t.k0s()()()()()}if(2&i){const e=r.$implicit,s=t.XpG(2);t.R7$(),t.Y8G("formGroup",e),t.R7$(4),t.Y8G("ngForOf",s.metadataFieldsWithAny),t.R7$(3),t.Y8G("ngForOf",s.predicates),t.R7$(7),t.Y8G("disabled",s.deleteQueryPredicateDisabled())}}function ot(i,r){if(1&i){const e=t.RV6();t.j41(0,"fieldset",21)(1,"label"),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"select",22),t.bIt("change",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.setPresetQuery())}),t.DNE(5,it,3,5,"option",23),t.k0s()(),t.j41(6,"div",17),t.EFF(7,"\xa0"),t.k0s(),t.j41(8,"div",24),t.DNE(9,rt,17,4,"div",25),t.k0s(),t.j41(10,"div",17),t.nrm(11,"span",18),t.j41(12,"button",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(13),t.nI1(14,"translate"),t.k0s()()}if(2&i){const e=t.XpG();t.R7$(2),t.SpI(" ",t.bMT(3,4,"admin.reports.items.predefinedQueries")," "),t.R7$(3),t.Y8G("ngForOf",e.presetQueries),t.R7$(4),t.Y8G("ngForOf",e.queryPredicatesArray().controls),t.R7$(4),t.JRh(t.bMT(14,6,"admin.reports.items.run"))}}function at(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.items.section.limitPaginateQueries")," ")}function lt(i,r){if(1&i&&(t.j41(0,"option",26),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&i){const e=r.$implicit;t.FS9("value",e.id),t.Y8G("selected",e.isDefault),t.R7$(),t.JRh(t.bMT(2,3,e.name$))}}function ct(i,r){if(1&i){const e=t.RV6();t.j41(0,"div",40)(1,"label",41),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",42)(5,"select",43),t.DNE(6,lt,3,5,"option",23),t.k0s()()(),t.j41(7,"div",40)(8,"label",44),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.j41(11,"div",42),t.nrm(12,"input",45),t.k0s()(),t.j41(13,"div",17),t.nrm(14,"span",18),t.j41(15,"button",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(16),t.nI1(17,"translate"),t.k0s()()}if(2&i){const e=t.XpG();t.R7$(2),t.SpI("",t.bMT(3,4,"admin.reports.items.limit"),":"),t.R7$(4),t.Y8G("ngForOf",e.pageLimits),t.R7$(3),t.SpI("",t.bMT(10,6,"admin.reports.items.offset"),":"),t.R7$(7),t.JRh(t.bMT(17,8,"admin.reports.items.run"))}}function mt(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.commons.filters")," ")}function dt(i,r){if(1&i){const e=t.RV6();t.j41(0,"div",17),t.nrm(1,"span",18),t.j41(2,"button",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.nrm(5,"ds-filters",46),t.j41(6,"div",17),t.nrm(7,"span",18),t.j41(8,"button",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(9),t.nI1(10,"translate"),t.k0s()()}if(2&i){const e=t.XpG();t.R7$(3),t.JRh(t.bMT(4,3,"admin.reports.items.run")),t.R7$(2),t.Y8G("filtersForm",e.filtersFormGroup()),t.R7$(4),t.JRh(t.bMT(10,5,"admin.reports.items.run"))}}function pt(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.commons.additional-data")," ")}function _t(i,r){if(1&i&&(t.j41(0,"option",39),t.EFF(1),t.nI1(2,"async"),t.k0s()),2&i){const e=r.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(t.bMT(2,2,e.name$))}}function ut(i,r){if(1&i){const e=t.RV6();t.j41(0,"div",47)(1,"select",48),t.DNE(2,_t,3,4,"option",32),t.k0s()(),t.j41(3,"div",17),t.nrm(4,"span",18),t.j41(5,"button",19),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.submit())}),t.EFF(6),t.nI1(7,"translate"),t.k0s()()}if(2&i){const e=t.XpG();t.R7$(2),t.Y8G("ngForOf",e.metadataFields),t.R7$(4),t.JRh(t.bMT(7,2,"admin.reports.items.run"))}}function ht(i,r){1&i&&(t.EFF(0),t.nI1(1,"translate")),2&i&&t.SpI(" ",t.bMT(1,1,"admin.reports.collections.item-results")," ")}function ft(i,r){if(1&i&&(t.j41(0,"th"),t.EFF(1),t.k0s()),2&i){const e=r.$implicit;t.R7$(),t.JRh(e)}}function Ft(i,r){if(1&i&&(t.j41(0,"a",58),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.Mz_("href","/handle/",e.owningCollection.handle,"",t.B4B),t.R7$(),t.JRh(e.owningCollection.name)}}function gt(i,r){if(1&i&&(t.j41(0,"a",58),t.EFF(1),t.k0s()),2&i){const e=t.XpG().$implicit;t.Mz_("href","/handle/",e.handle,"",t.B4B),t.R7$(),t.JRh(e.handle)}}function Et(i,r){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=r.$implicit;t.R7$(),t.SpI(" ",e.value||""," ")}}function bt(i,r){if(1&i&&(t.j41(0,"td",55),t.DNE(1,Et,2,1,"span",51),t.k0s()),2&i){const e=r.$implicit,s=t.XpG().$implicit;t.R7$(),t.Y8G("ngForOf",s.metadata[e])}}function Tt(i,r){if(1&i&&(t.j41(0,"tr")(1,"td",55),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.DNE(6,Ft,2,3,"a",56),t.k0s(),t.j41(7,"td"),t.DNE(8,gt,2,3,"a",56),t.k0s(),t.j41(9,"td"),t.EFF(10),t.k0s(),t.DNE(11,bt,2,1,"td",57),t.k0s()),2&i){const e=r.$implicit,s=t.XpG(2);t.R7$(2),t.JRh(e.index),t.R7$(2),t.JRh(e.uuid),t.R7$(2),t.Y8G("ngIf",e.owningCollection),t.R7$(2),t.Y8G("ngIf",e.handle),t.R7$(2),t.JRh(e.name),t.R7$(),t.Y8G("ngForOf",s.queryForm.value.additionalFields)}}function vt(i,r){if(1&i){const e=t.RV6();t.j41(0,"table",49)(1,"thead")(2,"tr",50)(3,"th"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"th"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"th"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"th"),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"th"),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.DNE(18,ft,2,1,"th",51),t.k0s()(),t.j41(19,"tbody"),t.DNE(20,Tt,12,6,"tr",51),t.nI1(21,"async"),t.k0s()(),t.j41(22,"div"),t.EFF(23),t.nI1(24,"translate"),t.nI1(25,"translate"),t.k0s(),t.j41(26,"div")(27,"button",52),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.prevPage())}),t.EFF(28),t.nI1(29,"translate"),t.k0s(),t.j41(30,"button",53),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.nextPage())}),t.EFF(31),t.nI1(32,"translate"),t.k0s()(),t.nrm(33,"table",54)}if(2&i){const e=t.XpG();t.R7$(4),t.JRh(t.bMT(5,15,"admin.reports.items.number")),t.R7$(3),t.JRh(t.bMT(8,17,"admin.reports.items.id")),t.R7$(3),t.JRh(t.bMT(11,19,"admin.reports.items.collection")),t.R7$(3),t.JRh(t.bMT(14,21,"admin.reports.items.handle")),t.R7$(3),t.JRh(t.bMT(17,23,"admin.reports.items.title")),t.R7$(2),t.Y8G("ngForOf",e.queryForm.value.additionalFields),t.R7$(2),t.Y8G("ngForOf",t.bMT(21,25,e.results$)),t.R7$(3),t.LHq(" ",t.bMT(24,27,"admin.reports.commons.page")," ",e.currentPage+1," ",t.bMT(25,29,"admin.reports.commons.of")," ",e.pageCount()," "),t.R7$(4),t.Y8G("disabled",!e.canNavigatePrevious()),t.R7$(),t.JRh(t.bMT(29,31,"admin.reports.commons.previous-page")),t.R7$(2),t.Y8G("disabled",!e.canNavigateNext()),t.R7$(),t.JRh(t.bMT(32,33,"admin.reports.commons.next-page"))}}const Rt=[{path:"collections",resolve:{breadcrumb:k.S},data:{title:"admin.reports.collections.title",breadcrumbKey:"admin.reports.collections"},children:[{path:"",component:L}]},{path:"queries",resolve:{breadcrumb:k.S},data:{title:"admin.reports.items.title",breadcrumbKey:"admin.reports.items"},children:[{path:"",component:(()=>{class i{constructor(e,s,n,a,f,p,O){this.communityService=e,this.collectionService=s,this.metadataSchemaService=n,this.metadataFieldService=a,this.translateService=f,this.formBuilder=p,this.restService=O,this.currentPage=0,this.results=new Y}ngOnInit(){this.loadCollections(),this.loadPresetQueries(),this.loadMetadataFields(),this.loadPredicates(),this.loadPageLimits();const e=[(new c).toFormGroup(this.formBuilder)];this.queryForm=this.formBuilder.group({collections:this.formBuilder.control([""],[]),presetQuery:this.formBuilder.control("new",[]),queryPredicates:this.formBuilder.array(e),pageLimit:this.formBuilder.control("10",[]),filters:F.formGroup(this.formBuilder),additionalFields:this.formBuilder.control([],[])})}loadCollections(){this.collections=[];const e=this.translateService.stream("admin.reports.items.wholeRepo");this.collections.push(u.collectionLoc("",e)),this.communityService.findAll({elementsPerPage:1e4,currentPage:1}).pipe((0,S.Ar)()).subscribe(s=>{s.forEach(n=>{const a=u.collection(n.uuid,n.name,!0);this.collections.push(a),this.collectionService.findByParent(n.uuid,{elementsPerPage:1e4,currentPage:1}).pipe((0,S.Ar)()).subscribe(f=>{f.filter(p=>"Publication"===p.firstMetadataValue("dspace.entity.type")).forEach(p=>{const O=u.collection(p.uuid,"\u2013"+p.name);this.collections.push(O)})})})})}loadPresetQueries(){this.presetQueries=[v.of("new","admin.reports.items.preset.new",[]),v.of("q1","admin.reports.items.preset.hasNoTitle",[c.of("dc.title",c.DOES_NOT_EXIST)]),v.of("q2","admin.reports.items.preset.hasNoIdentifierUri",[c.of("dc.identifier.uri",c.DOES_NOT_EXIST)]),v.of("q3","admin.reports.items.preset.hasCompoundSubject",[c.of("dc.subject.*",c.LIKE,"%;%")]),v.of("q4","admin.reports.items.preset.hasCompoundAuthor",[c.of("dc.contributor.author",c.LIKE,"% and %")]),v.of("q5","admin.reports.items.preset.hasCompoundCreator",[c.of("dc.creator",c.LIKE,"% and %")]),v.of("q6","admin.reports.items.preset.hasUrlInDescription",[c.of("dc.description",c.MATCHES,"^.*(http://|https://|mailto:).*$")]),v.of("q7","admin.reports.items.preset.hasFullTextInProvenance",[c.of("dc.description.provenance",c.MATCHES,"^.*No. of bitstreams(.|\r|\n|\r\n)*.(PDF|pdf|DOC|doc|PPT|ppt|DOCX|docx|PPTX|pptx).*$")]),v.of("q8","admin.reports.items.preset.hasNonFullTextInProvenance",[c.of("dc.description.provenance",c.DOES_NOT_MATCH,"^.*No. of bitstreams(.|\r|\n|\r\n)*.(PDF|pdf|DOC|doc|PPT|ppt|DOCX|docx|PPTX|pptx).*$")]),v.of("q9","admin.reports.items.preset.hasEmptyMetadata",[c.of("*",c.MATCHES,"^s*$")]),v.of("q10","admin.reports.items.preset.hasUnbreakingDataInDescription",[c.of("dc.description.*",c.MATCHES,"^.*[^s]{50,}.*$")]),v.of("q12","admin.reports.items.preset.hasXmlEntityInMetadata",[c.of("*",c.MATCHES,"^.*&#.*$")]),v.of("q13","admin.reports.items.preset.hasNonAsciiCharInMetadata",[c.of("*",c.MATCHES,"^.*[^[:ascii:]].*$")])]}loadMetadataFields(){this.metadataFields=[],this.metadataFieldsWithAny=[];const e=this.translateService.stream("admin.reports.items.anyField");this.metadataFieldsWithAny.push(u.itemLoc("*",e)),this.metadataSchemaService.findAll({elementsPerPage:1e4,currentPage:1}).pipe((0,S.Ar)()).subscribe(s=>{s.forEach(n=>{this.metadataFieldService.findBySchema(n,{elementsPerPage:1e4,currentPage:1}).pipe((0,S.Ar)()).subscribe(a=>{a.forEach(f=>{let p=n.prefix+"."+f.toString(),O=u.item(p,p);this.metadataFields.push(O),this.metadataFieldsWithAny.push(O),(0,Q.Im)(f.qualifier)&&(p=n.prefix+"."+f.element+".*",O=u.item(p,p),this.metadataFieldsWithAny.push(O))})})})})}loadPredicates(){this.predicates=[u.item(c.EXISTS,"admin.reports.items.predicate.exists"),u.item(c.DOES_NOT_EXIST,"admin.reports.items.predicate.doesNotExist"),u.item(c.EQUALS,"admin.reports.items.predicate.equals"),u.item(c.DOES_NOT_EQUAL,"admin.reports.items.predicate.doesNotEqual"),u.item(c.LIKE,"admin.reports.items.predicate.like"),u.item(c.NOT_LIKE,"admin.reports.items.predicate.notLike"),u.item(c.CONTAINS,"admin.reports.items.predicate.contains"),u.item(c.DOES_NOT_CONTAIN,"admin.reports.items.predicate.doesNotContain"),u.item(c.MATCHES,"admin.reports.items.predicate.matches"),u.item(c.DOES_NOT_MATCH,"admin.reports.items.predicate.doesNotMatch")]}loadPageLimits(){this.pageLimits=[u.item("10","10"),u.item("25","25"),u.item("50","50"),u.item("100","100")]}queryPredicatesArray(){return this.queryForm.get("queryPredicates")}addQueryPredicate(e=(new c).toFormGroup(this.formBuilder)){this.queryPredicatesArray().push(e)}deleteQueryPredicateDisabled(){return this.queryPredicatesArray().length<2}deleteQueryPredicate(e,s=1){e>-1&&this.queryPredicatesArray().removeAt(e)}setPresetQuery(){const s=this.queryForm.controls.presetQuery.value,n=this.presetQueries.find(a=>a.id===s);void 0!==n&&(this.queryPredicatesArray().clear(),n.predicates.map(a=>a.toFormGroup(this.formBuilder)).forEach(a=>this.addQueryPredicate(a)),0===n.predicates.length&&this.addQueryPredicate((new c).toFormGroup(this.formBuilder)))}filtersFormGroup(){return this.queryForm.get("filters")}pageSize(){return this.queryForm.value.pageLimit}canNavigatePrevious(){return this.currentPage>0}prevPage(){this.canNavigatePrevious()&&(this.currentPage--,this.resubmit())}pageCount(){return Math.ceil((this.results.itemCount||0)/this.pageSize())}canNavigateNext(){return this.currentPage+1<this.pageCount()}nextPage(){this.canNavigateNext()&&(this.currentPage++,this.resubmit())}submit(){this.accordionComponent.expand("itemResults"),this.currentPage=0,this.resubmit()}resubmit(){this.results$=this.getFilteredItems().pipe((0,w.T)(e=>{const s=this.currentPage*this.pageSize();return this.results.deserialize(e.payload,s),this.results.items}))}getFilteredItems(){let e=this.toQueryString();return e.length>0&&(e=`?${e}`),this.restService.request($.D.GET,`${y.c.rest.ssl?"https":"http"}://${y.c.rest.host}:${y.c.rest.port}${y.c.rest.nameSpace}/api/contentreport/filtereditems${e}`)}toQueryString(){let e=`pageNumber=${this.currentPage}&pageLimit=${this.pageSize()}`;const s=this.queryForm.value.collections;for(let p=0;p<s.length;p++)e+=`&collections=${s[p]}`;const n=this.queryForm.value.queryPredicates;for(let p=0;p<n.length;p++){const U=n[p].value;e+=`&queryPredicates=${n[p].field}:${n[p].operator}`,U&&(e+=`:${U}`)}const a=F.toQueryString(this.queryForm.value.filters);a.length>0&&(e+=`&${a}`);const f=this.queryForm.value.additionalFields;for(let p=0;p<f.length;p++)e+=`&additionalFields=${f[p]}`;return e}static#t=this.\u0275fac=function(s){return new(s||i)(t.rXU(K.CommunityDataService),t.rXU(J.CollectionDataService),t.rXU(W.MetadataSchemaDataService),t.rXU(V.MetadataFieldDataService),t.rXU(P.c$),t.rXU(h.ok),t.rXU(N.Y))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["ds-report-filtered-items"]],viewQuery:function(s,n){if(1&s&&t.GBs(z,5),2&s){let a;t.mGM(a=t.lsd())&&(n.accordionComponent=a.first)}},standalone:!0,features:[t.aNF],decls:27,vars:5,consts:[["acc","ngbAccordion"],[1,"container"],[1,"metadata-registry","row"],[1,"col-12"],["id","header",1,"border-bottom","pb-2"],["id","querydiv",3,"formGroup"],["activeIds","collectionSelector",3,"closeOthers"],["id","collectionSelector"],["ngbPanelTitle",""],["ngbPanelContent",""],["id","metadataFieldQueries"],["id","limitPaginateQueries"],["id","filters"],["id","additionalData"],["id","itemResults"],["id","collSel","name","collSel","multiple","multiple","size","10","formControlName","collections",1,"form-control"],[3,"value","disabled",4,"ngFor","ngForOf"],[1,"row"],[1,"col-3"],[1,"btn","btn-primary","mt-1","col-6",3,"click"],[3,"value","disabled"],["id","predefqueries",1,"form-group"],["id","predefselect","formControlName","presetQuery",1,"form-control",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["id","queries"],["class","metadata",4,"ngFor","ngForOf"],[3,"value","selected"],[1,"metadata"],[1,"form-group",3,"formGroup"],[1,"form-row"],[1,"col-4"],["formControlName","field",1,"form-control"],[3,"value",4,"ngFor","ngForOf"],[1,"col-auto"],["formControlName","operator",1,"form-control"],[1,"col"],["formControlName","value",1,"form-control"],[1,"btn","btn-light",3,"click"],[1,"btn","btn-light",3,"click","disabled"],[3,"value"],[1,"row","align-items-center"],["for","limit",1,"col-sm-2","col-form-label"],[1,"col-6"],["id","limit","name","limit","formControlName","pageLimit",1,"form-control","col-6"],["for","offset",1,"col-sm-2","col-form-label"],["id","offset","name","offset","value","0",1,"form-control","col-6"],[3,"filtersForm"],["id","show-fields"],["name","show_fields","multiple","multiple","size","8","formControlName","additionalFields",1,"form-control"],["id","table",1,"table","table-striped"],[1,"header"],[4,"ngFor","ngForOf"],["id","prev",1,"btn","btn-light",3,"click","disabled"],["id","next",1,"btn","btn-light",3,"click","disabled"],["id","itemtable",1,"sortable"],[1,"num"],["rel","noopener noreferrer","target","_blank",3,"href",4,"ngIf"],["class","num",4,"ngFor","ngForOf"],["rel","noopener noreferrer","target","_blank",3,"href"]],template:function(s,n){1&s&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1",4),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",5)(7,"ngb-accordion",6,0)(9,"ngb-panel",7),t.DNE(10,q,2,3,"ng-template",8)(11,tt,7,4,"ng-template",9),t.k0s(),t.j41(12,"ngb-panel",10),t.DNE(13,et,2,3,"ng-template",8)(14,ot,15,8,"ng-template",9),t.k0s(),t.j41(15,"ngb-panel",11),t.DNE(16,at,2,3,"ng-template",8)(17,ct,18,10,"ng-template",9),t.k0s(),t.j41(18,"ngb-panel",12),t.DNE(19,mt,2,3,"ng-template",8)(20,dt,11,7,"ng-template",9),t.k0s(),t.j41(21,"ngb-panel",13),t.DNE(22,pt,2,3,"ng-template",8)(23,ut,8,4,"ng-template",9),t.k0s(),t.j41(24,"ngb-panel",14),t.DNE(25,ht,2,3,"ng-template",8)(26,vt,34,35,"ng-template",9),t.k0s()()()()()()),2&s&&(t.R7$(4),t.JRh(t.bMT(5,3,"admin.reports.items.head")),t.R7$(2),t.Y8G("formGroup",n.queryForm),t.R7$(),t.Y8G("closeOthers",!0))},dependencies:[h.X1,h.xH,h.y7,h.me,h.wz,h.W0,h.BC,h.cb,h.j4,h.JD,R._f,R.W1,R.CT,R.sb,R.t3,P.h,P.D9,I.Jj,I.bT,I.Sq,F],styles:[".num[_ngcontent-%COMP%]{text-align:center}"]})}return i})()}]}]},29901:(X,j,o)=>{o.r(j),o.d(j,{MetadataFieldDataService:()=>A});var k=o(37610),I=o(72683),R=o(79224),P=o(45122),$=o(99120),N=o(25718),y=o(25744),h=o(45926),m=o(83951),D=o(2887),t=o(24265),B=o(12350),C=o(36705),F=o(9843),b=o(53107);let A=(()=>{class _ extends D.W{constructor(l,d,g,T,M){super("metadatafields",l,d,g,T),this.requestService=l,this.rdbService=d,this.objectCache=g,this.halService=T,this.notificationsService=M,this.searchBySchemaLinkPath="bySchema",this.searchByFieldNameLinkPath="byFieldName",this.createData=new h.V(this.linkPath,l,d,g,T,M,this.responseMsToLive),this.searchData=new B.X(this.linkPath,l,d,g,T,this.responseMsToLive),this.putData=new t.W(this.linkPath,l,d,g,T,this.responseMsToLive),this.deleteData=new m.I(this.linkPath,l,d,g,T,M,this.responseMsToLive,this.constructIdEndpoint)}findBySchema(l,d={},g=!0,T=!0,...M){const G=Object.assign(new C._,d,{searchParams:[new $.x("schema",l.prefix)]});return this.searchBy(this.searchBySchemaLinkPath,G,g,T,...M)}searchByFieldNameParams(l,d,g,T,M,G={},x=!0,L=!0,...w){const J=Object.assign(new C._,G,{searchParams:[new $.x("schema",(0,I.a4)(l)?l:""),new $.x("element",(0,I.a4)(d)?d:""),new $.x("qualifier",(0,I.a4)(g)?g:""),new $.x("query",(0,I.a4)(T)?T:""),new $.x("exactName",(0,I.a4)(M)?M:"")]});return this.searchBy(this.searchByFieldNameLinkPath,J,x,L,...w)}findByExactFieldName(l){return this.searchByFieldNameParams(null,null,null,null,l,null)}clearRequests(){this.getBrowseEndpoint().pipe((0,k.s)(1)).subscribe(l=>{this.requestService.setStaleByHrefSubstring(l)})}delete(l,d){return this.deleteData.delete(l,d)}deleteByHref(l,d){return this.deleteData.deleteByHref(l,d)}put(l){return this.putData.put(l)}create(l,...d){return this.createData.create(l,...d)}searchBy(l,d,g,T,...M){return this.searchData.searchBy(l,d,g,T,...M)}static#t=this.\u0275fac=function(d){return new(d||_)(b.KVO(F.B),b.KVO(P.o),b.KVO(N.$),b.KVO(y.Y),b.KVO(R.I))};static#e=this.\u0275prov=b.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},44752:(X,j,o)=>{o.r(j),o.d(j,{MetadataSchemaDataService:()=>F});var k=o(82040),I=o(72683),R=o(79224),P=o(45122),$=o(25718),N=o(25744),y=o(45926),h=o(83951),m=o(94937),D=o(2887),t=o(24265),B=o(9843),C=o(53107);let F=(()=>{class b extends D.W{constructor(_,E,l,d,g){super("metadataschemas",_,E,l,d),this.requestService=_,this.rdbService=E,this.objectCache=l,this.halService=d,this.notificationsService=g,this.createData=new y.V(this.linkPath,_,E,l,d,g,this.responseMsToLive),this.putData=new t.W(this.linkPath,_,E,l,d,this.responseMsToLive),this.deleteData=new h.I(this.linkPath,_,E,l,d,g,this.responseMsToLive,this.constructIdEndpoint),this.findAllData=new m.H(this.linkPath,_,E,l,d,this.responseMsToLive)}createOrUpdateMetadataSchema(_){return(0,I.a4)(_.id)?this.putData.put(_):this.createData.create(_)}clearRequests(){return this.getBrowseEndpoint().pipe((0,k.M)(_=>this.requestService.removeByHrefSubstring(_)))}findAll(_,E,l,...d){return this.findAllData.findAll(_,E,l,...d)}delete(_,E){return this.deleteData.delete(_,E)}deleteByHref(_,E){return this.deleteData.deleteByHref(_,E)}static#t=this.\u0275fac=function(E){return new(E||b)(C.KVO(B.B),C.KVO(P.o),C.KVO($.$),C.KVO(N.Y),C.KVO(R.I))};static#e=this.\u0275prov=C.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})()}}]);