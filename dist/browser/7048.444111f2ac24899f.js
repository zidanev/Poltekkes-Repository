"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[7048],{7048:(J,g,r)=>{r.r(g),r.d(g,{ROUTES:()=>z});var M=r(53527),f=r(54460),l=r(10936),u=r(2155),h=r(69685),y=r(95793),b=r(61299),F=r(71217),v=r(47947),S=r(41483),C=r(9843),I=r(32185),T=r(12007),w=r(72683),A=r(79224),o=r(31635),c=r(47817),D=r(52727),R=r(98573),j=r(2494),k=r(50946);let m=class{static#e=this.type=k.B};(0,o.Cg)([j.aK,c.autoserialize,(0,o.Sn)("design:type",R.v)],m.prototype,"type",void 0),(0,o.Cg)([c.autoserialize,(0,o.Sn)("design:type",String)],m.prototype,"alertId",void 0),(0,o.Cg)([c.autoserialize,(0,o.Sn)("design:type",String)],m.prototype,"message",void 0),(0,o.Cg)([c.autoserialize,(0,o.Sn)("design:type",String)],m.prototype,"countdownTo",void 0),(0,o.Cg)([c.autoserialize,(0,o.Sn)("design:type",Boolean)],m.prototype,"active",void 0),(0,o.Cg)([c.deserialize,(0,o.Sn)("design:type",Object)],m.prototype,"_links",void 0),m=(0,o.Cg)([D.gV],m);var e=r(53107),_=r(95968);const $=i=>({days:i}),W=i=>({hours:i}),G=i=>({minutes:i});function E(i,d){1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"system-wide-alert.form.error.message")," "))}function Y(i,d){if(1&i&&(e.j41(0,"div",23),e.DNE(1,E,3,3,"span",15),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.formMessage.errors)}}function X(i,d){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",8)(2,"div",24)(3,"div",25)(4,"input",26,0),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.date,n)||(a.date=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.updatePreviewTime())}),e.k0s(),e.j41(6,"button",27),e.nI1(7,"translate"),e.bIt("click",function(){e.eBV(t);const n=e.sdS(5);return e.Njj(n.toggle())}),e.k0s()()(),e.j41(8,"div",28)(9,"div",25)(10,"ngb-timepicker",29),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.time,n)||(a.time=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.updatePreviewTime())}),e.k0s()()(),e.j41(11,"div",30)(12,"div",25)(13,"ngb-timepicker",29),e.mxI("ngModelChange",function(n){e.eBV(t);const a=e.XpG();return e.DH7(a.time,n)||(a.time=n),e.Njj(n)}),e.bIt("ngModelChange",function(){e.eBV(t);const n=e.XpG();return e.Njj(n.updatePreviewTime())}),e.k0s()()()()()}if(2&i){const t=e.XpG();e.R7$(4),e.R50("ngModel",t.date),e.Y8G("minDate",t.minDate),e.R7$(2),e.BMQ("aria-label",e.bMT(7,5,"system-wide-alert-form.select-date-by-calendar")),e.R7$(4),e.R50("ngModel",t.time),e.R7$(3),e.R50("ngModel",t.time)}}function N(i,d){1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"system-wide-alert-banner.countdown.prefix")," "))}function U(i,d){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.i5U(2,1,"system-wide-alert-banner.countdown.days",e.eq3(4,$,t.previewDays))," ")}}function x(i,d){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.i5U(2,1,"system-wide-alert-banner.countdown.hours",e.eq3(4,W,t.previewHours))," ")}}function V(i,d){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",e.i5U(2,1,"system-wide-alert-banner.countdown.minutes",e.eq3(4,G,t.previewMinutes))," ")}}function B(i,d){if(1&i&&(e.j41(0,"div")(1,"div",8)(2,"div",6)(3,"label"),e.EFF(4),e.nI1(5,"translate"),e.k0s()()(),e.j41(6,"div",31)(7,"span",32),e.DNE(8,N,3,3,"span",15)(9,U,3,6,"span",15)(10,x,3,6,"span",15)(11,V,3,6,"span",15),e.k0s(),e.nrm(12,"span",33),e.k0s()()),2&i){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,6,"system-wide-alert.form.label.preview")),e.R7$(4),e.Y8G("ngIf",t.previewDays>0||t.previewHours>0||t.previewMinutes>0),e.R7$(),e.Y8G("ngIf",t.previewDays>0),e.R7$(),e.Y8G("ngIf",t.previewDays>0||t.previewHours>0),e.R7$(),e.Y8G("ngIf",t.previewDays>0||t.previewHours>0||t.previewMinutes>0),e.R7$(),e.Y8G("innerHTML",t.formMessage.value,e.npT)}}const z=[{path:"",canActivate:[M.Y],component:(()=>{class i{constructor(t,s,n,a,p){this.systemWideAlertDataService=t,this.notificationsService=s,this.router=n,this.requestService=a,this.translateService=p,this.counterEnabled$=new F.t(!1)}ngOnInit(){this.systemWideAlert$=this.systemWideAlertDataService.findAll().pipe((0,T.qD)(),(0,v.T)(s=>{if(s.hasSucceeded)return s.payload;this.notificationsService.error("system-wide-alert-form.retrieval.error")}),(0,v.T)(s=>s.page),(0,S.p)(s=>(0,w.hj)(s)),(0,v.T)(s=>s[0])),this.createForm();const t=new Date;this.minDate={year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},this.systemWideAlert$.subscribe(s=>{this.currentAlert=s,this.initFormValues(s)})}createForm(){this.alertForm=(new l.ze).group({formMessage:new l.hs("",{validators:[l.k0.required]}),formActive:new l.hs(!1)}),this.setDateTime(new Date)}initFormValues(t){this.formMessage.patchValue(t.message),this.formActive.patchValue(t.active);const s=(0,y.zonedTimeToUtc)(t.countdownTo,"UTC");s.getTime()-(new Date).getTime()>0&&(this.counterEnabled$.next(!0),this.setDateTime(s))}setActive(t){this.formActive.patchValue(t),this.save(!1)}setCounterEnabled(t){this.counterEnabled$.next(t),t?this.updatePreviewTime():(this.previewMinutes=0,this.previewHours=0,this.previewDays=0)}setDateTime(t){this.time={hour:t.getHours(),minute:t.getMinutes()},this.date={year:t.getFullYear(),month:t.getMonth()+1,day:t.getDate()},this.updatePreviewTime()}updatePreviewTime(){const s=new Date(this.date.year,this.date.month-1,this.date.day,this.time.hour,this.time.minute).getTime()-(new Date).getTime();this.allocateTimeUnits(s)}allocateTimeUnits(t){this.previewMinutes=Math.floor(t/6e4%60),this.previewHours=Math.floor(t/36e5%24),this.previewDays=Math.floor(t/864e5)}get formMessage(){return this.alertForm.get("formMessage")}get formActive(){return this.alertForm.get("formActive")}save(t=!0){const s=new m;if(s.message=this.formMessage.value,s.active=this.formActive.value,this.counterEnabled$.getValue()){const n=new Date(this.date.year,this.date.month-1,this.date.day,this.time.hour,this.time.minute);s.countdownTo=(0,y.utcToZonedTime)(n,"UTC").toUTCString()}else s.countdownTo=null;if(this.alertForm.valid)if((0,w.a4)(this.currentAlert)){const n=Object.assign(new m,this.currentAlert,s);this.handleResponse(this.systemWideAlertDataService.put(n),"system-wide-alert.form.update",t)}else this.handleResponse(this.systemWideAlertDataService.create(s),"system-wide-alert.form.create",t)}handleResponse(t,s,n){t.pipe((0,T.qD)()).subscribe(a=>{a.hasSucceeded?(this.notificationsService.success(this.translateService.get(`${s}.success`)),this.requestService.setStaleByHrefSubstring("systemwidealerts"),n&&this.back()):this.notificationsService.error(this.translateService.get(`${s}.error`,a.errorMessage))})}back(){this.router.navigate(["/home"])}static#e=this.\u0275fac=function(s){return new(s||i)(e.rXU(I.SystemWideAlertDataService),e.rXU(A.I),e.rXU(_.Ix),e.rXU(C.B),e.rXU(h.c$))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["ds-system-wide-alert-form"]],standalone:!0,features:[e.aNF],decls:43,vars:41,consts:[["d","ngbDatepicker"],[1,"container"],["id","header"],[3,"formGroup"],[1,"form-group"],[1,"row","mb-2"],[1,"col"],[3,"change","checkedLabel","uncheckedLabel","checked"],[1,"row"],["for","formMessage"],["id","formMessage","rows","5","formControlName","formMessage",3,"className"],["class","invalid-feedback show-feedback",4,"ngIf"],[1,"col","mb-2","d-flex","align-items-end"],["size","small",3,"change","ariaLabel","checked"],[1,"ml-2"],[4,"ngIf"],[1,"mb-2"],[1,"text-muted"],[1,"btn-row","float-right","space-children-mr","mt-2"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-save"],[1,"invalid-feedback","show-feedback"],[1,"col-sm-12","col-md-6"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","",1,"form-control",3,"ngModelChange","ngModel","minDate"],["type","button",1,"btn","btn-outline-secondary","fas","fa-calendar",3,"click"],[1,"col-12","d-md-none"],[3,"ngModelChange","ngModel"],[1,"d-none","d-md-block","col-md-6","timepicker-margin"],[1,"rounded-0","alert","alert-warning"],[1,"font-weight-bold"],[3,"innerHTML"]],template:function(s,n){1&s&&(e.j41(0,"div",1)(1,"h1",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"ui-switch",7),e.nI1(9,"translate"),e.nI1(10,"translate"),e.bIt("change",function(p){return n.setActive(p)}),e.k0s()()(),e.j41(11,"div",8)(12,"div",6)(13,"label",9),e.EFF(14),e.nI1(15,"translate"),e.k0s(),e.j41(16,"textarea",10),e.EFF(17,"                "),e.k0s(),e.DNE(18,Y,2,1,"div",11),e.k0s()()()(),e.j41(19,"div",8)(20,"div",12)(21,"ui-switch",13),e.nI1(22,"translate"),e.nI1(23,"async"),e.bIt("change",function(p){return n.setCounterEnabled(p)}),e.k0s(),e.j41(24,"span",14),e.EFF(25),e.nI1(26,"translate"),e.k0s()()(),e.DNE(27,X,14,7,"div",15),e.nI1(28,"async"),e.j41(29,"div",16)(30,"span",17),e.EFF(31),e.nI1(32,"translate"),e.k0s()(),e.DNE(33,B,13,8,"div",15),e.j41(34,"div",18)(35,"button",19),e.bIt("click",function(){return n.back()}),e.nrm(36,"i",20),e.EFF(37),e.nI1(38,"translate"),e.k0s(),e.j41(39,"button",21),e.bIt("click",function(){return n.save()}),e.nrm(40,"i",22),e.EFF(41),e.nI1(42,"translate"),e.k0s()()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,19,"system-wide-alert.form.header")),e.R7$(2),e.HbH("ng-invalid"),e.Y8G("formGroup",n.alertForm),e.R7$(4),e.Y8G("checkedLabel",e.bMT(9,21,"system-wide-alert.form.label.active"))("uncheckedLabel",e.bMT(10,23,"system-wide-alert.form.label.inactive"))("checked",n.formActive.value),e.R7$(6),e.JRh(e.bMT(15,25,"system-wide-alert.form.label.message")),e.R7$(2),e.Y8G("className",n.formMessage.invalid&&(n.formMessage.dirty||n.formMessage.touched)?"form-control is-invalid":"form-control"),e.R7$(2),e.Y8G("ngIf",n.formMessage.invalid&&(n.formMessage.dirty||n.formMessage.touched)),e.R7$(3),e.Y8G("ariaLabel",e.bMT(22,27,"system-wide-alert.form.label.countdownTo.enable"))("checked",e.bMT(23,29,n.counterEnabled$)),e.R7$(4),e.JRh(e.bMT(26,31,"system-wide-alert.form.label.countdownTo.enable")),e.R7$(2),e.Y8G("ngIf",e.bMT(28,33,n.counterEnabled$)),e.R7$(4),e.JRh(e.bMT(32,35,"system-wide-alert.form.label.countdownTo.hint")),e.R7$(2),e.Y8G("ngIf",n.formMessage.value),e.R7$(4),e.SpI(" ",e.bMT(38,37,"system-wide-alert.form.cancel")," "),e.R7$(2),e.Y8G("disabled",n.alertForm.invalid),e.R7$(2),e.SpI(" ",e.bMT(42,39,"system-wide-alert.form.save")," "))},dependencies:[l.YN,l.me,l.BC,l.cb,l.vS,l.X1,l.j4,l.JD,b.z,b.S,f.bT,u.IQ,u.cw,u.tJ,u.Pe,f.Jj,h.h,h.D9],styles:[".timepicker-margin[_ngcontent-%COMP%]{margin-top:-38px}"]})}return i})()}]}}]);