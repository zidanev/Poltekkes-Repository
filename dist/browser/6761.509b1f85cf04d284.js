(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[6761],{32588:(ot,A,o)=>{"use strict";o.d(A,{S:()=>t});var E=o(53107),N=o(72683),P=o(67044),Y=o(63016),f=o(72553);let h=(()=>{class u{getBreadcrumbs(p,y){return(0,Y.of)([new f.Q(p+".breadcrumbs",y)])}static#t=this.\u0275fac=function(y){return new(y||u)};static#e=this.\u0275prov=E.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})();const t=(u,R,p=(0,E.WQX)(h))=>{const y=u.data.breadcrumbKey;if((0,N.Tn)(y))throw new Error('You provided an i18nBreadcrumbResolver for url "'+u.url+"\" but no breadcrumbKey in the route's data");return{provider:p,key:y,url:(0,P.F)(u)}}},96761:(ot,A,o)=>{"use strict";o.r(A),o.d(A,{ROUTES:()=>Ts});var E=o(32588),N=o(23725),P=o(59390),Y=o(99794),f=o(81263),W=o(61305),h=o(54460),t=o(53107),u=o(95968),R=o(2155),p=o(69685),y=o(63016),$=o(76627),g=o(47947),it=o(2566),b=o(72683),V=o(15497);const _t=n=>({active:n}),rt=n=>[n];function dt(n,l){if(1&n&&(t.j41(0,"a",18),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG().$implicit,i=t.XpG(2);t.Y8G("ngClass",t.eq3(7,_t,e.page===i.currentPage))("routerLink",t.eq3(9,rt,"./"+e.page)),t.BMQ("aria-selected",e.page===i.currentPage)("data-test",e.page),t.R7$(),t.SpI(" ",t.bMT(2,5,"item.edit.tabs."+e.page+".head")," ")}}function H(n,l){if(1&n&&(t.j41(0,"button",19),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,"item.edit.tabs."+e.page+".head")," ")}}function mt(n,l){if(1&n&&(t.j41(0,"li",14),t.DNE(1,dt,3,11,"a",15),t.nI1(2,"async"),t.j41(3,"span",16),t.nI1(4,"translate"),t.DNE(5,H,3,3,"button",17),t.nI1(6,"async"),t.k0s()()),2&n){const e=l.$implicit;t.R7$(),t.Y8G("ngIf",t.bMT(2,3,e.enabled)),t.R7$(2),t.Y8G("ngbTooltip",t.bMT(4,5,"item.edit.tabs.disabled.tooltip")),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(6,7,e.enabled))}}function It(n,l){if(1&n&&(t.j41(0,"ul",12),t.DNE(1,mt,7,9,"li",13),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.Y8G("ngForOf",e.pages)}}let L=(()=>{class n{constructor(e,i,s){this.route=e,this.router=i,this.injector=s,this.router.events.subscribe(()=>this.initPageParamsByRoute())}ngOnInit(){this.initPageParamsByRoute(),this.pages=this.route.routeConfig.children.filter(e=>(0,b.hj)(e.path)).map(e=>{let i=(0,y.of)(!0);return(0,b.hj)(e.canActivate)&&(i=(0,$.z)(e.canActivate.map(s=>(0,t.N4e)(this.injector,()=>s(this.route.snapshot,this.router.routerState.snapshot)))).pipe((0,g.T)(s=>s.every(a=>!0===a)))),{page:e.path,enabled:i}}),this.itemRD$=this.route.data.pipe((0,g.T)(e=>e.dso))}getItemPage(e){return(0,V._o)(e)}initPageParamsByRoute(){this.currentPage=this.route.snapshot.firstChild.routeConfig.path}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(t.zZn))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-edit-item-page"]],standalone:!0,features:[t.aNF],decls:18,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-12"],[1,"border-bottom"],[1,"pt-2"],["class","nav nav-tabs justify-content-start","role","tablist",4,"ngIf"],[1,"tab-pane","active"],[1,"mb-4"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],["role","tablist",1,"nav","nav-tabs","justify-content-start"],["class","nav-item","role","presentation",4,"ngFor","ngForOf"],["role","presentation",1,"nav-item"],["class","nav-link","role","tab",3,"ngClass","routerLink",4,"ngIf"],[3,"ngbTooltip"],["class","nav-link disabled",4,"ngIf"],["role","tab",1,"nav-link",3,"ngClass","routerLink"],[1,"nav-link","disabled"]],template:function(i,s){if(1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",4),t.DNE(7,It,2,1,"ul",5),t.j41(8,"div",6)(9,"div",7),t.nrm(10,"router-outlet"),t.k0s(),t.j41(11,"div",8)(12,"div",9)(13,"a",10),t.nI1(14,"async"),t.nrm(15,"i",11),t.EFF(16),t.nI1(17,"translate"),t.k0s()()()()()()()()),2&i){let a;t.R7$(4),t.JRh(t.bMT(5,4,"item.edit.head")),t.R7$(3),t.Y8G("ngIf",s.pages.length>0),t.R7$(6),t.Y8G("routerLink",s.getItemPage(null==(a=t.bMT(14,6,s.itemRD$))?null:a.payload)),t.R7$(3),t.SpI(" ",t.bMT(17,8,"item.edit.return"),"")}},dependencies:[p.h,p.D9,h.YU,h.bT,h.Sq,h.Jj,R.n8,R.md,u.Wk,u.n3],encapsulation:2,data:{animation:[it.qG,it.Ws]},changeDetection:0})}return n})();var c=o(48922),m=o(12007),Tt=o(93068);function yt(n,l){1&n&&t.nrm(0,"ds-access-control-form-container",1),2&n&&t.Y8G("itemRD",l.ngIf)("showLimitToSpecificBitstreams",!0)}let $t=(()=>{class n{constructor(e){this.route=e}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,g.T)(e=>e.dso)).pipe((0,m.yd)())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-access-control"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["titleMessage","item-access-control-title",3,"itemRD","showLimitToSpecificBitstreams",4,"ngIf"],["titleMessage","item-access-control-title",3,"itemRD","showLimitToSpecificBitstreams"]],template:function(i,s){1&i&&(t.DNE(0,yt,1,2,"ds-access-control-form-container",0),t.nI1(1,"async")),2&i&&t.Y8G("ngIf",t.bMT(1,1,s.itemRD$))},dependencies:[Tt.o,h.bT,h.Jj]})}return n})();var Ct=o(75884),pt=o.n(Ct),I=o(71217),O=o(1703),v=o(41483),D=o(27035),M=o(17178),C=o(37610),J=o(83116),nt=o(66559),S=o(5338),k=o(96858);let st=(()=>{class n{constructor(e){this.ngFor=e,this.ngFor.ngForTrackBy=(i,s)=>s?s.id:void 0}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(h.Sq,1))};static#e=this.\u0275dir=t.FsC({type:n,selectors:[["","ngForTrackById",""]],standalone:!0})}return n})();var ut=o(60519),U=o(24106);function Ht(n,l){if(1&n&&(t.qex(0),t.nrm(1,"ds-resource-policies",5),t.bVm()),2&n){const e=l.$implicit;t.R7$(),t.Y8G("resourceType","bitstream")("resourceUUID",e.id)("resourceName",e.name)}}function Zt(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",11)(1,"button",12),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2).$implicit,a=t.XpG();return t.Njj(a.onBitstreamsLoad(s))}),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"collection.edit.item.authorizations.load-more-button")))}function qt(n,l){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",7)(2,"div",8)(3,"button",9),t.bIt("click",function(){t.eBV(e);const s=t.XpG().$implicit,a=t.XpG();return t.Njj(a.collapseArea(s.id))}),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div",10),t.DNE(7,Ht,2,3,"ng-container",3),t.nI1(8,"async"),t.DNE(9,Zt,4,3,"div",4),t.k0s()(),t.bVm()}if(2&n){const e=t.XpG().$implicit,i=t.XpG();t.R7$(3),t.BMQ("aria-expanded",!1)("aria-controls",e.id),t.R7$(),t.Lme(" ",t.bMT(5,8,"collection.edit.item.authorizations.show-bitstreams-button")," ",i.nameService.getName(e)," "),t.R7$(2),t.Y8G("id",e.id)("ngbCollapse",i.bundleBitstreamsMap.get(e.id).isCollapsed),t.R7$(),t.Y8G("ngForOf",t.bMT(8,10,i.bundleBitstreamsMap.get(e.id).bitstreams)),t.R7$(2),t.Y8G("ngIf",!i.bundleBitstreamsMap.get(e.id).allBitstreamsLoaded)}}function te(n,l){if(1&n&&(t.qex(0),t.nrm(1,"ds-resource-policies",5),t.DNE(2,qt,10,12,"ng-container",6),t.nI1(3,"async"),t.bVm()),2&n){let e;const i=l.$implicit,s=t.XpG();t.R7$(),t.Y8G("resourceType","bundle")("resourceUUID",i.id)("resourceName",i.name),t.R7$(),t.Y8G("ngIf",(null==(e=t.bMT(3,4,null==(e=s.bundleBitstreamsMap.get(i.id))?null:e.bitstreams))?null:e.length)>0)}}function ee(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",11)(1,"button",12),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.onBundleLoad())}),t.EFF(2),t.nI1(3,"translate"),t.k0s()()}2&n&&(t.R7$(2),t.JRh(t.bMT(3,1,"collection.edit.item.authorizations.load-bundle-button")))}let ie=(()=>{class n{constructor(e,i,s){this.linkService=e,this.route=i,this.nameService=s,this.bundleBitstreamsMap=new Map,this.bundles$=new I.t([]),this.subs=[],this.bundlesPerPage=6,this.bundlesPageSize=1,this.allBundlesLoaded=!1,this.bitstreamSize=4,this.bitstreamPageSize=4}ngOnInit(){this.getBundlesPerItem()}getItemUUID(){return this.item$.pipe((0,g.T)(e=>e.id),(0,O.$)(e=>(0,b.hj)(e)))}getItemName(){return this.item$.pipe((0,g.T)(e=>this.nameService.getName(e)))}getItemBundles(){return this.bundles$.asObservable()}getBundlesPerItem(e=1){this.item$=this.route.data.pipe((0,g.T)(s=>s.dso),(0,m.QQ)(),(0,g.T)(s=>this.linkService.resolveLink(s,(0,U.s)("bundles",{findListOptions:{currentPage:e,elementsPerPage:this.bundlesPerPage}},(0,U.s)("bitstreams")))));const i=this.item$.pipe((0,v.p)(s=>(0,b.hj)(s.bundles)),(0,D.Z)(s=>s.bundles),(0,m.QQ)(),(0,M.W)(s=>(console.error(s),(0,y.of)((0,S.g)(null,[])))));this.subs.push(i.pipe((0,C.s)(1),(0,g.T)(s=>s.page)).subscribe(s=>{(pt()(s.length,0)||s.length<this.bundlesPerPage)&&(this.allBundlesLoaded=!0),pt()(e,1)?this.bundles$.next(s):this.bundles$.next(this.bundles$.getValue().concat(s))}),i.pipe((0,C.s)(1),(0,D.Z)(s=>s.page),(0,g.T)(s=>({id:s.id,bitstreams:this.getBundleBitstreams(s)}))).subscribe(s=>{const a={isCollapsed:!0,allBitstreamsLoaded:!1,bitstreams:null};a.bitstreams=s.bitstreams.pipe((0,g.T)(r=>(a.allBitstreamsLoaded=r?.page.length<this.bitstreamSize,[...r.page.slice(0,this.bitstreamSize)]))),this.bundleBitstreamsMap.set(s.id,a)}))}getBundleBitstreams(e){return e.bitstreams.pipe((0,m.ak)(),(0,M.W)(i=>(console.error(i),(0,y.of)((0,S.g)(null,[])))))}collapseArea(e){this.bundleBitstreamsMap.get(e).isCollapsed=!this.bundleBitstreamsMap.get(e).isCollapsed}onBundleLoad(){this.bundlesPageSize++,this.getBundlesPerItem(this.bundlesPageSize)}onBitstreamsLoad(e){return this.getBundleBitstreams(e).subscribe(i=>{const s=i?.page.slice(this.bitstreamPageSize,this.bitstreamPageSize+this.bitstreamSize),a=this.bundleBitstreamsMap.get(e.id).bitstreams.pipe((0,g.T)(d=>[...d,...s]));this.bitstreamPageSize=this.bitstreamPageSize+this.bitstreamSize;const r={bitstreams:a,isCollapsed:this.bundleBitstreamsMap.get(e.id).isCollapsed,allBitstreamsLoaded:i?.page.length<=this.bitstreamPageSize};this.bundleBitstreamsMap.set(e.id,r)})}ngOnDestroy(){this.subs.filter(e=>(0,b.a4)(e)).forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(nt._),t.rXU(u.nX),t.rXU(J.f))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-authorizations"]],standalone:!0,features:[t.aNF],decls:8,vars:13,consts:[[1,"container"],[3,"type","content"],[3,"resourceType","resourceName","resourceUUID"],[4,"ngFor","ngForTrackById","ngForOf"],["class","row justify-content-center",4,"ngIf"],[3,"resourceType","resourceUUID","resourceName"],[4,"ngIf"],[1,"card","auth-bitstream-container"],[1,"card-header"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"card-body",3,"id","ngbCollapse"],[1,"row","justify-content-center"],["type","button",1,"btn","btn-link",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"div",0),t.nrm(1,"ds-alert",1)(2,"ds-resource-policies",2),t.nI1(3,"async"),t.nI1(4,"async"),t.DNE(5,te,4,6,"ng-container",3),t.nI1(6,"async"),t.DNE(7,ee,4,3,"div",4),t.k0s()),2&i&&(t.R7$(),t.Y8G("type","alert-info")("content","item.edit.authorizations.heading"),t.R7$(),t.Y8G("resourceType","item")("resourceName",t.bMT(3,7,s.getItemName()))("resourceUUID",t.bMT(4,9,s.getItemUUID())),t.R7$(3),t.Y8G("ngForOf",t.bMT(6,11,s.bundles$)),t.R7$(2),t.Y8G("ngIf",!s.allBundlesLoaded))},dependencies:[ut.e,R.HC,R.$G,p.h,p.D9,h.Sq,st,h.Jj,h.bT,k.C],styles:[".auth-bitstream-container[_ngcontent-%COMP%]{margin-top:-1em;margin-bottom:1.5em}"]})}return n})();var ne=o(35466),T=o(22867),Bt=o(25718),se=o(78052),Gt=o(61189),w=o(17584),Q=o(59809),z=o(89247),ht=o(9843),lt=o(21548),X=o(79224);class ct{constructor(l,e,i,s,a){this.xs=l,this.sm=e,this.md=i,this.lg=s,this.xl=a}buildClasses(){return`col-${this.xs} col-sm-${this.sm} col-md-${this.md} col-lg-${this.lg} col-xl-${this.xl}`}}class ae{constructor(l){this.columns=l}combineColumns(l,e){if(l<e&&(0,b.a4)(this.columns[l])&&(0,b.a4)(this.columns[e])){let i=this.columns[l].xs,s=this.columns[l].sm,a=this.columns[l].md,r=this.columns[l].lg,d=this.columns[l].xl;for(let _=l+1;_<e+1;_++)i+=this.columns[_].xs,s+=this.columns[_].sm,a+=this.columns[_].md,r+=this.columns[_].lg,d+=this.columns[_].xl;return new ct(i,s,a,r,d)}}}var Rt=o(63496);let gt=(()=>{class n{transform(e){const i=[];return(0,b.hj)(e)&&Object.values(e).forEach(s=>i.push(s)),i}static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275pipe=t.EJ8({name:"dsObjectValues",type:n,pure:!0,standalone:!0})}return n})();var q=o(63524),Mt=o(82040),oe=o(86722),re=(o(47376),o(8891)),le=o(90131);let Pt=(()=>{class n extends re.F{constructor(e,i,s,a,r,d){super(i,a,r,s),this.itemService=e,this.objectUpdatesService=i,this.router=s,this.notificationsService=a,this.translateService=r,this.route=d}ngOnInit(){(0,b.a4)(this.item)?this.setItem(this.item):this.itemUpdateSubscription=(0,$.z)([this.route.data,this.route.parent.data]).pipe((0,g.T)(([e,i])=>Object.assign({},e,i)),(0,g.T)(e=>e.dso),(0,Mt.M)(e=>{this.item=e.payload}),(0,T.n)(e=>this.itemService.findByHref(e.payload._links.self.href,!0,!0,...le.e)),(0,m.v7)()).subscribe(e=>{this.setItem(e.payload)}),super.ngOnInit(),this.discardTimeOut=oe.c.item.edit.undoTimeout,this.hasChanges().pipe((0,O.$)()).subscribe(e=>{e?this.checkLastModified():this.initializeOriginalFields()}),this.initializeNotificationsPrefix(),this.initializeUpdates()}setItem(e){this.item=e,this.itemPageRoute=(0,V._o)(this.item),this.postItemInit(),this.initializeUpdates()}ngOnDestroy(){(0,b.a4)(this.itemUpdateSubscription)&&this.itemUpdateSubscription.unsubscribe()}postItemInit(){}initializeUpdates(){}initializeNotificationsPrefix(){}initializeOriginalFields(){}submit(){}trackUpdate(e,i){return i&&i.field?i.field.uuid:void 0}isValid(){return this.objectUpdatesService.isValidPage(this.url)}checkLastModified(){const e=this.item.lastModified;this.objectUpdatesService.getLastModified(this.url).pipe((0,O.$)()).subscribe(i=>{i.getDate()!==e.getDate()&&(this.notificationsService.warning(this.getNotificationTitle("outdated"),this.getNotificationContent("outdated")),this.initializeOriginalFields())})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(w.ItemDataService),t.rXU(z.F),t.rXU(u.Ix),t.rXU(X.I),t.rXU(p.c$),t.rXU(u.nX))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-abstract-item-update"]],inputs:{item:"item"},standalone:!0,features:[t.Vt3,t.aNF],decls:0,vars:0,template:function(i,s){},encapsulation:2})}return n})();o(28083);const ce=["handleView"];function de(n,l){1&n&&(t.j41(0,"div",1),t.nrm(1,"i",2),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.Y8G("title",t.bMT(2,1,"item.edit.bitstreams.edit.buttons.drag")))}let St=(()=>{class n{constructor(e){this.viewContainerRef=e}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.handleView)}ngOnDestroy(){this.viewContainerRef.clear()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.c1b))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-edit-bitstream-drag-handle"]],viewQuery:function(i,s){if(1&i&&t.GBs(ce,7),2&i){let a;t.mGM(a=t.lsd())&&(s.handleView=a.first)}},standalone:!0,features:[t.aNF],decls:2,vars:0,consts:[["handleView",""],["tabindex","0",1,"drag-handle","text-muted","float-left","p-1","mr-2"],[1,"fas","fa-grip-vertical","fa-fw",3,"title"]],template:function(i,s){1&i&&t.DNE(0,de,3,3,"ng-template",null,0,t.C5r)},dependencies:[p.h,p.D9],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]})}return n})();var bt=o(85102),jt=o(95438),ft=o(51661),Vt=o(66645),wt=o(3618),Xt=o(67899);let pe=(()=>{class n{constructor(e,i,s,a){this.objectUpdatesService=e,this.elRef=i,this.objectValuesPipe=s,this.paginationService=a,this.dropObject=new t.bkB,this.pageSize=10,this.options=Object.assign(new Xt.W,{id:"dad",currentPage:1,pageSize:this.pageSize}),this.currentPage$=new I.t(this.options),this.loading$=new I.t(!1),this.subs=[]}ngOnInit(){this.initializeObjectsRD(),this.initializeURL(),this.initializeUpdates(),this.initializePagination()}initializePagination(){this.paginationService.getCurrentPagination(this.options.id,this.options).subscribe(e=>{this.currentPage$.next(e)})}initializeUpdates(){this.objectsRD$.pipe((0,m.yd)(),(0,m.qn)()).subscribe(e=>{this.objectUpdatesService.initialize(this.url,e,new Date)}),this.updates$=this.objectsRD$.pipe((0,m.v7)(),(0,m.qn)(),(0,T.n)(e=>this.objectUpdatesService.getFieldUpdatesExclusive(this.url,e))),this.subs.push(this.updates$.pipe((0,g.T)(e=>this.objectValuesPipe.transform(e)),(0,Vt.F)((0,wt.g0)(n=>(0,b.a4)(n)&&(0,b.a4)(n.field)?n.field.uuid:void 0))).subscribe(e=>{this.customOrder=e.map(i=>i.field.uuid),this.loading$.next(!1)}),this.loading$.subscribe(e=>this.options.disabled=e))}drop(e){const i=e.previousIndex;let s=e.currentIndex;const a=this.currentPage$.value.currentPage-1;let r=this.currentPage$.value.currentPage-1;const d=this.elRef.nativeElement.querySelector(".page-item:hover");if((0,b.a4)(d)&&(0,b.a4)(d.textContent)){const et=Number(d.textContent);(0,b.a4)(et)&&!Number.isNaN(et)&&(r=et-1,s=0)}const _=a!==r;!_&&i!==s&&(0,bt.HD)(this.customOrder,i,s);const j=r+1,B=a*this.pageSize+i,K=r*this.pageSize+s;B!==K&&(_&&this.loading$.next(!0),this.dropObject.emit(Object.assign({fromIndex:B,toIndex:K,finish:()=>{_&&this.paginationComponent.doPageChange(j)}})))}ngOnDestroy(){this.subs.filter(e=>(0,b.a4)(e)).forEach(e=>e.unsubscribe()),this.paginationService.clearPagination(this.options.id)}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(z.F),t.rXU(t.aKT),t.rXU(gt),t.rXU(jt.m))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-paginated-drag-drop-abstract"]],viewQuery:function(i,s){if(1&i&&t.GBs(ft.e,5),2&i){let a;t.mGM(a=t.lsd())&&(s.paginationComponent=a.first)}},outputs:{dropObject:"dropObject"},decls:0,vars:0,template:function(i,s){},encapsulation:2})}return n})();var ue=o(87599),he=o.n(ue),ge=o(31829),be=o(75911);const fe=["bitstreamView"],ve=[[["","slot","drag-handle"]]],_e=["[slot=drag-handle]"],Ie=n=>["/bitstreams/",n,"edit"];function Te(n,l){if(1&n&&(t.j41(0,"a",8),t.nI1(1,"translate"),t.nI1(2,"translate"),t.nI1(3,"dsBrowserOnly"),t.nrm(4,"i",14),t.k0s()),2&n){const e=t.XpG(2);t.FS9("title",t.bMT(1,4,"item.edit.bitstreams.edit.buttons.download")),t.Y8G("routerLink",e.bitstreamDownloadUrl),t.BMQ("aria-label",t.bMT(2,6,"item.edit.bitstreams.edit.buttons.download"))("data-test",t.bMT(3,8,"download-button"))}}function ye(n,l){if(1&n){const e=t.RV6();t.j41(0,"div"),t.SdG(1),t.j41(2,"div",1)(3,"span",2),t.EFF(4),t.k0s()()(),t.j41(5,"div")(6,"div",3)(7,"div",4),t.EFF(8),t.k0s()()(),t.j41(9,"div")(10,"div",5)(11,"span",2),t.EFF(12),t.nI1(13,"async"),t.k0s()()(),t.j41(14,"div")(15,"div",5)(16,"div",6),t.DNE(17,Te,5,10,"a",7),t.j41(18,"button",8),t.nI1(19,"translate"),t.nI1(20,"translate"),t.nrm(21,"i",9),t.k0s(),t.j41(22,"button",10),t.nI1(23,"translate"),t.nI1(24,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.remove())}),t.nrm(25,"i",11),t.k0s(),t.j41(26,"button",12),t.nI1(27,"translate"),t.nI1(28,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.undo())}),t.nrm(29,"i",13),t.k0s()()()()}if(2&n){let e;const i=t.XpG();t.ZvI("",i.columnSizes.columns[0].buildClasses()," row-element d-flex"),t.R7$(4),t.SpI(" ",i.bitstreamName," "),t.R7$(),t.ZvI("",i.columnSizes.columns[1].buildClasses()," row-element d-flex align-items-center"),t.R7$(2),t.Y8G("tooltipClass","larger-tooltip")("ngbTooltip",null==i.bitstream?null:i.bitstream.firstMetadataValue("dc.description")),t.R7$(),t.SpI(" ",null==i.bitstream?null:i.bitstream.firstMetadataValue("dc.description")," "),t.R7$(),t.ZvI("",i.columnSizes.columns[2].buildClasses()," row-element d-flex align-items-center"),t.R7$(3),t.SpI(" ",null==(e=t.bMT(13,27,i.format$))?null:e.shortDescription," "),t.R7$(2),t.ZvI("",i.columnSizes.columns[3].buildClasses()," row-element d-flex align-items-center"),t.R7$(3),t.Y8G("ngIf",null!==i.bitstreamDownloadUrl),t.R7$(),t.FS9("title",t.bMT(19,29,"item.edit.bitstreams.edit.buttons.edit")),t.Y8G("routerLink",t.eq3(41,Ie,i.bitstream.id)),t.BMQ("aria-label",t.bMT(20,31,"item.edit.bitstreams.edit.buttons.edit")),t.R7$(4),t.FS9("title",t.bMT(23,33,"item.edit.bitstreams.edit.buttons.remove")),t.Y8G("disabled",!i.canRemove()),t.BMQ("aria-label",t.bMT(24,35,"item.edit.bitstreams.edit.buttons.remove")),t.R7$(4),t.FS9("title",t.bMT(27,37,"item.edit.bitstreams.edit.buttons.undo")),t.Y8G("disabled",!i.canUndo()),t.BMQ("aria-label",t.bMT(28,39,"item.edit.bitstreams.edit.buttons.undo"))}}let $e=(()=>{class n{constructor(e,i,s){this.objectUpdatesService=e,this.dsoNameService=i,this.viewContainerRef=s}ngOnInit(){this.viewContainerRef.createEmbeddedView(this.bitstreamView)}ngOnDestroy(){this.viewContainerRef.clear()}ngOnChanges(e){this.bitstream=he()(this.fieldUpdate.field),this.bitstreamName=this.dsoNameService.getName(this.bitstream),this.bitstreamDownloadUrl=(0,ge.hV)(this.bitstream),this.format$=this.bitstream.format.pipe((0,m.yd)(),(0,m.Bo)())}remove(){this.objectUpdatesService.saveRemoveFieldUpdate(this.bundleUrl,this.bitstream)}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.bundleUrl,this.bitstream.uuid)}canRemove(){return this.fieldUpdate.changeType!==Q.B.REMOVE}canUndo(){return this.fieldUpdate.changeType?.valueOf()>=0}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(z.F),t.rXU(J.f),t.rXU(t.c1b))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-edit-bitstream"]],viewQuery:function(i,s){if(1&i&&t.GBs(fe,7),2&i){let a;t.mGM(a=t.lsd())&&(s.bitstreamView=a.first)}},inputs:{fieldUpdate:"fieldUpdate",bundleUrl:"bundleUrl",columnSizes:"columnSizes"},standalone:!0,features:[t.OA$,t.aNF],ngContentSelectors:_e,decls:2,vars:0,consts:[["bitstreamView",""],[1,"float-left","d-flex","align-items-center","overflow-hidden"],[1,"text-truncate"],[1,"w-100"],["placement","bottom",1,"text-truncate",3,"tooltipClass","ngbTooltip"],[1,"text-center","w-100"],[1,"btn-group","relationship-action-buttons"],["class","btn btn-outline-primary btn-sm",3,"routerLink","title",4,"ngIf"],[1,"btn","btn-outline-primary","btn-sm",3,"routerLink","title"],[1,"fas","fa-edit","fa-fw"],[1,"btn","btn-outline-danger","btn-sm",3,"click","disabled","title"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"click","disabled","title"],[1,"fas","fa-undo-alt","fa-fw"],[1,"fas","fa-download","fa-fw"]],template:function(i,s){1&i&&(t.NAR(ve),t.DNE(0,ye,30,43,"ng-template",null,0,t.C5r))},dependencies:[u.Wk,p.h,p.D9,be.L,R.n8,R.md,h.Jj,h.bT],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]})}return n})();const Ce=n=>({"mb-3":n}),Re=(n,l,e,i)=>({"table-warning":n,"table-danger":l,"table-success":e,"bg-white":i});function Me(n,l){if(1&n&&(t.j41(0,"div",7)(1,"ds-item-edit-bitstream",8)(2,"div",9),t.nrm(3,"ds-item-edit-bitstream-drag-handle"),t.k0s()()()),2&n){const e=l.$implicit,i=t.XpG(2).ngVar,s=t.XpG(3);t.Y8G("id",e)("ngClass",t.ziG(5,Re,0===i[e].changeType,2===i[e].changeType,1===i[e].changeType,void 0===i[e].changeType)),t.R7$(),t.Y8G("fieldUpdate",i[e])("bundleUrl",s.bundle.self)("columnSizes",s.columnSizes)}}function Se(n,l){if(1&n&&(t.qex(0),t.DNE(1,Me,4,10,"div",6),t.bVm()),2&n){const e=t.XpG(4);t.R7$(),t.Y8G("ngForOf",e.customOrder)}}function je(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",5),t.nI1(1,"async"),t.bIt("cdkDropListDropped",function(s){t.eBV(e);const a=t.XpG(3);return t.Njj(a.drop(s))}),t.DNE(2,Se,2,1,"ng-container",2),t.k0s()}if(2&n){let e;const i=l.ngVar,s=t.XpG(3);t.Y8G("id",s.bundle.id)("ngClass",t.eq3(5,Ce,(null==(e=t.bMT(1,3,s.objectsRD$))||null==e.payload?null:e.payload.totalElements)>s.pageSize)),t.R7$(2),t.Y8G("ngIf",i)}}function Fe(n,l){if(1&n&&(t.qex(0),t.DNE(1,je,3,7,"div",4),t.nI1(2,"async"),t.bVm()),2&n){const e=t.XpG(2);t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.updates$))}}function De(n,l){1&n&&(t.nrm(0,"ds-loading",10),t.nI1(1,"translate")),2&n&&t.Y8G("message",t.bMT(1,1,"loading.bitstreams"))}function Oe(n,l){if(1&n&&(t.j41(0,"ds-pagination",1),t.nI1(1,"async"),t.DNE(2,Fe,3,3,"ng-container",2),t.nI1(3,"async"),t.DNE(4,De,2,3,"ds-loading",3),t.nI1(5,"async"),t.k0s()),2&n){let e;const i=t.XpG();t.Y8G("hideGear",!0)("hidePagerWhenSinglePage",!0)("hidePaginationDetail",!0)("paginationOptions",i.options)("collectionSize",null==(e=t.bMT(1,7,i.objectsRD$))||null==e.payload?null:e.payload.totalElements),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(3,9,i.loading$)),t.R7$(2),t.Y8G("ngIf",t.bMT(5,11,i.loading$))}}let ke=(()=>{class n extends pe{constructor(e,i,s,a,r,d){super(e,i,s,r),this.objectUpdatesService=e,this.elRef=i,this.objectValuesPipe=s,this.bundleService=a,this.paginationService=r,this.requestService=d}ngOnInit(){super.ngOnInit()}initializeObjectsRD(){this.objectsRD$=this.currentPage$.pipe((0,T.n)(e=>{const i=new Rt.C({pagination:Object.assign({},e)});return this.bundleService.getBitstreamsEndpoint(this.bundle.id,i).pipe((0,T.n)(s=>this.requestService.hasByHref$(s)),(0,T.n)(()=>this.bundleService.getBitstreams(this.bundle.id,i,(0,U.s)("format"))))}))}initializeURL(){this.url=this.bundle.self}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(z.F),t.rXU(t.aKT),t.rXU(gt),t.rXU(Gt.BundleDataService),t.rXU(jt.m),t.rXU(ht.B))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-paginated-drag-and-drop-bitstream-list"]],inputs:{bundle:"bundle",columnSizes:"columnSizes"},standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","collectionSize",4,"ngIf"],[3,"hideGear","hidePagerWhenSinglePage","hidePaginationDetail","paginationOptions","collectionSize"],[4,"ngIf"],[3,"message",4,"ngIf"],["class","bundle-bitstreams-list","cdkDropList","",3,"id","ngClass","cdkDropListDropped",4,"ngVar"],["cdkDropList","",1,"bundle-bitstreams-list",3,"cdkDropListDropped","id","ngClass"],["class","row bitstream-row","cdkDrag","",3,"id","ngClass",4,"ngFor","ngForOf"],["cdkDrag","",1,"row","bitstream-row",3,"id","ngClass"],[3,"fieldUpdate","bundleUrl","columnSizes"],["slot","drag-handle","cdkDragHandle","","tabindex","0",1,"d-flex","align-items-center","bitstream-row-drag-handle"],[3,"message"]],template:function(i,s){if(1&i&&(t.DNE(0,Oe,6,13,"ds-pagination",0),t.nI1(1,"async")),2&i){let a;t.Y8G("ngIf",null==(a=t.bMT(1,1,s.objectsRD$))?null:a.payload)}},dependencies:[h.Jj,h.bT,ft.e,h.YU,q.r,bt.O7,h.Sq,bt.T1,$e,St,bt.Fb,lt.v,p.h,p.D9],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]})}return n})();const Ee=["bundleView"],Ue=n=>({name:n}),xe=n=>[n,"bitstreams","new"],Be=n=>({bundle:n});function Ge(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",1)(1,"div"),t.nrm(2,"ds-item-edit-bitstream-drag-handle"),t.j41(3,"div",2),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"div")(7,"div",3)(8,"button",4),t.nI1(9,"translate"),t.nI1(10,"translate"),t.nrm(11,"i",5),t.k0s()()()(),t.j41(12,"ds-paginated-drag-and-drop-bitstream-list",6),t.bIt("dropObject",function(s){t.eBV(e);const a=t.XpG();return t.Njj(a.dropObject.emit(s))}),t.k0s()}if(2&n){const e=t.XpG();t.R7$(),t.ZvI("",e.bundleNameColumn.buildClasses()," font-weight-bold row-element d-flex"),t.R7$(3),t.SpI(" ",t.i5U(5,13,"item.edit.bitstreams.bundle.name",t.eq3(20,Ue,e.dsoNameService.getName(e.bundle)))," "),t.R7$(2),t.ZvI("",e.columnSizes.columns[3].buildClasses()," text-center row-element"),t.R7$(2),t.FS9("title",t.bMT(9,16,"item.edit.bitstreams.bundle.edit.buttons.upload")),t.Y8G("routerLink",t.eq3(22,xe,e.itemPageRoute))("queryParams",t.eq3(24,Be,e.bundle.id)),t.BMQ("aria-label",t.bMT(10,18,"item.edit.bitstreams.bundle.edit.buttons.upload")),t.R7$(4),t.Y8G("bundle",e.bundle)("columnSizes",e.columnSizes)}}let Pe=(()=>{class n{constructor(e,i){this.viewContainerRef=e,this.dsoNameService=i,this.dropObject=new t.bkB}ngOnInit(){this.bundleNameColumn=this.columnSizes.combineColumns(0,2),this.viewContainerRef.createEmbeddedView(this.bundleView),this.itemPageRoute=(0,V._o)(this.item)}ngOnDestroy(){this.viewContainerRef.clear()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(t.c1b),t.rXU(J.f))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-edit-bitstream-bundle"]],viewQuery:function(i,s){if(1&i&&t.GBs(Ee,7),2&i){let a;t.mGM(a=t.lsd())&&(s.bundleView=a.first)}},inputs:{bundle:"bundle",item:"item",columnSizes:"columnSizes"},outputs:{dropObject:"dropObject"},standalone:!0,features:[t.aNF],decls:2,vars:0,consts:[["bundleView",""],[1,"row","bundle-row"],[1,"float-left","d-flex","align-items-center"],[1,"btn-group","bundle-action-buttons"],[1,"btn","btn-outline-success","btn-sm",3,"routerLink","queryParams","title"],[1,"fas","fa-upload","fa-fw"],[3,"dropObject","bundle","columnSizes"]],template:function(i,s){1&i&&t.DNE(0,Ge,13,26,"ng-template",null,0,t.C5r)},dependencies:[ke,p.h,p.D9,u.Wk,St],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]})}return n})();const Ve=n=>[n,"bitstreams","new"];function we(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",15),t.nI1(1,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.reinstate())}),t.nrm(2,"i",16),t.j41(3,"span",5),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}2&n&&(t.BMQ("aria-label",t.bMT(1,2,"item.edit.bitstreams.reinstate-button")),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.bitstreams.reinstate-button"),""))}function Xe(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",17),t.nI1(1,"async"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.discard())}),t.nrm(3,"i",18),t.j41(4,"span",5),t.EFF(5),t.nI1(6,"translate"),t.k0s()()}if(2&n){const e=t.XpG(2);t.Y8G("disabled",!0!==t.bMT(1,3,e.hasChanges$)||e.submitting),t.BMQ("aria-label",t.bMT(2,5,"item.edit.bitstreams.discard-button")),t.R7$(5),t.SpI("\xa0",t.bMT(6,7,"item.edit.bitstreams.discard-button"),"")}}function Ne(n,l){if(1&n){const e=t.RV6();t.j41(0,"ds-item-edit-bitstream-bundle",22),t.bIt("dropObject",function(s){const a=t.eBV(e).$implicit,r=t.XpG(3);return t.Njj(r.dropBitstream(a,s))}),t.k0s()}if(2&n){const e=l.$implicit,i=t.XpG(3);t.Y8G("bundle",e)("item",i.item)("columnSizes",i.columnSizes)}}function Le(n,l){if(1&n&&(t.j41(0,"div",19)(1,"div",20)(2,"div"),t.nrm(3,"ds-item-edit-bitstream-drag-handle"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"div"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"div"),t.EFF(13),t.nI1(14,"translate"),t.k0s()(),t.DNE(15,Ne,1,3,"ds-item-edit-bitstream-bundle",21),t.k0s()),2&n){const e=t.XpG().ngVar,i=t.XpG();t.R7$(2),t.ZvI("",i.columnSizes.columns[0].buildClasses()," row-element"),t.R7$(2),t.SpI(" ",t.bMT(5,17,"item.edit.bitstreams.headers.name")," "),t.R7$(2),t.ZvI("",i.columnSizes.columns[1].buildClasses()," row-element"),t.R7$(),t.JRh(t.bMT(8,19,"item.edit.bitstreams.headers.description")),t.R7$(2),t.ZvI("",i.columnSizes.columns[2].buildClasses()," text-center row-element"),t.R7$(),t.JRh(t.bMT(11,21,"item.edit.bitstreams.headers.format")),t.R7$(2),t.ZvI("",i.columnSizes.columns[3].buildClasses()," text-center row-element"),t.R7$(),t.JRh(t.bMT(14,23,"item.edit.bitstreams.headers.actions")),t.R7$(2),t.Y8G("ngForOf",e)}}function Ye(n,l){1&n&&(t.j41(0,"div",23),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"item.edit.bitstreams.empty")," "))}function ze(n,l){1&n&&(t.nrm(0,"ds-loading",24),t.nI1(1,"translate")),2&n&&t.FS9("message",t.bMT(1,1,"loading.bitstreams"))}function Ae(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",15),t.nI1(1,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.reinstate())}),t.nrm(2,"i",16),t.j41(3,"span",5),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}2&n&&(t.BMQ("aria-label",t.bMT(1,2,"item.edit.bitstreams.reinstate-button")),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.bitstreams.reinstate-button"),""))}function We(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",17),t.nI1(1,"async"),t.nI1(2,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.discard())}),t.nrm(3,"i",18),t.j41(4,"span",5),t.EFF(5),t.nI1(6,"translate"),t.k0s()()}if(2&n){const e=t.XpG(2);t.Y8G("disabled",!0!==t.bMT(1,3,e.hasChanges$)||e.submitting),t.BMQ("aria-label",t.bMT(2,5,"item.edit.bitstreams.discard-button")),t.R7$(5),t.SpI("\xa0",t.bMT(6,7,"item.edit.bitstreams.discard-button"),"")}}function Je(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"button",3),t.nI1(3,"translate"),t.nrm(4,"i",4),t.j41(5,"span",5),t.EFF(6),t.nI1(7,"translate"),t.k0s()(),t.DNE(8,we,6,6,"button",6),t.nI1(9,"async"),t.j41(10,"button",7),t.nI1(11,"async"),t.nI1(12,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.submit())}),t.nrm(13,"i",8),t.j41(14,"span",5),t.EFF(15),t.nI1(16,"translate"),t.k0s()(),t.DNE(17,Xe,7,9,"button",9),t.nI1(18,"async"),t.k0s(),t.DNE(19,Le,16,25,"div",10)(20,Ye,3,3,"div",11)(21,ze,2,3,"ds-loading",12),t.j41(22,"div",13)(23,"div",14),t.DNE(24,Ae,6,6,"button",6),t.nI1(25,"async"),t.j41(26,"button",7),t.nI1(27,"async"),t.nI1(28,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.submit())}),t.nrm(29,"i",8),t.j41(30,"span",5),t.EFF(31),t.nI1(32,"translate"),t.k0s()(),t.DNE(33,We,7,9,"button",9),t.nI1(34,"async"),t.k0s()()()}if(2&n){const e=l.ngVar,i=t.XpG();t.R7$(2),t.Y8G("routerLink",t.eq3(40,Ve,i.itemPageRoute)),t.BMQ("aria-label",t.bMT(3,16,"item.edit.bitstreams.upload-button")),t.R7$(4),t.SpI("\xa0",t.bMT(7,18,"item.edit.bitstreams.upload-button"),""),t.R7$(2),t.Y8G("ngIf",t.bMT(9,20,i.isReinstatable$)),t.R7$(2),t.Y8G("disabled",!0!==t.bMT(11,22,i.hasChanges$)||i.submitting),t.BMQ("aria-label",t.bMT(12,24,"item.edit.bitstreams.save-button")),t.R7$(5),t.SpI("\xa0",t.bMT(16,26,"item.edit.bitstreams.save-button"),""),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(18,28,i.isReinstatable$)),t.R7$(2),t.Y8G("ngIf",i.item&&(null==e?null:e.length)>0),t.R7$(),t.Y8G("ngIf",0===(null==e?null:e.length)),t.R7$(),t.Y8G("ngIf",!e),t.R7$(3),t.Y8G("ngIf",t.bMT(25,30,i.isReinstatable$)),t.R7$(2),t.Y8G("disabled",!0!==t.bMT(27,32,i.hasChanges$)||i.submitting),t.BMQ("aria-label",t.bMT(28,34,"item.edit.bitstreams.save-button")),t.R7$(5),t.SpI("\xa0",t.bMT(32,36,"item.edit.bitstreams.save-button"),""),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(34,38,i.isReinstatable$))}}let Ke=(()=>{class n extends Pt{constructor(e,i,s,a,r,d,_,j,B,K,et,xt){super(e,i,s,a,r,d),this.itemService=e,this.objectUpdatesService=i,this.router=s,this.notificationsService=a,this.translateService=r,this.route=d,this.bitstreamService=_,this.objectCache=j,this.requestService=B,this.cdRef=K,this.bundleService=et,this.zone=xt,this.bundlesOptions={id:"bundles-pagination-options",currentPage:1,pageSize:9999},this.columnSizes=new ae([new ct(2,2,3,4,4),new ct(2,3,3,3,3),new ct(2,2,2,2,2),new ct(6,5,4,3,3)]),this.submitting=!1}postItemInit(){this.bundles$=this.itemService.getBundles(this.item.id,new Rt.C({pagination:this.bundlesOptions})).pipe((0,m.yd)(),(0,m.Bo)(),(0,g.T)(e=>e.page))}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.bitstreams.notifications."}submit(){this.submitting=!0,this.bundles$.pipe((0,C.s)(1)).pipe((0,T.n)(a=>(0,ne.y)(...a.map(r=>this.objectUpdatesService.getFieldUpdates(r.self,[],!0)))),(0,g.T)(a=>[].concat(...a.map(r=>Object.values(r).filter(d=>d.changeType===Q.B.REMOVE)))),(0,g.T)(a=>a.map(r=>r.field))).pipe((0,C.s)(1),(0,T.n)(a=>this.bitstreamService.removeMultiple(a))).subscribe(a=>{this.displayNotifications("item.edit.bitstreams.notifications.remove",[a]),this.submitting=!1})}dropBitstream(e,i){this.zone.runOutsideAngular(()=>{(0,b.a4)(i)&&(0,b.a4)(i.fromIndex)&&(0,b.a4)(i.toIndex)&&(0,b.a4)(i.finish)&&this.bundleService.patch(e,[{op:"move",from:`/_links/bitstreams/${i.fromIndex}/href`,path:`/_links/bitstreams/${i.toIndex}/href`}]).pipe((0,C.s)(1)).subscribe(a=>{this.zone.run(()=>{this.displayNotifications("item.edit.bitstreams.notifications.move",[a]),this.requestService.removeByHrefSubstring(e.self).pipe((0,v.p)(r=>r),(0,C.s)(1)).subscribe(()=>i.finish())})})})}displayNotifications(e,i){if((0,b.hj)(i)){const s=i.filter(r=>(0,b.a4)(r)&&r.hasFailed),a=i.filter(r=>(0,b.a4)(r)&&r.hasSucceeded);s.forEach(r=>{this.notificationsService.error(this.translateService.instant(`${e}.failed.title`),r.errorMessage)}),a.length>0&&this.notificationsService.success(this.translateService.instant(`${e}.saved.title`),this.translateService.instant(`${e}.saved.content`))}}discard(){const e=this.notificationsService.info(this.getNotificationTitle("discarded"),this.getNotificationContent("discarded"),{timeOut:this.discardTimeOut});this.objectUpdatesService.discardAllFieldUpdates(this.url,e)}reinstate(){this.bundles$.pipe((0,C.s)(1)).subscribe(e=>{e.forEach(i=>{this.objectUpdatesService.reinstateFieldUpdates(i.self)})})}isReinstatable(){return this.bundles$.pipe((0,T.n)(e=>(0,$.z)(e.map(i=>this.objectUpdatesService.isReinstatable(i.self)))),(0,g.T)(e=>e.includes(!0)))}hasChanges(){return this.bundles$.pipe((0,T.n)(e=>(0,$.z)(e.map(i=>this.objectUpdatesService.hasUpdates(i.self)))),(0,g.T)(e=>e.includes(!0)))}ngOnDestroy(){this.itemUpdateSubscription&&this.itemUpdateSubscription.unsubscribe()}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(w.ItemDataService),t.rXU(z.F),t.rXU(u.Ix),t.rXU(X.I),t.rXU(p.c$),t.rXU(u.nX),t.rXU(se.BitstreamDataService),t.rXU(Bt.$),t.rXU(ht.B),t.rXU(t.gRc),t.rXU(Gt.BundleDataService),t.rXU(t.SKi))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-bitstreams"]],standalone:!0,features:[t.Jv_([gt]),t.Vt3,t.aNF],decls:2,vars:3,consts:[["class","item-bitstreams",4,"ngVar"],[1,"item-bitstreams"],[1,"button-row","top","d-flex","mt-2","space-children-mr"],[1,"mr-auto","btn","btn-success",3,"routerLink"],[1,"fas","fa-upload"],[1,"d-none","d-sm-inline"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fas","fa-save"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","container table-bordered mt-4",4,"ngIf"],["class","alert alert-info w-100 d-inline-block mt-4","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],[1,"button-row","bottom"],[1,"mt-4","float-right","space-children-mr","ml-gap"],[1,"btn","btn-warning",3,"click"],[1,"fas","fa-undo-alt"],[1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-times"],[1,"container","table-bordered","mt-4"],[1,"row","header-row","font-weight-bold"],[3,"bundle","item","columnSizes","dropObject",4,"ngFor","ngForOf"],[3,"dropObject","bundle","item","columnSizes"],["role","alert",1,"alert","alert-info","w-100","d-inline-block","mt-4"],[3,"message"]],template:function(i,s){1&i&&(t.DNE(0,Je,35,42,"div",0),t.nI1(1,"async")),2&i&&t.Y8G("ngVar",t.bMT(1,1,s.bundles$))},dependencies:[h.Jj,p.h,p.D9,Pe,u.Wk,h.bT,q.r,St,h.Sq,lt.v],styles:[".header-row[_ngcontent-%COMP%]{color:var(--bs-table-dark-color);background-color:var(--bs-table-dark-bg);border-color:var(--bs-table-dark-border-color)}.bundle-row[_ngcontent-%COMP%]{color:var(--bs-table-head-color);background-color:var(--bs-table-head-bg);border-color:var(--bs-table-border-color)}.row-element[_ngcontent-%COMP%]{padding:.75em;border-bottom:var(--bs-table-border-width) solid var(--bs-table-border-color)}.drag-handle[_ngcontent-%COMP%]{visibility:hidden}.drag-handle[_ngcontent-%COMP%]:hover, .bitstream-row-drag-handle[_ngcontent-%COMP%]:hover{cursor:move}[_nghost-%COMP%]     .bitstream-row:hover .drag-handle, [_nghost-%COMP%]     .bitstream-row-drag-handle:focus .drag-handle{visibility:visible!important}.cdk-drag-preview[_ngcontent-%COMP%]{margin-left:0;box-sizing:border-box;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.cdk-drop-list-dragging[_ngcontent-%COMP%]   .bitstream-row-drag-handle[_ngcontent-%COMP%], .cdk-drop-list-dragging[_ngcontent-%COMP%]   .drag-handle[_ngcontent-%COMP%]{cursor:grabbing}[_nghost-%COMP%]     .larger-tooltip .tooltip-inner{max-width:500px}"]})}return n})();var Nt=o(30593),Qe=o(8109),Ft=o(69509),Lt=o(67811),He=o(3631),Z=o(10936),Ze=o(68605),qe=o(96606),ti=o(79944),ei=o(52867);const ii=(n,l)=>({"btn-danger":n,"btn-primary":l});function ni(n,l){if(1&n){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"input",12,0),t.nI1(4,"async"),t.nI1(5,"async"),t.nI1(6,"translate"),t.bIt("change",function(){const s=t.eBV(e).$implicit,a=t.XpG(3);return t.Njj(a.switch(s.dso.id))}),t.k0s()(),t.j41(7,"td")(8,"a",13),t.EFF(9),t.k0s()()()}if(2&n){const e=l.$implicit,i=t.sdS(3),s=t.XpG(3);t.R7$(2),t.FS9("name",e.dso.id),t.Y8G("disabled",!1===t.bMT(4,6,e.canSelect$))("ngModel",t.bMT(5,8,e.selected$)),t.BMQ("aria-label",t.bMT(6,10,i.checked?"collection.select.table.deselect":"collection.select.table.select")),t.R7$(6),t.Y8G("routerLink",e.route),t.R7$(),t.JRh(s.dsoNameService.getName(e.dso))}}function si(n,l){if(1&n&&(t.j41(0,"ds-pagination",6)(1,"div",7)(2,"table",8)(3,"thead")(4,"tr")(5,"th")(6,"span",9),t.EFF(7),t.nI1(8,"translate"),t.k0s()(),t.j41(9,"th",10),t.EFF(10),t.nI1(11,"translate"),t.k0s()()(),t.j41(12,"tbody"),t.DNE(13,ni,10,12,"tr",11),t.nI1(14,"async"),t.k0s()()()()),2&n){const e=t.XpG().ngVar,i=t.XpG();t.Y8G("paginationOptions",i.paginationOptions)("sortOptions",i.sortOptions)("collectionSize",null==e||null==e.payload?null:e.payload.totalElements)("hidePagerWhenSinglePage",!0)("hideGear",!0),t.R7$(7),t.JRh(t.bMT(8,8,"collection.select.table.selected")),t.R7$(3),t.JRh(t.bMT(11,10,"collection.select.table.title")),t.R7$(3),t.Y8G("ngForOf",t.bMT(14,12,i.selectCollections$))}}function ai(n,l){1&n&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"collection.select.empty")," "))}function oi(n,l){1&n&&(t.nrm(0,"ds-error",15),t.nI1(1,"translate")),2&n&&t.FS9("message",t.bMT(1,1,"error.collections"))}function ri(n,l){1&n&&(t.nrm(0,"ds-loading",15),t.nI1(1,"translate")),2&n&&t.FS9("message",t.bMT(1,1,"loading.collections"))}function li(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",16)(1,"button",17),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.onCancel())}),t.nrm(2,"i",18),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"button",19),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.confirmSelected())}),t.nrm(6,"i",20),t.EFF(7),t.nI1(8,"translate"),t.k0s()()}if(2&n){const e=l.ngVar,i=t.XpG(2);t.R7$(3),t.SpI(" ",t.bMT(4,4,i.cancelButton)," "),t.R7$(2),t.Y8G("ngClass",t.l_i(8,ii,i.dangerConfirm,!i.dangerConfirm))("disabled",0===(null==e?null:e.length)),t.R7$(2),t.SpI(" ",t.bMT(8,6,i.confirmButton)," ")}}function ci(n,l){if(1&n&&(t.qex(0),t.DNE(1,si,15,14,"ds-pagination",2)(2,ai,3,3,"div",3)(3,oi,2,3,"ds-error",4)(4,ri,2,3,"ds-loading",4)(5,li,9,11,"div",5),t.nI1(6,"async"),t.bVm()),2&n){const e=l.ngVar,i=t.XpG();t.R7$(),t.Y8G("ngIf",(null==e||null==e.payload?null:e.payload.totalElements)>0||(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)>0),t.R7$(),t.Y8G("ngIf",0===(null==e||null==e.payload?null:e.payload.totalElements)||0===(null==e||null==e.payload||null==e.payload.page?null:e.payload.page.length)),t.R7$(),t.Y8G("ngIf",null==e?null:e.hasFailed),t.R7$(),t.Y8G("ngIf",!e||(null==e?null:e.isLoading)),t.R7$(),t.Y8G("ngVar",t.bMT(6,5,i.selectedIds$))}}let di=(()=>{class n extends ei.h{ngOnInit(){super.ngOnInit(),(0,b.hj)(this.confirmButton)||(this.confirmButton="collection.select.confirm"),this.selectCollections$=this.dsoRD$.pipe((0,b.Az)(),(0,m.Hz)(),(0,g.T)(e=>e.page.map(i=>Object.assign(new ti.A,{dso:i,canSelect$:this.canSelect(i),selected$:this.getSelected(i.id),route:(0,Ze.JW)(i.id)}))))}static#t=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}})();static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-collection-select"]],standalone:!0,features:[t.Vt3,t.aNF],decls:2,vars:3,consts:[["selectCollectionBtn",""],[4,"ngVar"],[3,"paginationOptions","sortOptions","collectionSize","hidePagerWhenSinglePage","hideGear",4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[3,"message",4,"ngIf"],["class","space-children-mr float-right",4,"ngVar"],[3,"paginationOptions","sortOptions","collectionSize","hidePagerWhenSinglePage","hideGear"],[1,"table-responsive","mt-2"],["id","collection-select",1,"table","table-striped","table-hover"],[1,"sr-only"],["scope","col"],[4,"ngFor","ngForOf"],["type","checkbox",1,"collection-checkbox",3,"change","disabled","ngModel","name"],[3,"routerLink"],["role","alert",1,"alert","alert-info","w-100"],[3,"message"],[1,"space-children-mr","float-right"],[1,"btn","btn-outline-secondary","collection-cancel",3,"click"],[1,"fas","fa-times"],[1,"btn","collection-confirm",3,"click","ngClass","disabled"],[1,"fas","fa-trash"]],template:function(i,s){1&i&&(t.DNE(0,ci,7,7,"ng-container",1),t.nI1(1,"async")),2&i&&t.Y8G("ngVar",t.bMT(1,1,s.dsoRD$))},dependencies:[q.r,h.bT,ft.e,h.pM,Z.YN,Z.Zm,Z.BC,Z.vS,u.Wk,qe.A,lt.v,h.YU,h.Jj,p.h,p.D9],styles:["table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type, table[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type{width:1rem!important}"]})}return n})();var mi=o(85941);const pi=["tabs"],ui=n=>({name:n});function hi(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",11)(1,"ds-collection-select",12),t.nI1(2,"async"),t.bIt("confirm",function(s){t.eBV(e);const a=t.XpG();return t.Njj(a.removeMappings(s))})("cancel",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.onCancel())}),t.k0s()()}if(2&n){let e;const i=t.XpG();t.R7$(),t.Y8G("key","browse")("dsoRD$",i.itemCollectionsRD$)("paginationOptions",null==(e=t.bMT(2,6,i.searchOptions$))?null:e.pagination)("confirmButton","item.edit.item-mapper.buttons.remove")("cancelButton","item.edit.item-mapper.cancel")("dangerConfirm",!0)}}function gi(n,l){if(1&n){const e=t.RV6();t.j41(0,"div")(1,"ds-collection-select",18),t.nI1(2,"async"),t.nI1(3,"async"),t.bIt("confirm",function(s){t.eBV(e);const a=t.XpG(2);return t.Njj(a.mapCollections(s))})("cancel",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.onCancel())}),t.k0s()()}if(2&n){let e,i;const s=t.XpG(2);t.R7$(),t.Y8G("key","map")("dsoRD$",s.mappedCollectionsRD$)("paginationOptions",null==(e=t.bMT(2,6,s.searchOptions$))?null:e.pagination)("sortOptions",null==(i=t.bMT(3,8,s.searchOptions$))?null:i.sort)("confirmButton","item.edit.item-mapper.buttons.add")("cancelButton","item.edit.item-mapper.cancel")}}function bi(n,l){1&n&&(t.j41(0,"div",19),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"item.edit.item-mapper.no-search")," "))}function fi(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"ds-search-form",15),t.nI1(3,"async"),t.nI1(4,"translate"),t.bIt("submitSearch",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.performedSearch=!0)}),t.k0s()()(),t.DNE(5,gi,4,10,"div",16)(6,bi,3,3,"div",17)}if(2&n){let e;const i=t.XpG();t.R7$(2),t.Y8G("query",null==(e=t.bMT(3,6,i.searchOptions$))?null:e.query)("currentUrl","./")("inPlaceSearch",!0)("searchPlaceholder",t.bMT(4,8,"item.edit.item-mapper.search-form.placeholder")),t.R7$(3),t.Y8G("ngIf",i.performedSearch),t.R7$(),t.Y8G("ngIf",!i.performedSearch)}}let Yt=(()=>{class n{constructor(e,i,s,a,r,d,_,j,B){this.route=e,this.router=i,this.searchConfigService=s,this.searchService=a,this.notificationsService=r,this.itemDataService=d,this.collectionDataService=_,this.translateService=j,this.dsoNameService=B,this.performedSearch=!1}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,C.s)(1),(0,g.T)(e=>e.dso)),this.itemName$=this.itemRD$.pipe((0,v.p)(e=>(0,b.a4)(e)),(0,g.T)(e=>this.dsoNameService.getName(e.payload))),this.searchOptions$=this.searchConfigService.paginatedSearchOptions,this.loadCollectionLists()}loadCollectionLists(){this.shouldUpdate$=new I.t(!0),this.itemCollectionsRD$=(0,$.z)(this.itemRD$.pipe((0,m.ak)()),this.shouldUpdate$).pipe((0,T.n)(([s,a])=>(!0===a&&this.shouldUpdate$.next(!1),this.collectionDataService.findListByHref(this.itemDataService.getMappedCollectionsEndpoint(s.id),void 0,!a,!1).pipe((0,m.v7)()))));const e=this.itemRD$.pipe((0,m.ak)(),(0,T.n)(s=>this.collectionDataService.findOwningCollectionFor(s)),(0,m.v7)()),i=(0,$.z)(this.itemCollectionsRD$,e,this.searchOptions$);this.mappedCollectionsRD$=i.pipe((0,T.n)(([s,a,r])=>this.searchService.search(Object.assign(new Rt.C(r),{query:this.buildQuery([...s.payload.page,a.payload],r.query),dsoTypes:[Ft.W.COLLECTION]}),1e4).pipe((0,m.jY)(),(0,Nt.Z)(void 0))))}mapCollections(e){const s=(0,$.z)([this.itemRD$.pipe((0,m.yd)(),(0,g.T)(a=>a.payload),(0,g.T)(a=>a.id)),this.itemCollectionsRD$.pipe((0,m.yd)(),(0,g.T)(a=>a.payload.page),(0,g.T)(a=>a.map(r=>r.id)))]).pipe((0,T.n)(([a,r])=>(0,$.z)(this.filterIds(e,r).map(d=>this.itemDataService.mapToCollection(a,d).pipe((0,m.qD)())))));this.showNotifications(s,"item.edit.item-mapper.notifications.add")}removeMappings(e){const i=this.itemRD$.pipe((0,m.yd)(),(0,g.T)(s=>s.payload.id),(0,T.n)(s=>(0,$.z)(e.map(a=>this.itemDataService.removeMappingFromCollection(s,a).pipe((0,m.qD)())))));this.showNotifications(i,"item.edit.item-mapper.notifications.remove")}filterIds(e,i){return e.filter(s=>i.indexOf(s)<0)}showNotifications(e,i){e.subscribe(s=>{const a=s.filter(d=>d.hasSucceeded),r=s.filter(d=>d.hasFailed);a.length>0&&((0,$.z)([this.translateService.get(`${i}.success.head`),this.translateService.get(`${i}.success.content`,{amount:a.length})]).subscribe(([_,j])=>{this.notificationsService.success(_,j)}),this.shouldUpdate$.next(!0)),r.length>0&&(0,$.z)([this.translateService.get(`${i}.error.head`),this.translateService.get(`${i}.error.content`,{amount:r.length})]).subscribe(([_,j])=>{this.notificationsService.error(_,j)}),this.switchToFirstTab()})}tabChange(e){this.performedSearch=!1,this.router.navigateByUrl(this.getCurrentUrl())}getCurrentUrl(){return this.router.url.indexOf("?")>-1?this.router.url.substring(0,this.router.url.indexOf("?")):this.router.url}buildQuery(e,i){let s=i;for(const a of e)s=this.addExcludeCollection(a.id,s);return s}addExcludeCollection(e,i){const s=`-search.resourceid:${e}`;return(0,b.hj)(i)?`${i} AND ${s}`:s}switchToFirstTab(){this.tabs.select("browseTab")}onCancel(){this.itemRD$.pipe((0,m.yd)(),(0,m.Bo)(),(0,C.s)(1)).subscribe(e=>{this.router.navigate([(0,V._o)(e)])})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(He.g),t.rXU(Lt.S),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(Qe.CollectionDataService),t.rXU(p.c$),t.rXU(J.f))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-collection-mapper"]],viewQuery:function(i,s){if(1&i&&t.GBs(pi,5),2&i){let a;t.mGM(a=t.lsd())&&(s.tabs=a.first)}},standalone:!0,features:[t.aNF],decls:25,vars:24,consts:[["tabs","ngbNav"],[1,"container","mt-2"],[1,"row"],[1,"col-12"],["id","item-name",3,"innerHTML"],["ngbNav","",1,"nav-tabs",3,"navChange","destroyOnHide"],["role","presentation","data-test","browseTab",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],["role","presentation","data-test","mapTab",3,"ngbNavItem"],[3,"ngbNavOutlet"],[1,"mt-2"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","confirmButton","cancelButton","dangerConfirm"],[1,"row","mt-2"],[1,"col-12","col-lg-6"],["id","search-form",3,"submitSearch","query","currentUrl","inPlaceSearch","searchPlaceholder"],[4,"ngIf"],["class","alert alert-info w-100","role","alert",4,"ngIf"],[1,"mt-2",3,"confirm","cancel","key","dsoRD$","paginationOptions","sortOptions","confirmButton","cancelButton"],["role","alert",1,"alert","alert-info","w-100"]],template:function(i,s){if(1&i){const a=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"p",4),t.nI1(7,"async"),t.nI1(8,"translate"),t.j41(9,"p"),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"ul",5,0),t.bIt("navChange",function(d){return t.eBV(a),t.Njj(s.tabChange(d))}),t.j41(14,"li",6)(15,"a",7),t.EFF(16),t.nI1(17,"translate"),t.k0s(),t.DNE(18,hi,3,8,"ng-template",8),t.k0s(),t.j41(19,"li",9)(20,"a",7),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.DNE(23,fi,7,10,"ng-template",8),t.k0s()(),t.nrm(24,"div",10),t.k0s()()()}if(2&i){const a=t.sdS(13);t.R7$(4),t.JRh(t.bMT(5,9,"item.edit.item-mapper.head")),t.R7$(2),t.Y8G("innerHTML",t.i5U(8,13,"item.edit.item-mapper.item",t.eq3(22,ui,t.bMT(7,11,s.itemName$))),t.npT),t.R7$(4),t.JRh(t.bMT(11,16,"item.edit.item-mapper.description")),t.R7$(2),t.Y8G("destroyOnHide",!0),t.R7$(2),t.Y8G("ngbNavItem","browseTab"),t.R7$(2),t.JRh(t.bMT(17,18,"item.edit.item-mapper.tabs.browse")),t.R7$(3),t.Y8G("ngbNavItem","mapTab"),t.R7$(2),t.JRh(t.bMT(22,20,"item.edit.item-mapper.tabs.map")),t.R7$(3),t.Y8G("ngbNavOutlet",a)}},dependencies:[R.Pv,R.Um,R.X9,R.sy,R.Ri,R.m_,di,mi.d,h.Jj,p.h,p.D9,h.bT],data:{animation:[it.qG,it.Ws]},changeDetection:0})}return n})();var vi=o(62230);const _i=n=>({item:n});function Ii(n,l){if(1&n&&t.nrm(0,"ds-curation-form",2),2&n){const e=l.ngIf;t.Y8G("dsoHandle",null==e?null:e.payload.handle)}}let Ti=(()=>{class n{constructor(e,i){this.route=e,this.dsoNameService=i}ngOnInit(){this.dsoRD$=this.route.parent.data.pipe((0,C.s)(1),(0,g.T)(e=>e.dso)),this.itemName$=this.dsoRD$.pipe((0,v.p)(e=>(0,b.a4)(e)),(0,g.T)(e=>this.dsoNameService.getName(e.payload)))}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(J.f))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-curate"]],standalone:!0,features:[t.aNF],decls:7,vars:11,consts:[[1,"container","mt-3"],[3,"dsoHandle",4,"ngIf"],[3,"dsoHandle"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"h2"),t.EFF(2),t.nI1(3,"async"),t.nI1(4,"translate"),t.k0s(),t.DNE(5,Ii,1,1,"ds-curation-form",1),t.nI1(6,"async"),t.k0s()),2&i&&(t.R7$(2),t.JRh(t.i5U(4,4,"item.edit.curate.title",t.eq3(9,_i,t.bMT(3,2,s.itemName$)))),t.R7$(3),t.Y8G("ngIf",t.bMT(6,7,s.dsoRD$)))},dependencies:[vi.X,h.bT,p.h,p.D9,h.Jj],encapsulation:2})}return n})();var Dt=o(45670),Ot=o(24119),vt=o(96459),zt=o(88842),kt=o(47637),tt=o(34199);const $i=n=>({id:n}),Ci=n=>[n,"edit"];let at=(()=>{class n{constructor(e,i,s,a,r){this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.translateService=r}ngOnInit(){this.itemRD$=this.route.data.pipe((0,g.T)(e=>e.dso),(0,m.yd)()),this.itemRD$.pipe((0,O.$)()).subscribe(e=>{this.item=e.payload,this.itemPageRoute=(0,V._o)(this.item)}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){}processRestResponse(e){e.hasSucceeded?this.itemDataService.findById(this.item.id).pipe((n=>l=>l.pipe((0,m.v7)(),(0,O.$)(n)))(i=>this.predicate(i))).subscribe(()=>{this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([(0,V.$r)(this.item)])}):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,V.$r)(this.item)]))}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(p.c$))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-simple-action"]],standalone:!0,features:[t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return s.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,s.headerMessage,t.eq3(15,$i,s.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,s.descriptionMessage)),t.R7$(2),t.Y8G("item",s.item),t.R7$(3),t.SpI("",t.bMT(13,11,s.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,Ci,s.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,s.cancelMessage)," "))},dependencies:[tt.W,p.h,p.D9,u.Wk],encapsulation:2})}return n})();const Ri=n=>({id:n}),Mi=n=>[n,"edit"];function Si(n,l){if(1&n&&t.nrm(0,"ds-listable-object-component-loader",24),2&n){const e=t.XpG().ngVar,i=t.XpG(6);t.Y8G("object",e)("viewMode",i.viewMode)}}function ji(n,l){if(1&n&&t.nrm(0,"ds-listable-object-component-loader",24),2&n){const e=t.XpG(2).ngVar,i=t.XpG(6);t.Y8G("object",e)("viewMode",i.viewMode)}}function Fi(n,l){if(1&n&&(t.j41(0,"div")(1,"div")(2,"div",31),t.EFF(3),t.k0s(),t.j41(4,"div"),t.EFF(5),t.k0s()()()),2&n){const e=l.$implicit;t.R7$(3),t.SpI(" ",e.metadataField," "),t.R7$(2),t.SpI(" ",e.metadataValue.value," ")}}function Di(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",25)(1,"div",26),t.EFF(2),t.nI1(3,"translate"),t.j41(4,"button",27),t.bIt("click",function(){t.eBV(e);const s=t.XpG(7);return t.Njj(s.closeVirtualMetadataModal())}),t.j41(5,"span",28),t.EFF(6,"\xd7"),t.k0s()()(),t.j41(7,"div",29),t.DNE(8,ji,1,2,"ds-listable-object-component-loader",19)(9,Fi,6,2,"div",30),t.nI1(10,"async"),t.k0s()()}if(2&n){const e=t.XpG().ngVar,i=t.XpG().$implicit;t.R7$(2),t.SpI(" ",t.bMT(3,3,"virtual-metadata.delete-item.modal-head")," "),t.R7$(6),t.Y8G("ngIf",e),t.R7$(),t.Y8G("ngForOf",t.bMT(10,5,i.virtualMetadata$))}}function Oi(n,l){if(1&n){const e=t.RV6();t.qex(0),t.DNE(1,Si,1,2,"ds-listable-object-component-loader",19),t.j41(2,"div",20)(3,"div",21)(4,"button",22),t.bIt("click",function(){t.eBV(e);const s=t.sdS(7),a=t.XpG(6);return t.Njj(a.openVirtualMetadataModal(s))}),t.nrm(5,"i",23),t.k0s()()(),t.DNE(6,Di,11,7,"ng-template",null,0,t.C5r),t.bVm()}if(2&n){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e)}}function ki(n,l){if(1&n&&(t.j41(0,"div",13),t.DNE(1,Oi,8,1,"ng-container",5),t.nI1(2,"async"),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.relatedItem$))}}function Ei(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",13)(1,"div",14),t.bIt("click",function(){const s=t.eBV(e).ngVar,a=t.XpG().$implicit,r=t.XpG(3);return t.Njj(r.setSelected(a.relationshipType,!s))}),t.j41(2,"label"),t.nrm(3,"input",15),t.nI1(4,"async"),t.k0s()(),t.j41(5,"div",16)(6,"h5",17),t.bIt("click",function(){const s=t.eBV(e).ngVar,a=t.XpG().$implicit,r=t.XpG(3);return t.Njj(r.setSelected(a.relationshipType,!s))}),t.EFF(7),t.nI1(8,"async"),t.nI1(9,"translate"),t.k0s(),t.DNE(10,ki,3,3,"div",18),t.nI1(11,"async"),t.k0s()()}if(2&n){const e=l.ngVar,i=t.XpG().$implicit,s=t.XpG(3);t.R7$(3),t.Y8G("checked",e)("disabled",t.bMT(4,4,s.isDeleting$)),t.R7$(4),t.SpI(" ",t.bMT(9,8,s.getRelationshipMessageKey(t.bMT(8,6,i.label$)))," "),t.R7$(3),t.Y8G("ngForOf",t.bMT(11,10,i.relationshipDTOs$))}}function Ui(n,l){if(1&n&&(t.j41(0,"div",10),t.DNE(1,Ei,12,12,"div",12),t.nI1(2,"async"),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.isSelected$))}}function xi(n,l){if(1&n&&(t.j41(0,"div",10),t.EFF(1),t.nI1(2,"translate"),t.DNE(3,Ui,3,3,"div",11),t.k0s()),2&n){const e=t.XpG().ngVar;t.R7$(),t.SpI(" ",t.bMT(2,2,"virtual-metadata.delete-item.info")," "),t.R7$(2),t.Y8G("ngForOf",e)}}function Bi(n,l){if(1&n&&(t.qex(0),t.DNE(1,xi,4,4,"div",9),t.bVm()),2&n){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e&&e.length>0)}}class Gi{}class Pi{}let Vi=(()=>{class n extends at{constructor(e,i,s,a,r,d,_,j,B,K){super(e,i,s,a,r),this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.translateService=r,this.modalService=d,this.objectUpdatesService=_,this.relationshipService=j,this.entityTypeService=B,this.linkService=K,this.messageKey="delete",this.viewMode=zt.n.ListElement,this.typeDTOs$=new I.t([]),this.relationships$=new Map,this.relatedItems$=new Map,this.virtualMetadata$=new Map,this.subs=[],this.isDeleting$=new I.t(!1)}ngOnInit(){super.ngOnInit(),this.url=this.router.url;const e=this.item.firstMetadataValue("dspace.entity.type");(0,b.hj)(e)&&this.subs.push(this.entityTypeService.getEntityTypeByLabel(e).pipe((0,m.yd)(),(0,m.Bo)(),(0,T.n)(i=>this.entityTypeService.getEntityTypeRelationships(i.id)),(0,m.yd)(),(0,m.Bo)(),(0,g.T)(i=>i.page),(0,T.n)(i=>0===i.length?(0,y.of)(i):(0,$.z)(i.map(s=>this.getRelationships(s))).pipe((0,g.T)(s=>i.reduce((a,r,d)=>a.some(_=>_.id===r.id)||0===s[d].length?a:[...a,r],[]))))).subscribe(i=>this.typeDTOs$.next(i.map(s=>Object.assign(new Gi,{relationshipType:s,isSelected$:this.isSelected(s),label$:this.getLabel(s),relationshipDTOs$:this.getRelationships(s).pipe((0,g.T)(a=>a.map(r=>Object.assign(new Pi,{relationship:r,relatedItem$:this.getRelatedItem(r),virtualMetadata$:this.getVirtualMetadata(r)}))))}))))),this.subs.push(this.typeDTOs$.pipe((0,C.s)(1)).subscribe(i=>this.objectUpdatesService.initialize(this.url,i.map(s=>s.relationshipType),this.item.lastModified)))}openVirtualMetadataModal(e){this.modalRef=this.modalService.open(e)}closeVirtualMetadataModal(){this.modalRef.close()}getRelationshipMessageKey(e){return(0,b.a4)(e)&&e.indexOf("Of")>-1?`relationships.${e.substring(0,e.indexOf("Of")+2)}`:e}getLabel(e){return this.getRelationships(e).pipe((0,T.n)(i=>this.isLeftItem(i[0]).pipe((0,g.T)(s=>s?e.leftwardType:e.rightwardType))))}getRelationships(e){return this.relationships$.has(e)||this.relationships$.set(e,this.relationshipService.getItemRelationshipsArray(this.item).pipe((0,T.n)(i=>(0,$.z)(i.map(s=>this.getRelationshipType(s))).pipe((0,Dt.U)([]),(0,g.T)(s=>i.filter((a,r)=>e.id===s[r].id)))))),this.relationships$.get(e)}getRelationshipType(e){return this.linkService.resolveLinks(e,(0,U.s)("relationshipType"),(0,U.s)("leftItem"),(0,U.s)("rightItem")),e.relationshipType.pipe((0,m.yd)(),(0,m.Bo)(),(0,v.p)(i=>(0,b.a4)(i)&&(0,b.hj)(i.uuid)))}getRelatedItem(e){return this.relatedItems$.has(e)||this.relatedItems$.set(e,this.isLeftItem(e).pipe((0,T.n)(i=>i?e.rightItem:e.leftItem),(0,m.yd)(),(0,m.Bo)())),this.relatedItems$.get(e)}getVirtualMetadata(e){return this.virtualMetadata$.has(e)||this.virtualMetadata$.set(e,this.getRelatedItem(e).pipe((0,g.T)(i=>Object.entries(i.metadata).map(([s,a])=>a.filter(r=>r.authority&&r.authority.endsWith(e.id)).map(r=>({metadataField:s,metadataValue:r}))).reduce((s,a)=>s.concat(a))))),this.virtualMetadata$.get(e)}isLeftItem(e){return e.leftItem.pipe((0,m.yd)(),(0,m.Bo)(),(0,v.p)(i=>(0,b.a4)(i)&&(0,b.hj)(i.uuid)),(0,g.T)(i=>i.uuid===this.item.uuid))}isSelected(e){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.item.uuid,e.uuid)}setSelected(e,i){!1===this.isDeleting$.value&&this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.item.uuid,e.uuid,i)}performAction(){this.isDeleting$.next(!0),this.subs.push(this.typeDTOs$.pipe((0,T.n)(e=>(0,$.z)(e.map(i=>i.isSelected$)).pipe((0,Dt.U)([]),(0,g.T)(i=>e.filter((s,a)=>i[a])),(0,g.T)(i=>i.map(s=>s.relationshipType.id)))),(0,T.n)(e=>this.itemDataService.delete(this.item.id,e)),(0,m.qD)()).subscribe(e=>{this.notify(e.hasSucceeded)}))}notify(e){e?(this.notificationsService.success(this.translateService.get("item.edit."+this.messageKey+".success")),this.router.navigate([""])):(this.notificationsService.error(this.translateService.get("item.edit."+this.messageKey+".error")),this.router.navigate([(0,V.$r)(this.item)]))}ngOnDestroy(){this.subs.filter(e=>(0,b.a4)(e)).forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(p.c$),t.rXU(R.Bq),t.rXU(z.F),t.rXU(vt.RelationshipDataService),t.rXU(Ot.f),t.rXU(nt._))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-delete"]],inputs:{url:"url"},standalone:!0,features:[t.Vt3,t.aNF],decls:21,vars:28,consts:[["virtualMetadataModal",""],[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[4,"ngVar"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click","disabled"],[1,"btn","btn-outline-secondary","cancel",3,"disabled","routerLink"],["class","mb-4",4,"ngIf"],[1,"mb-4"],["class","mb-4",4,"ngFor","ngForOf"],["class","d-flex flex-row",4,"ngVar"],[1,"d-flex","flex-row"],[1,"m-2",3,"click"],["type","checkbox",3,"checked","disabled"],[1,"flex-column","flex-grow-1"],[3,"click"],["class","d-flex flex-row",4,"ngFor","ngForOf"],[3,"object","viewMode",4,"ngIf"],[1,"ml-auto"],[1,"btn-group"],[1,"btn","btn-outline-info","btn-sm",3,"click"],[1,"fas","fa-info","fa-fw"],[3,"object","viewMode"],[1,"thumb-font-1"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(i,s){1&i&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",4),t.DNE(10,Bi,2,1,"ng-container",5),t.nI1(11,"async"),t.j41(12,"div",6)(13,"button",7),t.nI1(14,"async"),t.bIt("click",function(){return s.performAction()}),t.EFF(15),t.nI1(16,"translate"),t.k0s(),t.j41(17,"button",8),t.nI1(18,"async"),t.EFF(19),t.nI1(20,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,9,s.headerMessage,t.eq3(24,Ri,s.item.handle))),t.R7$(3),t.JRh(t.bMT(8,12,s.descriptionMessage)),t.R7$(2),t.Y8G("item",s.item),t.R7$(),t.Y8G("ngVar",t.bMT(11,14,s.typeDTOs$)),t.R7$(3),t.Y8G("disabled",t.bMT(14,16,s.isDeleting$)),t.R7$(2),t.SpI("",t.bMT(16,18,s.confirmMessage)," "),t.R7$(2),t.Y8G("disabled",t.bMT(18,20,s.isDeleting$))("routerLink",t.eq3(26,Mi,s.itemPageRoute)),t.R7$(2),t.SpI(" ",t.bMT(20,22,s.cancelMessage)," "))},dependencies:[p.h,p.D9,kt.v,h.bT,tt.W,h.Jj,q.r,h.Sq,u.Wk],encapsulation:2})}return n})();var wi=o(46002);const Xi=n=>({id:n}),Ni=n=>({type:n}),Li=n=>[n,"edit"];function Yi(n,l){1&n&&(t.EFF(0),t.nI1(1,"translate")),2&n&&t.SpI(" ",t.bMT(1,1,"item.edit.move.inheritpolicies.tooltip")," ")}function zi(n,l){1&n&&(t.j41(0,"span"),t.nrm(1,"i",18),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"item.edit.move.save-button")," "))}function Ai(n,l){1&n&&(t.j41(0,"span"),t.nrm(1,"i",19),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"item.edit.move.processing")," "))}let Wi=(()=>{class n{constructor(e,i,s,a,r,d,_,j){this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.searchService=r,this.translateService=d,this.requestService=_,this.dsoNameService=j,this.selectorType=Ft.W.COLLECTION,this.inheritPolicies=!1,this.canSubmit=!1,this.processing=!1,this.COLLECTIONS=[Ft.W.COLLECTION]}ngOnInit(){this.itemRD$=this.route.data.pipe((0,g.T)(e=>e.dso),(0,m.yd)()),this.itemPageRoute$=this.itemRD$.pipe((0,m.Hz)(),(0,g.T)(e=>(0,V._o)(e))),this.itemRD$.subscribe(e=>{this.item=e.payload}),this.itemRD$.pipe((0,m.yd)(),(0,m.Bo)(),(0,T.n)(e=>e.owningCollection),(0,m.yd)(),(0,m.Bo)()).subscribe(e=>{this.originalCollection=e})}selectDso(e){this.selectedCollection=e,this.selectedCollectionName=this.dsoNameService.getName(e),this.canSubmit=!0}getCurrentUrl(){return this.router.url}moveToCollection(){this.processing=!0;const e=this.itemDataService.moveToCollection(this.item.id,this.selectedCollection,this.inheritPolicies).pipe((0,m.qD)());e.subscribe(i=>{i.hasSucceeded?this.notificationsService.success(this.translateService.get("item.edit.move.success")):this.notificationsService.error(this.translateService.get("item.edit.move.error"))}),e.pipe((0,T.n)(()=>this.requestService.setStaleByHrefSubstring(this.item.id)),(0,T.n)(()=>this.itemDataService.findById(this.item.id,!1,!0,(0,U.s)("owningCollection"))),(0,m.qD)()).subscribe(()=>{this.processing=!1,this.router.navigate([(0,V.$r)(this.item)])})}discard(){this.selectedCollection=null,this.canSubmit=!1}get canMove(){return this.canSubmit&&this.selectedCollection?.id!==this.originalCollection.id}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(Lt.S),t.rXU(p.c$),t.rXU(ht.B),t.rXU(J.f))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-move"]],standalone:!0,features:[t.aNF],decls:46,vars:44,consts:[["tooltipContent",""],[1,"container"],[1,"row"],[1,"col-12"],[1,"card","mb-3"],[1,"card-header"],[1,"card-body"],[3,"onSelect","types","currentDSOId"],["for","inheritPoliciesCheckbox"],["type","checkbox","name","tc","id","inheritPoliciesCheckbox",3,"ngModelChange","ngModel","ngbTooltip"],[1,"button-row","bottom"],[1,"float-right","space-children-mr"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"click","disabled"],[4,"ngIf"],[1,"btn","btn-danger",3,"click","disabled"],[1,"fas","fa-times"],[1,"fas","fa-save"],[1,"fas","fa-circle-notch","fa-spin"]],template:function(i,s){if(1&i){const a=t.RV6();t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h1"),t.EFF(4),t.nI1(5,"async"),t.nI1(6,"translate"),t.k0s(),t.j41(7,"p"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",2)(11,"div",3)(12,"div",4)(13,"div",5),t.EFF(14),t.nI1(15,"translate"),t.nI1(16,"translate"),t.k0s(),t.j41(17,"div",6)(18,"ds-authorized-collection-selector",7),t.bIt("onSelect",function(d){return t.eBV(a),t.Njj(s.selectDso(d))}),t.k0s()(),t.nrm(19,"div"),t.k0s()()(),t.j41(20,"div",2)(21,"div",3)(22,"p")(23,"label",8),t.DNE(24,Yi,2,3,"ng-template",null,0,t.C5r),t.j41(26,"input",9),t.mxI("ngModelChange",function(d){return t.eBV(a),t.DH7(s.inheritPolicies,d)||(s.inheritPolicies=d),t.Njj(d)}),t.k0s(),t.EFF(27),t.nI1(28,"translate"),t.k0s()(),t.j41(29,"p"),t.EFF(30),t.nI1(31,"translate"),t.k0s()()(),t.j41(32,"div",10)(33,"div",11)(34,"button",12),t.nI1(35,"async"),t.nrm(36,"i",13),t.EFF(37),t.nI1(38,"translate"),t.k0s(),t.j41(39,"button",14),t.bIt("click",function(){return t.eBV(a),t.Njj(s.moveToCollection())}),t.DNE(40,zi,4,3,"span",15)(41,Ai,4,3,"span",15),t.k0s(),t.j41(42,"button",16),t.bIt("click",function(){return t.eBV(a),t.Njj(s.discard())}),t.nrm(43,"i",17),t.EFF(44),t.nI1(45,"translate"),t.k0s()()()()()()}if(2&i){let a;const r=t.sdS(25);t.R7$(4),t.JRh(t.i5U(6,18,"item.edit.move.head",t.eq3(38,Xi,null==(a=t.bMT(5,16,s.itemRD$))||null==a.payload?null:a.payload.handle))),t.R7$(4),t.JRh(t.bMT(9,21,"item.edit.move.description")),t.R7$(6),t.JRh(t.i5U(16,25,"dso-selector.placeholder",t.eq3(40,Ni,t.bMT(15,23,"dso-selector.placeholder.type.collection")))),t.R7$(4),t.Y8G("types",s.COLLECTIONS)("currentDSOId",s.selectedCollection?s.selectedCollection.id:s.originalCollection.id),t.R7$(8),t.R50("ngModel",s.inheritPolicies),t.Y8G("ngbTooltip",r),t.R7$(),t.SpI(" ",t.bMT(28,28,"item.edit.move.inheritpolicies.checkbox")," "),t.R7$(3),t.SpI(" ",t.bMT(31,30,"item.edit.move.inheritpolicies.description")," "),t.R7$(4),t.Y8G("routerLink",t.eq3(42,Li,t.bMT(35,32,s.itemPageRoute$))),t.R7$(3),t.SpI(" ",t.bMT(38,34,"item.edit.move.cancel")," "),t.R7$(2),t.Y8G("disabled",!s.canMove),t.R7$(),t.Y8G("ngIf",!s.processing),t.R7$(),t.Y8G("ngIf",s.processing),t.R7$(),t.Y8G("disabled",!s.canSubmit),t.R7$(2),t.SpI(" ",t.bMT(45,36,"item.edit.move.discard-button")," ")}},dependencies:[p.h,p.D9,R.UN,R.md,Z.YN,Z.Zm,Z.BC,Z.vS,u.Wk,h.Jj,wi.e,h.bT],encapsulation:2})}return n})();var G=o(1762),F=o(36556),x=o(78759);const Ji=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.AdministratorOf)),Ki=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanManageBitstreamBundles)),Qi=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanManageMappings)),Hi=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.AdministratorOf)),Zi=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanDelete)),qi=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanManagePolicies)),tn=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanEditMetadata)),en=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanMove)),nn=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanMakePrivate)),sn=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanRegisterDOI)),an=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.ReinstateItem)),on=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanManageRelationships)),ln=(0,o(3550).FO)(()=>x.Z,()=>(0,y.of)([F._.CanManageMappings,F._.WithdrawItem,F._.ReinstateItem,F._.CanManagePolicies,F._.CanMakePrivate,F._.CanDelete,F._.CanMove,F._.CanRegisterDOI])),cn=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.CanManageVersions)),dn=(0,G.L)(()=>x.Z,()=>(0,y.of)(F._.WithdrawItem)),mn=n=>({id:n}),pn=n=>[n,"edit"];let un=(()=>{class n extends at{constructor(e,i,s,a,r){super(e,i,s,a,r),this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.translateService=r,this.messageKey="private",this.predicate=d=>!d.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!1).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(p.c$))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-private"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return s.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,s.headerMessage,t.eq3(15,mn,s.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,s.descriptionMessage)),t.R7$(2),t.Y8G("item",s.item),t.R7$(3),t.SpI("",t.bMT(13,11,s.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,pn,s.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,s.cancelMessage)," "))},dependencies:[tt.W,p.h,p.D9,u.Wk],encapsulation:2})}return n})();const hn=n=>({id:n}),gn=n=>[n,"edit"];let bn=(()=>{class n extends at{constructor(e,i,s,a,r){super(e,i,s,a,r),this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.translateService=r,this.messageKey="public",this.predicate=d=>d.payload.isDiscoverable}performAction(){this.itemDataService.setDiscoverable(this.item,!0).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(p.c$))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-public"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return s.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,s.headerMessage,t.eq3(15,hn,s.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,s.descriptionMessage)),t.R7$(2),t.Y8G("item",s.item),t.R7$(3),t.SpI("",t.bMT(13,11,s.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,gn,s.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,s.cancelMessage)," "))},dependencies:[tt.W,p.h,p.D9,u.Wk],encapsulation:2})}return n})();var fn=o(28256);const vn=n=>({id:n}),_n=n=>[n,"edit"];function In(n,l){if(1&n&&(t.j41(0,"div")(1,"p",10),t.EFF(2),t.nI1(3,"translate"),t.nI1(4,"translate"),t.k0s()()),2&n){const e=t.XpG().$implicit,i=t.XpG();t.R7$(2),t.E5c("",t.bMT(3,3,i.doiToUpdateMessage),": ",e.value," (",t.bMT(4,5,"item.edit.identifiers.doi.status."+e.identifierStatus),") ")}}function Tn(n,l){if(1&n&&(t.j41(0,"div",8),t.DNE(1,In,5,7,"div",9),t.k0s()),2&n){const e=l.$implicit;t.R7$(),t.Y8G("ngIf","doi"===e.identifierType)}}let yn=(()=>{class n extends at{constructor(e,i,s,a,r,d){super(e,i,s,a,r),this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.translateService=r,this.identifierDataService=d,this.messageKey="register-doi",this.doiToUpdateMessage="item.edit."+this.messageKey+".to-update",this.processing=!1}ngOnInit(){this.itemRD$=this.route.data.pipe((0,g.T)(e=>e.dso),(0,m.yd)()),this.itemRD$.pipe((0,O.$)()).subscribe(e=>{this.item=e.payload,this.itemPageRoute=(0,V._o)(this.item),this.identifiers$=this.identifierDataService.getIdentifierDataFor(this.item).pipe((0,g.T)(i=>401!==i.statusCode&&(0,b.a4)(i.payload)?i.payload.identifiers:null))}),this.confirmMessage="item.edit."+this.messageKey+".confirm",this.cancelMessage="item.edit."+this.messageKey+".cancel",this.headerMessage="item.edit."+this.messageKey+".header",this.descriptionMessage="item.edit."+this.messageKey+".description"}performAction(){this.registerDoi()}registerDoi(){this.processing=!0,this.identifierDataService.registerIdentifier(this.item,"doi").subscribe(e=>{e.hasCompleted&&(this.processing=!1,this.processRestResponse(e))})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(p.c$),t.rXU(fn.IdentifierDataService))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-register-doi"]],standalone:!0,features:[t.Vt3,t.aNF],decls:19,vars:22,consts:[[1,"container"],[1,"row"],[1,"col-12"],["class","w-100 p",4,"ngFor","ngForOf"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"],[1,"w-100","p"],[4,"ngIf"],[1,"float-left"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.DNE(9,Tn,2,1,"div",3),t.nI1(10,"async"),t.nrm(11,"ds-modify-item-overview",4),t.j41(12,"div",5)(13,"button",6),t.bIt("click",function(){return s.performAction()}),t.EFF(14),t.nI1(15,"translate"),t.k0s(),t.j41(16,"button",7),t.EFF(17),t.nI1(18,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,7,s.headerMessage,t.eq3(18,vn,s.item.handle))),t.R7$(3),t.JRh(t.bMT(8,10,s.descriptionMessage)),t.R7$(2),t.Y8G("ngForOf",t.bMT(10,12,s.identifiers$)),t.R7$(2),t.Y8G("item",s.item),t.R7$(3),t.SpI("",t.bMT(15,14,s.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(20,_n,s.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(18,16,s.cancelMessage)," "))},dependencies:[tt.W,u.Wk,p.h,p.D9,h.Jj,h.bT,h.Sq],encapsulation:2})}return n})();const $n=n=>({id:n}),Cn=n=>[n,"edit"];let Rn=(()=>{class n extends at{constructor(e,i,s,a,r){super(e,i,s,a,r),this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.translateService=r,this.messageKey="reinstate",this.predicate=d=>!d.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!1).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(p.c$))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-reinstate"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return s.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,s.headerMessage,t.eq3(15,$n,s.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,s.descriptionMessage)),t.R7$(2),t.Y8G("item",s.item),t.R7$(3),t.SpI("",t.bMT(13,11,s.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,Cn,s.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,s.cancelMessage)," "))},dependencies:[tt.W,p.h,p.D9,u.Wk],encapsulation:2})}return n})();var Mn=o(98526),At=o(16700),Wt=o(76564),Jt=o(81459),Et=o(42267);let Ut=(()=>{class n{constructor(e,i,s,a,r,d,_){this.itemService=e,this.objectUpdatesService=i,this.notificationsService=s,this.modalService=a,this.relationshipService=r,this.entityTypeService=d,this.translateService=_,this.notificationsPrefix="item.edit.relationships.notifications.",this.isSaving$=new I.t(!1)}submit(e,i){this.isSaving$.next(!0),this.objectUpdatesService.getFieldUpdates(i,[],!0).pipe((0,g.T)(s=>Object.values(s).filter(a=>(0,b.a4)(a)).filter(a=>a.changeType===Q.B.ADD||a.changeType===Q.B.REMOVE)),(0,C.s)(1),(0,T.n)(s=>s),(0,Jt.H)(s=>s.changeType===Q.B.REMOVE?this.deleteRelationship(s.field).pipe((0,C.s)(1),(0,T.n)(a=>a.hasSucceeded?this.itemService.invalidateByHref(s.field.relatedItem._links.self.href).pipe((0,g.T)(()=>a)):[a])):s.changeType===Q.B.ADD?this.addRelationship(s.field).pipe((0,C.s)(1),(0,T.n)(a=>{if(a.hasSucceeded){const{leftItem:r,rightItem:d}=a.payload._links;return r.href===e.self?this.itemService.invalidateByHref(d.href).pipe((0,g.T)(()=>a)):this.itemService.invalidateByHref(r.href).pipe((0,g.T)(()=>a))}return[a]})):Wt.w),(0,Et.$)(),(0,T.n)(s=>this.itemService.invalidateByHref(e.self).pipe((0,g.T)(()=>s)))).subscribe(s=>{s.length>0&&(this.initializeOriginalFields(e,i),this.displayNotifications(s),this.modalService.dismissAll(),this.isSaving$.next(!1))})}initializeOriginalFields(e,i){return this.relationshipService.getRelatedItems(e).pipe((0,C.s)(1)).subscribe(s=>{this.objectUpdatesService.initialize(i,s,e.lastModified)})}deleteRelationship(e){let i;return i=e.keepLeftVirtualMetadata&&e.keepRightVirtualMetadata?"all":e.keepLeftVirtualMetadata?"left":e.keepRightVirtualMetadata?"right":"none",this.relationshipService.deleteRelationship(e.uuid,i,!1)}addRelationship(e){let i,s,a,r;return e.originalIsLeft?(i=e.originalItem,s=e.relatedItem,a=null,r=e.nameVariant):(i=e.relatedItem,s=e.originalItem,a=e.nameVariant,r=null),this.relationshipService.addRelationship(e.type.id,i,s,a,r,!1)}displayNotifications(e){const i=e.filter(a=>a.hasFailed),s=e.filter(a=>a.hasSucceeded);i.forEach(a=>{this.notificationsService.error(this.getNotificationTitle("failed"),a.errorMessage)}),s.length>0&&this.notificationsService.success(this.getNotificationTitle("saved"),this.getNotificationContent("saved"))}isProvidedItemTypeLeftType(e,i,s){return this.getRelationshipLeftAndRightType(e).pipe((0,g.T)(([a,r])=>a.id===i.id||r.id!==i.id&&void console.warn(`The item ${s.uuid} is not on the right or the left side of relationship type ${e.uuid}`)))}shouldDisplayBothRelationshipSides(e,i){return this.getRelationshipLeftAndRightType(e).pipe((0,g.T)(([s,a])=>s.id===i.id&&a.id===i.id&&e.leftwardType!==e.rightwardType))}getRelationshipLeftAndRightType(e){const i=e.leftType.pipe((0,m.yd)(),(0,m.Bo)()),s=e.rightType.pipe((0,m.yd)(),(0,m.Bo)());return(0,$.z)([i,s])}getNotificationTitle(e){return this.translateService.instant(this.notificationsPrefix+e+".title")}getNotificationContent(e){return this.translateService.instant(this.notificationsPrefix+e+".content")}static#t=this.\u0275fac=function(i){return new(i||n)(t.KVO(w.ItemDataService),t.KVO(z.F),t.KVO(X.I),t.KVO(R.Bq),t.KVO(vt.RelationshipDataService),t.KVO(Ot.f),t.KVO(p.c$))};static#e=this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();o(73171),o(98680);var Kt=o(33325),Qt=o(18062),Sn=o(99120),jn=o(99179),Fn=o(76990),Dn=o(82219),On=o(11022);function kn(n,l){if(1&n&&(t.j41(0,"div")(1,"div",16),t.EFF(2),t.k0s(),t.j41(3,"div"),t.EFF(4),t.k0s()()),2&n){const e=l.$implicit;t.R7$(2),t.SpI(" ",e.metadataField," "),t.R7$(2),t.SpI(" ",e.metadataValue.value," ")}}function En(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",10),t.bIt("click",function(){const s=t.eBV(e).ngVar,a=t.XpG().$implicit,r=t.XpG();return t.Njj(r.setSelectedVirtualMetadataItem(a.item,!s))}),t.j41(1,"div",11)(2,"label"),t.nrm(3,"input",12),t.k0s()(),t.j41(4,"div",13),t.nrm(5,"ds-listable-object-component-loader",14),t.DNE(6,kn,5,2,"div",15),t.k0s()()}if(2&n){const e=l.ngVar,i=t.XpG().$implicit,s=t.XpG();t.R7$(3),t.Y8G("checked",e),t.R7$(2),t.Y8G("object",i.item),t.R7$(),t.Y8G("ngForOf",s.virtualMetadata.get(i.item.uuid))}}function Un(n,l){if(1&n&&(t.qex(0),t.DNE(1,En,7,3,"div",9),t.nI1(2,"async"),t.bVm()),2&n){const e=l.$implicit;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e.isSelectedVirtualMetadataItem$))}}let xn=(()=>{class n{constructor(e,i){this.objectUpdatesService=e,this.appConfig=i,this.close=new t.bkB,this.save=new t.bkB,this.itemDTOs$=new I.t([]),this.subs=[],this.virtualMetadata=new Map,this.showThumbnails=this.appConfig.browseBy.showThumbnails}getVirtualMetadata(e){return Object.entries(e.metadata).map(([i,s])=>s.filter(a=>!i.startsWith("relation")&&a.authority&&a.authority.endsWith(this.relationshipId)).map(a=>({metadataField:i,metadataValue:a}))).reduce((i,s)=>i.concat(s),[])}setSelectedVirtualMetadataItem(e,i){this.objectUpdatesService.setSelectedVirtualMetadata(this.url,this.relationshipId,e.uuid,i)}isSelectedVirtualMetadataItem(e){return this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationshipId,e.uuid)}trackItemDTO(e,i){return i?.item?.uuid}ngOnInit(){this.subs.push(this.itemDTOs$.subscribe(e=>{e.forEach(i=>this.virtualMetadata.set(i.item.uuid,this.getVirtualMetadata(i.item)))}))}ngOnChanges(){(0,b.a4)(this.leftItem)&&(0,b.a4)(this.rightItem)&&this.itemDTOs$.next([{item:this.leftItem,isSelectedVirtualMetadataItem$:this.isSelectedVirtualMetadataItem(this.leftItem)},{item:this.rightItem,isSelectedVirtualMetadataItem$:this.isSelectedVirtualMetadataItem(this.rightItem)}])}ngOnDestroy(){this.subs.forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(z.F),t.rXU(Qt.vQ))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-virtual-metadata"]],inputs:{url:"url",relationshipId:"relationshipId",leftItem:"leftItem",rightItem:"rightItem"},outputs:{close:"close",save:"save"},standalone:!0,features:[t.OA$,t.aNF],decls:15,vars:11,consts:[[3,"ngClass"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"d-flex","flex-row-reverse","m-2"],[1,"btn","btn-primary","save",3,"click"],["aria-hidden","true",1,"fas","fa-save"],["class","item d-flex flex-row",3,"click",4,"ngVar"],[1,"item","d-flex","flex-row",3,"click"],[1,"m-2"],["type","checkbox",1,"select",3,"checked"],[1,"flex-column"],[3,"object"],[4,"ngFor","ngForOf"],[1,"font-weight-bold"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2),t.nI1(3,"translate"),t.j41(4,"button",2),t.bIt("click",function(){return s.close.emit()}),t.j41(5,"span",3),t.EFF(6,"\xd7"),t.k0s()()(),t.j41(7,"div",4),t.DNE(8,Un,3,3,"ng-container",5),t.nI1(9,"async"),t.j41(10,"div",6)(11,"button",7),t.bIt("click",function(){return s.save.emit()}),t.nrm(12,"i",8),t.EFF(13),t.nI1(14,"translate"),t.k0s()()()()),2&i&&(t.Y8G("ngClass",s.showThumbnails?"hide-modal-thumbnail-column":""),t.R7$(2),t.SpI("",t.bMT(3,5,"virtual-metadata.delete-relationship.modal-head")," "),t.R7$(6),t.Y8G("ngForOf",t.bMT(9,7,s.itemDTOs$))("ngForTrackBy",s.trackItemDTO),t.R7$(5),t.SpI(" ",t.bMT(14,9,"item.edit.metadata.save-button")," "))},dependencies:[h.YU,p.h,p.D9,h.Sq,q.r,h.Jj,kt.v],encapsulation:2})}return n})();function Bn(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",2)(1,"div",3),t.nrm(2,"ds-listable-object-component-loader",4),t.nI1(3,"async"),t.k0s(),t.j41(4,"div",5)(5,"div",6)(6,"button",7),t.nI1(7,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG(),a=t.sdS(3);return t.Njj(s.openVirtualMetadataModal(a))}),t.nrm(8,"i",8),t.k0s(),t.j41(9,"button",9),t.nI1(10,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.undo())}),t.nrm(11,"i",10),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(2),t.Y8G("object",t.bMT(3,7,e.relatedItem$))("viewMode",e.viewMode)("value",e.nameVariant),t.R7$(4),t.FS9("title",t.bMT(7,9,"item.edit.metadata.edit.buttons.remove")),t.Y8G("disabled",!e.canRemove()),t.R7$(3),t.FS9("title",t.bMT(10,11,"item.edit.metadata.edit.buttons.undo")),t.Y8G("disabled",!e.canUndo())}}function Gn(n,l){if(1&n){const e=t.RV6();t.j41(0,"ds-virtual-metadata",11),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("close",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.closeVirtualMetadataModal())})("save",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.remove())}),t.k0s()}if(2&n){const e=t.XpG();t.Y8G("relationshipId",e.relationship.id)("leftItem",t.bMT(1,4,e.leftItem$))("rightItem",t.bMT(2,6,e.rightItem$))("url",e.url)}}let Pn=(()=>{class n{get relationship(){return this.update.relationship}get update(){return this.fieldUpdate.field}get nameVariant(){return this.update.nameVariant}constructor(e,i){this.objectUpdatesService=e,this.modalService=i,this.relatedItem$=new I.t(null),this.viewMode=zt.n.ListElement}ngOnChanges(){this.relationship&&(this.relationship.leftItem||this.relationship.rightItem)?(this.leftItem$=this.relationship.leftItem.pipe((0,m.yd)(),(0,m.Bo)(),(0,v.p)(e=>(0,b.a4)(e)&&(0,b.hj)(e.uuid))),this.rightItem$=this.relationship.rightItem.pipe((0,m.yd)(),(0,m.Bo)(),(0,v.p)(e=>(0,b.a4)(e)&&(0,b.hj)(e.uuid))),(0,$.z)([this.leftItem$,this.rightItem$]).pipe((0,g.T)(([e,i])=>e.uuid===this.editItem.uuid?i:e),(0,C.s)(1)).subscribe(e=>{this.relatedItem$.next(e)})):this.relatedItem$.next(this.update.relatedItem)}remove(){this.closeVirtualMetadataModal(),(0,$.z)([this.leftItem$,this.rightItem$]).pipe((0,g.T)(e=>e.map(i=>this.objectUpdatesService.isSelectedVirtualMetadata(this.url,this.relationship.id,i.uuid))),(0,T.n)(e=>(0,$.z)(e)),(0,g.T)(e=>Object.assign({},this.fieldUpdate.field,{keepLeftVirtualMetadata:!0===e[0],keepRightVirtualMetadata:!0===e[1]})),(0,C.s)(1)).subscribe(e=>{this.objectUpdatesService.saveRemoveFieldUpdate(this.url,e)})}openVirtualMetadataModal(e){this.modalRef=this.modalService.open(e)}closeVirtualMetadataModal(){this.modalRef.close()}undo(){this.objectUpdatesService.removeSingleFieldUpdate(this.url,this.fieldUpdate.field.uuid)}canRemove(){return this.fieldUpdate.changeType!==Q.B.REMOVE&&this.fieldUpdate.changeType!==Q.B.ADD}canUndo(){return this.fieldUpdate.changeType?.valueOf()>=0}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(z.F),t.rXU(R.Bq))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-edit-relationship"]],inputs:{fieldUpdate:"fieldUpdate",url:"url",editItem:"editItem"},standalone:!0,features:[t.OA$,t.aNF],decls:4,vars:3,consts:[["virtualMetadataModal",""],["class","row",4,"ngIf"],[1,"row"],[1,"col-10","relationship"],[3,"object","viewMode","value"],[1,"col-2"],[1,"btn-group","relationship-action-buttons"],[1,"btn","btn-outline-danger","btn-sm",3,"click","disabled","title"],[1,"fas","fa-trash-alt","fa-fw"],[1,"btn","btn-outline-warning","btn-sm",3,"click","disabled","title"],[1,"fas","fa-undo-alt","fa-fw"],[3,"close","save","relationshipId","leftItem","rightItem","url"]],template:function(i,s){1&i&&(t.DNE(0,Bn,12,13,"div",1),t.nI1(1,"async"),t.DNE(2,Gn,3,8,"ng-template",null,0,t.C5r)),2&i&&t.Y8G("ngIf",t.bMT(1,1,s.relatedItem$))},dependencies:[kt.v,h.Jj,h.bT,p.h,p.D9,xn],styles:[".btn[disabled][_ngcontent-%COMP%]{color:var(--bs-gray-600);border-color:var(--bs-gray-600);z-index:0}.relationship-action-buttons[_ngcontent-%COMP%]{margin:0;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}"]})}return n})();const Vn=()=>({}),wn=(n,l,e)=>({"alert-success":n,"alert-warning":l,"alert-danger":e});function Xn(n,l){if(1&n&&t.nrm(0,"ds-edit-relationship",9),2&n){const e=l.$implicit,i=t.XpG(4);t.Y8G("fieldUpdate",e||t.lJ4(4,Vn))("url",i.url)("editItem",i.item)("ngClass",t.sMw(5,wn,1===e.changeType,0===e.changeType,2===e.changeType))}}function Nn(n,l){1&n&&(t.j41(0,"div"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n&&(t.R7$(),t.JRh(t.bMT(2,1,"item.edit.relationships.no-relationships")))}function Ln(n,l){if(1&n&&(t.qex(0),t.j41(1,"ds-pagination",6),t.nI1(2,"async"),t.nI1(3,"async"),t.j41(4,"div",7),t.DNE(5,Xn,1,9,"ds-edit-relationship",8),t.k0s()(),t.DNE(6,Nn,3,3,"div",5),t.bVm()),2&n){let e;const i=l.ngVar,s=t.XpG(3);t.R7$(),t.Y8G("paginationOptions",s.paginationConfig)("collectionSize",(null==(e=t.bMT(2,7,s.relationshipsRd$))||null==e.payload?null:e.payload.totalElements)+t.bMT(3,9,s.nbAddedFields$))("hideGear",!0)("hidePagerWhenSinglePage",!0),t.R7$(4),t.Y8G("ngForOf",i)("ngForTrackBy",s.trackUpdate),t.R7$(),t.Y8G("ngIf",0===i.length)}}function Yn(n,l){if(1&n&&(t.qex(0),t.DNE(1,Ln,7,11,"ng-container",4),t.nI1(2,"dsObjectValues"),t.bVm()),2&n){const e=t.XpG().ngVar;t.R7$(),t.Y8G("ngVar",t.bMT(2,1,e))}}function zn(n,l){1&n&&t.nrm(0,"ds-loading")}function An(n,l){if(1&n&&(t.qex(0),t.DNE(1,Yn,3,3,"ng-container",5),t.nI1(2,"async"),t.DNE(3,zn,1,0,"ds-loading",5),t.nI1(4,"async"),t.bVm()),2&n){const e=l.ngVar,i=t.XpG();t.R7$(),t.Y8G("ngIf",e&&!0!==t.bMT(2,2,i.loading$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,4,i.loading$))}}let Wn=(()=>{class n{constructor(e,i,s,a,r,d,_,j){this.objectUpdatesService=e,this.linkService=i,this.relationshipService=s,this.modalService=a,this.paginationService=r,this.selectableListService=d,this.editItemRelationshipsService=_,this.appConfig=j,this.submitModal=new t.bkB,this.currentItemIsLeftItem$=new I.t(void 0),this.updates$=new I.t(void 0),this.relationshipsRd$=new I.t(void 0),this.isLastPage$=new I.t(!0),this.loading$=new I.t(!0),this.nbAddedFields$=new I.t(0),this.subs=[],this.fetchThumbnail=this.appConfig.browseBy.showThumbnails}getRelationshipMessageKey(){return(0,$.z)([this.getLabel(),this.relatedEntityType$]).pipe((0,g.T)(([e,i])=>{if((0,b.a4)(e)&&e.indexOf("is")>-1&&e.indexOf("Of")>-1){const s=`${e.substring(2,e.indexOf("Of"))}`;return s!==i.label?`relationships.is${s}Of.${i.label}`:`relationships.is${s}Of`}return e}))}getLabel(){return this.currentItemIsLeftItem$.pipe((0,g.T)(e=>e?this.relationshipType.leftwardType:this.relationshipType.rightwardType))}trackUpdate(e,i){return i&&i.field?i.field.uuid:void 0}openLookup(){this.modalRef=this.modalService.open(jn.d,{size:"lg"});const e=this.modalRef.componentInstance;e.repeatable=!0,e.isEditRelationship=!0,e.listId=this.listId,e.item=this.item,e.relationshipType=this.relationshipType,e.currentItemIsLeftItem$=this.currentItemIsLeftItem$,e.toAdd=[],e.toRemove=[],e.isPending=!1,e.hiddenQuery="-search.resourceid:"+this.item.uuid,this.item.owningCollection.pipe((0,m.ak)()).subscribe(i=>{e.collection=i}),e.select=(...i)=>{i.forEach(s=>{const a=s.indexableObject,r=e.toRemove.findIndex(d=>d.indexableObject.uuid===a.uuid);-1!==r?e.toRemove.splice(r,1):this.getRelationFromId(a).subscribe(d=>{if(d){const _=e.toRemove.findIndex(j=>j.indexableObject.uuid===a.uuid);-1!==_&&e.toRemove.splice(_,1)}else e.toAdd.push(s);this.loading$.next((0,b.hj)(e.toAdd)||(0,b.hj)(e.toRemove)),this.relationshipsRd$.next(this.relationshipsRd$.getValue())})})},e.deselect=(...i)=>{i.forEach(s=>{const a=s.indexableObject,r=e.toAdd.findIndex(d=>d.indexableObject.uuid===a.uuid);-1!==r?e.toAdd.splice(r,1):e.toRemove.push(s),this.loading$.next((0,b.hj)(e.toAdd)||(0,b.hj)(e.toRemove))})},e.submitEv=()=>{e.isPending=!0;const i=this.currentItemIsLeftItem$.getValue(),s=e.toAdd.map(r=>({type:"add",searchResult:r})),a=e.toRemove.map(r=>({type:"remove",searchResult:r}));(0,Kt.H)([...s,...a]).pipe((0,Jt.H)(({type:r,searchResult:d})=>{const _=d.indexableObject;return"add"===r?this.relationshipService.getNameVariant(this.listId,_.uuid).pipe((0,T.n)(j=>this.objectUpdatesService.saveAddFieldUpdate(this.url,{uuid:`${this.relationshipType.id}-${_.uuid}`,nameVariant:j,type:this.relationshipType,originalIsLeft:i,originalItem:this.item,relatedItem:_})),(0,C.s)(1)):"remove"===r?this.relationshipService.getNameVariant(this.listId,_.uuid).pipe((0,T.n)(j=>this.getRelationFromId(d.indexableObject).pipe((0,g.T)(B=>this.objectUpdatesService.saveRemoveFieldUpdate(this.url,{uuid:B.id,nameVariant:j,type:this.relationshipType,originalIsLeft:i,originalItem:this.item,relatedItem:_,relationship:B})))),(0,C.s)(1)):Wt.w}),(0,Et.$)()).subscribe({complete:()=>{this.editItemRelationshipsService.submit(this.item,this.url),this.submitModal.emit()}})},e.discardEv=()=>{e.toAdd.forEach(i=>{this.selectableListService.deselectSingle(this.listId,i)}),e.toRemove.forEach(i=>{this.selectableListService.selectSingle(this.listId,i)}),e.toAdd=[],e.toRemove=[],this.loading$.next(!1)},e.closeEv=()=>{this.loading$.next(!1)},this.relatedEntityType$.pipe((0,C.s)(1)).subscribe(i=>{e.relationshipOptions=Object.assign(new Fn.j,{relationshipType:i.label,searchConfiguration:i.label.toLowerCase(),nameVariants:"true"})}),this.selectableListService.deselectAll(this.listId)}getRelationFromId(e){const i=this.currentItemIsLeftItem$.getValue()?this.relationshipType.leftwardType:this.relationshipType.rightwardType;return this.relationshipService.searchByItemsAndType(this.relationshipType.id,this.item.uuid,i,[e.id]).pipe((0,m.yd)(),(0,m.Bo)(),(0,g.T)(s=>s.page[0]))}ngOnInit(){this.relationshipLeftAndRightType$=(0,$.z)([this.relationshipType.leftType,this.relationshipType.rightType].map(s=>s.pipe((0,m.yd)(),(0,m.Bo)()))),this.relatedEntityType$=this.relationshipLeftAndRightType$.pipe((0,g.T)(([s,a])=>s.uuid!==this.itemType.uuid?s:a),(0,b.Az)()),this.relatedEntityType$.pipe((0,C.s)(1)).subscribe(s=>this.listId=`edit-relationship-${this.itemType.id}-${s.id}`),this.relationshipMessageKey$=this.getRelationshipMessageKey(),this.paginationConfig=new Xt.W,this.paginationConfig.id=`er${this.relationshipType.id}`,this.paginationConfig.pageSize=5,this.paginationConfig.currentPage=1;const e=this.paginationService.getCurrentPagination(this.paginationConfig.id,this.paginationConfig).pipe((0,Mt.M)(()=>this.loading$.next(!0))),i=(0,On.nW)(this.fetchThumbnail);this.subs.push((0,$.z)([e,this.currentItemIsLeftItem$,this.relatedEntityType$]).pipe((0,T.n)(([s,a,r])=>this.relationshipService.getItemRelationshipsByLabel(this.item,a?this.relationshipType.leftwardType:this.relationshipType.rightwardType,{elementsPerPage:s.pageSize,currentPage:s.currentPage,searchParams:[new Sn.x("relatedEntityType",r.label)]},!0,!0,...i)),(0,Mt.M)(s=>{this.relationshipsRd$.next(s)}),(0,m.v7)(),(0,m.Bo)()).subscribe(s=>{this.objectUpdatesService.initialize(this.url,s.page,new Date)})),this.subs.push(this.relationshipsRd$.pipe((0,b.Az)(),(0,m.v7)()).subscribe(s=>{this.isLastPage$.next((0,b.Tn)(s.payload._links.next))})),this.subs.push(this.relationshipsRd$.pipe((0,b.Az)(),(0,m.v7)(),(0,T.n)(s=>(0,Kt.H)(s.payload.page).pipe((0,D.Z)(a=>this.relationshipService.isLeftItem(a,this.item).pipe((0,T.n)(r=>r?a.rightItem.pipe((0,m.qD)(),(0,m.Bo)(),(0,g.T)(d=>[a,r,d])):a.leftItem.pipe((0,m.qD)(),(0,m.Bo)(),(0,g.T)(d=>[a,r,d]))))),(0,g.T)(([a,r,d])=>({uuid:a.id,type:this.relationshipType,relationship:a,originalIsLeft:r,originalItem:this.item,relatedItem:d,nameVariant:r?a.rightwardValue:a.leftwardValue})),(0,Et.$)(),(0,Dt.U)([]))),(0,T.n)(s=>this.objectUpdatesService.getFieldUpdates(this.url,s).pipe((0,g.T)(a=>{const r={};return this.nbAddedFields$.next(0),Object.keys(a).forEach(d=>{(0,b.a4)(a[d])&&a[d].field.type.id===this.relationshipType.id&&(a[d].changeType===Q.B.ADD?(this.nbAddedFields$.next(this.nbAddedFields$.getValue()+1),!0===this.isLastPage$.getValue()&&(r[d]=a[d])):r[d]=a[d])}),r}))),(0,Nt.Z)({})).subscribe(s=>{this.loading$.next(!1),this.updates$.next(s)}))}ngOnDestroy(){this.subs.filter(e=>(0,b.a4)(e)).forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(z.F),t.rXU(nt._),t.rXU(vt.RelationshipDataService),t.rXU(R.Bq),t.rXU(jt.m),t.rXU(Dn.K),t.rXU(Ut),t.rXU(Qt.vQ))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-edit-relationship-list"]],inputs:{item:"item",itemType:"itemType",url:"url",relationshipType:"relationshipType",hasChanges:"hasChanges",currentItemIsLeftItem$:"currentItemIsLeftItem$"},outputs:{submitModal:"submitModal"},standalone:!0,features:[t.aNF],decls:12,vars:14,consts:[[1,"h4"],[1,"ml-2","btn","btn-success",3,"click","disabled"],[1,"fas","fa-plus"],[1,"d-none","d-sm-inline"],[4,"ngVar"],[4,"ngIf"],[3,"paginationOptions","collectionSize","hideGear","hidePagerWhenSinglePage"],[1,"my-2"],["class","relationship-row d-block alert",3,"fieldUpdate","url","editItem","ngClass",4,"ngFor","ngForOf","ngForTrackBy"],[1,"relationship-row","d-block","alert",3,"fieldUpdate","url","editItem","ngClass"]],template:function(i,s){1&i&&(t.j41(0,"h2",0),t.EFF(1),t.nI1(2,"async"),t.nI1(3,"translate"),t.j41(4,"button",1),t.nI1(5,"async"),t.bIt("click",function(){return s.openLookup()}),t.nrm(6,"i",2),t.j41(7,"span",3),t.EFF(8),t.nI1(9,"translate"),t.k0s()()(),t.DNE(10,An,5,6,"ng-container",4),t.nI1(11,"async")),2&i&&(t.R7$(),t.SpI(" ",t.bMT(3,6,t.bMT(2,4,s.relationshipMessageKey$))," "),t.R7$(3),t.Y8G("disabled",t.bMT(5,8,s.hasChanges)),t.R7$(4),t.SpI("\xa0",t.bMT(9,10,"item.edit.relationships.edit.buttons.add"),""),t.R7$(2),t.Y8G("ngVar",t.bMT(11,12,s.updates$)))},dependencies:[Pn,ft.e,h.Jj,gt,q.r,h.bT,h.pM,p.h,p.D9,h.YU,lt.v],styles:[".relationship-row[_ngcontent-%COMP%]:not(.alert){padding:var(--bs-alert-padding-y) 0}.relationship-row.alert[_ngcontent-%COMP%]{margin-left:calc(-1 * var(--bs-alert-padding-x));margin-right:calc(-1 * var(--bs-alert-padding-x));margin-top:-1px;margin-bottom:-1px}"]})}return n})();function Jn(n,l){if(1&n&&(t.qex(0),t.nrm(1,"ds-edit-relationship-list",1)(2,"ds-edit-relationship-list",2),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("url",e.url)("item",e.item)("itemType",e.itemType)("relationshipType",e.relationshipType)("hasChanges",e.hasChanges)("currentItemIsLeftItem$",e.isLeftItem$),t.R7$(),t.Y8G("url",e.url)("item",e.item)("itemType",e.itemType)("relationshipType",e.relationshipType)("hasChanges",e.hasChanges)("currentItemIsLeftItem$",e.isRightItem$)}}function Kn(n,l){if(1&n&&(t.qex(0),t.nrm(1,"ds-edit-relationship-list",2),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("url",e.url)("item",e.item)("itemType",e.itemType)("relationshipType",e.relationshipType)("hasChanges",e.hasChanges)("currentItemIsLeftItem$",e.currentItemIsLeftItem$)}}let Qn=(()=>{class n{constructor(e){this.editItemRelationshipsService=e,this.submitModal=new t.bkB,this.currentItemIsLeftItem$=new I.t(void 0),this.isLeftItem$=new I.t(!0),this.isRightItem$=new I.t(!1),this.subs=[]}ngOnInit(){this.subs.push(this.editItemRelationshipsService.isProvidedItemTypeLeftType(this.relationshipType,this.itemType,this.item).subscribe(e=>{this.currentItemIsLeftItem$.next(e)})),this.shouldDisplayBothRelationshipSides$=this.editItemRelationshipsService.shouldDisplayBothRelationshipSides(this.relationshipType,this.itemType)}ngOnDestroy(){this.subs.filter(e=>(0,b.a4)(e)).forEach(e=>e.unsubscribe())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(Ut))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-edit-relationship-list-wrapper"]],inputs:{item:"item",itemType:"itemType",url:"url",relationshipType:"relationshipType",hasChanges:"hasChanges"},outputs:{submitModal:"submitModal"},standalone:!0,features:[t.aNF],decls:4,vars:6,consts:[[4,"ngIf"],[1,"d-block","mb-4",3,"url","item","itemType","relationshipType","hasChanges","currentItemIsLeftItem$"],[3,"url","item","itemType","relationshipType","hasChanges","currentItemIsLeftItem$"]],template:function(i,s){1&i&&(t.DNE(0,Jn,3,12,"ng-container",0),t.nI1(1,"async"),t.DNE(2,Kn,2,6,"ng-container",0),t.nI1(3,"async")),2&i&&(t.Y8G("ngIf",t.bMT(1,2,s.shouldDisplayBothRelationshipSides$)),t.R7$(2),t.Y8G("ngIf",!1===t.bMT(3,4,s.shouldDisplayBothRelationshipSides$)))},dependencies:[h.Jj,Wn,h.bT]})}return n})();function Hn(n,l){1&n&&t.eu8(0)}function Zn(n,l){if(1&n&&(t.j41(0,"div",10),t.nrm(1,"ds-edit-relationship-list-wrapper",12),t.k0s()),2&n){const e=l.$implicit,i=t.XpG(2).ngIf,s=t.XpG();t.R7$(),t.Y8G("url",s.url)("item",s.item)("itemType",i)("relationshipType",e)("hasChanges",s.hasChanges$)}}function qn(n,l){if(1&n&&(t.j41(0,"div",10),t.DNE(1,Zn,2,5,"div",11),t.k0s()),2&n){const e=l.ngIf,i=t.XpG(2);t.R7$(),t.Y8G("ngForOf",e)("ngForTrackBy",i.trackById)}}function ts(n,l){1&n&&t.eu8(0)}function es(n,l){if(1&n&&(t.qex(0),t.j41(1,"div",5),t.DNE(2,Hn,1,0,"ng-container",6),t.k0s(),t.DNE(3,qn,2,2,"div",7),t.nI1(4,"async"),t.j41(5,"div",8)(6,"div",9),t.DNE(7,ts,1,0,"ng-container",6),t.k0s()(),t.bVm()),2&n){const e=t.XpG(),i=t.sdS(6),s=t.sdS(8);t.R7$(2),t.Y8G("ngTemplateOutlet",s),t.R7$(),t.Y8G("ngIf",t.bMT(4,4,e.relationshipTypes$))("ngIfElse",i),t.R7$(4),t.Y8G("ngTemplateOutlet",s)}}function is(n,l){if(1&n&&(t.j41(0,"ds-alert",13),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&n){const e=t.XpG();t.Y8G("type",e.AlertType.Info),t.R7$(),t.SpI(" ",t.bMT(2,2,"item.edit.relationships.no-entity-type")," ")}}function ns(n,l){1&n&&t.nrm(0,"ds-loading")}function ss(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",21),t.nI1(1,"async"),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.discard())}),t.nrm(2,"i",22),t.j41(3,"span",20),t.EFF(4),t.nI1(5,"translate"),t.k0s()()}if(2&n){const e=t.XpG(2);t.Y8G("disabled",!0!==t.bMT(1,2,e.hasChanges$)),t.R7$(4),t.SpI("\xa0",t.bMT(5,4,"item.edit.metadata.discard-button"),"")}}function as(n,l){if(1&n){const e=t.RV6();t.j41(0,"button",23),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.reinstate())}),t.nrm(1,"i",24),t.j41(2,"span",20),t.EFF(3),t.nI1(4,"translate"),t.k0s()()}2&n&&(t.R7$(3),t.SpI("\xa0",t.bMT(4,1,"item.edit.metadata.reinstate-button"),""))}function os(n,l){1&n&&t.nrm(0,"span",25)}function rs(n,l){1&n&&t.nrm(0,"i",26)}function ls(n,l){if(1&n){const e=t.RV6();t.j41(0,"div",14),t.DNE(1,ss,6,6,"button",15),t.nI1(2,"async"),t.DNE(3,as,5,3,"button",16),t.nI1(4,"async"),t.j41(5,"button",17),t.nI1(6,"async"),t.nI1(7,"async"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.submit())}),t.DNE(8,os,1,0,"span",18),t.nI1(9,"async"),t.DNE(10,rs,1,0,"i",19),t.nI1(11,"async"),t.j41(12,"span",20),t.EFF(13),t.nI1(14,"translate"),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(),t.Y8G("ngIf",!0!==t.bMT(2,6,e.isReinstatable$)),t.R7$(2),t.Y8G("ngIf",t.bMT(4,8,e.isReinstatable$)),t.R7$(2),t.Y8G("disabled",!0!==t.bMT(6,10,e.hasChanges$)||!0===t.bMT(7,12,e.isSaving$)),t.R7$(3),t.Y8G("ngIf",t.bMT(9,14,e.isSaving$)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(11,16,e.isSaving$)),t.R7$(3),t.SpI("\xa0",t.bMT(14,18,"item.edit.metadata.save-button"),"")}}let cs=(()=>{class n extends Pt{get isSaving$(){return this.editItemRelationshipsService.isSaving$}constructor(e,i,s,a,r,d,_,j,B,K,et,xt,ys,$s){super(e,i,s,a,r,d),this.itemService=e,this.objectUpdatesService=i,this.router=s,this.notificationsService=a,this.translateService=r,this.route=d,this.relationshipService=_,this.objectCache=j,this.requestService=B,this.entityTypeService=K,this.relationshipTypeService=et,this.cdr=xt,this.modalService=ys,this.editItemRelationshipsService=$s,this.entityType$=new I.t(void 0),this.AlertType=At.v}initializeUpdates(){const e=this.item.firstMetadataValue("dspace.entity.type");void 0!==e?(this.relationshipTypes$=this.relationshipTypeService.searchByEntityType(e,!0,!0,...this.getRelationshipTypeFollowLinks()).pipe((0,g.T)(i=>i.page),(0,Vt.F)((0,wt.W2)())),this.entityTypeService.getEntityTypeByLabel(e).pipe((0,m.yd)(),(0,m.Bo)()).subscribe(i=>this.entityType$.next(i))):this.entityType$.next(void 0)}initializeNotificationsPrefix(){this.notificationsPrefix="item.edit.relationships.notifications."}submit(){this.editItemRelationshipsService.submit(this.item,this.url)}initializeOriginalFields(){return this.editItemRelationshipsService.initializeOriginalFields(this.item,this.url)}trackById(e,i){return i.id}getRelationshipTypeFollowLinks(){return[(0,U.s)("leftType"),(0,U.s)("rightType")]}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(w.ItemDataService),t.rXU(z.F),t.rXU(u.Ix),t.rXU(X.I),t.rXU(p.c$),t.rXU(u.nX),t.rXU(vt.RelationshipDataService),t.rXU(Bt.$),t.rXU(ht.B),t.rXU(Ot.f),t.rXU(Mn.RelationshipTypeDataService),t.rXU(t.gRc),t.rXU(R.Bq),t.rXU(Ut))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-relationships"]],standalone:!0,features:[t.Vt3,t.aNF],decls:9,vars:4,consts:[["noEntityType",""],["loading",""],["buttons",""],[1,"item-relationships"],[4,"ngIf","ngIfElse"],[1,"button-row","top","d-flex","justify-content-end"],[4,"ngTemplateOutlet"],["class","mb-4",4,"ngIf","ngIfElse"],[1,"button-row","bottom"],[1,"float-right","ml-gap"],[1,"mb-4"],["class","mb-4",4,"ngFor","ngForOf","ngForTrackBy"],[3,"url","item","itemType","relationshipType","hasChanges"],[1,"d-block","mt-2",3,"type"],[1,"d-flex","space-children-mr","justify-content-end"],["class","btn btn-danger",3,"disabled","click",4,"ngIf"],["class","btn btn-warning",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click","disabled"],["aria-hidden","true","class","spinner-border spinner-border-sm","role","status",4,"ngIf"],["aria-hidden","true","class","fas fa-save",4,"ngIf"],[1,"d-none","d-sm-inline"],[1,"btn","btn-danger",3,"click","disabled"],["aria-hidden","true",1,"fas","fa-times"],[1,"btn","btn-warning",3,"click"],["aria-hidden","true",1,"fas","fa-undo-alt"],["aria-hidden","true","role","status",1,"spinner-border","spinner-border-sm"],["aria-hidden","true",1,"fas","fa-save"]],template:function(i,s){if(1&i&&(t.j41(0,"div",3),t.DNE(1,es,8,6,"ng-container",4),t.nI1(2,"async"),t.k0s(),t.DNE(3,is,3,4,"ng-template",null,0,t.C5r)(5,ns,1,0,"ng-template",null,1,t.C5r)(7,ls,15,20,"ng-template",null,2,t.C5r)),2&i){const a=t.sdS(4);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,s.entityType$))("ngIfElse",a)}},dependencies:[k.C,h.Jj,h.Sq,h.bT,h.T3,lt.v,p.h,p.D9,Qn],styles:[".button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-right:var(--ds-gap)}.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:last-child{margin-right:0}@media screen and (min-width: 576px){.button-row[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{min-width:var(--ds-edit-item-button-min-width)}}.button-row.top[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{margin-top:calc(var(--bs-spacer) / 2);margin-bottom:calc(var(--bs-spacer) / 2)}"]})}return n})();var ds=o(21124);o(35494);const ms=["*"];function ps(n,l){}let us=(()=>{class n extends ds.J{getComponentName(){return"ItemStatusComponent"}importThemedComponent(e){return o(52529)(`./${e}/app/item-page/edit-item-page/item-status/item-status.component`)}importUnthemedComponent(){return Promise.resolve().then(o.bind(o,35494))}static#t=this.\u0275fac=(()=>{let e;return function(s){return(e||(e=t.xGo(n)))(s||n)}})();static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-status"]],standalone:!0,features:[t.Vt3,t.aNF],ngContentSelectors:ms,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(i,s){1&i&&(t.NAR(),t.DNE(0,ps,0,0,"ng-template",null,0,t.C5r),t.j41(2,"div",null,1),t.SdG(4),t.k0s())},encapsulation:2})}return n})();var hs=o(32398);function gs(n,l){if(1&n&&t.nrm(0,"ds-item-versions",3),2&n){const e=t.XpG().ngVar;t.Y8G("item",e)("displayWhenEmpty",!0)("displayTitle",!1)("displayActions",!0)}}function bs(n,l){if(1&n&&(t.j41(0,"div",1),t.DNE(1,gs,1,4,"ds-item-versions",2),t.k0s()),2&n){const e=l.ngVar;t.R7$(),t.Y8G("ngIf",e)}}const vs=n=>({id:n}),_s=n=>[n,"edit"],Ts=[{path:"",resolve:{breadcrumb:E.S},data:{breadcrumbKey:"item.edit"},children:[{path:"",component:L,children:[{path:"",redirectTo:"status",pathMatch:"full"},{path:"status",component:us,data:{title:"item.edit.tabs.status.title",showBreadcrumbs:!0},canActivate:[ln]},{path:"bitstreams",component:Ke,data:{title:"item.edit.tabs.bitstreams.title",showBreadcrumbs:!0},canActivate:[Ki]},{path:"metadata",component:N.Q,data:{title:"item.edit.tabs.metadata.title",showBreadcrumbs:!0},canActivate:[tn]},{path:"curate",component:Ti,data:{title:"item.edit.tabs.curate.title",showBreadcrumbs:!0},canActivate:[Hi]},{path:"relationships",component:cs,data:{title:"item.edit.tabs.relationships.title",showBreadcrumbs:!0},canActivate:[on]},{path:"versionhistory",component:(()=>{class n{constructor(e){this.route=e,this.AlertTypeEnum=At.v}ngOnInit(){this.itemRD$=this.route.parent.parent.data.pipe((0,g.T)(e=>e.dso)).pipe((0,m.yd)())}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-version-history"]],standalone:!0,features:[t.aNF],decls:2,vars:3,consts:[["class","mt-2",4,"ngVar"],[1,"mt-2"],[3,"item","displayWhenEmpty","displayTitle","displayActions",4,"ngIf"],[3,"item","displayWhenEmpty","displayTitle","displayActions"]],template:function(i,s){if(1&i&&(t.DNE(0,bs,2,1,"div",0),t.nI1(1,"async")),2&i){let a;t.Y8G("ngVar",null==(a=t.bMT(1,1,s.itemRD$))?null:a.payload)}},dependencies:[hs.I,q.r,h.bT,h.Jj],encapsulation:2})}return n})(),data:{title:"item.edit.tabs.versionhistory.title",showBreadcrumbs:!0},canActivate:[cn]},{path:"access-control",component:$t,data:{title:"item.edit.tabs.access-control.title",showBreadcrumbs:!0},canActivate:[Ji]},{path:"mapper",component:Yt,data:{title:"item.edit.tabs.item-mapper.title",showBreadcrumbs:!0},canActivate:[Qi]}]},{path:"mapper",component:Yt},{path:c.kH,component:(()=>{class n extends at{constructor(e,i,s,a,r){super(e,i,s,a,r),this.route=e,this.router=i,this.notificationsService=s,this.itemDataService=a,this.translateService=r,this.messageKey="withdraw",this.predicate=d=>d.payload.isWithdrawn}performAction(){this.itemDataService.setWithDrawn(this.item,!0).pipe((0,m.qD)()).subscribe(e=>{this.processRestResponse(e)})}static#t=this.\u0275fac=function(i){return new(i||n)(t.rXU(u.nX),t.rXU(u.Ix),t.rXU(X.I),t.rXU(w.ItemDataService),t.rXU(p.c$))};static#e=this.\u0275cmp=t.VBU({type:n,selectors:[["ds-item-withdraw"]],standalone:!0,features:[t.Vt3,t.aNF],decls:17,vars:19,consts:[[1,"container"],[1,"row"],[1,"col-12"],[3,"item"],[1,"space-children-mr"],[1,"btn","btn-outline-secondary","perform-action",3,"click"],[1,"btn","btn-outline-secondary","cancel",3,"routerLink"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1"),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.nrm(9,"ds-modify-item-overview",3),t.j41(10,"div",4)(11,"button",5),t.bIt("click",function(){return s.performAction()}),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",6),t.EFF(15),t.nI1(16,"translate"),t.k0s()()()()()),2&i&&(t.R7$(4),t.JRh(t.i5U(5,6,s.headerMessage,t.eq3(15,vs,s.item.handle))),t.R7$(3),t.JRh(t.bMT(8,9,s.descriptionMessage)),t.R7$(2),t.Y8G("item",s.item),t.R7$(3),t.SpI("",t.bMT(13,11,s.confirmMessage)," "),t.R7$(2),t.Y8G("routerLink",t.eq3(17,_s,s.itemPageRoute)),t.R7$(),t.SpI(" ",t.bMT(16,13,s.cancelMessage)," "))},dependencies:[tt.W,p.h,p.D9,u.Wk],encapsulation:2})}return n})(),canActivate:[dn]},{path:c.Pg,component:Rn,canActivate:[an]},{path:c.$2,component:un,canActivate:[nn]},{path:c.RS,component:bn},{path:c.Jr,component:Vi,canActivate:[Zi]},{path:c.Bw,component:Wi,data:{title:"item.edit.move.title"},canActivate:[en]},{path:c.KY,component:yn,canActivate:[sn],data:{title:"item.edit.register-doi.title"}},{path:c.K4,children:[{path:"create",resolve:{resourcePolicyTarget:W.Q},component:P.m,data:{title:"resource-policies.create.page.title"}},{path:"edit",resolve:{resourcePolicy:f.n},component:Y._,data:{title:"resource-policies.edit.page.title"}},{path:"",component:ie,data:{title:"item.edit.authorizations.title"}}],canActivate:[qi]}]}]},9353:(ot,A,o)=>{"use strict";o.d(A,{k:()=>t});var E=o(54460),N=o(95968),P=o(2155),Y=o(69685),f=o(53107);function W(u,R){if(1&u&&(f.j41(0,"span")(1,"button",5),f.nI1(2,"translate"),f.EFF(3),f.nI1(4,"translate"),f.k0s()()),2&u){const p=f.XpG();f.R7$(),f.Y8G("disabled",p.operation.disabled)("routerLink",p.operation.operationUrl),f.BMQ("aria-label",f.bMT(2,4,"item.edit.tabs.status.buttons."+p.operation.operationKey+".button")),f.R7$(2),f.SpI(" ",f.bMT(4,6,"item.edit.tabs.status.buttons."+p.operation.operationKey+".button")," ")}}function h(u,R){if(1&u&&(f.j41(0,"span",6),f.nI1(1,"translate"),f.j41(2,"button",7),f.nI1(3,"translate"),f.EFF(4),f.nI1(5,"translate"),f.k0s()()),2&u){const p=f.XpG();f.Y8G("ngbTooltip",f.bMT(1,4,"item.edit.tabs.status.buttons.unauthorized")),f.R7$(2),f.Y8G("disabled",!0),f.BMQ("aria-label",f.bMT(3,6,"item.edit.tabs.status.buttons."+p.operation.operationKey+".button")),f.R7$(2),f.SpI(" ",f.bMT(5,8,"item.edit.tabs.status.buttons."+p.operation.operationKey+".button")," ")}}let t=(()=>{class u{static#t=this.\u0275fac=function(y){return new(y||u)};static#e=this.\u0275cmp=f.VBU({type:u,selectors:[["ds-item-operation"]],inputs:{operation:"operation"},standalone:!0,features:[f.aNF],decls:7,vars:5,consts:[[1,"col-3","float-left","d-flex","h-100","action-label"],[1,"justify-content-center","align-self-center"],[1,"col-9","float-left","action-button"],[4,"ngIf"],[3,"ngbTooltip",4,"ngIf"],[1,"btn","btn-outline-primary",3,"disabled","routerLink"],[3,"ngbTooltip"],[1,"btn","btn-outline-primary",3,"disabled"]],template:function(y,$){1&y&&(f.j41(0,"div",0)(1,"span",1),f.EFF(2),f.nI1(3,"translate"),f.k0s()(),f.j41(4,"div",2),f.DNE(5,W,5,8,"span",3)(6,h,6,10,"span",4),f.k0s()),2&y&&(f.R7$(2),f.SpI(" ",f.bMT(3,3,"item.edit.tabs.status.buttons."+$.operation.operationKey+".label")," "),f.R7$(3),f.Y8G("ngIf",$.operation.authorized),f.R7$(),f.Y8G("ngIf",!$.operation.authorized))},dependencies:[Y.h,Y.D9,N.Wk,P.n8,P.md,E.bT],encapsulation:2})}return u})()},35494:(ot,A,o)=>{"use strict";o.r(A),o.d(A,{ItemStatusComponent:()=>pt});var E=o(54460),N=o(95968),P=o(69685),Y=o(71217),f=o(63016),W=o(76627),h=o(47947),t=o(1703),u=o(22867),R=o(27035),p=o(81459),y=o(66645),$=o(42267),g=o(84195),it=o(77304),b=o(36556),V=o(28256),_t=o(27685),rt=o(12007),dt=o(2566),H=o(72683),mt=o(15497),It=o(9353);class L{constructor(O,v,D,M=!1,C=!0){this.operationKey=O,this.operationUrl=v,this.featureID=D,this.authorized=C,this.setDisabled(M)}setDisabled(O){this.disabled=O}setAuthorized(O){this.authorized=O}}var c=o(53107);const m=I=>({"pt-3":I});function Tt(I,O){if(1&I&&(c.j41(0,"div",7)(1,"div",3),c.EFF(2),c.nI1(3,"translate"),c.k0s(),c.j41(4,"div",8),c.EFF(5),c.k0s()()),2&I){const v=O.$implicit,D=c.XpG();c.R7$(2),c.SpI(" ",c.bMT(3,4,"item.edit.tabs.status.labels."+v),": "),c.R7$(2),c.Mz_("id","status-",v,""),c.R7$(),c.SpI(" ",D.statusData[v]," ")}}function yt(I,O){if(1&I&&(c.j41(0,"div")(1,"div",3),c.EFF(2),c.k0s(),c.j41(3,"div",10),c.EFF(4),c.nI1(5,"translate"),c.k0s()()),2&I){const v=c.XpG().$implicit;c.R7$(2),c.SpI(" ",v.identifierType.toLocaleUpperCase()," "),c.R7$(2),c.Lme("",v.value," (",c.bMT(5,3,"item.edit.identifiers.doi.status."+v.identifierStatus),")")}}function $t(I,O){if(1&I&&(c.j41(0,"div",7),c.DNE(1,yt,6,5,"div",9),c.k0s()),2&I){const v=O.$implicit;c.R7$(),c.Y8G("ngIf","doi"===v.identifierType)}}function Ct(I,O){if(1&I&&(c.j41(0,"div",11),c.nrm(1,"ds-item-operation",12),c.k0s()),2&I){const v=O.$implicit;c.Y8G("ngClass",c.eq3(2,m,v)),c.R7$(),c.Y8G("operation",v)}}let pt=(()=>{class I{constructor(v,D,M,C,J){this.route=v,this.authorizationService=D,this.identifierDataService=M,this.configurationService=C,this.orcidAuthService=J,this.operations$=new Y.t([]),this.subs=[]}ngOnInit(){this.itemRD$=this.route.parent.data.pipe((0,h.T)(v=>v.dso)),this.itemRD$.pipe((0,t.$)(),(0,h.T)(v=>v.payload)).pipe((0,u.n)(v=>{this.statusData=Object.assign({id:v.id,handle:v.handle,lastModified:v.lastModified}),this.statusDataKeys=Object.keys(this.statusData),this.identifiers$=this.identifierDataService.getIdentifierDataFor(v).pipe((0,h.T)(S=>401!==S.statusCode&&(0,H.a4)(S.payload)?S.payload.identifiers:null));const D=this.configurationService.findByPropertyName("identifiers.item-status.register-doi").pipe((0,rt.qD)(),(0,h.T)(S=>{if(S.hasSucceeded){const k=S.payload;return!!(k.values.length>0&&(0,H.a4)(k.values[0]))&&"true"===k.values[0]}return!1})),M=this.getCurrentUrl(v),C=[new L("authorizations",`${M}/authorizations`,b._.CanManagePolicies,!0),new L("mappedCollections",`${M}/mapper`,b._.CanManageMappings,!0),v.isWithdrawn?new L("reinstate",`${M}/reinstate`,b._.ReinstateItem,!0):new L("withdraw",`${M}/withdraw`,b._.WithdrawItem,!0),v.isDiscoverable?new L("private",`${M}/private`,b._.CanMakePrivate,!0):new L("public",`${M}/public`,b._.CanMakePrivate,!0),new L("move",`${M}/move`,b._.CanMove,!0),new L("delete",`${M}/delete`,b._.CanDelete,!0)];this.operations$.next(C);const J=this.identifierDataService.getIdentifierDataFor(v).pipe((0,rt.qD)(),(0,R.Z)(S=>{if(S.hasSucceeded){const k=S.payload.identifiers;let st=!0,ut=!1;return k?.forEach(U=>{(0,H.a4)(U)&&"doi"===U.identifierType&&(st=!1,["PENDING","MINTED",null].includes(U.identifierStatus)&&(ut=!0))}),D.pipe((0,h.T)(U=>U&&(ut||st)))}return(0,f.of)(!1)}),(0,u.n)(S=>{const k=[...C];if(S){const st=new L("register-doi",`${M}/register-doi`,b._.CanRegisterDOI,!0);k.splice(k.length-1,0,st)}return k}),(0,p.H)(S=>(0,H.a4)(S.featureID)?this.authorizationService.isAuthorized(S.featureID,v.self).pipe((0,y.F)(),(0,h.T)(k=>(S.setDisabled(!k),S.setAuthorized(k),S))):[S]),(0,$.$)());let nt=(0,f.of)([]);return this.orcidAuthService.isLinkedToOrcid(v)&&(nt=this.orcidAuthService.onlyAdminCanDisconnectProfileFromOrcid().pipe((0,h.T)(S=>S?[new L("unlinkOrcid",`${M}/unlink-orcid`)]:[]))),(0,W.z)([J,nt])}),(0,h.T)(([v,D])=>[...v,...D])).subscribe(v=>this.operations$.next(v)),this.itemPageRoute$=this.itemRD$.pipe((0,rt.Hz)(),(0,h.T)(v=>(0,mt._o)(v)))}getCurrentUrl(v){return(0,mt.$r)(v)}trackOperation(v,D){return(0,H.a4)(D)?D.operationKey:void 0}ngOnDestroy(){this.subs.filter(v=>(0,H.a4)(v)).forEach(v=>v.unsubscribe())}static#t=this.\u0275fac=function(D){return new(D||I)(c.rXU(N.nX),c.rXU(it.AuthorizationDataService),c.rXU(V.IdentifierDataService),c.rXU(g.ConfigurationDataService),c.rXU(_t.r))};static#e=this.\u0275cmp=c.VBU({type:I,selectors:[["ds-base-item-status"]],standalone:!0,features:[c.aNF],decls:17,vars:19,consts:[[1,"mt-2"],[1,"row"],["class","w-100",4,"ngFor","ngForOf"],[1,"col-3","float-left","status-label"],["id","status-itemPage",1,"col-9","float-left","status-data"],[3,"routerLink"],["class","w-100",3,"ngClass",4,"ngFor","ngForOf"],[1,"w-100"],[1,"col-9","float-left","status-data",3,"id"],[4,"ngIf"],[1,"col-9","float-left","status-label"],[1,"w-100",3,"ngClass"],[3,"operation"]],template:function(D,M){1&D&&(c.j41(0,"p",0),c.EFF(1),c.nI1(2,"translate"),c.k0s(),c.j41(3,"div",1),c.DNE(4,Tt,6,6,"div",2)(5,$t,2,1,"div",2),c.nI1(6,"async"),c.j41(7,"div",3),c.EFF(8),c.nI1(9,"translate"),c.k0s(),c.j41(10,"div",4)(11,"a",5),c.nI1(12,"async"),c.EFF(13),c.nI1(14,"async"),c.k0s()(),c.DNE(15,Ct,2,4,"div",6),c.nI1(16,"async"),c.k0s()),2&D&&(c.R7$(),c.JRh(c.bMT(2,7,"item.edit.tabs.status.description")),c.R7$(3),c.Y8G("ngForOf",M.statusDataKeys),c.R7$(),c.Y8G("ngForOf",c.bMT(6,9,M.identifiers$)),c.R7$(3),c.SpI(" ",c.bMT(9,11,"item.edit.tabs.status.labels.itemPage"),": "),c.R7$(3),c.Y8G("routerLink",c.bMT(12,13,M.itemPageRoute$)),c.R7$(2),c.JRh(c.bMT(14,15,M.itemPageRoute$)),c.R7$(2),c.Y8G("ngForOf",c.bMT(16,17,M.operations$)))},dependencies:[P.h,P.D9,E.Sq,E.Jj,E.bT,N.Wk,It.k,E.YU],encapsulation:2,data:{animation:[dt.qG,dt.Ws]}})}return I})()},52529:(ot,A,o)=>{var E={"./custom/app/item-page/edit-item-page/item-status/item-status.component":[69512,9512]};function N(P){if(!o.o(E,P))return Promise.resolve().then(()=>{var W=new Error("Cannot find module '"+P+"'");throw W.code="MODULE_NOT_FOUND",W});var Y=E[P],f=Y[0];return o.e(Y[1]).then(()=>o(f))}N.keys=()=>Object.keys(E),N.id=52529,ot.exports=N}}]);