"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[9563,9003],{79003:(J,S,s)=>{s.r(S),s.d(S,{ResourcePolicyDataService:()=>Q});var m=s(27691),t=s(47947),T=s(1703),P=s(72683),F=s(79224),B=s(45122),f=s(99120),N=s(25718),W=s(45926),K=s(83951),d=s(2887),j=s(2868),_=s(12350),L=s(82114),G=s(36705),E=s(70210),b=s(9843),l=s(92312),g=s(31363),y=s(7172),e=s(25744),D=s(12007),$=s(53107);let Q=(()=>{class x extends d.W{constructor(u,p,O,I,U,C,k,V){super("resourcepolicies",u,p,O,I),this.requestService=u,this.rdbService=p,this.objectCache=O,this.halService=I,this.notificationsService=U,this.comparator=C,this.ePersonService=k,this.groupService=V,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new W.V(this.linkPath,u,p,O,I,U,this.responseMsToLive),this.searchData=new _.X(this.linkPath,u,p,O,I,this.responseMsToLive),this.patchData=new j.n(this.linkPath,u,p,O,I,C,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new K.I(this.linkPath,u,p,O,I,U,this.responseMsToLive,this.constructIdEndpoint)}create(u,p,O,I){const U=[];return U.push(new f.x("resource",p)),(0,P.hj)(O)?U.push(new f.x("eperson",O)):(0,P.hj)(I)&&U.push(new f.x("group",I)),this.createData.create(u,...U)}delete(u){return this.deleteData.delete(u).pipe((0,D.qD)(),(0,t.T)(p=>p.hasSucceeded))}update(u){return this.patchData.update(u)}getDefaultAccessConditionsFor(u,p){return this.findListByHref(u._links.defaultAccessConditions.href,p)}searchByEPerson(u,p,O=!0,I=!0,...U){const C=new G._;return C.searchParams=[new f.x("uuid",u)],(0,P.hj)(p)&&C.searchParams.push(new f.x("resource",p)),this.searchData.searchBy(this.searchByEPersonMethod,C,O,I,...U)}searchByGroup(u,p,O=!0,I=!0,...U){const C=new G._;return C.searchParams=[new f.x("uuid",u)],(0,P.hj)(p)&&C.searchParams.push(new f.x("resource",p)),this.searchData.searchBy(this.searchByGroupMethod,C,O,I,...U)}searchByResource(u,p,O=!0,I=!0,...U){const C=new G._;return C.searchParams=[new f.x("uuid",u)],(0,P.hj)(p)&&C.searchParams.push(new f.x("action",p)),this.searchData.searchBy(this.searchByResourceMethod,C,O,I,...U)}updateTarget(u,p,O,I){const C=("eperson"===I?this.ePersonService:this.groupService).getIDHrefObs(O),k=Object.create({});let V=new m.Lr;V=V.append("Content-Type","text/uri-list"),k.headers=V;const Z=this.requestService.generateRequestId();return C.pipe((0,T.$)()).subscribe(w=>{const X=new E.v_(Z,p+"/"+I,w,k);Object.assign(X,{getResponseParser:()=>l.M}),this.requestService.send(X)}),this.rdbService.buildFromRequestUUIDAndAwait(Z,()=>this.invalidateByHref(p))}static#e=this.\u0275fac=function(p){return new(p||x)($.KVO(b.B),$.KVO(B.o),$.KVO(N.$),$.KVO(e.Y),$.KVO(F.I),$.KVO(L.Y),$.KVO(g.EPersonDataService),$.KVO(y.GroupDataService))};static#t=this.\u0275prov=$.jDH({token:x,factory:x.\u0275fac,providedIn:"root"})}return x})()},59390:(J,S,s)=>{s.d(S,{m:()=>_});var m=s(69685),t=s(71217),T=s(47947),P=s(37610),F=s(83116),B=s(79003),f=s(12007),N=s(48922),W=s(79224),K=s(43334),d=s(53107),j=s(95968);let _=(()=>{class L{constructor(E,b,l,g,y,e){this.dsoNameService=E,this.notificationsService=b,this.resourcePolicyService=l,this.route=g,this.router=y,this.translate=e,this.processing$=new t.t(!1)}ngOnInit(){this.route.data.pipe((0,T.T)(E=>E),(0,P.s)(1)).subscribe(E=>{this.targetResourceUUID=E.resourcePolicyTarget.payload.id,this.targetResourceName=this.dsoNameService.getName(E.resourcePolicyTarget.payload)})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${N.K4}`],{relativeTo:this.route})}createResourcePolicy(E){let b;this.processing$.next(!0),b="eperson"===E.target.type?this.resourcePolicyService.create(E.object,this.targetResourceUUID,E.target.uuid):this.resourcePolicyService.create(E.object,this.targetResourceUUID,null,E.target.uuid),b.pipe((0,f.qD)()).subscribe(l=>{this.processing$.next(!1),l.hasSucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.create.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get("resource-policies.create.page.failure.content"))})}static#e=this.\u0275fac=function(b){return new(b||L)(d.rXU(F.f),d.rXU(W.I),d.rXU(B.ResourcePolicyDataService),d.rXU(j.nX),d.rXU(j.Ix),d.rXU(m.c$))};static#t=this.\u0275cmp=d.VBU({type:L,selectors:[["ds-resource-policy-create"]],standalone:!0,features:[d.aNF],decls:5,vars:5,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","isProcessing"]],template:function(b,l){1&b&&(d.j41(0,"div",0)(1,"h4",1),d.EFF(2),d.nI1(3,"translate"),d.k0s(),d.j41(4,"ds-resource-policy-form",2),d.bIt("reset",function(){return l.redirectToAuthorizationsPage()})("submit",function(y){return l.createResourcePolicy(y)}),d.k0s()()),2&b&&(d.R7$(2),d.Lme("",d.bMT(3,3,"resource-policies.create.page.heading")," ",l.targetResourceName,""),d.R7$(2),d.Y8G("isProcessing",l.isProcessing()))},dependencies:[K.y,m.h,m.D9],encapsulation:2})}return L})()},99794:(J,S,s)=>{s.d(S,{_:()=>G});var m=s(69685),t=s(71217),T=s(63016),P=s(76627),F=s(47947),B=s(37610),f=s(1211),N=s(79003),W=s(12007),K=s(48922),d=s(79224),j=s(43334),_=s(53107),L=s(95968);let G=(()=>{class E{constructor(l,g,y,e,D){this.notificationsService=l,this.resourcePolicyService=g,this.route=y,this.router=e,this.translate=D,this.processing$=new t.t(!1)}ngOnInit(){this.route.data.pipe((0,F.T)(l=>l),(0,B.s)(1)).subscribe(l=>{this.resourcePolicy=l.resourcePolicy.payload})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${K.K4}`],{relativeTo:this.route})}updateResourcePolicy(l){this.processing$.next(!0);const g=Object.assign({},l.object,{id:this.resourcePolicy.id,type:f.O.value,_links:this.resourcePolicy._links}),y=l.updateTarget?this.resourcePolicyService.updateTarget(this.resourcePolicy.id,this.resourcePolicy._links.self.href,l.target.uuid,l.target.type).pipe((0,W.qD)(),(0,F.T)(D=>D&&D.hasSucceeded)):(0,T.of)(!0),e=this.resourcePolicyService.update(g).pipe((0,W.qD)(),(0,F.T)(D=>D&&D.hasSucceeded));(0,P.z)([y,e]).subscribe(([D,$])=>{this.processing$.next(!1),D&&$?(this.notificationsService.success(null,this.translate.get("resource-policies.edit.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get($?"resource-policies.edit.page.target-failure.content":D?"resource-policies.edit.page.other-failure.content":"resource-policies.edit.page.failure.content"))})}static#e=this.\u0275fac=function(g){return new(g||E)(_.rXU(d.I),_.rXU(N.ResourcePolicyDataService),_.rXU(L.nX),_.rXU(L.Ix),_.rXU(m.c$))};static#t=this.\u0275cmp=_.VBU({type:E,selectors:[["ds-resource-policy-edit"]],standalone:!0,features:[_.aNF],decls:5,vars:6,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","resourcePolicy","isProcessing"]],template:function(g,y){1&g&&(_.j41(0,"div",0)(1,"h1",1),_.EFF(2),_.nI1(3,"translate"),_.k0s(),_.j41(4,"ds-resource-policy-form",2),_.bIt("reset",function(){return y.redirectToAuthorizationsPage()})("submit",function(D){return y.updateResourcePolicy(D)}),_.k0s()()),2&g&&(_.R7$(2),_.Lme("",_.bMT(3,4,"resource-policies.edit.page.heading")," ",y.resourcePolicy.id,""),_.R7$(2),_.Y8G("resourcePolicy",y.resourcePolicy)("isProcessing",y.isProcessing()))},dependencies:[j.y,m.h,m.D9],encapsulation:2})}return E})()},43334:(J,S,s)=>{s.d(S,{y:()=>re});var m=s(54460),t=s(53107),T=s(2155),P=s(89593),F=s(69685),B=s(63016),f=s(71217),N=s(76627),W=s(47947),K=s(41483),d=s(37610),j=s(83116),_=s(9843),L=s(31363),G=s(7172),E=s(69069),b=s(1211),l=s(12007),g=s(75988),y=s(72683),e=s(5653),D=s(12323),$=s(59191),Q=s(36590),x=s(50120),M=s(84437),u=s(14257);const p=[{label:u.t.TYPE_SUBMISSION,value:u.t.TYPE_SUBMISSION},{label:u.t.TYPE_WORKFLOW,value:u.t.TYPE_WORKFLOW},{label:u.t.TYPE_INHERITED,value:u.t.TYPE_INHERITED},{label:u.t.TYPE_CUSTOM,value:u.t.TYPE_CUSTOM}],O=[{label:M.X.READ.toString(),value:M.X.READ},{label:M.X.WRITE.toString(),value:M.X.WRITE},{label:M.X.REMOVE.toString(),value:M.X.REMOVE},{label:M.X.ADMIN.toString(),value:M.X.ADMIN},{label:M.X.DELETE.toString(),value:M.X.DELETE},{label:M.X.WITHDRAWN_READ.toString(),value:M.X.WITHDRAWN_READ},{label:M.X.DEFAULT_BITSTREAM_READ.toString(),value:M.X.DEFAULT_BITSTREAM_READ},{label:M.X.DEFAULT_ITEM_READ.toString(),value:M.X.DEFAULT_ITEM_READ}],I={id:"name",label:"resource-policies.form.name.label",maxLength:30,hint:"resource-policies.form.name.hint",metadataFields:[],repeatable:!1,submissionId:"",hasSelectableMetadata:!1},U={id:"description",label:"resource-policies.form.description.label",metadataFields:[],repeatable:!1,rows:10,submissionId:"",hasSelectableMetadata:!1},C={id:"policyType",label:"resource-policies.form.policy-type.label",options:p,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.policy-type.required"}},k={id:"action",label:"resource-policies.form.action-type.label",options:O,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.action-type.required"}},V={id:"date",group:[]},Z={element:{control:"form-row"}},w={id:"start",label:"resource-policies.form.date.start.label",placeholder:"resource-policies.form.date.start.label",inline:!1,toggleIcon:"far fa-calendar-alt"},c={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},X={id:"end",label:"resource-policies.form.date.end.label",placeholder:"resource-policies.form.date.end.label",inline:!1,toggleIcon:"far fa-calendar-alt"},i={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},n=["content"];function o(v,q){if(1&v&&t.nrm(0,"ds-form",17,2),2&v){const r=t.XpG();t.Y8G("formId",r.formId)("formModel",r.formModel)("displaySubmit",!1)("displayCancel",!1)}}function A(v,q){if(1&v){const r=t.RV6();t.j41(0,"ds-eperson-group-list",18),t.bIt("select",function(h){t.eBV(r);const R=t.XpG();return t.Njj(R.updateObjectSelected(h,!0))}),t.k0s()}}function Y(v,q){if(1&v){const r=t.RV6();t.j41(0,"ds-eperson-group-list",19),t.bIt("select",function(h){t.eBV(r);const R=t.XpG();return t.Njj(R.updateObjectSelected(h,!1))}),t.k0s()}2&v&&t.Y8G("isListOfEPerson",!1)}function ee(v,q){1&v&&(t.j41(0,"span"),t.nrm(1,"i",20),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&v&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function te(v,q){1&v&&(t.j41(0,"span"),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&v&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"form.submit")," "))}function se(v,q){if(1&v){const r=t.RV6();t.j41(0,"div",21)(1,"h4",22),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"button",23),t.bIt("click",function(){const h=t.eBV(r).$implicit;return t.Njj(h.close())}),t.j41(5,"span",24),t.EFF(6,"\xd7"),t.k0s()()(),t.j41(7,"div",25)(8,"div",26)(9,"div",27),t.nrm(10,"i",28),t.k0s(),t.j41(11,"div"),t.nrm(12,"p",29),t.nI1(13,"translate"),t.nrm(14,"p",30),t.nI1(15,"translate"),t.k0s()()(),t.j41(16,"div",31)(17,"button",32),t.bIt("click",function(){const h=t.eBV(r).$implicit;return t.Njj(h.close())}),t.EFF(18),t.nI1(19,"translate"),t.k0s()()}if(2&v){const r=t.XpG();t.R7$(2),t.JRh(t.bMT(3,4,"resource-policies.form.eperson-group-list.modal.header")),t.R7$(10),t.Y8G("innerHTML",t.bMT(13,6,"eperson"===r.navActiveId?"resource-policies.form.eperson-group-list.modal.text1.toGroup":"resource-policies.form.eperson-group-list.modal.text1.toEPerson"),t.npT),t.R7$(2),t.Y8G("innerHTML",t.bMT(15,8,"resource-policies.form.eperson-group-list.modal.text2"),t.npT),t.R7$(4),t.JRh(t.bMT(19,10,"resource-policies.form.eperson-group-list.modal.close"))}}let re=(()=>{class v{constructor(r,a,h,R,H,z){this.dsoNameService=r,this.ePersonService=a,this.formService=h,this.groupService=R,this.requestService=H,this.modalService=z,this.isProcessing=(0,B.of)(!1),this.reset=new t.bkB,this.submit=new t.bkB,this.resourcePolicyTargetName$=new f.t(""),this.subs=[],this.resourcePolicyTargetUpdated=!1}ngOnInit(){if(this.isActive=!0,this.formId=this.formService.getUniqueId("resource-policy-form"),this.formModel=this.buildResourcePolicyForm(),this.isBeingEdited()){const r=this.ePersonService.findByHref(this.resourcePolicy._links.eperson.href,!1).pipe((0,l.yd)()),a=this.groupService.findByHref(this.resourcePolicy._links.group.href,!1).pipe((0,l.yd)()),h=(0,N.z)([r,a]).pipe((0,W.T)(R=>R.find(H=>(0,y.hj)(H.payload))),(0,y.Az)());this.subs.push(h.pipe((0,K.p)(()=>this.isActive)).subscribe(R=>{this.resourcePolicyGrant=R.payload,this.navActiveId=String(R.payload.type),this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}))}}isFormValid(){return this.formService.isValid(this.formId).pipe((0,W.T)(r=>r&&(0,y.hj)(this.resourcePolicyGrant)))}buildResourcePolicyForm(){const r=[];r.push(new D.C(I),new $.E(U),new P.z4z(C),new P.z4z(k));const a=new P.dku(w,c),h=new P.dku(X,i),R=Object.assign({},V,{group:[]});return R.group.push(a,h),r.push(new P.iO5(R,Z)),this.initModelsValue(r),r}initModelsValue(r){return this.resourcePolicy&&r.forEach(a=>{"date"===a.id?((0,y.a4)(this.resourcePolicy.startDate)&&(a.get(0).value=(0,g.PR)(this.resourcePolicy.startDate)),(0,y.a4)(this.resourcePolicy.endDate)&&(a.get(1).value=(0,g.PR)(this.resourcePolicy.endDate))):this.resourcePolicy.hasOwnProperty(a.id)&&this.resourcePolicy[a.id]&&(a.value=this.resourcePolicy[a.id])}),r}isBeingEdited(){return!(0,y.Im)(this.resourcePolicy)}getResourcePolicyTargetName(){return(0,y.hj)(this.resourcePolicyGrant)?this.dsoNameService.getName(this.resourcePolicyGrant):""}updateObjectSelected(r,a){this.resourcePolicyTargetUpdated=!0,this.resourcePolicyGrant=r,this.resourcePolicyGrantType=a?"eperson":"group",this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}onReset(){this.reset.emit()}onSubmit(){this.formService.getFormData(this.formId).pipe((0,d.s)(1)).subscribe(r=>{const a=Object.create({});a.object=this.createResourcePolicyByFormData(r),a.target={type:this.resourcePolicyGrantType,uuid:this.resourcePolicyGrant.id},a.updateTarget=this.resourcePolicyTargetUpdated,this.submit.emit(a)})}createResourcePolicyByFormData(r){const a=new E.h;return a.name=r.name?r.name[0].value:null,a.description=r.description?r.description[0].value:null,a.policyType=r.policyType?r.policyType[0].value:null,a.action=r.action?r.action[0].value:null,a.startDate=r.date&&r.date.start?(0,g.Sd)(r.date.start[0].value):null,a.endDate=r.date&&r.date.end?(0,g.Sd)(r.date.end[0].value):null,a.type=b.O,a}ngOnDestroy(){this.isActive=!1,this.formModel=null,this.subs.filter(r=>(0,y.a4)(r)).forEach(r=>r.unsubscribe())}onNavChange(r){this.isBeingEdited()&&(r.preventDefault(),this.modalService.open(this.content))}static#e=this.\u0275fac=function(a){return new(a||v)(t.rXU(j.f),t.rXU(L.EPersonDataService),t.rXU(x.u),t.rXU(G.GroupDataService),t.rXU(_.B),t.rXU(T.Bq))};static#t=this.\u0275cmp=t.VBU({type:v,selectors:[["ds-resource-policy-form"]],viewQuery:function(a,h){if(1&a&&t.GBs(n,5),2&a){let R;t.mGM(R=t.lsd())&&(h.content=R.first)}},inputs:{resourcePolicy:"resourcePolicy",isProcessing:"isProcessing"},outputs:{reset:"reset",submit:"submit"},standalone:!0,features:[t.aNF],decls:38,vars:34,consts:[["nav","ngbNav"],["content",""],["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel",4,"ngIf"],[1,"container-fluid"],["for","ResourcePolicyObject"],["id","ResourcePolicyObject","type","text",1,"form-control","mb-3",3,"value"],["ngbNav","",1,"nav-pills",3,"activeIdChange","navChange","activeId"],["role","presentation",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"form-group","row"],[1,"col","text-right"],["type","reset",1,"btn","btn-default",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel"],[3,"select"],[3,"select","isListOfEPerson"],[1,"fas","fa-circle-notch","fa-spin"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"d-flex","flex-row"],[1,"mr-3"],[1,"fas","fa-info-circle","fa-2x","text-info"],[1,"font-weight-bold",3,"innerHTML"],[3,"innerHTML"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(a,h){if(1&a){const R=t.RV6();t.j41(0,"div"),t.DNE(1,o,2,4,"ds-form",3),t.j41(2,"div",4)(3,"label",5),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.nrm(6,"input",6),t.nI1(7,"async"),t.j41(8,"ul",7,0),t.mxI("activeIdChange",function(z){return t.eBV(R),t.DH7(h.navActiveId,z)||(h.navActiveId=z),t.Njj(z)}),t.bIt("navChange",function(z){return t.eBV(R),t.Njj(h.onNavChange(z))}),t.j41(10,"li",8)(11,"a",9),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.DNE(14,A,1,0,"ng-template",10),t.k0s(),t.j41(15,"li",8)(16,"a",9),t.EFF(17),t.nI1(18,"translate"),t.k0s(),t.DNE(19,Y,1,1,"ng-template",10),t.k0s()(),t.nrm(20,"div",11),t.j41(21,"div"),t.nrm(22,"hr"),t.j41(23,"div",12)(24,"div",13)(25,"button",14),t.nI1(26,"async"),t.bIt("click",function(){return t.eBV(R),t.Njj(h.onReset())}),t.EFF(27),t.nI1(28,"translate"),t.k0s(),t.j41(29,"button",15),t.nI1(30,"async"),t.nI1(31,"async"),t.bIt("click",function(){return t.eBV(R),t.Njj(h.onSubmit())}),t.DNE(32,ee,4,3,"span",16),t.nI1(33,"async"),t.DNE(34,te,3,3,"span",16),t.nI1(35,"async"),t.k0s()()()()()(),t.DNE(36,se,20,12,"ng-template",null,1,t.C5r)}if(2&a){const R=t.sdS(9);t.R7$(),t.Y8G("ngIf",h.formModel),t.R7$(3),t.JRh(t.bMT(5,14,"resource-policies.form.eperson-group-list.label")),t.R7$(2),t.Y8G("value",t.bMT(7,16,h.resourcePolicyTargetName$)),t.R7$(2),t.R50("activeId",h.navActiveId),t.R7$(2),t.Y8G("ngbNavItem","eperson"),t.R7$(2),t.JRh(t.bMT(13,18,"resource-policies.form.eperson-group-list.tab.eperson")),t.R7$(3),t.Y8G("ngbNavItem","group"),t.R7$(2),t.JRh(t.bMT(18,20,"resource-policies.form.eperson-group-list.tab.group")),t.R7$(3),t.Y8G("ngbNavOutlet",R),t.R7$(5),t.Y8G("disabled",t.bMT(26,22,h.isProcessing)),t.R7$(2),t.JRh(t.bMT(28,24,"form.cancel")),t.R7$(2),t.Y8G("disabled",!0!==t.bMT(30,26,h.isFormValid())||t.bMT(31,28,h.isProcessing)),t.R7$(3),t.Y8G("ngIf",t.bMT(33,30,h.isProcessing)),t.R7$(2),t.Y8G("ngIf",!0!==t.bMT(35,32,h.isProcessing))}},dependencies:[Q.s,T.Pv,T.Um,T.X9,T.sy,T.Ri,T.m_,e.T,F.h,F.D9,m.Jj,m.bT],encapsulation:2})}return v})()},61305:(J,S,s)=>{s.d(S,{Q:()=>W});var m=s(53107),t=s(95968),T=s(22867),P=s(18062),F=s(53169),B=s(12007),f=s(98573),N=s(72683);const W=(K,d,j=(0,m.WQX)(P.l9),_=(0,m.WQX)(m.zZn),L=(0,m.WQX)(t.Ix))=>{const G=K.queryParamMap.get("targetType"),E=K.queryParamMap.get("policyTargetId");((0,N.Im)(G)||(0,N.Im)(E))&&L.navigateByUrl("/404",{skipLocationChange:!0});const b=new f.v(G);return(0,F.M)(j,b.value,_).pipe((0,T.n)(g=>g.findById(E)),(0,B.qD)())}},81263:(J,S,s)=>{s.d(S,{n:()=>f});var m=s(53107),t=s(95968),T=s(79003),P=s(12007),F=s(72683),B=s(24106);const f=(N,W,K=(0,m.WQX)(t.Ix),d=(0,m.WQX)(T.ResourcePolicyDataService))=>{const j=N.queryParamMap.get("policyId");return(0,F.Im)(j)&&K.navigateByUrl("/404",{skipLocationChange:!0}),d.findById(j,!0,!1,(0,B.s)("eperson"),(0,B.s)("group")).pipe((0,P.qD)())}},60519:(J,S,s)=>{s.d(S,{e:()=>w});var m=s(54460),t=s(69685),T=s(71217),P=s(33325),F=s(41483),B=s(81215),f=s(47947),N=s(66645),W=s(81459),K=s(44660),d=s(37610),j=s(83116),_=s(9843),L=s(31363),G=s(7172),E=s(79003),b=s(12007),l=s(72683),g=s(79224),y=s(24106),e=s(53107),D=s(10936),$=s(57079),Q=s(75988),x=s(25138),M=s(95968);const u=["ds-resource-policy-entry",""];function p(c,X){if(1&c){const i=e.RV6();e.j41(0,"button",7),e.nI1(1,"translate"),e.bIt("click",function(){e.eBV(i);const o=e.XpG();return e.Njj(o.redirectToGroupEditPage())}),e.nrm(2,"i",10),e.k0s()}2&c&&e.Y8G("title",e.bMT(1,1,"resource-policies.table.headers.edit.group"))}let O=(()=>{class c{constructor(i,n,o,A){this.dsoNameService=i,this.groupService=n,this.route=o,this.router=A,this.toggleCheckbox=new e.bkB}ngOnInit(){this.epersonName$=this.getName$(this.entry.policy.eperson),this.groupName$=this.getName$(this.entry.policy.group)}getName$(i){return i.pipe((0,b.v7)(),(0,f.T)(n=>{if((0,l.a4)(n?.payload))return this.dsoNameService.getName(n.payload)}))}formatDate(i){return(0,l.hj)(i)?(0,Q.$T)((0,Q.PR)(i)):""}redirectToResourcePolicyEditPage(){this.router.navigate(["./edit"],{relativeTo:this.route,queryParams:{policyId:this.entry.policy.id}})}redirectToGroupEditPage(){this.groupService.findByHref(this.entry.policy._links.group.href,!1).pipe((0,b.ak)(),(0,f.T)(i=>i.id)).subscribe(i=>{this.router.navigate([(0,$.xl)(i)])})}static#e=this.\u0275fac=function(n){return new(n||c)(e.rXU(j.f),e.rXU(G.GroupDataService),e.rXU(M.nX),e.rXU(M.Ix))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["tr","ds-resource-policy-entry",""]],inputs:{entry:"entry"},outputs:{toggleCheckbox:"toggleCheckbox"},standalone:!0,features:[e.aNF],attrs:u,decls:33,vars:26,consts:[[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"ngModelChange","id","ngModel"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["scope","row"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm",3,"click","title"],["aria-hidden","true",1,"fas","fa-edit","fa-fw"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],["aria-hidden","true",1,"fas","fa-users","fa-fw"]],template:function(n,o){1&n&&(e.j41(0,"td",0)(1,"div",1)(2,"input",2),e.bIt("ngModelChange",function(Y){return o.toggleCheckbox.emit(Y)}),e.k0s(),e.j41(3,"label",3)(4,"span",4),e.EFF(5),e.nI1(6,"translate"),e.k0s()()()(),e.j41(7,"th",5),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.k0s(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td"),e.EFF(14),e.k0s(),e.j41(15,"td"),e.EFF(16),e.nI1(17,"async"),e.k0s(),e.j41(18,"td"),e.EFF(19),e.nI1(20,"async"),e.k0s(),e.j41(21,"td"),e.EFF(22),e.k0s(),e.j41(23,"td"),e.EFF(24),e.k0s(),e.j41(25,"td",0)(26,"div",6)(27,"button",7),e.nI1(28,"translate"),e.bIt("click",function(){return o.redirectToResourcePolicyEditPage()}),e.nrm(29,"i",8),e.k0s(),e.DNE(30,p,3,3,"button",9),e.nI1(31,"async"),e.nI1(32,"dsHasValue"),e.k0s()()),2&n&&(e.R7$(2),e.Y8G("id",o.entry.id)("ngModel",o.entry.checked),e.R7$(),e.Y8G("for",o.entry.id),e.R7$(2),e.JRh(e.bMT(6,14,o.entry.checked?"resource-policies.table.headers.deselect":"resource-policies.table.headers.select")),e.R7$(3),e.SpI(" ",o.entry.id,"\n"),e.R7$(2),e.JRh(o.entry.policy.name),e.R7$(2),e.JRh(o.entry.policy.policyType),e.R7$(2),e.JRh(o.entry.policy.action),e.R7$(2),e.SpI(" ",e.bMT(17,16,o.epersonName$),"\n"),e.R7$(3),e.SpI(" ",e.bMT(20,18,o.groupName$),"\n"),e.R7$(3),e.JRh(o.formatDate(o.entry.policy.startDate)),e.R7$(2),e.JRh(o.formatDate(o.entry.policy.endDate)),e.R7$(3),e.Y8G("title",e.bMT(28,20,"resource-policies.table.headers.edit.policy")),e.R7$(3),e.Y8G("ngIf",e.bMT(32,24,e.bMT(31,22,o.groupName$))))},dependencies:[m.Jj,t.h,t.D9,D.YN,D.Zm,D.BC,D.vS,m.bT,x.a],encapsulation:2})}return c})();function I(c,X){if(1&c&&(e.qex(0),e.EFF(1),e.bVm()),2&c){const i=e.XpG();e.R7$(),e.SpI(" (",i.resourceUUID,") ")}}function U(c,X){1&c&&(e.j41(0,"span"),e.nrm(1,"i",12),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&c&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function C(c,X){1&c&&(e.j41(0,"span"),e.nrm(1,"i",13),e.EFF(2),e.nI1(3,"translate"),e.k0s()),2&c&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"resource-policies.delete.btn")," "))}function k(c,X){if(1&c){const i=e.RV6();e.j41(0,"tr",14)(1,"th")(2,"div",15)(3,"input",16,0),e.bIt("change",function(o){e.eBV(i);const A=e.XpG();return e.Njj(A.selectAllCheckbox(o))}),e.k0s(),e.j41(5,"label",17)(6,"span",18),e.EFF(7),e.nI1(8,"translate"),e.k0s()()()(),e.j41(9,"th"),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th"),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"th"),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"th"),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"th"),e.EFF(22),e.nI1(23,"translate"),e.k0s(),e.j41(24,"th"),e.EFF(25),e.nI1(26,"translate"),e.k0s(),e.j41(27,"th"),e.EFF(28),e.nI1(29,"translate"),e.k0s(),e.j41(30,"th"),e.EFF(31),e.nI1(32,"translate"),e.k0s(),e.j41(33,"th"),e.EFF(34),e.nI1(35,"translate"),e.k0s()()}if(2&c){const i=e.sdS(4),n=e.XpG();e.R7$(3),e.Y8G("id","selectAll_"+n.resourceUUID),e.R7$(2),e.Y8G("for","selectAll_"+n.resourceUUID),e.R7$(2),e.JRh(e.bMT(8,12,i.checked?"resource-policies.table.headers.deselect-all":"resource-policies.table.headers.select-all")),e.R7$(3),e.JRh(e.bMT(11,14,"resource-policies.table.headers.id")),e.R7$(3),e.JRh(e.bMT(14,16,"resource-policies.table.headers.name")),e.R7$(3),e.JRh(e.bMT(17,18,"resource-policies.table.headers.policyType")),e.R7$(3),e.JRh(e.bMT(20,20,"resource-policies.table.headers.action")),e.R7$(3),e.JRh(e.bMT(23,22,"resource-policies.table.headers.eperson")),e.R7$(3),e.JRh(e.bMT(26,24,"resource-policies.table.headers.group")),e.R7$(3),e.JRh(e.bMT(29,26,"resource-policies.table.headers.date.start")),e.R7$(3),e.JRh(e.bMT(32,28,"resource-policies.table.headers.date.end")),e.R7$(3),e.JRh(e.bMT(35,30,"resource-policies.table.headers.edit"))}}function V(c,X){if(1&c){const i=e.RV6();e.j41(0,"tr",20),e.bIt("toggleCheckbox",function(o){const A=e.eBV(i).$implicit,Y=e.XpG(2);return e.Njj(Y.selectCheckbox(A,o))}),e.k0s()}2&c&&e.Y8G("entry",X.$implicit)}function Z(c,X){if(1&c&&(e.j41(0,"tbody"),e.DNE(1,V,1,1,"tr",19),e.nI1(2,"async"),e.k0s()),2&c){const i=e.XpG();e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,i.getResourcePolicies()))}}let w=(()=>{class c{constructor(i,n,o,A,Y,ee,te,se,re,v){this.cdr=i,this.dsoNameService=n,this.ePersonService=o,this.groupService=A,this.notificationsService=Y,this.requestService=ee,this.resourcePolicyService=te,this.route=se,this.router=re,this.translate=v,this.processingDelete$=new T.t(!1),this.resourcePoliciesEntries$=new T.t([]),this.subs=[]}ngOnInit(){this.isActive=!0,this.initResourcePolicyList()}canDelete(){return(0,P.H)(this.resourcePoliciesEntries$.value).pipe((0,F.p)(i=>i.checked),(0,B.T)((i,n)=>[...i,n],[]),(0,f.T)(i=>(0,l.hj)(i)),(0,N.F)())}deleteSelectedResourcePolicies(){this.processingDelete$.next(!0);const i=this.resourcePoliciesEntries$.value.filter(n=>n.checked);this.subs.push((0,P.H)(i).pipe((0,W.H)(n=>this.resourcePolicyService.delete(n.policy.id)),(0,K.S)((n,o)=>[...n,o],[]),(0,F.p)(n=>n.length===i.length),(0,d.s)(1)).subscribe(n=>{const o=n.filter(A=>!A);(0,l.Im)(o)?this.notificationsService.success(null,this.translate.get("resource-policies.delete.success.content")):this.notificationsService.error(null,this.translate.get("resource-policies.delete.failure.content")),this.processingDelete$.next(!1)}))}getResourcePolicies(){return this.resourcePoliciesEntries$.asObservable()}initResourcePolicyList(){this.subs.push(this.resourcePolicyService.searchByResource(this.resourceUUID,null,!1,!0,(0,y.s)("eperson"),(0,y.s)("group")).pipe((0,F.p)(()=>this.isActive),(0,b.v7)()).subscribe(i=>{const n=i.payload.page.map(o=>({id:o.id,policy:o,checked:!1}));this.resourcePoliciesEntries$.next(n),this.cdr.detectChanges()}))}isProcessingDelete(){return this.processingDelete$.asObservable()}redirectToResourcePolicyCreatePage(){this.router.navigate(["./create"],{relativeTo:this.route,queryParams:{policyTargetId:this.resourceUUID,targetType:this.resourceType}})}selectAllCheckbox(i){const n=i.target.checked;this.resourcePoliciesEntries$.value.forEach(o=>o.checked=n)}selectCheckbox(i,n){i.checked=n}ngOnDestroy(){this.isActive=!1,this.resourcePoliciesEntries$=null,this.subs.filter(i=>(0,l.a4)(i)).forEach(i=>i.unsubscribe())}static#e=this.\u0275fac=function(n){return new(n||c)(e.rXU(e.gRc),e.rXU(j.f),e.rXU(L.EPersonDataService),e.rXU(G.GroupDataService),e.rXU(g.I),e.rXU(_.B),e.rXU(E.ResourcePolicyDataService),e.rXU(M.nX),e.rXU(M.Ix),e.rXU(t.c$))};static#t=this.\u0275cmp=e.VBU({type:c,selectors:[["ds-resource-policies"]],inputs:{resourceUUID:"resourceUUID",resourceType:"resourceType",resourceName:"resourceName"},standalone:!0,features:[e.aNF],decls:31,vars:34,consts:[["selectAllBtn",""],[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],["colspan","10"],[1,"d-flex","justify-content-between","align-items-center","m-0"],[1,"text-info"],[4,"ngIf"],[1,"space-children-mr","flex-shrink-0"],[1,"btn","btn-danger","p-1",3,"click","disabled","title"],[1,"btn","btn-success","p-1",3,"click","disabled","title"],["aria-hidden","true",1,"fas","fa-plus"],["class","text-center",4,"ngIf"],["aria-hidden","true",1,"fas","fa-circle-notch","fa-spin"],["aria-hidden","true",1,"fas","fa-trash-alt","fa-fw"],[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"change","id"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["ds-resource-policy-entry","",3,"entry","toggleCheckbox",4,"ngFor","ngForOf"],["ds-resource-policy-entry","",3,"toggleCheckbox","entry"]],template:function(n,o){if(1&n&&(e.j41(0,"div",1)(1,"table",2)(2,"thead")(3,"tr")(4,"th",3)(5,"div",4)(6,"span"),e.EFF(7),e.nI1(8,"translate"),e.j41(9,"span",5),e.EFF(10),e.k0s(),e.DNE(11,I,2,1,"ng-container",6),e.k0s(),e.j41(12,"div",7)(13,"button",8),e.nI1(14,"async"),e.nI1(15,"async"),e.nI1(16,"translate"),e.bIt("click",function(){return o.deleteSelectedResourcePolicies()}),e.DNE(17,U,4,3,"span",6),e.nI1(18,"async"),e.DNE(19,C,4,3,"span",6),e.nI1(20,"async"),e.k0s(),e.j41(21,"button",9),e.nI1(22,"async"),e.nI1(23,"translate"),e.bIt("click",function(){return o.redirectToResourcePolicyCreatePage()}),e.nrm(24,"i",10),e.EFF(25),e.nI1(26,"translate"),e.k0s()()()()(),e.DNE(27,k,36,32,"tr",11),e.nI1(28,"async"),e.k0s(),e.DNE(29,Z,3,3,"tbody",6),e.nI1(30,"async"),e.k0s()()),2&n){let A,Y;e.R7$(7),e.SpI(" ",e.bMT(8,12,"resource-policies.table.headers.title.for."+o.resourceType)," "),e.R7$(3),e.SpI(" ",o.resourceName," "),e.R7$(),e.Y8G("ngIf","item"!==o.resourceType),e.R7$(2),e.Y8G("disabled",!0!==e.bMT(14,14,o.canDelete())||e.bMT(15,16,o.isProcessingDelete()))("title",e.bMT(16,18,"resource-policies.delete.btn.title")),e.R7$(4),e.Y8G("ngIf",e.bMT(18,20,o.isProcessingDelete())),e.R7$(2),e.Y8G("ngIf",!0!==e.bMT(20,22,o.isProcessingDelete())),e.R7$(2),e.Y8G("disabled",e.bMT(22,24,o.isProcessingDelete()))("title",e.bMT(23,26,"resource-policies.add.for."+o.resourceType)),e.R7$(4),e.SpI(" ",e.bMT(26,28,"resource-policies.add.button")," "),e.R7$(2),e.Y8G("ngIf",(null==(A=e.bMT(28,30,o.getResourcePolicies()))?null:A.length)>0),e.R7$(2),e.Y8G("ngIf",(null==(Y=e.bMT(30,32,o.getResourcePolicies()))?null:Y.length)>0)}},dependencies:[O,t.h,t.D9,m.bT,m.Jj,m.Sq],styles:["td[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:focus{box-shadow:none!important}"]})}return c})()},25138:(J,S,s)=>{s.d(S,{a:()=>T});var m=s(72683),t=s(53107);let T=(()=>{class P{transform(B){return(0,m.a4)(B)}static#e=this.\u0275fac=function(f){return new(f||P)};static#t=this.\u0275pipe=t.EJ8({name:"dsHasValue",type:P,pure:!0,standalone:!0})}return P})()}}]);