"use strict";(self.webpackChunkdspace_angular=self.webpackChunkdspace_angular||[]).push([[7006],{86503:(b,M,e)=>{e.d(M,{h:()=>f});var a=e(53107),h=e(95968),c=e(69685),v=e(63016),d=e(47947),m=e(22867),I=e(31829),T=e(58183),s=e(12007),g=e(72683);const f=(o,D,P=(0,a.WQX)(T.BrowseDefinitionDataService),B=(0,a.WQX)(h.Ix),O=(0,a.WQX)(c.c$))=>{const x=o.data.title,E=o.params.id||o.queryParams.id||o.data.id;let S;S=(0,g.Tn)(o.data.browseDefinition)&&(0,g.a4)(E)?P.findById(E).pipe((0,s.qD)(),(0,d.T)(K=>K.payload)):(0,v.of)(o.data.browseDefinition);const L=o.queryParams.scope??o.parent?.params.id,W=o.queryParams.value,R=O.instant(`browse.metadata.${E}`);return S.pipe((0,m.n)(K=>(0,g.a4)(K)?(o.data=function p(o,D,P,B,O,x,E){return Object.assign({},x.data,{title:o,id:D,browseDefinition:P,field:B,value:(0,g.a4)(O)?`"${O}"`:"",scope:E})}(x,E,K,R,W,o,L),(0,v.of)(!0)):(B.navigate([I.RD]),(0,v.of)(!1))))}},96206:(b,M,e)=>{e.d(M,{p:()=>h});var a=e(32588);const h=(c,v)=>(c.data=Object.assign({},c.data,{breadcrumbKey:c.data.breadcrumbKey+"."+c.params.id}),(0,a.S)(c,v))},94299:(b,M,e)=>{e.d(M,{e:()=>T}),e(71526);var h=e(76794),c=e(8181),d=(e(21894),e(22957)),m=e(53107);function I(s,g){}let T=(()=>{class s extends h.e{constructor(){super(...arguments),this.inputNamesDependentForComponent=["context","browseByType"],this.inputNames=["context","browseByType","displayTitle","scope"]}getComponent(){return(0,d.cv)(this.browseByType,this.context,this.themeService.getThemeName())}static#e=this.\u0275fac=(()=>{let f;return function(o){return(f||(f=m.xGo(s)))(o||s)}})();static#t=this.\u0275cmp=m.VBU({type:s,selectors:[["ds-browse-by-switcher"]],inputs:{context:"context",browseByType:"browseByType",displayTitle:"displayTitle",scope:"scope"},standalone:!0,features:[m.Vt3,m.aNF],decls:2,vars:0,consts:[["DynamicComponentLoader",""],["dsDynamicComponentLoader",""]],template:function(p,o){1&p&&m.DNE(0,I,0,0,"ng-template",1,0,m.C5r)},dependencies:[c.z],encapsulation:2})}return s})()},32588:(b,M,e)=>{e.d(M,{S:()=>T});var a=e(53107),h=e(72683),c=e(67044),v=e(63016),d=e(72553);let I=(()=>{class s{getBreadcrumbs(f,p){return(0,v.of)([new d.Q(f+".breadcrumbs",p)])}static#e=this.\u0275fac=function(p){return new(p||s)};static#t=this.\u0275prov=a.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();const T=(s,g,f=(0,a.WQX)(I))=>{const p=s.data.breadcrumbKey;if((0,h.Tn)(p))throw new Error('You provided an i18nBreadcrumbResolver for url "'+s.url+"\" but no breadcrumbKey in the route's data");return{provider:f,key:p,url:(0,c.F)(s)}}},74733:(b,M,e)=>{e.d(M,{c:()=>Y});var a=e(53107),h=e(63016),c=e(76627),v=e(22867),d=e(47947),m=e(31829),I=e(60875),T=e(77304),s=e(36556),g=e(12792),f=e(58751),p=e(82376),o=e(47376),D=e(12007),P=e(59517),B=e(87913),O=e(72683),x=e(62990),E=e(78198),S=e(43515),L=e(79224),W=e(49559),R=e(82040),K=e(17584),N=e(26041),j=e(35130),w=e(71779),F=e(45830),H=e(89788),z=e(2155),$=e(95968);let Q=(()=>{class u{constructor(t,i,r,l,n,y,C){this.modalService=t,this.versionService=i,this.versionHistoryService=r,this.itemVersionShared=l,this.router=n,this.workspaceItemDataService=y,this.itemService=C}openCreateVersionModal(t){const i=t,r=i._links.version.href,l=this.modalService.open(H.L);this.versionService.findByHref(r).pipe((0,D.qD)()).subscribe(n=>{l.componentInstance.firstVersion=n.hasNoContent,l.componentInstance.versionNumber=n.hasNoContent?void 0:n.payload.version}),l.componentInstance.createVersionEvent.pipe((0,v.n)(n=>this.versionHistoryService.createVersion(i._links.self.href,n)),(0,D.qD)(),(0,R.M)(()=>l.close()),(0,R.M)(n=>{this.itemVersionShared.notifyCreateNewVersion(n)}),(0,D.ak)(),(0,v.n)(n=>this.itemService.findByHref(n._links.item.href)),(0,D.ak)(),(0,v.n)(n=>this.workspaceItemDataService.findByItem(n.uuid,!0,!1)),(0,D.ak)()).subscribe(n=>{this.router.navigateByUrl("workspaceitems/"+n.id+"/edit")})}isNewVersionButtonDisabled(t){return this.versionHistoryService.hasDraftVersion$(t._links.version.href).pipe((0,d.T)(i=>!!i))}getVersioningTooltipMessage(t,i,r){return this.isNewVersionButtonDisabled(t).pipe((0,v.n)(l=>(0,h.of)(l?i:r)))}static#e=this.\u0275fac=function(i){return new(i||u)(a.KVO(z.Bq),a.KVO(N.VersionDataService),a.KVO(j.VersionHistoryDataService),a.KVO(F.h),a.KVO($.Ix),a.KVO(w.WorkspaceitemDataService),a.KVO(K.ItemDataService))};static#t=this.\u0275prov=a.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})();var U=e(21362),X=e(69685);let G=(()=>{class u{constructor(t,i,r,l,n,y,C,A,V,Z){this.dSpaceObjectDataService=t,this.menuService=i,this.authorizationService=r,this.modalService=l,this.dsoVersioningModalService=n,this.researcherProfileService=y,this.notificationsService=C,this.translate=A,this.dsoWithdrawnReinstateModalService=V,this.correctionTypeDataService=Z}resolve(t,i){let r=t.params.id;return(0,O.Tn)(r)&&(0,O.a4)(t.queryParams.scope)&&(r=t.queryParams.scope),(0,O.Tn)(r)?(0,h.of)({...t.data?.menu}):this.dSpaceObjectDataService.findById(r,!0,!1).pipe((0,D.qD)(),(0,v.n)(l=>{if(l.hasSucceeded){const n=l.payload;return(0,c.z)(this.getDsoMenus(n,t,i)).pipe((0,d.T)(y=>[].concat.apply([],y)),(0,d.T)(y=>this.addDsoUuidToMenuIDs(y,n)),(0,d.T)(y=>({...t.data?.menu,[E.D.DSO_EDIT]:y})))}return(0,h.of)({...t.data?.menu})}))}getDsoMenus(t,i,r){return[this.getItemMenu(t),this.getComColMenu(t),this.getCommonMenu(t,r)]}getCommonMenu(t,i){return(0,c.z)([this.authorizationService.isAuthorized(s._.CanEditMetadata,t.self)]).pipe((0,d.T)(([r])=>[{id:"edit-dso",active:!1,visible:r,model:{type:S.x.LINK,text:this.getDsoType(t)+".page.edit",link:new B.t((0,m.wN)(t),"edit","metadata").toString()},icon:"pencil-alt",index:2}]))}getItemMenu(t){return t instanceof o.q?(0,c.z)([this.authorizationService.isAuthorized(s._.CanCreateVersion,t.self),this.dsoVersioningModalService.isNewVersionButtonDisabled(t),this.dsoVersioningModalService.getVersioningTooltipMessage(t,"item.page.version.hasDraft","item.page.version.create"),this.authorizationService.isAuthorized(s._.CanSynchronizeWithORCID,t.self),this.authorizationService.isAuthorized(s._.CanClaimItem,t.self),this.correctionTypeDataService.findByItem(t.uuid,!1).pipe((0,D.qD)(),(0,D.Bo)())]).pipe((0,d.T)(([i,r,l,n,y,C])=>{const A="person"===this.getDsoType(t);return[{id:"orcid-dso",active:!1,visible:A&&n,model:{type:S.x.LINK,text:"item.page.orcid.tooltip",link:new B.t((0,m.wN)(t),"orcid").toString()},icon:"orcid fab fa-lg",index:0},{id:"version-dso",active:!1,visible:i,model:{type:S.x.ONCLICK,text:l,disabled:r,function:()=>{this.dsoVersioningModalService.openCreateVersionModal(t)}},icon:"code-branch",index:1},{id:"claim-dso",active:!1,visible:A&&y,model:{type:S.x.ONCLICK,text:"item.page.claim.button",function:()=>{this.claimResearcher(t)}},icon:"hand-paper",index:3},{id:"withdrawn-item",active:!1,visible:t.isArchived&&C?.page.some(V=>V.topic===U.pc),model:{type:S.x.ONCLICK,text:"item.page.withdrawn",function:()=>{this.dsoWithdrawnReinstateModalService.openCreateWithdrawnReinstateModal(t,"request-withdrawn",t.isArchived)}},icon:"eye-slash",index:4},{id:"reinstate-item",active:!1,visible:t.isWithdrawn&&C?.page.some(V=>V.topic===U.el),model:{type:S.x.ONCLICK,text:"item.page.reinstate",function:()=>{this.dsoWithdrawnReinstateModalService.openCreateWithdrawnReinstateModal(t,"request-reinstate",t.isArchived)}},icon:"eye",index:5}]})):(0,h.of)([])}getComColMenu(t){return t instanceof p.E||t instanceof f.p?(0,c.z)([this.authorizationService.isAuthorized(s._.CanSubscribe,t.self)]).pipe((0,d.T)(([i])=>[{id:"subscribe",active:!1,visible:i,model:{type:S.x.ONCLICK,text:"subscriptions.tooltip",function:()=>{this.modalService.open(W.w).componentInstance.dso=t}},icon:"bell",index:4}])):(0,h.of)([])}claimResearcher(t){this.researcherProfileService.createFromExternalSourceAndReturnRelatedItemId(t.self).subscribe(i=>{(0,O.hj)(i)?(this.notificationsService.success(this.translate.get("researcherprofile.success.claim.title"),this.translate.get("researcherprofile.success.claim.body")),this.authorizationService.invalidateAuthorizationsRequestCache(),this.menuService.hideMenuSection(E.D.DSO_EDIT,"claim-dso-"+t.uuid)):this.notificationsService.error(this.translate.get("researcherprofile.error.claim.title"),this.translate.get("researcherprofile.error.claim.body"))})}getDsoType(t){const i=t.getRenderTypes()[0];return"string"==typeof i||i instanceof String?i.toLowerCase():t.type.toString().toLowerCase()}addDsoUuidToMenuIDs(t,i){return t.map(r=>(Object.assign(r,{id:r.id+"-"+i.uuid}),(0,O.a4)(r.parentID)&&Object.assign(r,{parentID:r.parentID+"-"+i.uuid}),r))}static#e=this.\u0275fac=function(i){return new(i||u)(a.KVO(I.DSpaceObjectDataService),a.KVO(x.$),a.KVO(T.AuthorizationDataService),a.KVO(z.Bq),a.KVO(Q),a.KVO(g.ResearcherProfileDataService),a.KVO(L.I),a.KVO(X.c$),a.KVO(U.Ee),a.KVO(P.CorrectionTypeDataService))};static#t=this.\u0275prov=a.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})();const Y=(u,J,t=(0,a.WQX)(G))=>t.resolve(u,J)}}]);