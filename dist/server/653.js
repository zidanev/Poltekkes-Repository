exports.id=653,exports.ids=[653,5592],exports.modules={40653:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ROUTES:()=>ROUTES});var authenticated_guard=__webpack_require__(98234),core=__webpack_require__(68014),bitstream_data_service=__webpack_require__(36505),operators=__webpack_require__(82656),follow_link_config_model=__webpack_require__(32181);const BITSTREAM_PAGE_LINKS_TO_FOLLOW=[(0,follow_link_config_model.s)("bundle",{},(0,follow_link_config_model.s)("primaryBitstream"),(0,follow_link_config_model.s)("item")),(0,follow_link_config_model.s)("format")],bitstreamPageResolver=(route,state,bitstreamService=(0,core.WQX)(bitstream_data_service.BitstreamDataService))=>bitstreamService.findById(route.params.id,!0,!1,...BITSTREAM_PAGE_LINKS_TO_FOLLOW).pipe((0,operators.qD)());var cjs=__webpack_require__(74785),cjs_operators=__webpack_require__(10743),app_routing_paths=__webpack_require__(45930),breadcrumb_model=__webpack_require__(96622),empty_util=__webpack_require__(77028),link_service=__webpack_require__(48614),dso_breadcrumbs_service=__webpack_require__(15446),dso_name_service=__webpack_require__(91735);let BitstreamBreadcrumbsService=(()=>{class BitstreamBreadcrumbsService2 extends dso_breadcrumbs_service.U{constructor(bitstreamService,linkService,dsoNameService){super(linkService,dsoNameService),this.bitstreamService=bitstreamService,this.linkService=linkService,this.dsoNameService=dsoNameService}getBreadcrumbs(key,url){const label=this.dsoNameService.getName(key),crumb=new breadcrumb_model.Q(label,url);return this.getOwningItem(key.uuid).pipe((0,cjs_operators.nx)(parentRD=>{if((0,empty_util.hj)(parentRD)&&(0,empty_util.a4)(parentRD.payload)){const parent=parentRD.payload;return super.getBreadcrumbs(parent,(0,app_routing_paths.wN)(parent))}return(0,cjs.of)([])}),(0,cjs_operators.Tj)(breadcrumbs=>[...breadcrumbs,crumb]))}getOwningItem(uuid){return this.bitstreamService.findById(uuid,!0,!0,...BITSTREAM_PAGE_LINKS_TO_FOLLOW).pipe((0,operators.qD)(),(0,operators.Bo)(),(0,cjs_operators.nx)(bitstream=>(0,empty_util.a4)(bitstream)?bitstream.bundle.pipe((0,operators.qD)(),(0,operators.Bo)(),(0,cjs_operators.nx)(bundle=>(0,empty_util.a4)(bundle)?bundle.item.pipe((0,operators.qD)()):(0,cjs.of)(void 0))):(0,cjs.of)(void 0)))}static#_=this.\u0275fac=function(t){return new(t||BitstreamBreadcrumbsService2)(core.KVO(bitstream_data_service.BitstreamDataService),core.KVO(link_service._),core.KVO(dso_name_service.f))};static#_2=this.\u0275prov=core.jDH({token:BitstreamBreadcrumbsService2,factory:BitstreamBreadcrumbsService2.\u0275fac,providedIn:"root"})}return BitstreamBreadcrumbsService2})();var dso_breadcrumb_resolver=__webpack_require__(20550);const bitstreamBreadcrumbResolver=(route,state,breadcrumbService=(0,core.WQX)(BitstreamBreadcrumbsService),dataService=(0,core.WQX)(bitstream_data_service.BitstreamDataService))=>(0,dso_breadcrumb_resolver.G)(route,state,breadcrumbService,dataService,...BITSTREAM_PAGE_LINKS_TO_FOLLOW);var i18n_breadcrumb_resolver=__webpack_require__(21870),resource_policy_create_component=__webpack_require__(96315),resource_policy_edit_component=__webpack_require__(28319),resource_policy_resolver=__webpack_require__(48576),resource_policy_target_resolver=__webpack_require__(20312),common=__webpack_require__(84739),fesm2022_router=__webpack_require__(64247),ngx_translate_core=__webpack_require__(43750),resource_policies_component=__webpack_require__(67848);const _c0=a0=>["/bitstreams",a0,"edit"];let BitstreamAuthorizationsComponent=(()=>{class BitstreamAuthorizationsComponent2{constructor(route){this.route=route}ngOnInit(){this.dsoRD$=this.route.data.pipe((0,cjs_operators.$1)(),(0,cjs_operators.Tj)(data=>data.bitstream))}static#_=this.\u0275fac=function(t){return new(t||BitstreamAuthorizationsComponent2)(core.rXU(fesm2022_router.nX))};static#_2=this.\u0275cmp=core.VBU({type:BitstreamAuthorizationsComponent2,selectors:[["ds-collection-authorizations"]],standalone:!0,features:[core.aNF],decls:10,vars:12,consts:[[1,"container"],[3,"resourceType","resourceUUID"],[1,"button-row","bottom"],[1,"text-right"],["role","button",1,"btn","btn-outline-secondary","mr-1",3,"routerLink"],[1,"fas","fa-arrow-left"]],template:function(rf,ctx){if(1&rf&&(core.j41(0,"div",0),core.nrm(1,"ds-resource-policies",1),core.nI1(2,"async"),core.j41(3,"div",2)(4,"div",3)(5,"a",4),core.nI1(6,"async"),core.nrm(7,"i",5),core.EFF(8),core.nI1(9,"translate"),core.k0s()()()()),2&rf){let tmp_1_0,tmp_2_0;core.R7$(),core.Y8G("resourceType","bitstream")("resourceUUID",null==(tmp_1_0=core.bMT(2,4,ctx.dsoRD$))||null==tmp_1_0.payload?null:tmp_1_0.payload.id),core.R7$(4),core.Y8G("routerLink",core.eq3(10,_c0,null==(tmp_2_0=core.bMT(6,6,ctx.dsoRD$))||null==tmp_2_0.payload?null:tmp_2_0.payload.id)),core.R7$(3),core.SpI(" ",core.bMT(9,8,"bitstream.edit.return")," ")}},dependencies:[resource_policies_component.e,common.Jj,ngx_translate_core.h,ngx_translate_core.D9,fesm2022_router.Wk],encapsulation:2})}return BitstreamAuthorizationsComponent2})();var auth_service=__webpack_require__(41543),authorization_data_service=__webpack_require__(30289),feature_id=__webpack_require__(29321),signposting_data_service=__webpack_require__(92203),server_response_service=__webpack_require__(42180),authorized_operators=__webpack_require__(78911),file_service=__webpack_require__(98562),hard_redirect_service=__webpack_require__(91793);const bitstream_download_page_component_c0=a0=>({bitstream:a0});let BitstreamDownloadPageComponent=(()=>{class BitstreamDownloadPageComponent2{constructor(route,router,authorizationService,auth,fileService,hardRedirectService,location,dsoNameService,signpostingDataService,responseService,platformId){this.route=route,this.router=router,this.authorizationService=authorizationService,this.auth=auth,this.fileService=fileService,this.hardRedirectService=hardRedirectService,this.location=location,this.dsoNameService=dsoNameService,this.signpostingDataService=signpostingDataService,this.responseService=responseService,this.platformId=platformId,this.initPageLinks()}back(){this.location.back()}ngOnInit(){this.bitstreamRD$=this.route.data.pipe((0,cjs_operators.Tj)(data=>data.bitstream)),this.bitstream$=this.bitstreamRD$.pipe((0,authorized_operators.QD)(this.router,this.auth),(0,operators.Bo)()),this.bitstream$.pipe((0,cjs_operators.nx)(bitstream=>{const isAuthorized$=this.authorizationService.isAuthorized(feature_id._.CanDownload,(0,empty_util.hj)(bitstream)?bitstream.self:void 0),isLoggedIn$=this.auth.isAuthenticated();return(0,cjs.combineLatest)([isAuthorized$,isLoggedIn$,(0,cjs.of)(bitstream)])}),(0,cjs_operators.pb)(([isAuthorized,isLoggedIn,bitstream])=>(0,empty_util.a4)(isAuthorized)&&(0,empty_util.a4)(isLoggedIn)),(0,cjs_operators.s)(1),(0,cjs_operators.nx)(([isAuthorized,isLoggedIn,bitstream])=>isAuthorized&&isLoggedIn?this.fileService.retrieveFileDownloadLink(bitstream._links.content.href).pipe((0,cjs_operators.pb)(fileLink=>(0,empty_util.a4)(fileLink)),(0,cjs_operators.s)(1),(0,cjs_operators.Tj)(fileLink=>[isAuthorized,isLoggedIn,bitstream,fileLink])):[[isAuthorized,isLoggedIn,bitstream,""]])).subscribe(([isAuthorized,isLoggedIn,bitstream,fileLink])=>{isAuthorized&&isLoggedIn&&(0,empty_util.hj)(fileLink)?this.hardRedirectService.redirect(fileLink):isAuthorized&&!isLoggedIn?this.hardRedirectService.redirect(bitstream._links.content.href):!isAuthorized&&isLoggedIn?this.router.navigateByUrl((0,app_routing_paths.bZ)(),{skipLocationChange:!0}):!isAuthorized&&!isLoggedIn&&(this.auth.setRedirectUrl(this.router.url),this.router.navigateByUrl("login"))})}initPageLinks(){(0,common.Vy)(this.platformId)&&this.route.params.subscribe(params=>{this.signpostingDataService.getLinks(params.id).pipe((0,cjs_operators.s)(1)).subscribe(signpostingLinks=>{let links="";signpostingLinks.forEach(link=>{links=links+((0,empty_util.hj)(links)?", ":"")+`<${link.href}> ; rel="${link.rel}"`+((0,empty_util.hj)(link.type)?` ; type="${link.type}" `:" ")}),this.responseService.setHeader("Link",links)})})}static#_=this.\u0275fac=function(t){return new(t||BitstreamDownloadPageComponent2)(core.rXU(fesm2022_router.nX),core.rXU(fesm2022_router.Ix),core.rXU(authorization_data_service.AuthorizationDataService),core.rXU(auth_service.uR),core.rXU(file_service.E),core.rXU(hard_redirect_service.$),core.rXU(common.aZ),core.rXU(dso_name_service.f),core.rXU(signposting_data_service.z),core.rXU(server_response_service.w),core.rXU(core.Agw))};static#_2=this.\u0275cmp=core.VBU({type:BitstreamDownloadPageComponent2,selectors:[["ds-bitstream-download-page"]],standalone:!0,features:[core.aNF],decls:10,vars:11,consts:[[1,"container"],[1,"h2"],[1,"pt-3"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"]],template:function(rf,ctx){1&rf&&(core.j41(0,"div",0)(1,"h1",1),core.EFF(2),core.nI1(3,"async"),core.nI1(4,"translate"),core.k0s(),core.j41(5,"div",2)(6,"button",3),core.bIt("click",function(){return ctx.back()}),core.nrm(7,"i",4),core.EFF(8),core.nI1(9,"translate"),core.k0s()()()),2&rf&&(core.R7$(2),core.JRh(core.i5U(4,4,"bitstream.download.page",core.eq3(9,bitstream_download_page_component_c0,ctx.dsoNameService.getName(core.bMT(3,2,ctx.bitstream$))))),core.R7$(6),core.SpI(" ",core.bMT(9,7,"bitstream.download.page.back")," "))},dependencies:[common.Jj,ngx_translate_core.h,ngx_translate_core.D9],encapsulation:2})}return BitstreamDownloadPageComponent2})();const bitstreamPageAuthorizationsGuard=(0,__webpack_require__(96293).L)(()=>bitstreamPageResolver,()=>(0,cjs.of)(feature_id._.CanManagePolicies));var themed_component=__webpack_require__(31260);__webpack_require__(84593);const themed_edit_bitstream_page_component_c0=["*"];function ThemedEditBitstreamPageComponent_ng_template_0_Template(rf,ctx){}const legacyBitstreamURLRedirectGuard=(route,state,bitstreamDataService=(0,core.WQX)(bitstream_data_service.BitstreamDataService),serverHardRedirectService=(0,core.WQX)(hard_redirect_service.$),router=(0,core.WQX)(fesm2022_router.Ix))=>{const prefix=route.params.prefix,suffix=route.params.suffix,filename=route.params.filename;let sequenceId=route.params.sequence_id;return(0,empty_util.Tn)(sequenceId)&&(sequenceId=route.queryParams.sequenceId),bitstreamDataService.findByItemHandle(`${prefix}/${suffix}`,sequenceId,filename).pipe((0,operators.qD)(),(0,cjs_operators.Tj)(rd=>rd.hasSucceeded&&!rd.hasNoContent?(serverHardRedirectService.redirect(new URL(`/bitstreams/${rd.payload.uuid}/download`,serverHardRedirectService.getCurrentOrigin()).href,301),!1):router.createUrlTree([app_routing_paths.RD])))},ROUTES=[{path:"handle/:prefix/:suffix/:filename",component:BitstreamDownloadPageComponent,canActivate:[legacyBitstreamURLRedirectGuard]},{path:":prefix/:suffix/:sequence_id/:filename",component:BitstreamDownloadPageComponent,canActivate:[legacyBitstreamURLRedirectGuard]},{path:":id/download",component:BitstreamDownloadPageComponent,resolve:{bitstream:bitstreamPageResolver}},{path:":id/edit",component:(()=>{class ThemedEditBitstreamPageComponent2 extends themed_component.J{getComponentName(){return"EditBitstreamPageComponent"}importThemedComponent(themeName){return __webpack_require__(13170)(`./${themeName}/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component`)}importUnthemedComponent(){return Promise.resolve().then(__webpack_require__.bind(__webpack_require__,84593))}static#_=this.\u0275fac=(()=>{let \u0275ThemedEditBitstreamPageComponent_BaseFactory;return function(t){return(\u0275ThemedEditBitstreamPageComponent_BaseFactory||(\u0275ThemedEditBitstreamPageComponent_BaseFactory=core.xGo(ThemedEditBitstreamPageComponent2)))(t||ThemedEditBitstreamPageComponent2)}})();static#_2=this.\u0275cmp=core.VBU({type:ThemedEditBitstreamPageComponent2,selectors:[["ds-edit-bitstream-page"]],standalone:!0,features:[core.Vt3,core.aNF],ngContentSelectors:themed_edit_bitstream_page_component_c0,decls:5,vars:0,consts:[["vcr",""],["content",""]],template:function(rf,ctx){1&rf&&(core.NAR(),core.DNE(0,ThemedEditBitstreamPageComponent_ng_template_0_Template,0,0,"ng-template",null,0,core.C5r),core.j41(2,"div",null,1),core.SdG(4),core.k0s())},encapsulation:2})}return ThemedEditBitstreamPageComponent2})(),resolve:{bitstream:bitstreamPageResolver,breadcrumb:bitstreamBreadcrumbResolver},canActivate:[authenticated_guard.t]},{path:":id/authorizations",canActivate:[bitstreamPageAuthorizationsGuard],children:[{path:"create",resolve:{resourcePolicyTarget:resource_policy_target_resolver.Q},component:resource_policy_create_component.m,data:{title:"resource-policies.create.page.title",showBreadcrumbs:!0}},{path:"edit",resolve:{breadcrumb:i18n_breadcrumb_resolver.S,resourcePolicy:resource_policy_resolver.n},component:resource_policy_edit_component._,data:{breadcrumbKey:"item.edit",title:"resource-policies.edit.page.title",showBreadcrumbs:!0}},{path:"",resolve:{bitstream:bitstreamPageResolver,breadcrumb:bitstreamBreadcrumbResolver},component:BitstreamAuthorizationsComponent,data:{title:"bitstream.edit.authorizations.title",showBreadcrumbs:!0}}]}]},84593:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{EditBitstreamPageComponent:()=>EditBitstreamPageComponent});var common=__webpack_require__(84739),router=__webpack_require__(64247),core=__webpack_require__(71508),ngx_translate_core=__webpack_require__(43750),cloneDeep=__webpack_require__(42768),cloneDeep_default=__webpack_require__.n(cloneDeep),cjs=__webpack_require__(74785),operators=__webpack_require__(10743),dso_name_service=__webpack_require__(91735),bitstream_data_service=__webpack_require__(36505),bitstream_format_data_service=__webpack_require__(26705),http=__webpack_require__(38068),notifications_service=__webpack_require__(10117),remote_data_build_service=__webpack_require__(86786),object_cache_service=__webpack_require__(40017),hal_endpoint_service=__webpack_require__(91365),shared_operators=__webpack_require__(82656),bundle_data_service=__webpack_require__(78330),request_models=__webpack_require__(87457),request_service=__webpack_require__(72744),fesm2022_core=__webpack_require__(68014);let PrimaryBitstreamService=(()=>{class PrimaryBitstreamService2{constructor(requestService,rdbService,objectCache,halService,notificationsService,bundleDataService){this.requestService=requestService,this.rdbService=rdbService,this.objectCache=objectCache,this.halService=halService,this.notificationsService=notificationsService,this.bundleDataService=bundleDataService}getHttpOptions(){const options=Object.create({});let headers=new http.Lr;return headers=headers.append("Content-Type","text/uri-list"),options.headers=headers,options}createAndSendRequest(requestType,endpointURL,primaryBitstreamSelfLink){const requestId=this.requestService.generateRequestId(),request=new requestType(requestId,endpointURL,primaryBitstreamSelfLink,this.getHttpOptions());return this.requestService.send(request),this.rdbService.buildFromRequestUUID(requestId)}create(primaryBitstream,bundle){return this.createAndSendRequest(request_models.Qf,bundle._links.primaryBitstream.href,primaryBitstream.self)}put(primaryBitstream,bundle){return this.createAndSendRequest(request_models.v_,bundle._links.primaryBitstream.href,primaryBitstream.self)}delete(bundle){return this.createAndSendRequest(request_models.$,bundle._links.primaryBitstream.href).pipe((0,shared_operators.bD)(),(0,cjs.switchMap)(rd=>this.bundleDataService.findByHref(bundle.self,rd.hasFailed)))}static#_=this.\u0275fac=function(t){return new(t||PrimaryBitstreamService2)(fesm2022_core.KVO(request_service.B),fesm2022_core.KVO(remote_data_build_service.o),fesm2022_core.KVO(object_cache_service.$),fesm2022_core.KVO(hal_endpoint_service.Y),fesm2022_core.KVO(notifications_service.I),fesm2022_core.KVO(bundle_data_service.BundleDataService))};static#_2=this.\u0275prov=fesm2022_core.jDH({token:PrimaryBitstreamService2,factory:PrimaryBitstreamService2.\u0275fac,providedIn:"root"})}return PrimaryBitstreamService2})();var bitstream_format_support_level=__webpack_require__(3449),metadata_utils=__webpack_require__(10339),item_page_routing_paths=__webpack_require__(63254),empty_util=__webpack_require__(77028),error_component=__webpack_require__(36159),custom_switch_model=__webpack_require__(62165),ds_dynamic_input_model=__webpack_require__(13942),ds_dynamic_textarea_model=__webpack_require__(67044),form_component=__webpack_require__(49148),themed_loading_component=__webpack_require__(32943),file_size_pipe=__webpack_require__(49192),var_directive=__webpack_require__(45961),themed_thumbnail_component=__webpack_require__(80661);const _c0=a0=>["/bitstreams",a0,"authorizations"];function EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template(rf,ctx){if(1&rf){const _r1=fesm2022_core.RV6();fesm2022_core.j41(0,"ds-form",13),fesm2022_core.bIt("submitForm",function(){fesm2022_core.eBV(_r1);const ctx_r1=fesm2022_core.XpG(4);return fesm2022_core.Njj(ctx_r1.onSubmit())})("cancel",function(){fesm2022_core.eBV(_r1);const ctx_r1=fesm2022_core.XpG(4);return fesm2022_core.Njj(ctx_r1.onCancel())})("dfChange",function($event){fesm2022_core.eBV(_r1);const ctx_r1=fesm2022_core.XpG(4);return fesm2022_core.Njj(ctx_r1.onChange($event))}),fesm2022_core.j41(1,"div",14)(2,"a",15),fesm2022_core.EFF(3),fesm2022_core.nI1(4,"translate"),fesm2022_core.k0s()()()}if(2&rf){const bitstreamRD_r3=fesm2022_core.XpG(3).ngVar,ctx_r1=fesm2022_core.XpG();fesm2022_core.Y8G("formId","edit-bitstream-form-id")("formGroup",ctx_r1.formGroup)("formModel",ctx_r1.formModel)("formLayout",ctx_r1.formLayout)("submitLabel","form.save"),fesm2022_core.R7$(2),fesm2022_core.Y8G("routerLink",fesm2022_core.eq3(9,_c0,null==bitstreamRD_r3||null==bitstreamRD_r3.payload?null:bitstreamRD_r3.payload.id)),fesm2022_core.R7$(),fesm2022_core.JRh(fesm2022_core.bMT(4,7,"bitstream.edit.authorizations.link"))}}function EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template(rf,ctx){if(1&rf&&(fesm2022_core.j41(0,"div",5)(1,"div",6),fesm2022_core.nrm(2,"ds-thumbnail",7),fesm2022_core.k0s(),fesm2022_core.j41(3,"div",8)(4,"div",2)(5,"div",5)(6,"div",9)(7,"h1",10),fesm2022_core.EFF(8),fesm2022_core.j41(9,"span",11),fesm2022_core.EFF(10),fesm2022_core.nI1(11,"dsFileSize"),fesm2022_core.k0s()()()()(),fesm2022_core.DNE(12,EditBitstreamPageComponent_ng_container_0_div_1_div_1_ds_form_12_Template,5,11,"ds-form",12),fesm2022_core.k0s()()),2&rf){const bitstreamRD_r3=fesm2022_core.XpG(2).ngVar,ctx_r1=fesm2022_core.XpG();fesm2022_core.R7$(2),fesm2022_core.Y8G("thumbnail",null==bitstreamRD_r3?null:bitstreamRD_r3.payload),fesm2022_core.R7$(6),fesm2022_core.SpI("",ctx_r1.dsoNameService.getName(null==bitstreamRD_r3?null:bitstreamRD_r3.payload)," "),fesm2022_core.R7$(2),fesm2022_core.SpI("(",fesm2022_core.bMT(11,4,null==bitstreamRD_r3||null==bitstreamRD_r3.payload?null:bitstreamRD_r3.payload.sizeBytes),")"),fesm2022_core.R7$(2),fesm2022_core.Y8G("ngIf",ctx_r1.formGroup)}}function EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template(rf,ctx){1&rf&&(fesm2022_core.nrm(0,"ds-error",16),fesm2022_core.nI1(1,"translate")),2&rf&&fesm2022_core.FS9("message",fesm2022_core.bMT(1,1,"error.bitstream"))}function EditBitstreamPageComponent_ng_container_0_div_1_ds_loading_3_Template(rf,ctx){1&rf&&(fesm2022_core.nrm(0,"ds-loading",16),fesm2022_core.nI1(1,"translate")),2&rf&&fesm2022_core.FS9("message",fesm2022_core.bMT(1,1,"loading.bitstream"))}function EditBitstreamPageComponent_ng_container_0_div_1_Template(rf,ctx){if(1&rf&&(fesm2022_core.j41(0,"div",2),fesm2022_core.DNE(1,EditBitstreamPageComponent_ng_container_0_div_1_div_1_Template,13,6,"div",3)(2,EditBitstreamPageComponent_ng_container_0_div_1_ds_error_2_Template,2,3,"ds-error",4)(3,EditBitstreamPageComponent_ng_container_0_div_1_ds_loading_3_Template,2,3,"ds-loading",4),fesm2022_core.k0s()),2&rf){const formatsRD_r4=ctx.ngVar,bitstreamRD_r3=fesm2022_core.XpG().ngVar;fesm2022_core.R7$(),fesm2022_core.Y8G("ngIf",(null==bitstreamRD_r3?null:bitstreamRD_r3.hasSucceeded)&&(null==formatsRD_r4?null:formatsRD_r4.hasSucceeded)),fesm2022_core.R7$(),fesm2022_core.Y8G("ngIf",null==bitstreamRD_r3?null:bitstreamRD_r3.hasFailed),fesm2022_core.R7$(),fesm2022_core.Y8G("ngIf",!bitstreamRD_r3||!formatsRD_r4||(null==bitstreamRD_r3?null:bitstreamRD_r3.isLoading)||(null==formatsRD_r4?null:formatsRD_r4.isLoading))}}function EditBitstreamPageComponent_ng_container_0_Template(rf,ctx){if(1&rf&&(fesm2022_core.qex(0),fesm2022_core.DNE(1,EditBitstreamPageComponent_ng_container_0_div_1_Template,4,3,"div",1),fesm2022_core.nI1(2,"async"),fesm2022_core.bVm()),2&rf){const ctx_r1=fesm2022_core.XpG();fesm2022_core.R7$(),fesm2022_core.Y8G("ngVar",fesm2022_core.bMT(2,1,ctx_r1.bitstreamFormatsRD$))}}let EditBitstreamPageComponent=(()=>{class EditBitstreamPageComponent2{constructor(route,router2,changeDetectorRef,formService,translate,bitstreamService,dsoNameService,notificationsService,bitstreamFormatService,primaryBitstreamService){this.route=route,this.router=router2,this.changeDetectorRef=changeDetectorRef,this.formService=formService,this.translate=translate,this.bitstreamService=bitstreamService,this.dsoNameService=dsoNameService,this.notificationsService=notificationsService,this.bitstreamFormatService=bitstreamFormatService,this.primaryBitstreamService=primaryBitstreamService,this.KEY_PREFIX="bitstream.edit.form.",this.LABEL_KEY_SUFFIX=".label",this.HINT_KEY_SUFFIX=".hint",this.NOTIFICATIONS_PREFIX="bitstream.edit.notifications.",this.IMAGE_WIDTH_METADATA="iiif.image.width",this.IMAGE_HEIGHT_METADATA="iiif.image.height",this.IIIF_TOC_METADATA="iiif.toc",this.IIIF_LABEL_METADATA="iiif.label",this.findAllOptions={elementsPerPage:9999},this.fileNameModel=new ds_dynamic_input_model.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"fileName",name:"fileName",required:!0,validators:{required:null},errorMessages:{required:"You must provide a file name for the bitstream"}}),this.primaryBitstreamModel=new custom_switch_model.i({id:"primaryBitstream",name:"primaryBitstream"}),this.descriptionModel=new ds_dynamic_textarea_model.E({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"description",name:"description",rows:10}),this.selectedFormatModel=new core.z4z({id:"selectedFormat",name:"selectedFormat"}),this.newFormatModel=new core.rA_({id:"newFormat",name:"newFormat"}),this.iiifLabelModel=new ds_dynamic_input_model.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifLabel",name:"iiifLabel"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifLabelContainer=new core.iO5({id:"iiifLabelContainer",group:[this.iiifLabelModel]},{grid:{host:"form-row"}}),this.iiifTocModel=new ds_dynamic_input_model.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifToc",name:"iiifToc"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifTocContainer=new core.iO5({id:"iiifTocContainer",group:[this.iiifTocModel]},{grid:{host:"form-row"}}),this.iiifWidthModel=new ds_dynamic_input_model.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifWidth",name:"iiifWidth"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifWidthContainer=new core.iO5({id:"iiifWidthContainer",group:[this.iiifWidthModel]},{grid:{host:"form-row"}}),this.iiifHeightModel=new ds_dynamic_input_model.C({hasSelectableMetadata:!1,metadataFields:[],repeatable:!1,submissionId:"",id:"iiifHeight",name:"iiifHeight"},{grid:{host:"col col-lg-6 d-inline-block"}}),this.iiifHeightContainer=new core.iO5({id:"iiifHeightContainer",group:[this.iiifHeightModel]},{grid:{host:"form-row"}}),this.inputModels=[this.primaryBitstreamModel,this.fileNameModel,this.descriptionModel,this.selectedFormatModel,this.newFormatModel],this.formModel=[new core.iO5({id:"fileNamePrimaryContainer",group:[this.primaryBitstreamModel,this.fileNameModel]},{grid:{host:"form-row"}}),new core.iO5({id:"descriptionContainer",group:[this.descriptionModel]}),new core.iO5({id:"formatContainer",group:[this.selectedFormatModel,this.newFormatModel]})],this.newFormatBaseLayout="col col-sm-6 d-inline-block",this.formLayout={fileName:{grid:{host:"col col-sm-8 d-inline-block"}},primaryBitstream:{grid:{container:"col-12"},element:{container:"text-right"}},description:{grid:{host:"col-12 d-inline-block"}},embargo:{grid:{host:"col-12 d-inline-block"}},selectedFormat:{grid:{host:"col col-sm-6 d-inline-block"}},newFormat:{grid:{host:this.newFormatBaseLayout+" invisible"}},fileNamePrimaryContainer:{grid:{host:"row position-relative"}},descriptionContainer:{grid:{host:"row"}},formatContainer:{grid:{host:"row"}}},this.isIIIF=!1,this.subs=[]}ngOnInit(){this.itemId=this.route.snapshot.queryParams.itemId,this.entityType=this.route.snapshot.queryParams.entityType,this.bitstreamRD$=this.route.data.pipe((0,operators.Tj)(data=>data.bitstream)),this.bitstreamFormatsRD$=this.bitstreamFormatService.findAll(this.findAllOptions);const bitstream$=this.bitstreamRD$.pipe((0,shared_operators.yd)(),(0,shared_operators.Bo)()),allFormats$=this.bitstreamFormatsRD$.pipe((0,shared_operators.yd)(),(0,shared_operators.Bo)()),bundle$=bitstream$.pipe((0,operators.nx)(bitstream=>bitstream.bundle),(0,shared_operators.ak)()),primaryBitstream$=bundle$.pipe((0,empty_util.Az)(),(0,operators.nx)(bundle=>this.bitstreamService.findByHref(bundle._links.primaryBitstream.href)),(0,shared_operators.ak)()),item$=bundle$.pipe((0,operators.nx)(bundle=>bundle.item),(0,shared_operators.ak)());this.subs.push((0,cjs.combineLatest)(bitstream$,allFormats$,bundle$,primaryBitstream$,item$).pipe().subscribe(([bitstream,allFormats,bundle,primaryBitstream,item])=>{this.bitstream=bitstream,this.formats=allFormats.page,this.bundle=bundle,this.primaryBitstreamUUID=(0,empty_util.a4)(primaryBitstream)?primaryBitstream.uuid:null,this.itemId=item.uuid,this.setIiifStatus(this.bitstream)})),this.subs.push(this.translate.onLangChange.subscribe(()=>{this.updateFieldTranslations()}))}setForm(){this.formGroup=this.formService.createFormGroup(this.formModel),this.updateFormatModel(),this.updateForm(this.bitstream),this.updateFieldTranslations()}updateForm(bitstream){this.formGroup.patchValue({fileNamePrimaryContainer:{fileName:bitstream.name,primaryBitstream:this.primaryBitstreamUUID===bitstream.uuid},descriptionContainer:{description:bitstream.firstMetadataValue("dc.description")},formatContainer:{newFormat:(0,empty_util.a4)(bitstream.firstMetadata("dc.format"))?bitstream.firstMetadata("dc.format").value:void 0}}),this.isIIIF&&this.formGroup.patchValue({iiifLabelContainer:{iiifLabel:bitstream.firstMetadataValue(this.IIIF_LABEL_METADATA)},iiifTocContainer:{iiifToc:bitstream.firstMetadataValue(this.IIIF_TOC_METADATA)},iiifWidthContainer:{iiifWidth:bitstream.firstMetadataValue(this.IMAGE_WIDTH_METADATA)},iiifHeightContainer:{iiifHeight:bitstream.firstMetadataValue(this.IMAGE_HEIGHT_METADATA)}}),this.bitstream.format.pipe((0,shared_operators.Hz)()).subscribe(format=>{this.originalFormat=format,this.formGroup.patchValue({formatContainer:{selectedFormat:format.id}}),this.updateNewFormatLayout(format.id)})}updateFormatModel(){this.selectedFormatModel.options=this.formats.map(format=>Object.assign({value:format.id,label:this.isUnknownFormat(format.id)?this.translate.instant(this.KEY_PREFIX+"selectedFormat.unknown"):format.shortDescription}))}updateNewFormatLayout(selectedId){this.formLayout.newFormat.grid.host=this.isUnknownFormat(selectedId)?this.newFormatBaseLayout:this.newFormatBaseLayout+" invisible"}isUnknownFormat(id){const format=this.formats.find(f=>f.id===id);return(0,empty_util.a4)(format)&&format.supportLevel===bitstream_format_support_level.c.Unknown}updateFieldTranslations(){this.inputModels.forEach(fieldModel=>{this.updateFieldTranslation(fieldModel)})}updateFieldTranslation(fieldModel){fieldModel.label=this.translate.instant(this.KEY_PREFIX+fieldModel.id+this.LABEL_KEY_SUFFIX),fieldModel.id!==this.primaryBitstreamModel.id&&(fieldModel.hint=this.translate.instant(this.KEY_PREFIX+fieldModel.id+this.HINT_KEY_SUFFIX))}onChange(event){const model=event.model;model.id===this.selectedFormatModel.id&&this.updateNewFormatLayout(model.value)}onSubmit(){const updatedValues=this.formGroup.getRawValue(),updatedBitstream=this.formToBitstream(updatedValues),selectedFormat=this.formats.find(f=>f.id===updatedValues.formatContainer.selectedFormat),isNewFormat=selectedFormat.id!==this.originalFormat.id,wasPrimary=this.primaryBitstreamUUID===this.bitstream.uuid;let bitstream$,bundle$,errorWhileSaving=!1;if(wasPrimary!==updatedValues.fileNamePrimaryContainer.primaryBitstream){let bundleRd$;bundleRd$=wasPrimary?this.primaryBitstreamService.delete(this.bundle):(0,empty_util.a4)(this.primaryBitstreamUUID)?this.primaryBitstreamService.put(this.bitstream,this.bundle):this.primaryBitstreamService.create(this.bitstream,this.bundle);const completedBundleRd$=bundleRd$.pipe((0,shared_operators.qD)());this.subs.push(completedBundleRd$.pipe((0,operators.pb)(bundleRd=>bundleRd.hasFailed)).subscribe(bundleRd=>{this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.primaryBitstream.title"),bundleRd.errorMessage),errorWhileSaving=!0})),bundle$=completedBundleRd$.pipe((0,operators.Tj)(bundleRd=>bundleRd.hasSucceeded?bundleRd.payload:this.bundle)),this.subs.push(bundle$.pipe((0,empty_util.Az)(),(0,operators.nx)(bundle=>this.bitstreamService.findByHref(bundle._links.primaryBitstream.href,!1)),(0,shared_operators.ak)()).subscribe(bitstream=>{this.primaryBitstreamUUID=(0,empty_util.a4)(bitstream)?bitstream.uuid:null}))}else bundle$=(0,cjs.of)(this.bundle);bitstream$=isNewFormat?this.bitstreamService.updateFormat(this.bitstream,selectedFormat).pipe((0,shared_operators.qD)(),(0,operators.Tj)(formatResponse=>{if(!(0,empty_util.a4)(formatResponse)||!formatResponse.hasFailed)return formatResponse.payload;this.notificationsService.error(this.translate.instant(this.NOTIFICATIONS_PREFIX+"error.format.title"),formatResponse.errorMessage)})):(0,cjs.of)(this.bitstream),(0,cjs.combineLatest)([bundle$,bitstream$]).pipe((0,operators.Mi)(([bundle])=>this.bundle=bundle),(0,operators.nx)(()=>this.bitstreamService.update(updatedBitstream).pipe((0,shared_operators.ak)()))).subscribe(()=>{this.bitstreamService.commitUpdates(),this.notificationsService.success(this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.title"),this.translate.instant(this.NOTIFICATIONS_PREFIX+"saved.content")),errorWhileSaving||this.navigateToItemEditBitstreams()})}formToBitstream(rawForm){const updatedBitstream=cloneDeep_default()(this.bitstream),newMetadata=updatedBitstream.metadata;return metadata_utils.O.setFirstValue(newMetadata,"dc.title",rawForm.fileNamePrimaryContainer.fileName),(0,empty_util.Im)(rawForm.descriptionContainer.description)?delete newMetadata["dc.description"]:metadata_utils.O.setFirstValue(newMetadata,"dc.description",rawForm.descriptionContainer.description),this.isIIIF&&((0,empty_util.Im)(rawForm.iiifLabelContainer.iiifLabel)?delete newMetadata[this.IIIF_LABEL_METADATA]:metadata_utils.O.setFirstValue(newMetadata,this.IIIF_LABEL_METADATA,rawForm.iiifLabelContainer.iiifLabel),(0,empty_util.Im)(rawForm.iiifTocContainer.iiifToc)?delete newMetadata[this.IIIF_TOC_METADATA]:metadata_utils.O.setFirstValue(newMetadata,this.IIIF_TOC_METADATA,rawForm.iiifTocContainer.iiifToc),(0,empty_util.Im)(rawForm.iiifWidthContainer.iiifWidth)?delete newMetadata[this.IMAGE_WIDTH_METADATA]:metadata_utils.O.setFirstValue(newMetadata,this.IMAGE_WIDTH_METADATA,rawForm.iiifWidthContainer.iiifWidth),(0,empty_util.Im)(rawForm.iiifHeightContainer.iiifHeight)?delete newMetadata[this.IMAGE_HEIGHT_METADATA]:metadata_utils.O.setFirstValue(newMetadata,this.IMAGE_HEIGHT_METADATA,rawForm.iiifHeightContainer.iiifHeight)),(0,empty_util.hj)(rawForm.formatContainer.newFormat)&&metadata_utils.O.setFirstValue(newMetadata,"dc.format",rawForm.formatContainer.newFormat),updatedBitstream.metadata=newMetadata,updatedBitstream}onCancel(){this.navigateToItemEditBitstreams()}navigateToItemEditBitstreams(){this.router.navigate([(0,item_page_routing_paths.DL)(this.entityType,this.itemId),"bitstreams"])}setIiifStatus(bitstream){const regexExcludeBundles=/OTHERCONTENT|THUMBNAIL|LICENSE/,regexIIIFItem=/true|yes/i,isImage$=this.bitstream.format.pipe((0,shared_operators.yd)(),(0,operators.Tj)(format=>format.payload.mimetype.includes("image/"))),isIIIFBundle$=this.bitstream.bundle.pipe((0,shared_operators.yd)(),(0,operators.Tj)(bundle=>null==this.dsoNameService.getName(bundle.payload).match(regexExcludeBundles))),isEnabled$=this.bitstream.bundle.pipe((0,shared_operators.yd)(),(0,operators.Tj)(bundle=>bundle.payload.item.pipe((0,shared_operators.yd)(),(0,operators.Tj)(item=>item.payload.firstMetadataValue("dspace.iiif.enabled")&&null!==item.payload.firstMetadataValue("dspace.iiif.enabled").match(regexIIIFItem))))),iiifSub=(0,cjs.combineLatest)(isImage$,isIIIFBundle$,isEnabled$).subscribe(([isImage,isIIIFBundle,isEnabled])=>{isImage&&isIIIFBundle&&isEnabled&&(this.isIIIF=!0,this.inputModels.push(this.iiifLabelModel),this.formModel.push(this.iiifLabelContainer),this.inputModels.push(this.iiifTocModel),this.formModel.push(this.iiifTocContainer),this.inputModels.push(this.iiifWidthModel),this.formModel.push(this.iiifWidthContainer),this.inputModels.push(this.iiifHeightModel),this.formModel.push(this.iiifHeightContainer)),this.setForm(),this.changeDetectorRef.detectChanges()});this.subs.push(iiifSub)}ngOnDestroy(){this.subs.filter(subscription=>(0,empty_util.a4)(subscription)).forEach(subscription=>subscription.unsubscribe())}static#_=this.\u0275fac=function(t){return new(t||EditBitstreamPageComponent2)(fesm2022_core.rXU(router.nX),fesm2022_core.rXU(router.Ix),fesm2022_core.rXU(fesm2022_core.gRc),fesm2022_core.rXU(core.J9r),fesm2022_core.rXU(ngx_translate_core.c$),fesm2022_core.rXU(bitstream_data_service.BitstreamDataService),fesm2022_core.rXU(dso_name_service.f),fesm2022_core.rXU(notifications_service.I),fesm2022_core.rXU(bitstream_format_data_service.BitstreamFormatDataService),fesm2022_core.rXU(PrimaryBitstreamService))};static#_2=this.\u0275cmp=fesm2022_core.VBU({type:EditBitstreamPageComponent2,selectors:[["ds-base-edit-bitstream-page"]],standalone:!0,features:[fesm2022_core.aNF],decls:2,vars:3,consts:[[4,"ngVar"],["class","container",4,"ngVar"],[1,"container"],["class","row",4,"ngIf"],[3,"message",4,"ngIf"],[1,"row"],[1,"col-md-2"],[3,"thumbnail"],[1,"col-md-10"],[1,"col-12"],[1,"h2"],[1,"text-muted"],[3,"formId","formGroup","formModel","formLayout","submitLabel","submitForm","cancel","dfChange",4,"ngIf"],[3,"submitForm","cancel","dfChange","formId","formGroup","formModel","formLayout","submitLabel"],["additional","",1,"container","py-3"],[3,"routerLink"],[3,"message"]],template:function(rf,ctx){1&rf&&(fesm2022_core.DNE(0,EditBitstreamPageComponent_ng_container_0_Template,3,3,"ng-container",0),fesm2022_core.nI1(1,"async")),2&rf&&fesm2022_core.Y8G("ngVar",fesm2022_core.bMT(1,1,ctx.bitstreamRD$))},dependencies:[form_component.s,common.bT,var_directive.r,themed_thumbnail_component.T,common.Jj,router.Wk,error_component.A,themed_loading_component.v,ngx_translate_core.h,ngx_translate_core.D9,file_size_pipe.s],changeDetection:0})}return EditBitstreamPageComponent2})()},96622:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Q:()=>Breadcrumb});class Breadcrumb{constructor(text,url){this.text=text,this.url=url}}},20550:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{G:()=>DSOBreadcrumbResolver,o:()=>DSOBreadcrumbResolverByUuid});var rxjs_operators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10743),_app_routing_paths__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45930),_shared_empty_util__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(77028),_shared_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(82656);const DSOBreadcrumbResolver=(route,state,breadcrumbService,dataService,...linksToFollow)=>DSOBreadcrumbResolverByUuid(route,state,route.params.id,breadcrumbService,dataService,...linksToFollow),DSOBreadcrumbResolverByUuid=(route,state,uuid,breadcrumbService,dataService,...linksToFollow)=>dataService.findById(uuid,!0,!1,...linksToFollow).pipe((0,_shared_operators__WEBPACK_IMPORTED_MODULE_1__.qD)(),(0,_shared_operators__WEBPACK_IMPORTED_MODULE_1__.Bo)(),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_2__.Tj)(object=>{if((0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_3__.a4)(object))return{provider:breadcrumbService,key:object,url:(0,_app_routing_paths__WEBPACK_IMPORTED_MODULE_0__.wN)(object)}}))},15446:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{U:()=>DSOBreadcrumbsService});var rxjs__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(74785),rxjs_operators__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(10743),_app_routing_paths__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(45930),_breadcrumbs_breadcrumb_breadcrumb_model__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(96622),_shared_empty_util__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(77028),_shared_utils_follow_link_config_model__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(32181),_cache_builders_link_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(48614),_dso_name_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(91735),_angular_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(68014);let DSOBreadcrumbsService=(()=>{class DSOBreadcrumbsService2{constructor(linkService,dsoNameService){this.linkService=linkService,this.dsoNameService=dsoNameService}getBreadcrumbs(key,url){const label=this.dsoNameService.getName(key),crumb=new _breadcrumbs_breadcrumb_breadcrumb_model__WEBPACK_IMPORTED_MODULE_3__.Q(label,url),propertyName=key.getParentLinkKey();return this.linkService.resolveLink(key,(0,_shared_utils_follow_link_config_model__WEBPACK_IMPORTED_MODULE_4__.s)(propertyName))[propertyName].pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.I6)(parentRD=>parentRD.hasSucceeded||204===parentRD.statusCode),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.nx)(parentRD=>{if((0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_6__.a4)(parentRD)&&(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_6__.a4)(parentRD.payload)){const parent=parentRD.payload;return this.getBreadcrumbs(parent,(0,_app_routing_paths__WEBPACK_IMPORTED_MODULE_0__.wN)(parent))}return(0,rxjs__WEBPACK_IMPORTED_MODULE_7__.of)([])}),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_5__.Tj)(breadcrumbs=>[...breadcrumbs,crumb]))}static#_=this.\u0275fac=function(t){return new(t||DSOBreadcrumbsService2)(_angular_core__WEBPACK_IMPORTED_MODULE_8__.KVO(_cache_builders_link_service__WEBPACK_IMPORTED_MODULE_1__._),_angular_core__WEBPACK_IMPORTED_MODULE_8__.KVO(_dso_name_service__WEBPACK_IMPORTED_MODULE_2__.f))};static#_2=this.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_8__.jDH({token:DSOBreadcrumbsService2,factory:DSOBreadcrumbsService2.\u0275fac,providedIn:"root"})}return DSOBreadcrumbsService2})()},21870:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{S:()=>i18nBreadcrumbResolver});var core=__webpack_require__(68014),empty_util=__webpack_require__(77028),route_utils=__webpack_require__(39609),cjs=__webpack_require__(74785),breadcrumb_model=__webpack_require__(96622);let I18nBreadcrumbsService=(()=>{class I18nBreadcrumbsService2{getBreadcrumbs(key,url){return(0,cjs.of)([new breadcrumb_model.Q(key+".breadcrumbs",url)])}static#_=this.\u0275fac=function(t){return new(t||I18nBreadcrumbsService2)};static#_2=this.\u0275prov=core.jDH({token:I18nBreadcrumbsService2,factory:I18nBreadcrumbsService2.\u0275fac,providedIn:"root"})}return I18nBreadcrumbsService2})();const i18nBreadcrumbResolver=(route,state,breadcrumbService=(0,core.WQX)(I18nBreadcrumbsService))=>{const key=route.data.breadcrumbKey;if((0,empty_util.Tn)(key))throw new Error('You provided an i18nBreadcrumbResolver for url "'+route.url+"\" but no breadcrumbKey in the route's data");return{provider:breadcrumbService,key,url:(0,route_utils.F)(route)}}},96293:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{L:()=>dsoPageSingleFeatureGuard});var rxjs_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(10743),_dso_page_some_feature_guard__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(39833);const dsoPageSingleFeatureGuard=(getResolveFn,getFeatureID)=>(0,_dso_page_some_feature_guard__WEBPACK_IMPORTED_MODULE_0__.FO)(getResolveFn,(route,state)=>getFeatureID(route,state).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_1__.Tj)(featureID=>[featureID])))},39833:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{FO:()=>dsoPageSomeFeatureGuard});var rxjs_operators__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10743),_shared_empty_util__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(77028),_shared_operators__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(82656),_some_feature_authorization_guard__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(90254);const defaultDSOGetObjectUrl=resolve=>(route,state)=>{const routeWithObjectID=(route=>{let routeWithDSOId=route;for(;(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_2__.Tn)(routeWithDSOId.params.id)&&(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_2__.a4)(routeWithDSOId.parent);)routeWithDSOId=routeWithDSOId.parent;return routeWithDSOId})(route);return resolve(routeWithObjectID,state).pipe((0,_shared_operators__WEBPACK_IMPORTED_MODULE_0__.Hz)(),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_3__.Tj)(dso=>dso.self))},dsoPageSomeFeatureGuard=(getResolveFn,getFeatureIDs,getObjectUrl=defaultDSOGetObjectUrl,getEPersonUuid)=>(0,_some_feature_authorization_guard__WEBPACK_IMPORTED_MODULE_1__.h)((route,state)=>getFeatureIDs(route,state),getObjectUrl(getResolveFn()),getEPersonUuid)},92203:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{z:()=>SignpostingDataService});var rxjs__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(74785),rxjs_operators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(10743),_config_app_config_interface__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59945),_dspace_rest_dspace_rest_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(26597),_angular_core__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(68014);let SignpostingDataService=(()=>{class SignpostingDataService2{constructor(appConfig,restService){this.appConfig=appConfig,this.restService=restService}getLinks(uuid){return this.restService.get(`${this.appConfig.rest.baseUrl}/signposting/links/${uuid}`).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_2__.WL)(err=>(0,rxjs__WEBPACK_IMPORTED_MODULE_3__.of)([])),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_2__.Tj)(res=>200===res.statusCode?res.payload:[]))}static#_=this.\u0275fac=function(t){return new(t||SignpostingDataService2)(_angular_core__WEBPACK_IMPORTED_MODULE_4__.KVO(_config_app_config_interface__WEBPACK_IMPORTED_MODULE_0__.vQ),_angular_core__WEBPACK_IMPORTED_MODULE_4__.KVO(_dspace_rest_dspace_rest_service__WEBPACK_IMPORTED_MODULE_1__.Y))};static#_2=this.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_4__.jDH({token:SignpostingDataService2,factory:SignpostingDataService2.\u0275fac,providedIn:"root"})}return SignpostingDataService2})()},55592:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ResourcePolicyDataService:()=>ResourcePolicyDataService});var _angular_common_http__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(38068),rxjs_operators__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(10743),_shared_empty_util__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(77028),_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10117),_cache_builders_remote_data_build_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(86786),_cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(57699),_cache_object_cache_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(40017),_data_base_create_data__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(85311),_data_base_delete_data__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(43626),_data_base_identifiable_data_service__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(68134),_data_base_patch_data__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(75467),_data_base_search_data__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(19399),_data_default_change_analyzer_service__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(84237),_data_find_list_options_model__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(97570),_data_request_models__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(87457),_data_request_service__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(72744),_data_status_code_only_response_parsing_service__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(36191),_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(62120),_eperson_group_data_service__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(97195),_shared_hal_endpoint_service__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(91365),_shared_operators__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(82656),_angular_core__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(68014);let ResourcePolicyDataService=(()=>{class ResourcePolicyDataService2 extends _data_base_identifiable_data_service__WEBPACK_IMPORTED_MODULE_5__.W{constructor(requestService,rdbService,objectCache,halService,notificationsService,comparator,ePersonService,groupService){super("resourcepolicies",requestService,rdbService,objectCache,halService),this.requestService=requestService,this.rdbService=rdbService,this.objectCache=objectCache,this.halService=halService,this.notificationsService=notificationsService,this.comparator=comparator,this.ePersonService=ePersonService,this.groupService=groupService,this.searchByEPersonMethod="eperson",this.searchByGroupMethod="group",this.searchByResourceMethod="resource",this.createData=new _data_base_create_data__WEBPACK_IMPORTED_MODULE_3__.V(this.linkPath,requestService,rdbService,objectCache,halService,notificationsService,this.responseMsToLive),this.searchData=new _data_base_search_data__WEBPACK_IMPORTED_MODULE_7__.X(this.linkPath,requestService,rdbService,objectCache,halService,this.responseMsToLive),this.patchData=new _data_base_patch_data__WEBPACK_IMPORTED_MODULE_6__.n(this.linkPath,requestService,rdbService,objectCache,halService,comparator,this.responseMsToLive,this.constructIdEndpoint),this.deleteData=new _data_base_delete_data__WEBPACK_IMPORTED_MODULE_4__.I(this.linkPath,requestService,rdbService,objectCache,halService,notificationsService,this.responseMsToLive,this.constructIdEndpoint)}create(resourcePolicy,resourceUUID,epersonUUID,groupUUID){const params=[];return params.push(new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("resource",resourceUUID)),(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_17__.hj)(epersonUUID)?params.push(new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("eperson",epersonUUID)):(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_17__.hj)(groupUUID)&&params.push(new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("group",groupUUID)),this.createData.create(resourcePolicy,...params)}delete(resourcePolicyID){return this.deleteData.delete(resourcePolicyID).pipe((0,_shared_operators__WEBPACK_IMPORTED_MODULE_15__.qD)(),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_18__.Tj)(response=>response.hasSucceeded))}update(object){return this.patchData.update(object)}getDefaultAccessConditionsFor(collection,findListOptions){return this.findListByHref(collection._links.defaultAccessConditions.href,findListOptions)}searchByEPerson(UUID,resourceUUID,useCachedVersionIfAvailable=!0,reRequestOnStale=!0,...linksToFollow){const options=new _data_find_list_options_model__WEBPACK_IMPORTED_MODULE_19__._;return options.searchParams=[new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("uuid",UUID)],(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_17__.hj)(resourceUUID)&&options.searchParams.push(new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("resource",resourceUUID)),this.searchData.searchBy(this.searchByEPersonMethod,options,useCachedVersionIfAvailable,reRequestOnStale,...linksToFollow)}searchByGroup(UUID,resourceUUID,useCachedVersionIfAvailable=!0,reRequestOnStale=!0,...linksToFollow){const options=new _data_find_list_options_model__WEBPACK_IMPORTED_MODULE_19__._;return options.searchParams=[new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("uuid",UUID)],(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_17__.hj)(resourceUUID)&&options.searchParams.push(new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("resource",resourceUUID)),this.searchData.searchBy(this.searchByGroupMethod,options,useCachedVersionIfAvailable,reRequestOnStale,...linksToFollow)}searchByResource(UUID,action,useCachedVersionIfAvailable=!0,reRequestOnStale=!0,...linksToFollow){const options=new _data_find_list_options_model__WEBPACK_IMPORTED_MODULE_19__._;return options.searchParams=[new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("uuid",UUID)],(0,_shared_empty_util__WEBPACK_IMPORTED_MODULE_17__.hj)(action)&&options.searchParams.push(new _cache_models_request_param_model__WEBPACK_IMPORTED_MODULE_16__.x("action",action)),this.searchData.searchBy(this.searchByResourceMethod,options,useCachedVersionIfAvailable,reRequestOnStale,...linksToFollow)}updateTarget(resourcePolicyId,resourcePolicyHref,targetUUID,targetType){const targetEndpoint$=("eperson"===targetType?this.ePersonService:this.groupService).getIDHrefObs(targetUUID),options=Object.create({});let headers=new _angular_common_http__WEBPACK_IMPORTED_MODULE_20__.Lr;headers=headers.append("Content-Type","text/uri-list"),options.headers=headers;const requestId=this.requestService.generateRequestId();return targetEndpoint$.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_18__.$1)()).subscribe(targetEndpoint=>{const request=new _data_request_models__WEBPACK_IMPORTED_MODULE_9__.v_(requestId,resourcePolicyHref+"/"+targetType,targetEndpoint,options);Object.assign(request,{getResponseParser:()=>_data_status_code_only_response_parsing_service__WEBPACK_IMPORTED_MODULE_11__.M}),this.requestService.send(request)}),this.rdbService.buildFromRequestUUIDAndAwait(requestId,()=>this.invalidateByHref(resourcePolicyHref))}static#_=this.\u0275fac=function(t){return new(t||ResourcePolicyDataService2)(_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_data_request_service__WEBPACK_IMPORTED_MODULE_10__.B),_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_cache_builders_remote_data_build_service__WEBPACK_IMPORTED_MODULE_1__.o),_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_cache_object_cache_service__WEBPACK_IMPORTED_MODULE_2__.$),_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_shared_hal_endpoint_service__WEBPACK_IMPORTED_MODULE_14__.Y),_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_shared_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_0__.I),_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_data_default_change_analyzer_service__WEBPACK_IMPORTED_MODULE_8__.Y),_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_eperson_eperson_data_service__WEBPACK_IMPORTED_MODULE_12__.EPersonDataService),_angular_core__WEBPACK_IMPORTED_MODULE_21__.KVO(_eperson_group_data_service__WEBPACK_IMPORTED_MODULE_13__.GroupDataService))};static#_2=this.\u0275prov=_angular_core__WEBPACK_IMPORTED_MODULE_21__.jDH({token:ResourcePolicyDataService2,factory:ResourcePolicyDataService2.\u0275fac,providedIn:"root"})}return ResourcePolicyDataService2})()},96315:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{m:()=>ResourcePolicyCreateComponent});var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(43750),rxjs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(74785),rxjs_operators__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(10743),_core_breadcrumbs_dso_name_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(91735),_core_resource_policy_resource_policy_data_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(55592),_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(82656),_item_page_edit_item_page_edit_item_page_routing_paths__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(62181),_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10117),_form_resource_policy_form_component__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7951),_angular_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(68014),_angular_router__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(64247);let ResourcePolicyCreateComponent=(()=>{class ResourcePolicyCreateComponent2{constructor(dsoNameService,notificationsService,resourcePolicyService,route,router,translate){this.dsoNameService=dsoNameService,this.notificationsService=notificationsService,this.resourcePolicyService=resourcePolicyService,this.route=route,this.router=router,this.translate=translate,this.processing$=new rxjs__WEBPACK_IMPORTED_MODULE_5__.BehaviorSubject(!1)}ngOnInit(){this.route.data.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.Tj)(data=>data),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.s)(1)).subscribe(data=>{this.targetResourceUUID=data.resourcePolicyTarget.payload.id,this.targetResourceName=this.dsoNameService.getName(data.resourcePolicyTarget.payload)})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${_item_page_edit_item_page_edit_item_page_routing_paths__WEBPACK_IMPORTED_MODULE_7__.K4}`],{relativeTo:this.route})}createResourcePolicy(event){let response$;this.processing$.next(!0),response$="eperson"===event.target.type?this.resourcePolicyService.create(event.object,this.targetResourceUUID,event.target.uuid):this.resourcePolicyService.create(event.object,this.targetResourceUUID,null,event.target.uuid),response$.pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__.qD)()).subscribe(responseRD=>{this.processing$.next(!1),responseRD.hasSucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.create.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get("resource-policies.create.page.failure.content"))})}static#_=this.\u0275fac=function(t){return new(t||ResourcePolicyCreateComponent2)(_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_core_breadcrumbs_dso_name_service__WEBPACK_IMPORTED_MODULE_0__.f),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_3__.I),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_core_resource_policy_resource_policy_data_service__WEBPACK_IMPORTED_MODULE_1__.ResourcePolicyDataService),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_angular_router__WEBPACK_IMPORTED_MODULE_9__.nX),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_angular_router__WEBPACK_IMPORTED_MODULE_9__.Ix),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__.c$))};static#_2=this.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_8__.VBU({type:ResourcePolicyCreateComponent2,selectors:[["ds-resource-policy-create"]],standalone:!0,features:[_angular_core__WEBPACK_IMPORTED_MODULE_8__.aNF],decls:5,vars:5,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","isProcessing"]],template:function(rf,ctx){1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_8__.j41(0,"div",0)(1,"h4",1),_angular_core__WEBPACK_IMPORTED_MODULE_8__.EFF(2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.nI1(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_8__.k0s(),_angular_core__WEBPACK_IMPORTED_MODULE_8__.j41(4,"ds-resource-policy-form",2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.bIt("reset",function(){return ctx.redirectToAuthorizationsPage()})("submit",function($event){return ctx.createResourcePolicy($event)}),_angular_core__WEBPACK_IMPORTED_MODULE_8__.k0s()()),2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_8__.R7$(2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.Lme("",_angular_core__WEBPACK_IMPORTED_MODULE_8__.bMT(3,3,"resource-policies.create.page.heading")," ",ctx.targetResourceName,""),_angular_core__WEBPACK_IMPORTED_MODULE_8__.R7$(2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.Y8G("isProcessing",ctx.isProcessing()))},dependencies:[_form_resource_policy_form_component__WEBPACK_IMPORTED_MODULE_4__.y,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__.h,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__.D9],encapsulation:2})}return ResourcePolicyCreateComponent2})()},28319:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{_:()=>ResourcePolicyEditComponent});var _ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(43750),rxjs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(74785),rxjs_operators__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(10743),_core_resource_policy_models_resource_policy_resource_type__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(46328),_core_resource_policy_resource_policy_data_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(55592),_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(82656),_item_page_edit_item_page_edit_item_page_routing_paths__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(62181),_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10117),_form_resource_policy_form_component__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(7951),_angular_core__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(68014),_angular_router__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(64247);let ResourcePolicyEditComponent=(()=>{class ResourcePolicyEditComponent2{constructor(notificationsService,resourcePolicyService,route,router,translate){this.notificationsService=notificationsService,this.resourcePolicyService=resourcePolicyService,this.route=route,this.router=router,this.translate=translate,this.processing$=new rxjs__WEBPACK_IMPORTED_MODULE_5__.BehaviorSubject(!1)}ngOnInit(){this.route.data.pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.Tj)(data=>data),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.s)(1)).subscribe(data=>{this.resourcePolicy=data.resourcePolicy.payload})}isProcessing(){return this.processing$.asObservable()}redirectToAuthorizationsPage(){this.router.navigate([`../../${_item_page_edit_item_page_edit_item_page_routing_paths__WEBPACK_IMPORTED_MODULE_7__.K4}`],{relativeTo:this.route})}updateResourcePolicy(event){this.processing$.next(!0);const updatedObject=Object.assign({},event.object,{id:this.resourcePolicy.id,type:_core_resource_policy_models_resource_policy_resource_type__WEBPACK_IMPORTED_MODULE_0__.O.value,_links:this.resourcePolicy._links}),updateTargetSucceeded$=event.updateTarget?this.resourcePolicyService.updateTarget(this.resourcePolicy.id,this.resourcePolicy._links.self.href,event.target.uuid,event.target.type).pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__.qD)(),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.Tj)(responseRD=>responseRD&&responseRD.hasSucceeded)):(0,rxjs__WEBPACK_IMPORTED_MODULE_5__.of)(!0),updateResourcePolicySucceeded$=this.resourcePolicyService.update(updatedObject).pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_2__.qD)(),(0,rxjs_operators__WEBPACK_IMPORTED_MODULE_6__.Tj)(responseRD=>responseRD&&responseRD.hasSucceeded));(0,rxjs__WEBPACK_IMPORTED_MODULE_5__.combineLatest)([updateTargetSucceeded$,updateResourcePolicySucceeded$]).subscribe(([updateTargetSucceeded,updateResourcePolicySucceeded])=>{this.processing$.next(!1),updateTargetSucceeded&&updateResourcePolicySucceeded?(this.notificationsService.success(null,this.translate.get("resource-policies.edit.page.success.content")),this.redirectToAuthorizationsPage()):this.notificationsService.error(null,this.translate.get(updateResourcePolicySucceeded?"resource-policies.edit.page.target-failure.content":updateTargetSucceeded?"resource-policies.edit.page.other-failure.content":"resource-policies.edit.page.failure.content"))})}static#_=this.\u0275fac=function(t){return new(t||ResourcePolicyEditComponent2)(_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_notifications_notifications_service__WEBPACK_IMPORTED_MODULE_3__.I),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_core_resource_policy_resource_policy_data_service__WEBPACK_IMPORTED_MODULE_1__.ResourcePolicyDataService),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_angular_router__WEBPACK_IMPORTED_MODULE_9__.nX),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_angular_router__WEBPACK_IMPORTED_MODULE_9__.Ix),_angular_core__WEBPACK_IMPORTED_MODULE_8__.rXU(_ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__.c$))};static#_2=this.\u0275cmp=_angular_core__WEBPACK_IMPORTED_MODULE_8__.VBU({type:ResourcePolicyEditComponent2,selectors:[["ds-resource-policy-edit"]],standalone:!0,features:[_angular_core__WEBPACK_IMPORTED_MODULE_8__.aNF],decls:5,vars:6,consts:[[1,"container"],[1,"mb-3"],[3,"reset","submit","resourcePolicy","isProcessing"]],template:function(rf,ctx){1&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_8__.j41(0,"div",0)(1,"h1",1),_angular_core__WEBPACK_IMPORTED_MODULE_8__.EFF(2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.nI1(3,"translate"),_angular_core__WEBPACK_IMPORTED_MODULE_8__.k0s(),_angular_core__WEBPACK_IMPORTED_MODULE_8__.j41(4,"ds-resource-policy-form",2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.bIt("reset",function(){return ctx.redirectToAuthorizationsPage()})("submit",function($event){return ctx.updateResourcePolicy($event)}),_angular_core__WEBPACK_IMPORTED_MODULE_8__.k0s()()),2&rf&&(_angular_core__WEBPACK_IMPORTED_MODULE_8__.R7$(2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.Lme("",_angular_core__WEBPACK_IMPORTED_MODULE_8__.bMT(3,4,"resource-policies.edit.page.heading")," ",ctx.resourcePolicy.id,""),_angular_core__WEBPACK_IMPORTED_MODULE_8__.R7$(2),_angular_core__WEBPACK_IMPORTED_MODULE_8__.Y8G("resourcePolicy",ctx.resourcePolicy)("isProcessing",ctx.isProcessing()))},dependencies:[_form_resource_policy_form_component__WEBPACK_IMPORTED_MODULE_4__.y,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__.h,_ngx_translate_core__WEBPACK_IMPORTED_MODULE_10__.D9],encapsulation:2})}return ResourcePolicyEditComponent2})()},7951:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{y:()=>ResourcePolicyFormComponent});var common=__webpack_require__(84739),core=__webpack_require__(68014),ng_bootstrap=__webpack_require__(71781),fesm2020_core=__webpack_require__(71508),ngx_translate_core=__webpack_require__(43750),cjs=__webpack_require__(74785),operators=__webpack_require__(10743),dso_name_service=__webpack_require__(91735),request_service=__webpack_require__(72744),eperson_data_service=__webpack_require__(62120),group_data_service=__webpack_require__(97195),resource_policy_model=__webpack_require__(12266),resource_policy_resource_type=__webpack_require__(46328),shared_operators=__webpack_require__(82656),date_util=__webpack_require__(7840),empty_util=__webpack_require__(77028),eperson_group_list_component=__webpack_require__(46846),ds_dynamic_input_model=__webpack_require__(13942),ds_dynamic_textarea_model=__webpack_require__(67044),form_component=__webpack_require__(49148),form_service=__webpack_require__(79181),action_type_model=__webpack_require__(22598),policy_type_model=__webpack_require__(38226);const policyTypeList=[{label:policy_type_model.t.TYPE_SUBMISSION,value:policy_type_model.t.TYPE_SUBMISSION},{label:policy_type_model.t.TYPE_WORKFLOW,value:policy_type_model.t.TYPE_WORKFLOW},{label:policy_type_model.t.TYPE_INHERITED,value:policy_type_model.t.TYPE_INHERITED},{label:policy_type_model.t.TYPE_CUSTOM,value:policy_type_model.t.TYPE_CUSTOM}],policyActionList=[{label:action_type_model.X.READ.toString(),value:action_type_model.X.READ},{label:action_type_model.X.WRITE.toString(),value:action_type_model.X.WRITE},{label:action_type_model.X.REMOVE.toString(),value:action_type_model.X.REMOVE},{label:action_type_model.X.ADMIN.toString(),value:action_type_model.X.ADMIN},{label:action_type_model.X.DELETE.toString(),value:action_type_model.X.DELETE},{label:action_type_model.X.WITHDRAWN_READ.toString(),value:action_type_model.X.WITHDRAWN_READ},{label:action_type_model.X.DEFAULT_BITSTREAM_READ.toString(),value:action_type_model.X.DEFAULT_BITSTREAM_READ},{label:action_type_model.X.DEFAULT_ITEM_READ.toString(),value:action_type_model.X.DEFAULT_ITEM_READ}],RESOURCE_POLICY_FORM_NAME_CONFIG={id:"name",label:"resource-policies.form.name.label",maxLength:30,hint:"resource-policies.form.name.hint",metadataFields:[],repeatable:!1,submissionId:"",hasSelectableMetadata:!1},RESOURCE_POLICY_FORM_DESCRIPTION_CONFIG={id:"description",label:"resource-policies.form.description.label",metadataFields:[],repeatable:!1,rows:10,submissionId:"",hasSelectableMetadata:!1},RESOURCE_POLICY_FORM_POLICY_TYPE_CONFIG={id:"policyType",label:"resource-policies.form.policy-type.label",options:policyTypeList,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.policy-type.required"}},RESOURCE_POLICY_FORM_ACTION_TYPE_CONFIG={id:"action",label:"resource-policies.form.action-type.label",options:policyActionList,required:!0,validators:{required:null},errorMessages:{required:"resource-policies.form.action-type.required"}},RESOURCE_POLICY_FORM_DATE_GROUP_CONFIG={id:"date",group:[]},RESOURCE_POLICY_FORM_DATE_GROUP_LAYOUT={element:{control:"form-row"}},RESOURCE_POLICY_FORM_START_DATE_CONFIG={id:"start",label:"resource-policies.form.date.start.label",placeholder:"resource-policies.form.date.start.label",inline:!1,toggleIcon:"far fa-calendar-alt"},RESOURCE_POLICY_FORM_START_DATE_LAYOUT={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},RESOURCE_POLICY_FORM_END_DATE_CONFIG={id:"end",label:"resource-policies.form.date.end.label",placeholder:"resource-policies.form.date.end.label",inline:!1,toggleIcon:"far fa-calendar-alt"},RESOURCE_POLICY_FORM_END_DATE_LAYOUT={element:{container:"p-0",label:"col-form-label"},grid:{host:"col-md-6"}},_c0=["content"];function ResourcePolicyFormComponent_ds_form_1_Template(rf,ctx){if(1&rf&&core.nrm(0,"ds-form",17,2),2&rf){const ctx_r1=core.XpG();core.Y8G("formId",ctx_r1.formId)("formModel",ctx_r1.formModel)("displaySubmit",!1)("displayCancel",!1)}}function ResourcePolicyFormComponent_ng_template_14_Template(rf,ctx){if(1&rf){const _r3=core.RV6();core.j41(0,"ds-eperson-group-list",18),core.bIt("select",function($event){core.eBV(_r3);const ctx_r1=core.XpG();return core.Njj(ctx_r1.updateObjectSelected($event,!0))}),core.k0s()}}function ResourcePolicyFormComponent_ng_template_19_Template(rf,ctx){if(1&rf){const _r4=core.RV6();core.j41(0,"ds-eperson-group-list",19),core.bIt("select",function($event){core.eBV(_r4);const ctx_r1=core.XpG();return core.Njj(ctx_r1.updateObjectSelected($event,!1))}),core.k0s()}2&rf&&core.Y8G("isListOfEPerson",!1)}function ResourcePolicyFormComponent_span_32_Template(rf,ctx){1&rf&&(core.j41(0,"span"),core.nrm(1,"i",20),core.EFF(2),core.nI1(3,"translate"),core.k0s()),2&rf&&(core.R7$(2),core.SpI(" ",core.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function ResourcePolicyFormComponent_span_34_Template(rf,ctx){1&rf&&(core.j41(0,"span"),core.EFF(1),core.nI1(2,"translate"),core.k0s()),2&rf&&(core.R7$(),core.SpI(" ",core.bMT(2,1,"form.submit")," "))}function ResourcePolicyFormComponent_ng_template_36_Template(rf,ctx){if(1&rf){const _r5=core.RV6();core.j41(0,"div",21)(1,"h4",22),core.EFF(2),core.nI1(3,"translate"),core.k0s(),core.j41(4,"button",23),core.bIt("click",function(){const modal_r6=core.eBV(_r5).$implicit;return core.Njj(modal_r6.close())}),core.j41(5,"span",24),core.EFF(6,"\xd7"),core.k0s()()(),core.j41(7,"div",25)(8,"div",26)(9,"div",27),core.nrm(10,"i",28),core.k0s(),core.j41(11,"div"),core.nrm(12,"p",29),core.nI1(13,"translate"),core.nrm(14,"p",30),core.nI1(15,"translate"),core.k0s()()(),core.j41(16,"div",31)(17,"button",32),core.bIt("click",function(){const modal_r6=core.eBV(_r5).$implicit;return core.Njj(modal_r6.close())}),core.EFF(18),core.nI1(19,"translate"),core.k0s()()}if(2&rf){const ctx_r1=core.XpG();core.R7$(2),core.JRh(core.bMT(3,4,"resource-policies.form.eperson-group-list.modal.header")),core.R7$(10),core.Y8G("innerHTML",core.bMT(13,6,"eperson"===ctx_r1.navActiveId?"resource-policies.form.eperson-group-list.modal.text1.toGroup":"resource-policies.form.eperson-group-list.modal.text1.toEPerson"),core.npT),core.R7$(2),core.Y8G("innerHTML",core.bMT(15,8,"resource-policies.form.eperson-group-list.modal.text2"),core.npT),core.R7$(4),core.JRh(core.bMT(19,10,"resource-policies.form.eperson-group-list.modal.close"))}}let ResourcePolicyFormComponent=(()=>{class ResourcePolicyFormComponent2{constructor(dsoNameService,ePersonService,formService,groupService,requestService,modalService){this.dsoNameService=dsoNameService,this.ePersonService=ePersonService,this.formService=formService,this.groupService=groupService,this.requestService=requestService,this.modalService=modalService,this.isProcessing=(0,cjs.of)(!1),this.reset=new core.bkB,this.submit=new core.bkB,this.resourcePolicyTargetName$=new cjs.BehaviorSubject(""),this.subs=[],this.resourcePolicyTargetUpdated=!1}ngOnInit(){if(this.isActive=!0,this.formId=this.formService.getUniqueId("resource-policy-form"),this.formModel=this.buildResourcePolicyForm(),this.isBeingEdited()){const epersonRD$=this.ePersonService.findByHref(this.resourcePolicy._links.eperson.href,!1).pipe((0,shared_operators.yd)()),groupRD$=this.groupService.findByHref(this.resourcePolicy._links.group.href,!1).pipe((0,shared_operators.yd)()),dsoRD$=(0,cjs.combineLatest)([epersonRD$,groupRD$]).pipe((0,operators.Tj)(rdArr=>rdArr.find(rd=>(0,empty_util.hj)(rd.payload))),(0,empty_util.Az)());this.subs.push(dsoRD$.pipe((0,operators.pb)(()=>this.isActive)).subscribe(dsoRD=>{this.resourcePolicyGrant=dsoRD.payload,this.navActiveId=String(dsoRD.payload.type),this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}))}}isFormValid(){return this.formService.isValid(this.formId).pipe((0,operators.Tj)(isValid=>isValid&&(0,empty_util.hj)(this.resourcePolicyGrant)))}buildResourcePolicyForm(){const formModel=[];formModel.push(new ds_dynamic_input_model.C(RESOURCE_POLICY_FORM_NAME_CONFIG),new ds_dynamic_textarea_model.E(RESOURCE_POLICY_FORM_DESCRIPTION_CONFIG),new fesm2020_core.z4z(RESOURCE_POLICY_FORM_POLICY_TYPE_CONFIG),new fesm2020_core.z4z(RESOURCE_POLICY_FORM_ACTION_TYPE_CONFIG));const startDateModel=new fesm2020_core.dku(RESOURCE_POLICY_FORM_START_DATE_CONFIG,RESOURCE_POLICY_FORM_START_DATE_LAYOUT),endDateModel=new fesm2020_core.dku(RESOURCE_POLICY_FORM_END_DATE_CONFIG,RESOURCE_POLICY_FORM_END_DATE_LAYOUT),dateGroupConfig=Object.assign({},RESOURCE_POLICY_FORM_DATE_GROUP_CONFIG,{group:[]});return dateGroupConfig.group.push(startDateModel,endDateModel),formModel.push(new fesm2020_core.iO5(dateGroupConfig,RESOURCE_POLICY_FORM_DATE_GROUP_LAYOUT)),this.initModelsValue(formModel),formModel}initModelsValue(formModel){return this.resourcePolicy&&formModel.forEach(model=>{"date"===model.id?((0,empty_util.a4)(this.resourcePolicy.startDate)&&(model.get(0).value=(0,date_util.PR)(this.resourcePolicy.startDate)),(0,empty_util.a4)(this.resourcePolicy.endDate)&&(model.get(1).value=(0,date_util.PR)(this.resourcePolicy.endDate))):this.resourcePolicy.hasOwnProperty(model.id)&&this.resourcePolicy[model.id]&&(model.value=this.resourcePolicy[model.id])}),formModel}isBeingEdited(){return!(0,empty_util.Im)(this.resourcePolicy)}getResourcePolicyTargetName(){return(0,empty_util.hj)(this.resourcePolicyGrant)?this.dsoNameService.getName(this.resourcePolicyGrant):""}updateObjectSelected(object,isEPerson){this.resourcePolicyTargetUpdated=!0,this.resourcePolicyGrant=object,this.resourcePolicyGrantType=isEPerson?"eperson":"group",this.resourcePolicyTargetName$.next(this.getResourcePolicyTargetName())}onReset(){this.reset.emit()}onSubmit(){this.formService.getFormData(this.formId).pipe((0,operators.s)(1)).subscribe(data=>{const eventPayload=Object.create({});eventPayload.object=this.createResourcePolicyByFormData(data),eventPayload.target={type:this.resourcePolicyGrantType,uuid:this.resourcePolicyGrant.id},eventPayload.updateTarget=this.resourcePolicyTargetUpdated,this.submit.emit(eventPayload)})}createResourcePolicyByFormData(data){const resourcePolicy=new resource_policy_model.h;return resourcePolicy.name=data.name?data.name[0].value:null,resourcePolicy.description=data.description?data.description[0].value:null,resourcePolicy.policyType=data.policyType?data.policyType[0].value:null,resourcePolicy.action=data.action?data.action[0].value:null,resourcePolicy.startDate=data.date&&data.date.start?(0,date_util.Sd)(data.date.start[0].value):null,resourcePolicy.endDate=data.date&&data.date.end?(0,date_util.Sd)(data.date.end[0].value):null,resourcePolicy.type=resource_policy_resource_type.O,resourcePolicy}ngOnDestroy(){this.isActive=!1,this.formModel=null,this.subs.filter(subscription=>(0,empty_util.a4)(subscription)).forEach(subscription=>subscription.unsubscribe())}onNavChange(changeEvent){this.isBeingEdited()&&(changeEvent.preventDefault(),this.modalService.open(this.content))}static#_=this.\u0275fac=function(t){return new(t||ResourcePolicyFormComponent2)(core.rXU(dso_name_service.f),core.rXU(eperson_data_service.EPersonDataService),core.rXU(form_service.u),core.rXU(group_data_service.GroupDataService),core.rXU(request_service.B),core.rXU(ng_bootstrap.Bq))};static#_2=this.\u0275cmp=core.VBU({type:ResourcePolicyFormComponent2,selectors:[["ds-resource-policy-form"]],viewQuery:function(rf,ctx){if(1&rf&&core.GBs(_c0,5),2&rf){let _t;core.mGM(_t=core.lsd())&&(ctx.content=_t.first)}},inputs:{resourcePolicy:"resourcePolicy",isProcessing:"isProcessing"},outputs:{reset:"reset",submit:"submit"},standalone:!0,features:[core.aNF],decls:38,vars:34,consts:[["nav","ngbNav"],["content",""],["formRef","formComponent"],[3,"formId","formModel","displaySubmit","displayCancel",4,"ngIf"],[1,"container-fluid"],["for","ResourcePolicyObject"],["id","ResourcePolicyObject","type","text",1,"form-control","mb-3",3,"value"],["ngbNav","",1,"nav-pills",3,"activeIdChange","navChange","activeId"],["role","presentation",3,"ngbNavItem"],["ngbNavLink",""],["ngbNavContent",""],[3,"ngbNavOutlet"],[1,"form-group","row"],[1,"col","text-right"],["type","reset",1,"btn","btn-default",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[4,"ngIf"],[3,"formId","formModel","displaySubmit","displayCancel"],[3,"select"],[3,"select","isListOfEPerson"],[1,"fas","fa-circle-notch","fa-spin"],[1,"modal-header"],["id","modal-basic-title",1,"modal-title"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"d-flex","flex-row"],[1,"mr-3"],[1,"fas","fa-info-circle","fa-2x","text-info"],[1,"font-weight-bold",3,"innerHTML"],[3,"innerHTML"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"]],template:function(rf,ctx){if(1&rf){const _r1=core.RV6();core.j41(0,"div"),core.DNE(1,ResourcePolicyFormComponent_ds_form_1_Template,2,4,"ds-form",3),core.j41(2,"div",4)(3,"label",5),core.EFF(4),core.nI1(5,"translate"),core.k0s(),core.nrm(6,"input",6),core.nI1(7,"async"),core.j41(8,"ul",7,0),core.mxI("activeIdChange",function($event){return core.eBV(_r1),core.DH7(ctx.navActiveId,$event)||(ctx.navActiveId=$event),core.Njj($event)}),core.bIt("navChange",function($event){return core.eBV(_r1),core.Njj(ctx.onNavChange($event))}),core.j41(10,"li",8)(11,"a",9),core.EFF(12),core.nI1(13,"translate"),core.k0s(),core.DNE(14,ResourcePolicyFormComponent_ng_template_14_Template,1,0,"ng-template",10),core.k0s(),core.j41(15,"li",8)(16,"a",9),core.EFF(17),core.nI1(18,"translate"),core.k0s(),core.DNE(19,ResourcePolicyFormComponent_ng_template_19_Template,1,1,"ng-template",10),core.k0s()(),core.nrm(20,"div",11),core.j41(21,"div"),core.nrm(22,"hr"),core.j41(23,"div",12)(24,"div",13)(25,"button",14),core.nI1(26,"async"),core.bIt("click",function(){return core.eBV(_r1),core.Njj(ctx.onReset())}),core.EFF(27),core.nI1(28,"translate"),core.k0s(),core.j41(29,"button",15),core.nI1(30,"async"),core.nI1(31,"async"),core.bIt("click",function(){return core.eBV(_r1),core.Njj(ctx.onSubmit())}),core.DNE(32,ResourcePolicyFormComponent_span_32_Template,4,3,"span",16),core.nI1(33,"async"),core.DNE(34,ResourcePolicyFormComponent_span_34_Template,3,3,"span",16),core.nI1(35,"async"),core.k0s()()()()()(),core.DNE(36,ResourcePolicyFormComponent_ng_template_36_Template,20,12,"ng-template",null,1,core.C5r)}if(2&rf){const nav_r7=core.sdS(9);core.R7$(),core.Y8G("ngIf",ctx.formModel),core.R7$(3),core.JRh(core.bMT(5,14,"resource-policies.form.eperson-group-list.label")),core.R7$(2),core.Y8G("value",core.bMT(7,16,ctx.resourcePolicyTargetName$)),core.R7$(2),core.R50("activeId",ctx.navActiveId),core.R7$(2),core.Y8G("ngbNavItem","eperson"),core.R7$(2),core.JRh(core.bMT(13,18,"resource-policies.form.eperson-group-list.tab.eperson")),core.R7$(3),core.Y8G("ngbNavItem","group"),core.R7$(2),core.JRh(core.bMT(18,20,"resource-policies.form.eperson-group-list.tab.group")),core.R7$(3),core.Y8G("ngbNavOutlet",nav_r7),core.R7$(5),core.Y8G("disabled",core.bMT(26,22,ctx.isProcessing)),core.R7$(2),core.JRh(core.bMT(28,24,"form.cancel")),core.R7$(2),core.Y8G("disabled",!0!==core.bMT(30,26,ctx.isFormValid())||core.bMT(31,28,ctx.isProcessing)),core.R7$(3),core.Y8G("ngIf",core.bMT(33,30,ctx.isProcessing)),core.R7$(2),core.Y8G("ngIf",!0!==core.bMT(35,32,ctx.isProcessing))}},dependencies:[form_component.s,ng_bootstrap.Pv,ng_bootstrap.Um,ng_bootstrap.X9,ng_bootstrap.sy,ng_bootstrap.Ri,ng_bootstrap.m_,eperson_group_list_component.T,ngx_translate_core.h,ngx_translate_core.D9,common.Jj,common.bT],encapsulation:2})}return ResourcePolicyFormComponent2})()},20312:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Q:()=>resourcePolicyTargetResolver});var _angular_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(68014),_angular_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(64247),rxjs_operators__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(10743),_config_app_config_interface__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59945),_core_lazy_data_service__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(56964),_core_shared_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(82656),_core_shared_resource_type__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(94554),_empty_util__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(77028);const resourcePolicyTargetResolver=(route,state,dataServiceMap=(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.WQX)(_config_app_config_interface__WEBPACK_IMPORTED_MODULE_0__.l9),parentInjector=(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.WQX)(_angular_core__WEBPACK_IMPORTED_MODULE_2__.zZn),router=(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.WQX)(_angular_router__WEBPACK_IMPORTED_MODULE_3__.Ix))=>{const targetType=route.queryParamMap.get("targetType"),policyTargetId=route.queryParamMap.get("policyTargetId");((0,_empty_util__WEBPACK_IMPORTED_MODULE_4__.Im)(targetType)||(0,_empty_util__WEBPACK_IMPORTED_MODULE_4__.Im)(policyTargetId))&&router.navigateByUrl("/404",{skipLocationChange:!0});const resourceType=new _core_shared_resource_type__WEBPACK_IMPORTED_MODULE_5__.v(targetType);return(0,_core_lazy_data_service__WEBPACK_IMPORTED_MODULE_6__.M)(dataServiceMap,resourceType.value,parentInjector).pipe((0,rxjs_operators__WEBPACK_IMPORTED_MODULE_7__.nx)(dataService=>dataService.findById(policyTargetId)),(0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_1__.qD)())}},48576:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{n:()=>resourcePolicyResolver});var _angular_core__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(68014),_angular_router__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(64247),_core_resource_policy_resource_policy_data_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(55592),_core_shared_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(82656),_empty_util__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(77028),_utils_follow_link_config_model__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(32181);const resourcePolicyResolver=(route,state,router=(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.WQX)(_angular_router__WEBPACK_IMPORTED_MODULE_3__.Ix),resourcePolicyService=(0,_angular_core__WEBPACK_IMPORTED_MODULE_2__.WQX)(_core_resource_policy_resource_policy_data_service__WEBPACK_IMPORTED_MODULE_0__.ResourcePolicyDataService))=>{const policyId=route.queryParamMap.get("policyId");return(0,_empty_util__WEBPACK_IMPORTED_MODULE_4__.Im)(policyId)&&router.navigateByUrl("/404",{skipLocationChange:!0}),resourcePolicyService.findById(policyId,!0,!1,(0,_utils_follow_link_config_model__WEBPACK_IMPORTED_MODULE_5__.s)("eperson"),(0,_utils_follow_link_config_model__WEBPACK_IMPORTED_MODULE_5__.s)("group")).pipe((0,_core_shared_operators__WEBPACK_IMPORTED_MODULE_1__.qD)())}},67848:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{e:()=>ResourcePoliciesComponent});var common=__webpack_require__(84739),ngx_translate_core=__webpack_require__(43750),cjs=__webpack_require__(74785),operators=__webpack_require__(10743),dso_name_service=__webpack_require__(91735),request_service=__webpack_require__(72744),eperson_data_service=__webpack_require__(62120),group_data_service=__webpack_require__(97195),resource_policy_data_service=__webpack_require__(55592),shared_operators=__webpack_require__(82656),empty_util=__webpack_require__(77028),notifications_service=__webpack_require__(10117),follow_link_config_model=__webpack_require__(32181),core=__webpack_require__(68014),fesm2022_forms=__webpack_require__(28955),access_control_routing_paths=__webpack_require__(60856),date_util=__webpack_require__(7840),has_value_pipe=__webpack_require__(10585),router=__webpack_require__(64247);const _c0=["ds-resource-policy-entry",""];function ResourcePolicyEntryComponent_button_30_Template(rf,ctx){if(1&rf){const _r1=core.RV6();core.j41(0,"button",7),core.nI1(1,"translate"),core.bIt("click",function(){core.eBV(_r1);const ctx_r1=core.XpG();return core.Njj(ctx_r1.redirectToGroupEditPage())}),core.nrm(2,"i",10),core.k0s()}2&rf&&core.Y8G("title",core.bMT(1,1,"resource-policies.table.headers.edit.group"))}let ResourcePolicyEntryComponent=(()=>{class ResourcePolicyEntryComponent2{constructor(dsoNameService,groupService,route,router2){this.dsoNameService=dsoNameService,this.groupService=groupService,this.route=route,this.router=router2,this.toggleCheckbox=new core.bkB}ngOnInit(){this.epersonName$=this.getName$(this.entry.policy.eperson),this.groupName$=this.getName$(this.entry.policy.group)}getName$(dso$){return dso$.pipe((0,shared_operators.v7)(),(0,operators.Tj)(rd=>{if((0,empty_util.a4)(rd?.payload))return this.dsoNameService.getName(rd.payload)}))}formatDate(date){return(0,empty_util.hj)(date)?(0,date_util.$T)((0,date_util.PR)(date)):""}redirectToResourcePolicyEditPage(){this.router.navigate(["./edit"],{relativeTo:this.route,queryParams:{policyId:this.entry.policy.id}})}redirectToGroupEditPage(){this.groupService.findByHref(this.entry.policy._links.group.href,!1).pipe((0,shared_operators.ak)(),(0,operators.Tj)(group=>group.id)).subscribe(groupUUID=>{this.router.navigate([(0,access_control_routing_paths.xl)(groupUUID)])})}static#_=this.\u0275fac=function(t){return new(t||ResourcePolicyEntryComponent2)(core.rXU(dso_name_service.f),core.rXU(group_data_service.GroupDataService),core.rXU(router.nX),core.rXU(router.Ix))};static#_2=this.\u0275cmp=core.VBU({type:ResourcePolicyEntryComponent2,selectors:[["tr","ds-resource-policy-entry",""]],inputs:{entry:"entry"},outputs:{toggleCheckbox:"toggleCheckbox"},standalone:!0,features:[core.aNF],attrs:_c0,decls:33,vars:26,consts:[[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"ngModelChange","id","ngModel"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["scope","row"],[1,"btn-group","edit-field"],[1,"btn","btn-outline-primary","btn-sm",3,"click","title"],["aria-hidden","true",1,"fas","fa-edit","fa-fw"],["class","btn btn-outline-primary btn-sm",3,"title","click",4,"ngIf"],["aria-hidden","true",1,"fas","fa-users","fa-fw"]],template:function(rf,ctx){1&rf&&(core.j41(0,"td",0)(1,"div",1)(2,"input",2),core.bIt("ngModelChange",function($event){return ctx.toggleCheckbox.emit($event)}),core.k0s(),core.j41(3,"label",3)(4,"span",4),core.EFF(5),core.nI1(6,"translate"),core.k0s()()()(),core.j41(7,"th",5),core.EFF(8),core.k0s(),core.j41(9,"td"),core.EFF(10),core.k0s(),core.j41(11,"td"),core.EFF(12),core.k0s(),core.j41(13,"td"),core.EFF(14),core.k0s(),core.j41(15,"td"),core.EFF(16),core.nI1(17,"async"),core.k0s(),core.j41(18,"td"),core.EFF(19),core.nI1(20,"async"),core.k0s(),core.j41(21,"td"),core.EFF(22),core.k0s(),core.j41(23,"td"),core.EFF(24),core.k0s(),core.j41(25,"td",0)(26,"div",6)(27,"button",7),core.nI1(28,"translate"),core.bIt("click",function(){return ctx.redirectToResourcePolicyEditPage()}),core.nrm(29,"i",8),core.k0s(),core.DNE(30,ResourcePolicyEntryComponent_button_30_Template,3,3,"button",9),core.nI1(31,"async"),core.nI1(32,"dsHasValue"),core.k0s()()),2&rf&&(core.R7$(2),core.Y8G("id",ctx.entry.id)("ngModel",ctx.entry.checked),core.R7$(),core.Y8G("for",ctx.entry.id),core.R7$(2),core.JRh(core.bMT(6,14,ctx.entry.checked?"resource-policies.table.headers.deselect":"resource-policies.table.headers.select")),core.R7$(3),core.SpI(" ",ctx.entry.id,"\n"),core.R7$(2),core.JRh(ctx.entry.policy.name),core.R7$(2),core.JRh(ctx.entry.policy.policyType),core.R7$(2),core.JRh(ctx.entry.policy.action),core.R7$(2),core.SpI(" ",core.bMT(17,16,ctx.epersonName$),"\n"),core.R7$(3),core.SpI(" ",core.bMT(20,18,ctx.groupName$),"\n"),core.R7$(3),core.JRh(ctx.formatDate(ctx.entry.policy.startDate)),core.R7$(2),core.JRh(ctx.formatDate(ctx.entry.policy.endDate)),core.R7$(3),core.Y8G("title",core.bMT(28,20,"resource-policies.table.headers.edit.policy")),core.R7$(3),core.Y8G("ngIf",core.bMT(32,24,core.bMT(31,22,ctx.groupName$))))},dependencies:[common.Jj,ngx_translate_core.h,ngx_translate_core.D9,fesm2022_forms.YN,fesm2022_forms.Zm,fesm2022_forms.BC,fesm2022_forms.vS,common.bT,has_value_pipe.a],encapsulation:2})}return ResourcePolicyEntryComponent2})();function ResourcePoliciesComponent_ng_container_11_Template(rf,ctx){if(1&rf&&(core.qex(0),core.EFF(1),core.bVm()),2&rf){const ctx_r0=core.XpG();core.R7$(),core.SpI(" (",ctx_r0.resourceUUID,") ")}}function ResourcePoliciesComponent_span_17_Template(rf,ctx){1&rf&&(core.j41(0,"span"),core.nrm(1,"i",12),core.EFF(2),core.nI1(3,"translate"),core.k0s()),2&rf&&(core.R7$(2),core.SpI(" ",core.bMT(3,1,"submission.workflow.tasks.generic.processing")," "))}function ResourcePoliciesComponent_span_19_Template(rf,ctx){1&rf&&(core.j41(0,"span"),core.nrm(1,"i",13),core.EFF(2),core.nI1(3,"translate"),core.k0s()),2&rf&&(core.R7$(2),core.SpI(" ",core.bMT(3,1,"resource-policies.delete.btn")," "))}function ResourcePoliciesComponent_tr_27_Template(rf,ctx){if(1&rf){const _r2=core.RV6();core.j41(0,"tr",14)(1,"th")(2,"div",15)(3,"input",16,0),core.bIt("change",function($event){core.eBV(_r2);const ctx_r0=core.XpG();return core.Njj(ctx_r0.selectAllCheckbox($event))}),core.k0s(),core.j41(5,"label",17)(6,"span",18),core.EFF(7),core.nI1(8,"translate"),core.k0s()()()(),core.j41(9,"th"),core.EFF(10),core.nI1(11,"translate"),core.k0s(),core.j41(12,"th"),core.EFF(13),core.nI1(14,"translate"),core.k0s(),core.j41(15,"th"),core.EFF(16),core.nI1(17,"translate"),core.k0s(),core.j41(18,"th"),core.EFF(19),core.nI1(20,"translate"),core.k0s(),core.j41(21,"th"),core.EFF(22),core.nI1(23,"translate"),core.k0s(),core.j41(24,"th"),core.EFF(25),core.nI1(26,"translate"),core.k0s(),core.j41(27,"th"),core.EFF(28),core.nI1(29,"translate"),core.k0s(),core.j41(30,"th"),core.EFF(31),core.nI1(32,"translate"),core.k0s(),core.j41(33,"th"),core.EFF(34),core.nI1(35,"translate"),core.k0s()()}if(2&rf){const selectAllBtn_r3=core.sdS(4),ctx_r0=core.XpG();core.R7$(3),core.Y8G("id","selectAll_"+ctx_r0.resourceUUID),core.R7$(2),core.Y8G("for","selectAll_"+ctx_r0.resourceUUID),core.R7$(2),core.JRh(core.bMT(8,12,selectAllBtn_r3.checked?"resource-policies.table.headers.deselect-all":"resource-policies.table.headers.select-all")),core.R7$(3),core.JRh(core.bMT(11,14,"resource-policies.table.headers.id")),core.R7$(3),core.JRh(core.bMT(14,16,"resource-policies.table.headers.name")),core.R7$(3),core.JRh(core.bMT(17,18,"resource-policies.table.headers.policyType")),core.R7$(3),core.JRh(core.bMT(20,20,"resource-policies.table.headers.action")),core.R7$(3),core.JRh(core.bMT(23,22,"resource-policies.table.headers.eperson")),core.R7$(3),core.JRh(core.bMT(26,24,"resource-policies.table.headers.group")),core.R7$(3),core.JRh(core.bMT(29,26,"resource-policies.table.headers.date.start")),core.R7$(3),core.JRh(core.bMT(32,28,"resource-policies.table.headers.date.end")),core.R7$(3),core.JRh(core.bMT(35,30,"resource-policies.table.headers.edit"))}}function ResourcePoliciesComponent_tbody_29_tr_1_Template(rf,ctx){if(1&rf){const _r4=core.RV6();core.j41(0,"tr",20),core.bIt("toggleCheckbox",function($event){const entry_r5=core.eBV(_r4).$implicit,ctx_r0=core.XpG(2);return core.Njj(ctx_r0.selectCheckbox(entry_r5,$event))}),core.k0s()}2&rf&&core.Y8G("entry",ctx.$implicit)}function ResourcePoliciesComponent_tbody_29_Template(rf,ctx){if(1&rf&&(core.j41(0,"tbody"),core.DNE(1,ResourcePoliciesComponent_tbody_29_tr_1_Template,1,1,"tr",19),core.nI1(2,"async"),core.k0s()),2&rf){const ctx_r0=core.XpG();core.R7$(),core.Y8G("ngForOf",core.bMT(2,1,ctx_r0.getResourcePolicies()))}}let ResourcePoliciesComponent=(()=>{class ResourcePoliciesComponent2{constructor(cdr,dsoNameService,ePersonService,groupService,notificationsService,requestService,resourcePolicyService,route,router2,translate){this.cdr=cdr,this.dsoNameService=dsoNameService,this.ePersonService=ePersonService,this.groupService=groupService,this.notificationsService=notificationsService,this.requestService=requestService,this.resourcePolicyService=resourcePolicyService,this.route=route,this.router=router2,this.translate=translate,this.processingDelete$=new cjs.BehaviorSubject(!1),this.resourcePoliciesEntries$=new cjs.BehaviorSubject([]),this.subs=[]}ngOnInit(){this.isActive=!0,this.initResourcePolicyList()}canDelete(){return(0,cjs.from)(this.resourcePoliciesEntries$.value).pipe((0,operators.pb)(entry=>entry.checked),(0,operators.TS)((acc,value)=>[...acc,value],[]),(0,operators.Tj)(entries=>(0,empty_util.hj)(entries)),(0,operators.F)())}deleteSelectedResourcePolicies(){this.processingDelete$.next(!0);const policiesToDelete=this.resourcePoliciesEntries$.value.filter(entry=>entry.checked);this.subs.push((0,cjs.from)(policiesToDelete).pipe((0,operators.Hh)(entry=>this.resourcePolicyService.delete(entry.policy.id)),(0,operators.SQ)((acc,value)=>[...acc,value],[]),(0,operators.pb)(results=>results.length===policiesToDelete.length),(0,operators.s)(1)).subscribe(results=>{const failureResults=results.filter(result=>!result);(0,empty_util.Im)(failureResults)?this.notificationsService.success(null,this.translate.get("resource-policies.delete.success.content")):this.notificationsService.error(null,this.translate.get("resource-policies.delete.failure.content")),this.processingDelete$.next(!1)}))}getResourcePolicies(){return this.resourcePoliciesEntries$.asObservable()}initResourcePolicyList(){this.subs.push(this.resourcePolicyService.searchByResource(this.resourceUUID,null,!1,!0,(0,follow_link_config_model.s)("eperson"),(0,follow_link_config_model.s)("group")).pipe((0,operators.pb)(()=>this.isActive),(0,shared_operators.v7)()).subscribe(result=>{const entries=result.payload.page.map(policy=>({id:policy.id,policy,checked:!1}));this.resourcePoliciesEntries$.next(entries),this.cdr.detectChanges()}))}isProcessingDelete(){return this.processingDelete$.asObservable()}redirectToResourcePolicyCreatePage(){this.router.navigate(["./create"],{relativeTo:this.route,queryParams:{policyTargetId:this.resourceUUID,targetType:this.resourceType}})}selectAllCheckbox(event){const checked=event.target.checked;this.resourcePoliciesEntries$.value.forEach(entry=>entry.checked=checked)}selectCheckbox(policyEntry,checked){policyEntry.checked=checked}ngOnDestroy(){this.isActive=!1,this.resourcePoliciesEntries$=null,this.subs.filter(subscription=>(0,empty_util.a4)(subscription)).forEach(subscription=>subscription.unsubscribe())}static#_=this.\u0275fac=function(t){return new(t||ResourcePoliciesComponent2)(core.rXU(core.gRc),core.rXU(dso_name_service.f),core.rXU(eperson_data_service.EPersonDataService),core.rXU(group_data_service.GroupDataService),core.rXU(notifications_service.I),core.rXU(request_service.B),core.rXU(resource_policy_data_service.ResourcePolicyDataService),core.rXU(router.nX),core.rXU(router.Ix),core.rXU(ngx_translate_core.c$))};static#_2=this.\u0275cmp=core.VBU({type:ResourcePoliciesComponent2,selectors:[["ds-resource-policies"]],inputs:{resourceUUID:"resourceUUID",resourceType:"resourceType",resourceName:"resourceName"},standalone:!0,features:[core.aNF],decls:31,vars:34,consts:[["selectAllBtn",""],[1,"table-responsive"],[1,"table","table-striped","table-bordered","table-hover"],["colspan","10"],[1,"d-flex","justify-content-between","align-items-center","m-0"],[1,"text-info"],[4,"ngIf"],[1,"space-children-mr","flex-shrink-0"],[1,"btn","btn-danger","p-1",3,"click","disabled","title"],[1,"btn","btn-success","p-1",3,"click","disabled","title"],["aria-hidden","true",1,"fas","fa-plus"],["class","text-center",4,"ngIf"],["aria-hidden","true",1,"fas","fa-circle-notch","fa-spin"],["aria-hidden","true",1,"fas","fa-trash-alt","fa-fw"],[1,"text-center"],[1,"custom-control","custom-checkbox"],["type","checkbox",1,"custom-control-input",3,"change","id"],[1,"custom-control-label",3,"for"],[1,"sr-only"],["ds-resource-policy-entry","",3,"entry","toggleCheckbox",4,"ngFor","ngForOf"],["ds-resource-policy-entry","",3,"toggleCheckbox","entry"]],template:function(rf,ctx){if(1&rf&&(core.j41(0,"div",1)(1,"table",2)(2,"thead")(3,"tr")(4,"th",3)(5,"div",4)(6,"span"),core.EFF(7),core.nI1(8,"translate"),core.j41(9,"span",5),core.EFF(10),core.k0s(),core.DNE(11,ResourcePoliciesComponent_ng_container_11_Template,2,1,"ng-container",6),core.k0s(),core.j41(12,"div",7)(13,"button",8),core.nI1(14,"async"),core.nI1(15,"async"),core.nI1(16,"translate"),core.bIt("click",function(){return ctx.deleteSelectedResourcePolicies()}),core.DNE(17,ResourcePoliciesComponent_span_17_Template,4,3,"span",6),core.nI1(18,"async"),core.DNE(19,ResourcePoliciesComponent_span_19_Template,4,3,"span",6),core.nI1(20,"async"),core.k0s(),core.j41(21,"button",9),core.nI1(22,"async"),core.nI1(23,"translate"),core.bIt("click",function(){return ctx.redirectToResourcePolicyCreatePage()}),core.nrm(24,"i",10),core.EFF(25),core.nI1(26,"translate"),core.k0s()()()()(),core.DNE(27,ResourcePoliciesComponent_tr_27_Template,36,32,"tr",11),core.nI1(28,"async"),core.k0s(),core.DNE(29,ResourcePoliciesComponent_tbody_29_Template,3,3,"tbody",6),core.nI1(30,"async"),core.k0s()()),2&rf){let tmp_10_0,tmp_11_0;core.R7$(7),core.SpI(" ",core.bMT(8,12,"resource-policies.table.headers.title.for."+ctx.resourceType)," "),core.R7$(3),core.SpI(" ",ctx.resourceName," "),core.R7$(),core.Y8G("ngIf","item"!==ctx.resourceType),core.R7$(2),core.Y8G("disabled",!0!==core.bMT(14,14,ctx.canDelete())||core.bMT(15,16,ctx.isProcessingDelete()))("title",core.bMT(16,18,"resource-policies.delete.btn.title")),core.R7$(4),core.Y8G("ngIf",core.bMT(18,20,ctx.isProcessingDelete())),core.R7$(2),core.Y8G("ngIf",!0!==core.bMT(20,22,ctx.isProcessingDelete())),core.R7$(2),core.Y8G("disabled",core.bMT(22,24,ctx.isProcessingDelete()))("title",core.bMT(23,26,"resource-policies.add.for."+ctx.resourceType)),core.R7$(4),core.SpI(" ",core.bMT(26,28,"resource-policies.add.button")," "),core.R7$(2),core.Y8G("ngIf",(null==(tmp_10_0=core.bMT(28,30,ctx.getResourcePolicies()))?null:tmp_10_0.length)>0),core.R7$(2),core.Y8G("ngIf",(null==(tmp_11_0=core.bMT(30,32,ctx.getResourcePolicies()))?null:tmp_11_0.length)>0)}},dependencies:[ResourcePolicyEntryComponent,ngx_translate_core.h,ngx_translate_core.D9,common.bT,common.Jj,common.Sq],styles:["td[_ngcontent-%COMP%]   .btn-link[_ngcontent-%COMP%]:focus{box-shadow:none!important}"]})}return ResourcePoliciesComponent2})()},10585:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a:()=>HasValuePipe});var _empty_util__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(77028),_angular_core__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(68014);let HasValuePipe=(()=>{class HasValuePipe2{transform(value){return(0,_empty_util__WEBPACK_IMPORTED_MODULE_0__.a4)(value)}static#_=this.\u0275fac=function(t){return new(t||HasValuePipe2)};static#_2=this.\u0275pipe=_angular_core__WEBPACK_IMPORTED_MODULE_1__.EJ8({name:"dsHasValue",type:HasValuePipe2,pure:!0,standalone:!0})}return HasValuePipe2})()},13170:(module,__unused_webpack_exports,__webpack_require__)=>{var map={"./custom/app/bitstream-page/edit-bitstream-page/edit-bitstream-page.component":[80890,890]};function webpackAsyncContext(req){if(!__webpack_require__.o(map,req))return Promise.resolve().then(()=>{var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e});var ids=map[req],id=ids[0];return __webpack_require__.e(ids[1]).then(()=>__webpack_require__(id))}webpackAsyncContext.keys=()=>Object.keys(map),webpackAsyncContext.id=13170,module.exports=webpackAsyncContext}};