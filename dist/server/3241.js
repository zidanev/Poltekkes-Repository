"use strict";exports.id=3241,exports.ids=[3241],exports.modules={53241:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ROUTES:()=>ROUTES});var site_administrator_guard=__webpack_require__(22658),common=__webpack_require__(84739),fesm2022_forms=__webpack_require__(28955),ng_bootstrap=__webpack_require__(71781),ngx_translate_core=__webpack_require__(43750),date_fns_tz=__webpack_require__(25640),ngx_ui_switch=__webpack_require__(25702),cjs=__webpack_require__(74785),operators=__webpack_require__(10743),request_service=__webpack_require__(72744),system_wide_alert_data_service=__webpack_require__(40520),shared_operators=__webpack_require__(82656),empty_util=__webpack_require__(77028),notifications_service=__webpack_require__(10117),tslib_es6=__webpack_require__(31635),cerialize=__webpack_require__(95488),build_decorators=__webpack_require__(89934),resource_type=__webpack_require__(94554),equals_decorators=__webpack_require__(39891),system_wide_alert_resource_type=__webpack_require__(98085);let SystemWideAlert=class{static#_=this.type=system_wide_alert_resource_type.B};(0,tslib_es6.Cg)([equals_decorators.aK,cerialize.autoserialize,(0,tslib_es6.Sn)("design:type",resource_type.v)],SystemWideAlert.prototype,"type",void 0),(0,tslib_es6.Cg)([cerialize.autoserialize,(0,tslib_es6.Sn)("design:type",String)],SystemWideAlert.prototype,"alertId",void 0),(0,tslib_es6.Cg)([cerialize.autoserialize,(0,tslib_es6.Sn)("design:type",String)],SystemWideAlert.prototype,"message",void 0),(0,tslib_es6.Cg)([cerialize.autoserialize,(0,tslib_es6.Sn)("design:type",String)],SystemWideAlert.prototype,"countdownTo",void 0),(0,tslib_es6.Cg)([cerialize.autoserialize,(0,tslib_es6.Sn)("design:type",Boolean)],SystemWideAlert.prototype,"active",void 0),(0,tslib_es6.Cg)([cerialize.deserialize,(0,tslib_es6.Sn)("design:type",Object)],SystemWideAlert.prototype,"_links",void 0),SystemWideAlert=(0,tslib_es6.Cg)([build_decorators.gV],SystemWideAlert);var core=__webpack_require__(68014),router=__webpack_require__(64247);const _c0=a0=>({days:a0}),_c1=a0=>({hours:a0}),_c2=a0=>({minutes:a0});function SystemWideAlertFormComponent_div_18_span_1_Template(rf,ctx){1&rf&&(core.j41(0,"span"),core.EFF(1),core.nI1(2,"translate"),core.k0s()),2&rf&&(core.R7$(),core.SpI(" ",core.bMT(2,1,"system-wide-alert.form.error.message")," "))}function SystemWideAlertFormComponent_div_18_Template(rf,ctx){if(1&rf&&(core.j41(0,"div",23),core.DNE(1,SystemWideAlertFormComponent_div_18_span_1_Template,3,3,"span",15),core.k0s()),2&rf){const ctx_r0=core.XpG();core.R7$(),core.Y8G("ngIf",ctx_r0.formMessage.errors)}}function SystemWideAlertFormComponent_div_27_Template(rf,ctx){if(1&rf){const _r2=core.RV6();core.j41(0,"div")(1,"div",8)(2,"div",24)(3,"div",25)(4,"input",26,0),core.mxI("ngModelChange",function($event){core.eBV(_r2);const ctx_r0=core.XpG();return core.DH7(ctx_r0.date,$event)||(ctx_r0.date=$event),core.Njj($event)}),core.bIt("ngModelChange",function(){core.eBV(_r2);const ctx_r0=core.XpG();return core.Njj(ctx_r0.updatePreviewTime())}),core.k0s(),core.j41(6,"button",27),core.nI1(7,"translate"),core.bIt("click",function(){core.eBV(_r2);const d_r3=core.sdS(5);return core.Njj(d_r3.toggle())}),core.k0s()()(),core.j41(8,"div",28)(9,"div",25)(10,"ngb-timepicker",29),core.mxI("ngModelChange",function($event){core.eBV(_r2);const ctx_r0=core.XpG();return core.DH7(ctx_r0.time,$event)||(ctx_r0.time=$event),core.Njj($event)}),core.bIt("ngModelChange",function(){core.eBV(_r2);const ctx_r0=core.XpG();return core.Njj(ctx_r0.updatePreviewTime())}),core.k0s()()(),core.j41(11,"div",30)(12,"div",25)(13,"ngb-timepicker",29),core.mxI("ngModelChange",function($event){core.eBV(_r2);const ctx_r0=core.XpG();return core.DH7(ctx_r0.time,$event)||(ctx_r0.time=$event),core.Njj($event)}),core.bIt("ngModelChange",function(){core.eBV(_r2);const ctx_r0=core.XpG();return core.Njj(ctx_r0.updatePreviewTime())}),core.k0s()()()()()}if(2&rf){const ctx_r0=core.XpG();core.R7$(4),core.R50("ngModel",ctx_r0.date),core.Y8G("minDate",ctx_r0.minDate),core.R7$(2),core.BMQ("aria-label",core.bMT(7,5,"system-wide-alert-form.select-date-by-calendar")),core.R7$(4),core.R50("ngModel",ctx_r0.time),core.R7$(3),core.R50("ngModel",ctx_r0.time)}}function SystemWideAlertFormComponent_div_33_span_8_Template(rf,ctx){1&rf&&(core.j41(0,"span"),core.EFF(1),core.nI1(2,"translate"),core.k0s()),2&rf&&(core.R7$(),core.SpI(" ",core.bMT(2,1,"system-wide-alert-banner.countdown.prefix")," "))}function SystemWideAlertFormComponent_div_33_span_9_Template(rf,ctx){if(1&rf&&(core.j41(0,"span"),core.EFF(1),core.nI1(2,"translate"),core.k0s()),2&rf){const ctx_r0=core.XpG(2);core.R7$(),core.SpI(" ",core.i5U(2,1,"system-wide-alert-banner.countdown.days",core.eq3(4,_c0,ctx_r0.previewDays))," ")}}function SystemWideAlertFormComponent_div_33_span_10_Template(rf,ctx){if(1&rf&&(core.j41(0,"span"),core.EFF(1),core.nI1(2,"translate"),core.k0s()),2&rf){const ctx_r0=core.XpG(2);core.R7$(),core.SpI(" ",core.i5U(2,1,"system-wide-alert-banner.countdown.hours",core.eq3(4,_c1,ctx_r0.previewHours))," ")}}function SystemWideAlertFormComponent_div_33_span_11_Template(rf,ctx){if(1&rf&&(core.j41(0,"span"),core.EFF(1),core.nI1(2,"translate"),core.k0s()),2&rf){const ctx_r0=core.XpG(2);core.R7$(),core.SpI(" ",core.i5U(2,1,"system-wide-alert-banner.countdown.minutes",core.eq3(4,_c2,ctx_r0.previewMinutes))," ")}}function SystemWideAlertFormComponent_div_33_Template(rf,ctx){if(1&rf&&(core.j41(0,"div")(1,"div",8)(2,"div",6)(3,"label"),core.EFF(4),core.nI1(5,"translate"),core.k0s()()(),core.j41(6,"div",31)(7,"span",32),core.DNE(8,SystemWideAlertFormComponent_div_33_span_8_Template,3,3,"span",15)(9,SystemWideAlertFormComponent_div_33_span_9_Template,3,6,"span",15)(10,SystemWideAlertFormComponent_div_33_span_10_Template,3,6,"span",15)(11,SystemWideAlertFormComponent_div_33_span_11_Template,3,6,"span",15),core.k0s(),core.nrm(12,"span",33),core.k0s()()),2&rf){const ctx_r0=core.XpG();core.R7$(4),core.JRh(core.bMT(5,6,"system-wide-alert.form.label.preview")),core.R7$(4),core.Y8G("ngIf",ctx_r0.previewDays>0||ctx_r0.previewHours>0||ctx_r0.previewMinutes>0),core.R7$(),core.Y8G("ngIf",ctx_r0.previewDays>0),core.R7$(),core.Y8G("ngIf",ctx_r0.previewDays>0||ctx_r0.previewHours>0),core.R7$(),core.Y8G("ngIf",ctx_r0.previewDays>0||ctx_r0.previewHours>0||ctx_r0.previewMinutes>0),core.R7$(),core.Y8G("innerHTML",ctx_r0.formMessage.value,core.npT)}}const ROUTES=[{path:"",canActivate:[site_administrator_guard.Y],component:(()=>{class SystemWideAlertFormComponent2{constructor(systemWideAlertDataService,notificationsService,router2,requestService,translateService){this.systemWideAlertDataService=systemWideAlertDataService,this.notificationsService=notificationsService,this.router=router2,this.requestService=requestService,this.translateService=translateService,this.counterEnabled$=new cjs.BehaviorSubject(!1)}ngOnInit(){this.systemWideAlert$=this.systemWideAlertDataService.findAll().pipe((0,shared_operators.qD)(),(0,operators.Tj)(rd=>{if(rd.hasSucceeded)return rd.payload;this.notificationsService.error("system-wide-alert-form.retrieval.error")}),(0,operators.Tj)(payload=>payload.page),(0,operators.pb)(page=>(0,empty_util.hj)(page)),(0,operators.Tj)(page=>page[0])),this.createForm();const currentDate=new Date;this.minDate={year:currentDate.getFullYear(),month:currentDate.getMonth()+1,day:currentDate.getDate()},this.systemWideAlert$.subscribe(alert=>{this.currentAlert=alert,this.initFormValues(alert)})}createForm(){this.alertForm=(new fesm2022_forms.ze).group({formMessage:new fesm2022_forms.hs("",{validators:[fesm2022_forms.k0.required]}),formActive:new fesm2022_forms.hs(!1)}),this.setDateTime(new Date)}initFormValues(alert){this.formMessage.patchValue(alert.message),this.formActive.patchValue(alert.active);const countDownTo=(0,date_fns_tz.zonedTimeToUtc)(alert.countdownTo,"UTC");countDownTo.getTime()-(new Date).getTime()>0&&(this.counterEnabled$.next(!0),this.setDateTime(countDownTo))}setActive(active){this.formActive.patchValue(active),this.save(!1)}setCounterEnabled(enabled){this.counterEnabled$.next(enabled),enabled?this.updatePreviewTime():(this.previewMinutes=0,this.previewHours=0,this.previewDays=0)}setDateTime(dateToSet){this.time={hour:dateToSet.getHours(),minute:dateToSet.getMinutes()},this.date={year:dateToSet.getFullYear(),month:dateToSet.getMonth()+1,day:dateToSet.getDate()},this.updatePreviewTime()}updatePreviewTime(){const timeDifference=new Date(this.date.year,this.date.month-1,this.date.day,this.time.hour,this.time.minute).getTime()-(new Date).getTime();this.allocateTimeUnits(timeDifference)}allocateTimeUnits(timeDifference){this.previewMinutes=Math.floor(timeDifference/6e4%60),this.previewHours=Math.floor(timeDifference/36e5%24),this.previewDays=Math.floor(timeDifference/864e5)}get formMessage(){return this.alertForm.get("formMessage")}get formActive(){return this.alertForm.get("formActive")}save(navigateToHomePage=!0){const alert=new SystemWideAlert;if(alert.message=this.formMessage.value,alert.active=this.formActive.value,this.counterEnabled$.getValue()){const countDownTo=new Date(this.date.year,this.date.month-1,this.date.day,this.time.hour,this.time.minute);alert.countdownTo=(0,date_fns_tz.utcToZonedTime)(countDownTo,"UTC").toUTCString()}else alert.countdownTo=null;if(this.alertForm.valid)if((0,empty_util.a4)(this.currentAlert)){const updatedAlert=Object.assign(new SystemWideAlert,this.currentAlert,alert);this.handleResponse(this.systemWideAlertDataService.put(updatedAlert),"system-wide-alert.form.update",navigateToHomePage)}else this.handleResponse(this.systemWideAlertDataService.create(alert),"system-wide-alert.form.create",navigateToHomePage)}handleResponse(response$,messagePrefix,navigateToHomePage){response$.pipe((0,shared_operators.qD)()).subscribe(response=>{response.hasSucceeded?(this.notificationsService.success(this.translateService.get(`${messagePrefix}.success`)),this.requestService.setStaleByHrefSubstring("systemwidealerts"),navigateToHomePage&&this.back()):this.notificationsService.error(this.translateService.get(`${messagePrefix}.error`,response.errorMessage))})}back(){this.router.navigate(["/home"])}static#_=this.\u0275fac=function(t){return new(t||SystemWideAlertFormComponent2)(core.rXU(system_wide_alert_data_service.SystemWideAlertDataService),core.rXU(notifications_service.I),core.rXU(router.Ix),core.rXU(request_service.B),core.rXU(ngx_translate_core.c$))};static#_2=this.\u0275cmp=core.VBU({type:SystemWideAlertFormComponent2,selectors:[["ds-system-wide-alert-form"]],standalone:!0,features:[core.aNF],decls:43,vars:41,consts:[["d","ngbDatepicker"],[1,"container"],["id","header"],[3,"formGroup"],[1,"form-group"],[1,"row","mb-2"],[1,"col"],[3,"change","checkedLabel","uncheckedLabel","checked"],[1,"row"],["for","formMessage"],["id","formMessage","rows","5","formControlName","formMessage",3,"className"],["class","invalid-feedback show-feedback",4,"ngIf"],[1,"col","mb-2","d-flex","align-items-end"],["size","small",3,"change","ariaLabel","checked"],[1,"ml-2"],[4,"ngIf"],[1,"mb-2"],[1,"text-muted"],[1,"btn-row","float-right","space-children-mr","mt-2"],[1,"btn","btn-outline-secondary",3,"click"],[1,"fas","fa-arrow-left"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-save"],[1,"invalid-feedback","show-feedback"],[1,"col-sm-12","col-md-6"],[1,"input-group"],["placeholder","yyyy-mm-dd","name","dp","ngbDatepicker","",1,"form-control",3,"ngModelChange","ngModel","minDate"],["type","button",1,"btn","btn-outline-secondary","fas","fa-calendar",3,"click"],[1,"col-12","d-md-none"],[3,"ngModelChange","ngModel"],[1,"d-none","d-md-block","col-md-6","timepicker-margin"],[1,"rounded-0","alert","alert-warning"],[1,"font-weight-bold"],[3,"innerHTML"]],template:function(rf,ctx){1&rf&&(core.j41(0,"div",1)(1,"h1",2),core.EFF(2),core.nI1(3,"translate"),core.k0s(),core.j41(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"ui-switch",7),core.nI1(9,"translate"),core.nI1(10,"translate"),core.bIt("change",function($event){return ctx.setActive($event)}),core.k0s()()(),core.j41(11,"div",8)(12,"div",6)(13,"label",9),core.EFF(14),core.nI1(15,"translate"),core.k0s(),core.j41(16,"textarea",10),core.EFF(17,"                "),core.k0s(),core.DNE(18,SystemWideAlertFormComponent_div_18_Template,2,1,"div",11),core.k0s()()()(),core.j41(19,"div",8)(20,"div",12)(21,"ui-switch",13),core.nI1(22,"translate"),core.nI1(23,"async"),core.bIt("change",function($event){return ctx.setCounterEnabled($event)}),core.k0s(),core.j41(24,"span",14),core.EFF(25),core.nI1(26,"translate"),core.k0s()()(),core.DNE(27,SystemWideAlertFormComponent_div_27_Template,14,7,"div",15),core.nI1(28,"async"),core.j41(29,"div",16)(30,"span",17),core.EFF(31),core.nI1(32,"translate"),core.k0s()(),core.DNE(33,SystemWideAlertFormComponent_div_33_Template,13,8,"div",15),core.j41(34,"div",18)(35,"button",19),core.bIt("click",function(){return ctx.back()}),core.nrm(36,"i",20),core.EFF(37),core.nI1(38,"translate"),core.k0s(),core.j41(39,"button",21),core.bIt("click",function(){return ctx.save()}),core.nrm(40,"i",22),core.EFF(41),core.nI1(42,"translate"),core.k0s()()()),2&rf&&(core.R7$(2),core.JRh(core.bMT(3,19,"system-wide-alert.form.header")),core.R7$(2),core.HbH("ng-invalid"),core.Y8G("formGroup",ctx.alertForm),core.R7$(4),core.Y8G("checkedLabel",core.bMT(9,21,"system-wide-alert.form.label.active"))("uncheckedLabel",core.bMT(10,23,"system-wide-alert.form.label.inactive"))("checked",ctx.formActive.value),core.R7$(6),core.JRh(core.bMT(15,25,"system-wide-alert.form.label.message")),core.R7$(2),core.Y8G("className",ctx.formMessage.invalid&&(ctx.formMessage.dirty||ctx.formMessage.touched)?"form-control is-invalid":"form-control"),core.R7$(2),core.Y8G("ngIf",ctx.formMessage.invalid&&(ctx.formMessage.dirty||ctx.formMessage.touched)),core.R7$(3),core.Y8G("ariaLabel",core.bMT(22,27,"system-wide-alert.form.label.countdownTo.enable"))("checked",core.bMT(23,29,ctx.counterEnabled$)),core.R7$(4),core.JRh(core.bMT(26,31,"system-wide-alert.form.label.countdownTo.enable")),core.R7$(2),core.Y8G("ngIf",core.bMT(28,33,ctx.counterEnabled$)),core.R7$(4),core.JRh(core.bMT(32,35,"system-wide-alert.form.label.countdownTo.hint")),core.R7$(2),core.Y8G("ngIf",ctx.formMessage.value),core.R7$(4),core.SpI(" ",core.bMT(38,37,"system-wide-alert.form.cancel")," "),core.R7$(2),core.Y8G("disabled",ctx.alertForm.invalid),core.R7$(2),core.SpI(" ",core.bMT(42,39,"system-wide-alert.form.save")," "))},dependencies:[fesm2022_forms.YN,fesm2022_forms.me,fesm2022_forms.BC,fesm2022_forms.cb,fesm2022_forms.vS,fesm2022_forms.X1,fesm2022_forms.j4,fesm2022_forms.JD,ngx_ui_switch.z,ngx_ui_switch.S,common.bT,ng_bootstrap.IQ,ng_bootstrap.cw,ng_bootstrap.tJ,ng_bootstrap.Pe,common.Jj,ngx_translate_core.h,ngx_translate_core.D9],styles:[".timepicker-margin[_ngcontent-%COMP%]{margin-top:-38px}"]})}return SystemWideAlertFormComponent2})()}]}};